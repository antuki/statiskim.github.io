---
layout: post
comments : true
title: "Importer des données du site de l'Insee grâce à rsdmx"
tags: [Open data et open source, S'amuser sur R]
---
 
L'Insee diffuse en OpenData les données de sa banque de données macro-économique (BDM) (http://www.bdm.insee.fr/bdm2/index) dans un format appelé SDMX. L'idée de ce format utilisant la syntaxe XML est de promouvoir la diffusion et les échanges de données statistiques à un niveau européen (promu par Eurostat, le FMI, l'OCDE...)

J'ai ici récupéré les données de taux de mortalité des plus de 65 ans par département et en faire un graphique d'évolution pour le département de la Seine-Maritime. J'ai également utilisé ces mêmes données dans un article visant à apprendre à réaliser des gif de cartes interactives sur R. 

<!--break-->

Pour récupérer les données sur le site de l'Insee, plusieurs méthodes s'offrent à vous : 

- Vous pouvez repérer sur la BDM un identifiant appelé idbank (ici 001745064) associé aux données et utiliser ensuite la fonction readSDMX du package rsdmx (cf. cet article du bloc nc233)

http://www.bdm.insee.fr/bdm2/affichageSeries?idbank=001745064&codeGroupe=1702

- Vous pouvez utiliser le package RJSDMX et en particulier la fonction sdmxHelp() pour explorer les données présentes en SDMX sur le site de l'Insee. Il suffit de choisir INSEE après avoir cliqué sur providers puis, après avoir choisi les données et filtré les dimensions, cliquer sur action > Buid commands et récupérer la requête R à appliquer.

image1
image2

```r
#install.packages("rsdmx")
library(rsdmx)
library(RJSDMX)
library(plyr)
#sdmxHelp()

#Téléchargement des données de mortalité de la BDM
base_bdm <- "http://www.bdm.insee.fr/series/sdmx/data/FR1,TAUX-MORTALITE-AGE-DEP,1.0/65-."
#result = getTimeSeries('INSEE', 'TAUX-MORTALITE-AGE-DEP/65-.'); #autre possibilité du package RJSDMX
base_bdm <- readSDMX(base_bdm) #on récupère un data.frame des données de la BDM
base_bdm <- as.data.frame(base_bdm)
base_bdm<- base_bdm[which(base_bdm$AGE=="65-"),c("DEPARTEMENT","OBS_VALUE","TIME_PERIOD")]
base_bdm$OBS_VALUE <- as.numeric(base_bdm$OBS_VALUE)
base_bdm$TIME_PERIOD <- as.numeric(base_bdm$TIME_PERIOD)

library(ggplot2)
plot_76 <- ggplot(base_bdm[which(base_bdm$DEPARTEMENT=="76"),], aes(x=TIME_PERIOD, y=OBS_VALUE)) + geom_line(colour="blue",size=2)+
  xlab("Année") + ylab("Taux de mortalité des plus de 65 ans (o/oo)") + labs(title="Taux de mortalité en Seine-Maritime")
print(plot_76)
```

![](figure/sdmx_fig1.png)<!-- -->
