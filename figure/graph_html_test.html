<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gZXZhbCgiKCIgKyB0YXNrICsgIikiKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQoKICAgIC8vIFN1cHBvcnQgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zLiBPbGQtc3R5bGUgY2xhc3MtYm91bmQKICAgIC8vIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldCAib2JqZWN0IiBwZXIgd2lkZ2V0IHBlciB0eXBlL2NsYXNzIG9mCiAgICAvLyB3aWRnZXQ7IHRoZSByZW5kZXJWYWx1ZSBhbmQgcmVzaXplIG1ldGhvZHMgb24gc3VjaCB3aWRnZXQgb2JqZWN0cwogICAgLy8gdGFrZSBlbCBhbmQgaW5zdGFuY2UgYXJndW1lbnRzLCBiZWNhdXNlIHRoZSB3aWRnZXQgb2JqZWN0IGNhbid0CiAgICAvLyBzdG9yZSB0aGVtLiBOZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0CiAgICAvLyBvYmplY3QgcGVyIHdpZGdldCBpbnN0YW5jZTsgdGhlIGRlZmluaXRpb24gdGhhdCdzIHBhc3NlZCBpbiBkb2Vzbid0CiAgICAvLyBwcm92aWRlIHJlbmRlclZhbHVlIG9yIHJlc2l6ZSBtZXRob2RzIGF0IGFsbCwganVzdCB0aGUgc2luZ2xlIG1ldGhvZAogICAgLy8gICBmYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KQogICAgLy8gd2hpY2ggcmV0dXJucyBhbiBvYmplY3QgdGhhdCBoYXMgcmVuZGVyVmFsdWUoeCkgYW5kIHJlc2l6ZSh3LCBoKS4KICAgIC8vIFRoaXMgZW5hYmxlcyBhIGZhciBtb3JlIG5hdHVyYWwgcHJvZ3JhbW1pbmcgc3R5bGUgZm9yIHRoZSB3aWRnZXQKICAgIC8vIGF1dGhvciwgd2hvIGNhbiBzdG9yZSBwZXItaW5zdGFuY2Ugc3RhdGUgdXNpbmcgZWl0aGVyIE9PLXN0eWxlCiAgICAvLyBpbnN0YW5jZSBmaWVsZHMgb3IgZnVuY3Rpb25hbC1zdHlsZSBjbG9zdXJlIHZhcmlhYmxlcyAoSSBndWVzcyB0aGlzCiAgICAvLyBpcyBpbiBjb250cmFzdCB0byB3aGF0IGNhbiBvbmx5IGJlIGNhbGxlZCBDLXN0eWxlIHBzZXVkby1PTyB3aGljaCBpcwogICAgLy8gd2hhdCB3ZSByZXF1aXJlZCBiZWZvcmUpLgogICAgaWYgKGRlZmluaXRpb24uZmFjdG9yeSkgewogICAgICBkZWZpbml0aW9uID0gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmaW5pdGlvbik7CiAgICB9CgogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gd2l0aCBhbiBvdXRwdXQgYmluZGluZy4KICAgICAgLy8gVGhlIGRlZmluaXRpb24gaXRzZWxmIHdpbGwgbm90IGJlIHRoZSBvdXRwdXQgYmluZGluZywgaW5zdGVhZAogICAgICAvLyB3ZSB3aWxsIG1ha2UgYW4gb3V0cHV0IGJpbmRpbmcgb2JqZWN0IHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICAvLyBkZWZpbml0aW9uLiBUaGlzIGlzIGJlY2F1c2Ugd2UgZm9vbGlzaGx5IHVzZWQgdGhlIHNhbWUgbWV0aG9kCiAgICAgIC8vIG5hbWUgKHJlbmRlclZhbHVlKSBmb3IgaHRtbHdpZGdldHMgZGVmaW5pdGlvbiBhbmQgU2hpbnkgYmluZGluZ3MKICAgICAgLy8gYnV0IHRoZXkgYWN0dWFsbHkgaGF2ZSBxdWl0ZSBkaWZmZXJlbnQgc2VtYW50aWNzICh0aGUgU2hpbnkKICAgICAgLy8gYmluZGluZ3MgcmVjZWl2ZSBkYXRhIHRoYXQgaW5jbHVkZXMgbG90cyBvZiBtZXRhZGF0YSB0aGF0IGl0CiAgICAgIC8vIHN0cmlwcyBvZmYgYmVmb3JlIGNhbGxpbmcgaHRtbHdpZGdldHMgcmVuZGVyVmFsdWUpLiBXZSBjYW4ndAogICAgICAvLyBqdXN0IGlnbm9yZSB0aGUgZGlmZmVyZW5jZSBiZWNhdXNlIGluIHNvbWUgd2lkZ2V0cyBpdCdzIGhlbHBmdWwKICAgICAgLy8gdG8gY2FsbCB0aGlzLnJlbmRlclZhbHVlKCkgZnJvbSBpbnNpZGUgb2YgcmVzaXplKCksIGFuZCBpZgogICAgICAvLyB3ZSdyZSBub3QgZGVsZWdhdGluZywgdGhlbiB0aGF0IGNhbGwgd2lsbCBnbyB0byB0aGUgU2hpbnkKICAgICAgLy8gdmVyc2lvbiBpbnN0ZWFkIG9mIHRoZSBodG1sd2lkZ2V0cyB2ZXJzaW9uLgoKICAgICAgLy8gTWVyZ2UgZGVmYXVsdHMgd2l0aCBkZWZpbml0aW9uLCB3aXRob3V0IG11dGF0aW5nIGVpdGhlci4KICAgICAgdmFyIGJpbmRpbmdEZWYgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKCiAgICAgIC8vIFRoaXMgb2JqZWN0IHdpbGwgYmUgb3VyIGFjdHVhbCBTaGlueSBiaW5kaW5nLgogICAgICB2YXIgc2hpbnlCaW5kaW5nID0gbmV3IFNoaW55Lk91dHB1dEJpbmRpbmcoKTsKCiAgICAgIC8vIFdpdGggYSBmZXcgZXhjZXB0aW9ucywgd2UnbGwgd2FudCB0byBzaW1wbHkgdXNlIHRoZSBiaW5kaW5nRGVmJ3MKICAgICAgLy8gdmVyc2lvbiBvZiBtZXRob2RzIGlmIHRoZXkgYXJlIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0bwogICAgICAvLyBTaGlueSdzIGRlZmF1bHRzLiBOT1RFOiBJZiBTaGlueSdzIG91dHB1dCBiaW5kaW5ncyBnYWluIGFkZGl0aW9uYWwKICAgICAgLy8gbWV0aG9kcyBpbiB0aGUgZnV0dXJlLCBhbmQgd2Ugd2FudCB0aGVtIHRvIGJlIG92ZXJyaWRlYWJsZSBieQogICAgICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcgZGVmaW5pdGlvbnMsIHRoZW4gd2UnbGwgbmVlZCB0byBhZGQgdGhlbSB0byB0aGlzCiAgICAgIC8vIGxpc3QuCiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImdldElkIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVDaGFuZ2UiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInJlbmRlckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImNsZWFyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAic2hvd1Byb2dyZXNzIik7CgogICAgICAvLyBUaGUgZmluZCwgcmVuZGVyVmFsdWUsIGFuZCByZXNpemUgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHksIGJlY2F1c2Ugd2UKICAgICAgLy8gd2FudCB0byBhY3R1YWxseSBkZWNvcmF0ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIGJpbmRpbmdEZWYgbWV0aG9kcy4KCiAgICAgIHNoaW55QmluZGluZy5maW5kID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IGJpbmRpbmdEZWYuZmluZChzY29wZSk7CgogICAgICAgIC8vIE9ubHkgcmV0dXJuIGVsZW1lbnRzIHRoYXQgYXJlIFNoaW55IG91dHB1dHMsIG5vdCBzdGF0aWMgb25lcwogICAgICAgIHZhciBkeW5hbWljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKCIuaHRtbC13aWRnZXQtb3V0cHV0Iik7CgogICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAvLyBuZXcgZHluYW1pYyBvdXRwdXRzLCBhbHNvIGNhdXNlZCB0aGVyZSB0byBiZSBuZXcgc3RhdGljIG91dHB1dHMuCiAgICAgICAgLy8gU2luY2UgdGhlcmUgbWlnaHQgYmUgbG90cyBvZiBkaWZmZXJlbnQgaHRtbHdpZGdldHMgYmluZGluZ3MsIHdlCiAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAvLyB0aW1lcy4KICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT09IGR5bmFtaWNSZXN1bHRzLmxlbmd0aCkKICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgIHJldHVybiBkeW5hbWljUmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIFdyYXAgcmVuZGVyVmFsdWUgdG8gaGFuZGxlIGluaXRpYWxpemF0aW9uLCB3aGljaCB1bmZvcnR1bmF0ZWx5IGlzbid0CiAgICAgIC8vIHN1cHBvcnRlZCBuYXRpdmVseSBieSBTaGlueSBhdCB0aGUgdGltZSBvZiB0aGlzIHdyaXRpbmcuCgogICAgICBzaGlueUJpbmRpbmcucmVuZGVyVmFsdWUgPSBmdW5jdGlvbihlbCwgZGF0YSkgewogICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgZGF0YS5ldmFscyAmJiBpIDwgZGF0YS5ldmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIGlmICghYmluZGluZ0RlZi5yZW5kZXJPbk51bGxWYWx1ZSkgewogICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaW5oZXJpdCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICBpbml0U2l6aW5nKGVsKTsKCiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICBpZiAoYmluZGluZ0RlZi5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBiaW5kaW5nRGVmLmluaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBTaGlueS5yZW5kZXJEZXBlbmRlbmNpZXMoZGF0YS5kZXBzKTsKICAgICAgICBiaW5kaW5nRGVmLnJlbmRlclZhbHVlKGVsLCBkYXRhLngsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiksIFtlbCwgZGF0YS54XSk7CiAgICAgIH07CgogICAgICAvLyBPbmx5IG92ZXJyaWRlIHJlc2l6ZSBpZiBiaW5kaW5nRGVmIGltcGxlbWVudHMgaXQKICAgICAgaWYgKGJpbmRpbmdEZWYucmVzaXplKSB7CiAgICAgICAgc2hpbnlCaW5kaW5nLnJlc2l6ZSA9IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAvLyBTaGlueSBjYW4gY2FsbCByZXNpemUgYmVmb3JlIGluaXRpYWxpemUvcmVuZGVyVmFsdWUgaGF2ZSBiZWVuCiAgICAgICAgICAvLyBjYWxsZWQsIHdoaWNoIGRvZXNuJ3QgbWFrZSBzZW5zZSBmb3Igd2lkZ2V0cy4KICAgICAgICAgIGlmIChlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIikpIHsKICAgICAgICAgICAgYmluZGluZ0RlZi5yZXNpemUoZWwsIHdpZHRoLCBoZWlnaHQsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgU2hpbnkub3V0cHV0QmluZGluZ3MucmVnaXN0ZXIoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLm5hbWUpOwogICAgfQogIH07CgogIHZhciBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogIGZ1bmN0aW9uIHNjaGVkdWxlU3RhdGljUmVuZGVyKCkgewogICAgaWYgKCFzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQpIHsKICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfSwgMSk7CiAgICB9CiAgfQoKICAvLyBSZW5kZXIgc3RhdGljIHdpZGdldHMgYWZ0ZXIgdGhlIGRvY3VtZW50IGZpbmlzaGVzIGxvYWRpbmcKICAvLyBTdGF0aWNhbGx5IHJlbmRlciBhbGwgZWxlbWVudHMgdGhhdCBhcmUgb2YgdGhpcyB3aWRnZXQncyBjbGFzcwogIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiaW5kaW5ncyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgZm9yRWFjaChiaW5kaW5ncywgZnVuY3Rpb24oYmluZGluZykgewogICAgICB2YXIgbWF0Y2hlcyA9IGJpbmRpbmcuZmluZChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgICBmb3JFYWNoKG1hdGNoZXMsIGZ1bmN0aW9uKGVsKSB7CiAgICAgICAgdmFyIHNpemVPYmogPSBpbml0U2l6aW5nKGVsLCBiaW5kaW5nKTsKCiAgICAgICAgaWYgKGhhc0NsYXNzKGVsLCAiaHRtbC13aWRnZXQtc3RhdGljLWJvdW5kIikpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lICsgIiBodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiOwoKICAgICAgICB2YXIgaW5pdFJlc3VsdDsKICAgICAgICBpZiAoYmluZGluZy5pbml0aWFsaXplKSB7CiAgICAgICAgICBpbml0UmVzdWx0ID0gYmluZGluZy5pbml0aWFsaXplKGVsLAogICAgICAgICAgICBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICApOwogICAgICAgICAgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIsIGluaXRSZXN1bHQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJpbmRpbmcucmVzaXplKSB7CiAgICAgICAgICB2YXIgbGFzdFNpemUgPSB7fTsKICAgICAgICAgIHZhciByZXNpemVIYW5kbGVyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgc2l6ZSA9IHsKICAgICAgICAgICAgICB3OiBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgaDogc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHNpemUudyA9PT0gMCAmJiBzaXplLmggPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSBsYXN0U2l6ZS53ICYmIHNpemUuaCA9PT0gbGFzdFNpemUuaCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGxhc3RTaXplID0gc2l6ZTsKICAgICAgICAgICAgYmluZGluZy5yZXNpemUoZWwsIHNpemUudywgc2l6ZS5oLCBpbml0UmVzdWx0KTsKICAgICAgICAgIH07CgogICAgICAgICAgb24od2luZG93LCAicmVzaXplIiwgcmVzaXplSGFuZGxlcik7CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIGNhc2VzIHdoZXJlIHdlJ3JlIHJ1bm5pbmcgaW4gYSBTaGlueQogICAgICAgICAgLy8gYXBwLCBidXQgdGhlIHdpZGdldCBpdHNlbGYgaXMgbm90IGEgU2hpbnkgb3V0cHV0LCBidXQKICAgICAgICAgIC8vIHJhdGhlciBhIHNpbXBsZSBzdGF0aWMgd2lkZ2V0LiBPbmUgZXhhbXBsZSBvZiB0aGlzIGlzCiAgICAgICAgICAvLyBhbiBybWFya2Rvd24gZG9jdW1lbnQgdGhhdCBoYXMgcnVudGltZTpzaGlueSBhbmQgd2lkZ2V0CiAgICAgICAgICAvLyB0aGF0IGlzbid0IGluIGEgcmVuZGVyIGZ1bmN0aW9uLiBTaGlueSBvbmx5IGtub3dzIHRvCiAgICAgICAgICAvLyBjYWxsIHJlc2l6ZSBoYW5kbGVycyBmb3IgU2hpbnkgb3V0cHV0cywgbm90IGZvciBzdGF0aWMKICAgICAgICAgIC8vIHdpZGdldHMsIHNvIHdlIGRvIGl0IG91cnNlbHZlcy4KICAgICAgICAgIGlmICh3aW5kb3cualF1ZXJ5KSB7CiAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkoZG9jdW1lbnQpLm9uKAogICAgICAgICAgICAgICJzaG93bi5odG1sd2lkZ2V0cyBzaG93bi5icy50YWIuaHRtbHdpZGdldHMgc2hvd24uYnMuY29sbGFwc2UuaHRtbHdpZGdldHMiLAogICAgICAgICAgICAgIHJlc2l6ZUhhbmRsZXIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oCiAgICAgICAgICAgICAgImhpZGRlbi5odG1sd2lkZ2V0cyBoaWRkZW4uYnMudGFiLmh0bWx3aWRnZXRzIGhpZGRlbi5icy5jb2xsYXBzZS5odG1sd2lkZ2V0cyIsCiAgICAgICAgICAgICAgcmVzaXplSGFuZGxlcgogICAgICAgICAgICApOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFRoaXMgaXMgbmVlZGVkIGZvciB0aGUgc3BlY2lmaWMgY2FzZSBvZiBpb3NsaWRlcywgd2hpY2gKICAgICAgICAgIC8vIGZsaXBzIHNsaWRlcyBiZXR3ZWVuIGRpc3BsYXk6bm9uZSBhbmQgZGlzcGxheTpibG9jay4KICAgICAgICAgIC8vIElkZWFsbHkgd2Ugd291bGQgbm90IGhhdmUgdG8gaGF2ZSBpb3NsaWRlLXNwZWNpZmljIGNvZGUKICAgICAgICAgIC8vIGhlcmUsIGJ1dCByYXRoZXIgaGF2ZSBpb3NsaWRlcyByYWlzZSBhIGdlbmVyaWMgZXZlbnQsCiAgICAgICAgICAvLyBidXQgdGhlIHJtYXJrZG93biBwYWNrYWdlIGp1c3Qgd2VudCB0byBDUkFOIHNvIHRoZQogICAgICAgICAgLy8gd2luZG93IHRvIGdldHRpbmcgdGhhdCBmaXhlZCBtYXkgYmUgbG9uZy4KICAgICAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgICAvLyBJdCdzIE9LIHRvIGxpbWl0IHRoaXMgdG8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIKICAgICAgICAgICAgLy8gYnJvd3NlcnMgYmVjYXVzZSBpb3NsaWRlcyBpdHNlbGYgb25seSBzdXBwb3J0cwogICAgICAgICAgICAvLyBzdWNoIGJyb3dzZXJzLgogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlZW50ZXIiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgICAgb24oZG9jdW1lbnQsICJzbGlkZWxlYXZlIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgc2NyaXB0RGF0YSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInNjcmlwdFtkYXRhLWZvcj0nIiArIGVsLmlkICsgIiddW3R5cGU9J2FwcGxpY2F0aW9uL2pzb24nXSIpOwogICAgICAgIGlmIChzY3JpcHREYXRhKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2Uoc2NyaXB0RGF0YS50ZXh0Q29udGVudCB8fCBzY3JpcHREYXRhLnRleHQpOwogICAgICAgICAgLy8gUmVzb2x2ZSBzdHJpbmdzIG1hcmtlZCBhcyBqYXZhc2NyaXB0IGxpdGVyYWxzIHRvIG9iamVjdHMKICAgICAgICAgIGlmICghKGRhdGEuZXZhbHMgaW5zdGFuY2VvZiBBcnJheSkpIGRhdGEuZXZhbHMgPSBbZGF0YS5ldmFsc107CiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgZGF0YS5ldmFscyAmJiBrIDwgZGF0YS5ldmFscy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIoZGF0YS54LCBkYXRhLmV2YWxzW2tdKTsKICAgICAgICAgIH0KICAgICAgICAgIGJpbmRpbmcucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgaW5pdFJlc3VsdCk7CiAgICAgICAgICBldmFsQW5kUnVuKGRhdGEuanNIb29rcy5yZW5kZXIsIGluaXRSZXN1bHQsIFtlbCwgZGF0YS54XSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpOwogIH0KCiAgLy8gV2FpdCB1bnRpbCBhZnRlciB0aGUgZG9jdW1lbnQgaGFzIGxvYWRlZCB0byByZW5kZXIgdGhlIHdpZGdldHMuCiAgaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbigpIHsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGFyZ3VtZW50cy5jYWxsZWUsIGZhbHNlKTsKICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgfSwgZmFsc2UpOwogIH0gZWxzZSBpZiAoZG9jdW1lbnQuYXR0YWNoRXZlbnQpIHsKICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIpIHsKICAgICAgICBkb2N1bWVudC5kZXRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgYXJndW1lbnRzLmNhbGxlZSk7CiAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgICB9CiAgICB9KTsKICB9CgoKICB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0QXR0YWNobWVudFVybCA9IGZ1bmN0aW9uKGRlcG5hbWUsIGtleSkgewogICAgLy8gSWYgbm8ga2V5LCBkZWZhdWx0IHRvIHRoZSBmaXJzdCBpdGVtCiAgICBpZiAodHlwZW9mKGtleSkgPT09ICJ1bmRlZmluZWQiKQogICAgICBrZXkgPSAxOwoKICAgIHZhciBsaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGVwbmFtZSArICItIiArIGtleSArICItYXR0YWNobWVudCIpOwogICAgaWYgKCFsaW5rKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQXR0YWNobWVudCAiICsgZGVwbmFtZSArICIvIiArIGtleSArICIgbm90IGZvdW5kIGluIGRvY3VtZW50Iik7CiAgICB9CiAgICByZXR1cm4gbGluay5nZXRBdHRyaWJ1dGUoImhyZWYiKTsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMuZGF0YWZyYW1lVG9EMyA9IGZ1bmN0aW9uKGRmKSB7CiAgICB2YXIgbmFtZXMgPSBbXTsKICAgIHZhciBsZW5ndGg7CiAgICBmb3IgKHZhciBuYW1lIGluIGRmKSB7CiAgICAgICAgaWYgKGRmLmhhc093blByb3BlcnR5KG5hbWUpKQogICAgICAgICAgICBuYW1lcy5wdXNoKG5hbWUpOwogICAgICAgIGlmICh0eXBlb2YoZGZbbmFtZV0pICE9PSAib2JqZWN0IiB8fCB0eXBlb2YoZGZbbmFtZV0ubGVuZ3RoKSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgZmllbGRzIG11c3QgYmUgYXJyYXlzIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YobGVuZ3RoKSAhPT0gInVuZGVmaW5lZCIgJiYgbGVuZ3RoICE9PSBkZltuYW1lXS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgZmllbGRzIG11c3QgYmUgYXJyYXlzIG9mIHRoZSBzYW1lIGxlbmd0aCIpOwogICAgICAgIH0KICAgICAgICBsZW5ndGggPSBkZltuYW1lXS5sZW5ndGg7CiAgICB9CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGl0ZW07CiAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBsZW5ndGg7IHJvdysrKSB7CiAgICAgICAgaXRlbSA9IHt9OwogICAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG5hbWVzLmxlbmd0aDsgY29sKyspIHsKICAgICAgICAgICAgaXRlbVtuYW1lc1tjb2xdXSA9IGRmW25hbWVzW2NvbF1dW3Jvd107CiAgICAgICAgfQogICAgICAgIHJlc3VsdHMucHVzaChpdGVtKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIHdpbmRvdy5IVE1MV2lkZ2V0cy50cmFuc3Bvc2VBcnJheTJEID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIGFycmF5OwogICAgICB2YXIgbmV3QXJyYXkgPSBhcnJheVswXS5tYXAoZnVuY3Rpb24oY29sLCBpKSB7CiAgICAgICAgICByZXR1cm4gYXJyYXkubWFwKGZ1bmN0aW9uKHJvdykgewogICAgICAgICAgICAgIHJldHVybiByb3dbaV0KICAgICAgICAgIH0pCiAgICAgIH0pOwogICAgICByZXR1cm4gbmV3QXJyYXk7CiAgfTsKICAvLyBTcGxpdCB2YWx1ZSBhdCBzcGxpdENoYXIsIGJ1dCBhbGxvdyBzcGxpdENoYXIgdG8gYmUgZXNjYXBlZAogIC8vIHVzaW5nIGVzY2FwZUNoYXIuIEFueSBvdGhlciBjaGFyYWN0ZXJzIGVzY2FwZWQgYnkgZXNjYXBlQ2hhcgogIC8vIHdpbGwgYmUgaW5jbHVkZWQgYXMgdXN1YWwgKGluY2x1ZGluZyBlc2NhcGVDaGFyIGl0c2VsZikuCiAgZnVuY3Rpb24gc3BsaXRXaXRoRXNjYXBlKHZhbHVlLCBzcGxpdENoYXIsIGVzY2FwZUNoYXIpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICB2YXIgZXNjYXBlTW9kZSA9IGZhbHNlOwogICAgdmFyIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgIGZvciAodmFyIHBvcyA9IDA7IHBvcyA8IHZhbHVlLmxlbmd0aDsgcG9zKyspIHsKICAgICAgaWYgKCFlc2NhcGVNb2RlKSB7CiAgICAgICAgaWYgKHZhbHVlW3Bvc10gPT09IHNwbGl0Q2hhcikgewogICAgICAgICAgcmVzdWx0cy5wdXNoKGN1cnJlbnRSZXN1bHQpOwogICAgICAgICAgY3VycmVudFJlc3VsdCA9ICIiOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWVbcG9zXSA9PT0gZXNjYXBlQ2hhcikgewogICAgICAgICAgZXNjYXBlTW9kZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VycmVudFJlc3VsdCArPSB2YWx1ZVtwb3NdOwogICAgICAgIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKGN1cnJlbnRSZXN1bHQgIT09ICIiKSB7CiAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH0KICAvLyBGdW5jdGlvbiBhdXRob3JlZCBieSBZaWh1aS9KSiBBbGxhaXJlCiAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyID0gZnVuY3Rpb24obywgbWVtYmVyKSB7CiAgICB2YXIgcGFydHMgPSBzcGxpdFdpdGhFc2NhcGUobWVtYmVyLCAnLicsICdcXCcpOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIHBhcnQgPSBwYXJ0c1tpXTsKICAgICAgLy8gcGFydCBtYXkgYmUgYSBjaGFyYWN0ZXIgb3IgJ251bWVyaWMnIG1lbWJlciBuYW1lCiAgICAgIGlmIChvICE9PSBudWxsICYmIHR5cGVvZiBvID09PSAib2JqZWN0IiAmJiBwYXJ0IGluIG8pIHsKICAgICAgICBpZiAoaSA9PSAobCAtIDEpKSB7IC8vIGlmIHdlIGFyZSBhdCB0aGUgZW5kIG9mIHRoZSBsaW5lIHRoZW4gZXZhbHVsYXRlCiAgICAgICAgICBpZiAodHlwZW9mIG9bcGFydF0gPT09ICJzdHJpbmciKQogICAgICAgICAgICBvW3BhcnRdID0gZXZhbCgiKCIgKyBvW3BhcnRdICsgIikiKTsKICAgICAgICB9IGVsc2UgeyAvLyBvdGhlcndpc2UgY29udGludWUgdG8gbmV4dCBlbWJlZGRlZCBvYmplY3QKICAgICAgICAgIG8gPSBvW3BhcnRdOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8vIFJldHJpZXZlIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YgYW4KICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCBhbiBlbGVtZW50LCBvciBudWxsIGlmIG5vbmUuCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlID0gZnVuY3Rpb24oZWwpIHsKICAgIHJldHVybiBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0Iik7CiAgfTsKCiAgLy8gRmluZHMgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2hlcyB0aGUgc2VsZWN0b3IsCiAgLy8gYW5kIHJldHVybnMgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2UgKGkuZS4gdGhlIHJldHVybiB2YWx1ZSBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoYXQgZWxlbWVudCwgaWYgYW55LiBJZiBubyBlbGVtZW50IG1hdGNoZXMgdGhlCiAgLy8gc2VsZWN0b3IsIG9yIHRoZSBmaXJzdCBtYXRjaGluZyBlbGVtZW50IGhhcyBubyBIVE1MV2lkZ2V0CiAgLy8gaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIGl0LCB0aGVuIG51bGwgaXMgcmV0dXJuZWQuCiAgLy8KICAvLyBUaGUgc2NvcGUgYXJndW1lbnQgaXMgb3B0aW9uYWwsIGFuZCBkZWZhdWx0cyB0byB3aW5kb3cuZG9jdW1lbnQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmZpbmQgPSBmdW5jdGlvbihzY29wZSwgc2VsZWN0b3IpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgc2VsZWN0b3IgPSBzY29wZTsKICAgICAgc2NvcGUgPSBkb2N1bWVudDsKICAgIH0KCiAgICB2YXIgZWwgPSBzY29wZS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgIGlmIChlbCA9PT0gbnVsbCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0SW5zdGFuY2UoZWwpOwogICAgfQogIH07CgogIC8vIEZpbmRzIGFsbCBlbGVtZW50cyBpbiB0aGUgc2NvcGUgdGhhdCBtYXRjaCB0aGUgc2VsZWN0b3IsIGFuZAogIC8vIHJldHVybnMgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2VzIChpLmUuIHRoZSByZXR1cm4gdmFsdWVzIG9mCiAgLy8gYW4gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggdGhlIGVsZW1lbnRzLCBpbiBhbiBhcnJheS4gSWYgZWxlbWVudHMgdGhhdAogIC8vIG1hdGNoIHRoZSBzZWxlY3RvciBkb24ndCBoYXZlIGFuIGFzc29jaWF0ZWQgSFRNTFdpZGdldAogIC8vIGluc3RhbmNlLCB0aGUgcmV0dXJuZWQgYXJyYXkgd2lsbCBjb250YWluIG51bGxzLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kQWxsID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIG5vZGVzID0gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykgewogICAgICByZXN1bHRzLnB1c2god2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKG5vZGVzW2ldKSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcG9zdFJlbmRlckhhbmRsZXJzID0gW107CiAgZnVuY3Rpb24gaW52b2tlUG9zdFJlbmRlckhhbmRsZXJzKCkgewogICAgd2hpbGUgKHBvc3RSZW5kZXJIYW5kbGVycy5sZW5ndGgpIHsKICAgICAgdmFyIGhhbmRsZXIgPSBwb3N0UmVuZGVySGFuZGxlcnMuc2hpZnQoKTsKICAgICAgaWYgKGhhbmRsZXIpIHsKICAgICAgICBoYW5kbGVyKCk7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIFJlZ2lzdGVyIHRoZSBnaXZlbiBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSBpbnZva2VkIGFmdGVyIHRoZQogIC8vIG5leHQgdGltZSBzdGF0aWMgd2lkZ2V0cyBhcmUgcmVuZGVyZWQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmFkZFBvc3RSZW5kZXJIYW5kbGVyID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHBvc3RSZW5kZXJIYW5kbGVycy5wdXNoKGNhbGxiYWNrKTsKICB9OwoKICAvLyBUYWtlcyBhIG5ldy1zdHlsZSBpbnN0YW5jZS1ib3VuZCBkZWZpbml0aW9uLCBhbmQgcmV0dXJucyBhbgogIC8vIG9sZC1zdHlsZSBjbGFzcy1ib3VuZCBkZWZpbml0aW9uLiBUaGlzIHNhdmVzIHVzIGZyb20gaGF2aW5nCiAgLy8gdG8gcmV3cml0ZSBhbGwgdGhlIGxvZ2ljIGluIHRoaXMgZmlsZSB0byBhY2NvbW9kYXRlIGJvdGgKICAvLyB0eXBlcyBvZiBkZWZpbml0aW9ucy4KICBmdW5jdGlvbiBjcmVhdGVMZWdhY3lEZWZpbml0aW9uQWRhcHRlcihkZWZuKSB7CiAgICB2YXIgcmVzdWx0ID0gewogICAgICBuYW1lOiBkZWZuLm5hbWUsCiAgICAgIHR5cGU6IGRlZm4udHlwZSwKICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICByZXR1cm4gZGVmbi5mYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgfSwKICAgICAgcmVuZGVyVmFsdWU6IGZ1bmN0aW9uKGVsLCB4LCBpbnN0YW5jZSkgewogICAgICAgIHJldHVybiBpbnN0YW5jZS5yZW5kZXJWYWx1ZSh4KTsKICAgICAgfSwKICAgICAgcmVzaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVzaXplKHdpZHRoLCBoZWlnaHQpOwogICAgICB9CiAgICB9OwoKICAgIGlmIChkZWZuLmZpbmQpCiAgICAgIHJlc3VsdC5maW5kID0gZGVmbi5maW5kOwogICAgaWYgKGRlZm4ucmVuZGVyRXJyb3IpCiAgICAgIHJlc3VsdC5yZW5kZXJFcnJvciA9IGRlZm4ucmVuZGVyRXJyb3I7CiAgICBpZiAoZGVmbi5jbGVhckVycm9yKQogICAgICByZXN1bHQuY2xlYXJFcnJvciA9IGRlZm4uY2xlYXJFcnJvcjsKCiAgICByZXR1cm4gcmVzdWx0OwogIH0KfSkoKTsKCg=="></script>
<script src="data:application/x-javascript;base64,LyohIGpRdWVyeSB2MS4xMS4zIHwgKGMpIDIwMDUsIDIwMTUgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gfCBqcXVlcnkub3JnL2xpY2Vuc2UgKi8KIWZ1bmN0aW9uKGEsYil7Im9iamVjdCI9PXR5cGVvZiBtb2R1bGUmJiJvYmplY3QiPT10eXBlb2YgbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9YS5kb2N1bWVudD9iKGEsITApOmZ1bmN0aW9uKGEpe2lmKCFhLmRvY3VtZW50KXRocm93IG5ldyBFcnJvcigialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIpO3JldHVybiBiKGEpfTpiKGEpfSgidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6dGhpcyxmdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQ9Yy5zbGljZSxlPWMuY29uY2F0LGY9Yy5wdXNoLGc9Yy5pbmRleE9mLGg9e30saT1oLnRvU3RyaW5nLGo9aC5oYXNPd25Qcm9wZXJ0eSxrPXt9LGw9IjEuMTEuMyIsbT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgbS5mbi5pbml0KGEsYil9LG49L15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nLG89L14tbXMtLyxwPS8tKFtcZGEtel0pL2dpLHE9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYi50b1VwcGVyQ2FzZSgpfTttLmZuPW0ucHJvdG90eXBlPXtqcXVlcnk6bCxjb25zdHJ1Y3RvcjptLHNlbGVjdG9yOiIiLGxlbmd0aDowLHRvQXJyYXk6ZnVuY3Rpb24oKXtyZXR1cm4gZC5jYWxsKHRoaXMpfSxnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGwhPWE/MD5hP3RoaXNbYSt0aGlzLmxlbmd0aF06dGhpc1thXTpkLmNhbGwodGhpcyl9LHB1c2hTdGFjazpmdW5jdGlvbihhKXt2YXIgYj1tLm1lcmdlKHRoaXMuY29uc3RydWN0b3IoKSxhKTtyZXR1cm4gYi5wcmV2T2JqZWN0PXRoaXMsYi5jb250ZXh0PXRoaXMuY29udGV4dCxifSxlYWNoOmZ1bmN0aW9uKGEsYil7cmV0dXJuIG0uZWFjaCh0aGlzLGEsYil9LG1hcDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2sobS5tYXAodGhpcyxmdW5jdGlvbihiLGMpe3JldHVybiBhLmNhbGwoYixjLGIpfSkpfSxzbGljZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnB1c2hTdGFjayhkLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9LGZpcnN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXEoMCl9LGxhc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgtMSl9LGVxOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMubGVuZ3RoLGM9K2ErKDA+YT9iOjApO3JldHVybiB0aGlzLnB1c2hTdGFjayhjPj0wJiZiPmM/W3RoaXNbY11dOltdKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpmLHNvcnQ6Yy5zb3J0LHNwbGljZTpjLnNwbGljZX0sbS5leHRlbmQ9bS5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgYSxiLGMsZCxlLGYsZz1hcmd1bWVudHNbMF18fHt9LGg9MSxpPWFyZ3VtZW50cy5sZW5ndGgsaj0hMTtmb3IoImJvb2xlYW4iPT10eXBlb2YgZyYmKGo9ZyxnPWFyZ3VtZW50c1toXXx8e30saCsrKSwib2JqZWN0Ij09dHlwZW9mIGd8fG0uaXNGdW5jdGlvbihnKXx8KGc9e30pLGg9PT1pJiYoZz10aGlzLGgtLSk7aT5oO2grKylpZihudWxsIT0oZT1hcmd1bWVudHNbaF0pKWZvcihkIGluIGUpYT1nW2RdLGM9ZVtkXSxnIT09YyYmKGomJmMmJihtLmlzUGxhaW5PYmplY3QoYyl8fChiPW0uaXNBcnJheShjKSkpPyhiPyhiPSExLGY9YSYmbS5pc0FycmF5KGEpP2E6W10pOmY9YSYmbS5pc1BsYWluT2JqZWN0KGEpP2E6e30sZ1tkXT1tLmV4dGVuZChqLGYsYykpOnZvaWQgMCE9PWMmJihnW2RdPWMpKTtyZXR1cm4gZ30sbS5leHRlbmQoe2V4cGFuZG86ImpRdWVyeSIrKGwrTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywiIiksaXNSZWFkeTohMCxlcnJvcjpmdW5jdGlvbihhKXt0aHJvdyBuZXcgRXJyb3IoYSl9LG5vb3A6ZnVuY3Rpb24oKXt9LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuImZ1bmN0aW9uIj09PW0udHlwZShhKX0saXNBcnJheTpBcnJheS5pc0FycmF5fHxmdW5jdGlvbihhKXtyZXR1cm4iYXJyYXkiPT09bS50eXBlKGEpfSxpc1dpbmRvdzpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbCE9YSYmYT09YS53aW5kb3d9LGlzTnVtZXJpYzpmdW5jdGlvbihhKXtyZXR1cm4hbS5pc0FycmF5KGEpJiZhLXBhcnNlRmxvYXQoYSkrMT49MH0saXNFbXB0eU9iamVjdDpmdW5jdGlvbihhKXt2YXIgYjtmb3IoYiBpbiBhKXJldHVybiExO3JldHVybiEwfSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGEpe3ZhciBiO2lmKCFhfHwib2JqZWN0IiE9PW0udHlwZShhKXx8YS5ub2RlVHlwZXx8bS5pc1dpbmRvdyhhKSlyZXR1cm4hMTt0cnl7aWYoYS5jb25zdHJ1Y3RvciYmIWouY2FsbChhLCJjb25zdHJ1Y3RvciIpJiYhai5jYWxsKGEuY29uc3RydWN0b3IucHJvdG90eXBlLCJpc1Byb3RvdHlwZU9mIikpcmV0dXJuITF9Y2F0Y2goYyl7cmV0dXJuITF9aWYoay5vd25MYXN0KWZvcihiIGluIGEpcmV0dXJuIGouY2FsbChhLGIpO2ZvcihiIGluIGEpO3JldHVybiB2b2lkIDA9PT1ifHxqLmNhbGwoYSxiKX0sdHlwZTpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbD09YT9hKyIiOiJvYmplY3QiPT10eXBlb2YgYXx8ImZ1bmN0aW9uIj09dHlwZW9mIGE/aFtpLmNhbGwoYSldfHwib2JqZWN0Ijp0eXBlb2YgYX0sZ2xvYmFsRXZhbDpmdW5jdGlvbihiKXtiJiZtLnRyaW0oYikmJihhLmV4ZWNTY3JpcHR8fGZ1bmN0aW9uKGIpe2EuZXZhbC5jYWxsKGEsYil9KShiKX0sY2FtZWxDYXNlOmZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UobywibXMtIikucmVwbGFjZShwLHEpfSxub2RlTmFtZTpmdW5jdGlvbihhLGIpe3JldHVybiBhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iLnRvTG93ZXJDYXNlKCl9LGVhY2g6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU9MCxmPWEubGVuZ3RoLGc9cihhKTtpZihjKXtpZihnKXtmb3IoO2Y+ZTtlKyspaWYoZD1iLmFwcGx5KGFbZV0sYyksZD09PSExKWJyZWFrfWVsc2UgZm9yKGUgaW4gYSlpZihkPWIuYXBwbHkoYVtlXSxjKSxkPT09ITEpYnJlYWt9ZWxzZSBpZihnKXtmb3IoO2Y+ZTtlKyspaWYoZD1iLmNhbGwoYVtlXSxlLGFbZV0pLGQ9PT0hMSlicmVha31lbHNlIGZvcihlIGluIGEpaWYoZD1iLmNhbGwoYVtlXSxlLGFbZV0pLGQ9PT0hMSlicmVhaztyZXR1cm4gYX0sdHJpbTpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbD09YT8iIjooYSsiIikucmVwbGFjZShuLCIiKX0sbWFrZUFycmF5OmZ1bmN0aW9uKGEsYil7dmFyIGM9Ynx8W107cmV0dXJuIG51bGwhPWEmJihyKE9iamVjdChhKSk/bS5tZXJnZShjLCJzdHJpbmciPT10eXBlb2YgYT9bYV06YSk6Zi5jYWxsKGMsYSkpLGN9LGluQXJyYXk6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO2lmKGIpe2lmKGcpcmV0dXJuIGcuY2FsbChiLGEsYyk7Zm9yKGQ9Yi5sZW5ndGgsYz1jPzA+Yz9NYXRoLm1heCgwLGQrYyk6YzowO2Q+YztjKyspaWYoYyBpbiBiJiZiW2NdPT09YSlyZXR1cm4gY31yZXR1cm4tMX0sbWVyZ2U6ZnVuY3Rpb24oYSxiKXt2YXIgYz0rYi5sZW5ndGgsZD0wLGU9YS5sZW5ndGg7d2hpbGUoYz5kKWFbZSsrXT1iW2QrK107aWYoYyE9PWMpd2hpbGUodm9pZCAwIT09YltkXSlhW2UrK109YltkKytdO3JldHVybiBhLmxlbmd0aD1lLGF9LGdyZXA6ZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZCxlPVtdLGY9MCxnPWEubGVuZ3RoLGg9IWM7Zz5mO2YrKylkPSFiKGFbZl0sZiksZCE9PWgmJmUucHVzaChhW2ZdKTtyZXR1cm4gZX0sbWFwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxmPTAsZz1hLmxlbmd0aCxoPXIoYSksaT1bXTtpZihoKWZvcig7Zz5mO2YrKylkPWIoYVtmXSxmLGMpLG51bGwhPWQmJmkucHVzaChkKTtlbHNlIGZvcihmIGluIGEpZD1iKGFbZl0sZixjKSxudWxsIT1kJiZpLnB1c2goZCk7cmV0dXJuIGUuYXBwbHkoW10saSl9LGd1aWQ6MSxwcm94eTpmdW5jdGlvbihhLGIpe3ZhciBjLGUsZjtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGImJihmPWFbYl0sYj1hLGE9ZiksbS5pc0Z1bmN0aW9uKGEpPyhjPWQuY2FsbChhcmd1bWVudHMsMiksZT1mdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGJ8fHRoaXMsYy5jb25jYXQoZC5jYWxsKGFyZ3VtZW50cykpKX0sZS5ndWlkPWEuZ3VpZD1hLmd1aWR8fG0uZ3VpZCsrLGUpOnZvaWQgMH0sbm93OmZ1bmN0aW9uKCl7cmV0dXJuK25ldyBEYXRlfSxzdXBwb3J0Omt9KSxtLmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IiLnNwbGl0KCIgIiksZnVuY3Rpb24oYSxiKXtoWyJbb2JqZWN0ICIrYisiXSJdPWIudG9Mb3dlckNhc2UoKX0pO2Z1bmN0aW9uIHIoYSl7dmFyIGI9Imxlbmd0aCJpbiBhJiZhLmxlbmd0aCxjPW0udHlwZShhKTtyZXR1cm4iZnVuY3Rpb24iPT09Y3x8bS5pc1dpbmRvdyhhKT8hMToxPT09YS5ub2RlVHlwZSYmYj8hMDoiYXJyYXkiPT09Y3x8MD09PWJ8fCJudW1iZXIiPT10eXBlb2YgYiYmYj4wJiZiLTEgaW4gYX12YXIgcz1mdW5jdGlvbihhKXt2YXIgYixjLGQsZSxmLGcsaCxpLGosayxsLG0sbixvLHAscSxyLHMsdCx1PSJzaXp6bGUiKzEqbmV3IERhdGUsdj1hLmRvY3VtZW50LHc9MCx4PTAseT1oYSgpLHo9aGEoKSxBPWhhKCksQj1mdW5jdGlvbihhLGIpe3JldHVybiBhPT09YiYmKGw9ITApLDB9LEM9MTw8MzEsRD17fS5oYXNPd25Qcm9wZXJ0eSxFPVtdLEY9RS5wb3AsRz1FLnB1c2gsSD1FLnB1c2gsST1FLnNsaWNlLEo9ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MCxkPWEubGVuZ3RoO2Q+YztjKyspaWYoYVtjXT09PWIpcmV0dXJuIGM7cmV0dXJuLTF9LEs9ImNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkIixMPSJbXFx4MjBcXHRcXHJcXG5cXGZdIixNPSIoPzpcXFxcLnxbXFx3LV18W15cXHgwMC1cXHhhMF0pKyIsTj1NLnJlcGxhY2UoInciLCJ3IyIpLE89IlxcWyIrTCsiKigiK00rIikoPzoiK0wrIiooWypeJHwhfl0/PSkiK0wrIiooPzonKCg/OlxcXFwufFteXFxcXCddKSopJ3xcIigoPzpcXFxcLnxbXlxcXFxcIl0pKilcInwoIitOKyIpKXwpIitMKyIqXFxdIixQPSI6KCIrTSsiKSg/OlxcKCgoJygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCIpfCgoPzpcXFxcLnxbXlxcXFwoKVtcXF1dfCIrTysiKSopfC4qKVxcKXwpIixRPW5ldyBSZWdFeHAoTCsiKyIsImciKSxSPW5ldyBSZWdFeHAoIl4iK0wrIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIrTCsiKyQiLCJnIiksUz1uZXcgUmVnRXhwKCJeIitMKyIqLCIrTCsiKiIpLFQ9bmV3IFJlZ0V4cCgiXiIrTCsiKihbPit+XXwiK0wrIikiK0wrIioiKSxVPW5ldyBSZWdFeHAoIj0iK0wrIiooW15cXF0nXCJdKj8pIitMKyIqXFxdIiwiZyIpLFY9bmV3IFJlZ0V4cChQKSxXPW5ldyBSZWdFeHAoIl4iK04rIiQiKSxYPXtJRDpuZXcgUmVnRXhwKCJeIygiK00rIikiKSxDTEFTUzpuZXcgUmVnRXhwKCJeXFwuKCIrTSsiKSIpLFRBRzpuZXcgUmVnRXhwKCJeKCIrTS5yZXBsYWNlKCJ3IiwidyoiKSsiKSIpLEFUVFI6bmV3IFJlZ0V4cCgiXiIrTyksUFNFVURPOm5ldyBSZWdFeHAoIl4iK1ApLENISUxEOm5ldyBSZWdFeHAoIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcKCIrTCsiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIrTCsiKig/OihbKy1dfCkiK0wrIiooXFxkKyl8KSkiK0wrIipcXCl8KSIsImkiKSxib29sOm5ldyBSZWdFeHAoIl4oPzoiK0srIikkIiwiaSIpLG5lZWRzQ29udGV4dDpuZXcgUmVnRXhwKCJeIitMKyIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXCgiK0wrIiooKD86LVxcZCk/XFxkKikiK0wrIipcXCl8KSg/PVteLV18JCkiLCJpIil9LFk9L14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSxaPS9eaFxkJC9pLCQ9L15bXntdK1x7XHMqXFtuYXRpdmUgXHcvLF89L14oPzojKFtcdy1dKyl8KFx3Kyl8XC4oW1x3LV0rKSkkLyxhYT0vWyt+XS8sYmE9Lyd8XFwvZyxjYT1uZXcgUmVnRXhwKCJcXFxcKFtcXGRhLWZdezEsNn0iK0wrIj98KCIrTCsiKXwuKSIsImlnIiksZGE9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPSIweCIrYi02NTUzNjtyZXR1cm4gZCE9PWR8fGM/YjowPmQ/U3RyaW5nLmZyb21DaGFyQ29kZShkKzY1NTM2KTpTdHJpbmcuZnJvbUNoYXJDb2RlKGQ+PjEwfDU1Mjk2LDEwMjMmZHw1NjMyMCl9LGVhPWZ1bmN0aW9uKCl7bSgpfTt0cnl7SC5hcHBseShFPUkuY2FsbCh2LmNoaWxkTm9kZXMpLHYuY2hpbGROb2RlcyksRVt2LmNoaWxkTm9kZXMubGVuZ3RoXS5ub2RlVHlwZX1jYXRjaChmYSl7SD17YXBwbHk6RS5sZW5ndGg/ZnVuY3Rpb24oYSxiKXtHLmFwcGx5KGEsSS5jYWxsKGIpKX06ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmxlbmd0aCxkPTA7d2hpbGUoYVtjKytdPWJbZCsrXSk7YS5sZW5ndGg9Yy0xfX19ZnVuY3Rpb24gZ2EoYSxiLGQsZSl7dmFyIGYsaCxqLGssbCxvLHIscyx3LHg7aWYoKGI/Yi5vd25lckRvY3VtZW50fHxiOnYpIT09biYmbShiKSxiPWJ8fG4sZD1kfHxbXSxrPWIubm9kZVR5cGUsInN0cmluZyIhPXR5cGVvZiBhfHwhYXx8MSE9PWsmJjkhPT1rJiYxMSE9PWspcmV0dXJuIGQ7aWYoIWUmJnApe2lmKDExIT09ayYmKGY9Xy5leGVjKGEpKSlpZihqPWZbMV0pe2lmKDk9PT1rKXtpZihoPWIuZ2V0RWxlbWVudEJ5SWQoaiksIWh8fCFoLnBhcmVudE5vZGUpcmV0dXJuIGQ7aWYoaC5pZD09PWopcmV0dXJuIGQucHVzaChoKSxkfWVsc2UgaWYoYi5vd25lckRvY3VtZW50JiYoaD1iLm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaikpJiZ0KGIsaCkmJmguaWQ9PT1qKXJldHVybiBkLnB1c2goaCksZH1lbHNle2lmKGZbMl0pcmV0dXJuIEguYXBwbHkoZCxiLmdldEVsZW1lbnRzQnlUYWdOYW1lKGEpKSxkO2lmKChqPWZbM10pJiZjLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIEguYXBwbHkoZCxiLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoaikpLGR9aWYoYy5xc2EmJighcXx8IXEudGVzdChhKSkpe2lmKHM9cj11LHc9Yix4PTEhPT1rJiZhLDE9PT1rJiYib2JqZWN0IiE9PWIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSl7bz1nKGEpLChyPWIuZ2V0QXR0cmlidXRlKCJpZCIpKT9zPXIucmVwbGFjZShiYSwiXFwkJiIpOmIuc2V0QXR0cmlidXRlKCJpZCIscykscz0iW2lkPSciK3MrIiddICIsbD1vLmxlbmd0aDt3aGlsZShsLS0pb1tsXT1zK3JhKG9bbF0pO3c9YWEudGVzdChhKSYmcGEoYi5wYXJlbnROb2RlKXx8Yix4PW8uam9pbigiLCIpfWlmKHgpdHJ5e3JldHVybiBILmFwcGx5KGQsdy5xdWVyeVNlbGVjdG9yQWxsKHgpKSxkfWNhdGNoKHkpe31maW5hbGx5e3J8fGIucmVtb3ZlQXR0cmlidXRlKCJpZCIpfX19cmV0dXJuIGkoYS5yZXBsYWNlKFIsIiQxIiksYixkLGUpfWZ1bmN0aW9uIGhhKCl7dmFyIGE9W107ZnVuY3Rpb24gYihjLGUpe3JldHVybiBhLnB1c2goYysiICIpPmQuY2FjaGVMZW5ndGgmJmRlbGV0ZSBiW2Euc2hpZnQoKV0sYltjKyIgIl09ZX1yZXR1cm4gYn1mdW5jdGlvbiBpYShhKXtyZXR1cm4gYVt1XT0hMCxhfWZ1bmN0aW9uIGphKGEpe3ZhciBiPW4uY3JlYXRlRWxlbWVudCgiZGl2Iik7dHJ5e3JldHVybiEhYShiKX1jYXRjaChjKXtyZXR1cm4hMX1maW5hbGx5e2IucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpLGI9bnVsbH19ZnVuY3Rpb24ga2EoYSxiKXt2YXIgYz1hLnNwbGl0KCJ8IiksZT1hLmxlbmd0aDt3aGlsZShlLS0pZC5hdHRySGFuZGxlW2NbZV1dPWJ9ZnVuY3Rpb24gbGEoYSxiKXt2YXIgYz1iJiZhLGQ9YyYmMT09PWEubm9kZVR5cGUmJjE9PT1iLm5vZGVUeXBlJiYofmIuc291cmNlSW5kZXh8fEMpLSh+YS5zb3VyY2VJbmRleHx8Qyk7aWYoZClyZXR1cm4gZDtpZihjKXdoaWxlKGM9Yy5uZXh0U2libGluZylpZihjPT09YilyZXR1cm4tMTtyZXR1cm4gYT8xOi0xfWZ1bmN0aW9uIG1hKGEpe3JldHVybiBmdW5jdGlvbihiKXt2YXIgYz1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuImlucHV0Ij09PWMmJmIudHlwZT09PWF9fWZ1bmN0aW9uIG5hKGEpe3JldHVybiBmdW5jdGlvbihiKXt2YXIgYz1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuKCJpbnB1dCI9PT1jfHwiYnV0dG9uIj09PWMpJiZiLnR5cGU9PT1hfX1mdW5jdGlvbiBvYShhKXtyZXR1cm4gaWEoZnVuY3Rpb24oYil7cmV0dXJuIGI9K2IsaWEoZnVuY3Rpb24oYyxkKXt2YXIgZSxmPWEoW10sYy5sZW5ndGgsYiksZz1mLmxlbmd0aDt3aGlsZShnLS0pY1tlPWZbZ11dJiYoY1tlXT0hKGRbZV09Y1tlXSkpfSl9KX1mdW5jdGlvbiBwYShhKXtyZXR1cm4gYSYmInVuZGVmaW5lZCIhPXR5cGVvZiBhLmdldEVsZW1lbnRzQnlUYWdOYW1lJiZhfWM9Z2Euc3VwcG9ydD17fSxmPWdhLmlzWE1MPWZ1bmN0aW9uKGEpe3ZhciBiPWEmJihhLm93bmVyRG9jdW1lbnR8fGEpLmRvY3VtZW50RWxlbWVudDtyZXR1cm4gYj8iSFRNTCIhPT1iLm5vZGVOYW1lOiExfSxtPWdhLnNldERvY3VtZW50PWZ1bmN0aW9uKGEpe3ZhciBiLGUsZz1hP2Eub3duZXJEb2N1bWVudHx8YTp2O3JldHVybiBnIT09biYmOT09PWcubm9kZVR5cGUmJmcuZG9jdW1lbnRFbGVtZW50PyhuPWcsbz1nLmRvY3VtZW50RWxlbWVudCxlPWcuZGVmYXVsdFZpZXcsZSYmZSE9PWUudG9wJiYoZS5hZGRFdmVudExpc3RlbmVyP2UuYWRkRXZlbnRMaXN0ZW5lcigidW5sb2FkIixlYSwhMSk6ZS5hdHRhY2hFdmVudCYmZS5hdHRhY2hFdmVudCgib251bmxvYWQiLGVhKSkscD0hZihnKSxjLmF0dHJpYnV0ZXM9amEoZnVuY3Rpb24oYSl7cmV0dXJuIGEuY2xhc3NOYW1lPSJpIiwhYS5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpfSksYy5nZXRFbGVtZW50c0J5VGFnTmFtZT1qYShmdW5jdGlvbihhKXtyZXR1cm4gYS5hcHBlbmRDaGlsZChnLmNyZWF0ZUNvbW1lbnQoIiIpKSwhYS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aH0pLGMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZT0kLnRlc3QoZy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSxjLmdldEJ5SWQ9amEoZnVuY3Rpb24oYSl7cmV0dXJuIG8uYXBwZW5kQ2hpbGQoYSkuaWQ9dSwhZy5nZXRFbGVtZW50c0J5TmFtZXx8IWcuZ2V0RWxlbWVudHNCeU5hbWUodSkubGVuZ3RofSksYy5nZXRCeUlkPyhkLmZpbmQuSUQ9ZnVuY3Rpb24oYSxiKXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQmJnApe3ZhciBjPWIuZ2V0RWxlbWVudEJ5SWQoYSk7cmV0dXJuIGMmJmMucGFyZW50Tm9kZT9bY106W119fSxkLmZpbHRlci5JRD1mdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UoY2EsZGEpO3JldHVybiBmdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoImlkIik9PT1ifX0pOihkZWxldGUgZC5maW5kLklELGQuZmlsdGVyLklEPWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVwbGFjZShjYSxkYSk7cmV0dXJuIGZ1bmN0aW9uKGEpe3ZhciBjPSJ1bmRlZmluZWQiIT10eXBlb2YgYS5nZXRBdHRyaWJ1dGVOb2RlJiZhLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7cmV0dXJuIGMmJmMudmFsdWU9PT1ifX0pLGQuZmluZC5UQUc9Yy5nZXRFbGVtZW50c0J5VGFnTmFtZT9mdW5jdGlvbihhLGIpe3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgYi5nZXRFbGVtZW50c0J5VGFnTmFtZT9iLmdldEVsZW1lbnRzQnlUYWdOYW1lKGEpOmMucXNhP2IucXVlcnlTZWxlY3RvckFsbChhKTp2b2lkIDB9OmZ1bmN0aW9uKGEsYil7dmFyIGMsZD1bXSxlPTAsZj1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKGEpO2lmKCIqIj09PWEpe3doaWxlKGM9ZltlKytdKTE9PT1jLm5vZGVUeXBlJiZkLnB1c2goYyk7cmV0dXJuIGR9cmV0dXJuIGZ9LGQuZmluZC5DTEFTUz1jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUmJmZ1bmN0aW9uKGEsYil7cmV0dXJuIHA/Yi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGEpOnZvaWQgMH0scj1bXSxxPVtdLChjLnFzYT0kLnRlc3QoZy5xdWVyeVNlbGVjdG9yQWxsKSkmJihqYShmdW5jdGlvbihhKXtvLmFwcGVuZENoaWxkKGEpLmlubmVySFRNTD0iPGEgaWQ9JyIrdSsiJz48L2E+PHNlbGVjdCBpZD0nIit1KyItXGZdJyBtc2FsbG93Y2FwdHVyZT0nJz48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiIsYS5xdWVyeVNlbGVjdG9yQWxsKCJbbXNhbGxvd2NhcHR1cmVePScnXSIpLmxlbmd0aCYmcS5wdXNoKCJbKl4kXT0iK0wrIiooPzonJ3xcIlwiKSIpLGEucXVlcnlTZWxlY3RvckFsbCgiW3NlbGVjdGVkXSIpLmxlbmd0aHx8cS5wdXNoKCJcXFsiK0wrIiooPzp2YWx1ZXwiK0srIikiKSxhLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZH49Iit1KyItXSIpLmxlbmd0aHx8cS5wdXNoKCJ+PSIpLGEucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGh8fHEucHVzaCgiOmNoZWNrZWQiKSxhLnF1ZXJ5U2VsZWN0b3JBbGwoImEjIit1KyIrKiIpLmxlbmd0aHx8cS5wdXNoKCIuIy4rWyt+XSIpfSksamEoZnVuY3Rpb24oYSl7dmFyIGI9Zy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpO2Iuc2V0QXR0cmlidXRlKCJ0eXBlIiwiaGlkZGVuIiksYS5hcHBlbmRDaGlsZChiKS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCJEIiksYS5xdWVyeVNlbGVjdG9yQWxsKCJbbmFtZT1kXSIpLmxlbmd0aCYmcS5wdXNoKCJuYW1lIitMKyIqWypeJHwhfl0/PSIpLGEucXVlcnlTZWxlY3RvckFsbCgiOmVuYWJsZWQiKS5sZW5ndGh8fHEucHVzaCgiOmVuYWJsZWQiLCI6ZGlzYWJsZWQiKSxhLnF1ZXJ5U2VsZWN0b3JBbGwoIiosOngiKSxxLnB1c2goIiwuKjoiKX0pKSwoYy5tYXRjaGVzU2VsZWN0b3I9JC50ZXN0KHM9by5tYXRjaGVzfHxvLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8by5tb3pNYXRjaGVzU2VsZWN0b3J8fG8ub01hdGNoZXNTZWxlY3Rvcnx8by5tc01hdGNoZXNTZWxlY3RvcikpJiZqYShmdW5jdGlvbihhKXtjLmRpc2Nvbm5lY3RlZE1hdGNoPXMuY2FsbChhLCJkaXYiKSxzLmNhbGwoYSwiW3MhPScnXTp4Iiksci5wdXNoKCIhPSIsUCl9KSxxPXEubGVuZ3RoJiZuZXcgUmVnRXhwKHEuam9pbigifCIpKSxyPXIubGVuZ3RoJiZuZXcgUmVnRXhwKHIuam9pbigifCIpKSxiPSQudGVzdChvLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSx0PWJ8fCQudGVzdChvLmNvbnRhaW5zKT9mdW5jdGlvbihhLGIpe3ZhciBjPTk9PT1hLm5vZGVUeXBlP2EuZG9jdW1lbnRFbGVtZW50OmEsZD1iJiZiLnBhcmVudE5vZGU7cmV0dXJuIGE9PT1kfHwhKCFkfHwxIT09ZC5ub2RlVHlwZXx8IShjLmNvbnRhaW5zP2MuY29udGFpbnMoZCk6YS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiYmMTYmYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihkKSkpfTpmdW5jdGlvbihhLGIpe2lmKGIpd2hpbGUoYj1iLnBhcmVudE5vZGUpaWYoYj09PWEpcmV0dXJuITA7cmV0dXJuITF9LEI9Yj9mdW5jdGlvbihhLGIpe2lmKGE9PT1iKXJldHVybiBsPSEwLDA7dmFyIGQ9IWEuY29tcGFyZURvY3VtZW50UG9zaXRpb24tIWIuY29tcGFyZURvY3VtZW50UG9zaXRpb247cmV0dXJuIGQ/ZDooZD0oYS5vd25lckRvY3VtZW50fHxhKT09PShiLm93bmVyRG9jdW1lbnR8fGIpP2EuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYik6MSwxJmR8fCFjLnNvcnREZXRhY2hlZCYmYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihhKT09PWQ/YT09PWd8fGEub3duZXJEb2N1bWVudD09PXYmJnQodixhKT8tMTpiPT09Z3x8Yi5vd25lckRvY3VtZW50PT09diYmdCh2LGIpPzE6az9KKGssYSktSihrLGIpOjA6NCZkPy0xOjEpfTpmdW5jdGlvbihhLGIpe2lmKGE9PT1iKXJldHVybiBsPSEwLDA7dmFyIGMsZD0wLGU9YS5wYXJlbnROb2RlLGY9Yi5wYXJlbnROb2RlLGg9W2FdLGk9W2JdO2lmKCFlfHwhZilyZXR1cm4gYT09PWc/LTE6Yj09PWc/MTplPy0xOmY/MTprP0ooayxhKS1KKGssYik6MDtpZihlPT09ZilyZXR1cm4gbGEoYSxiKTtjPWE7d2hpbGUoYz1jLnBhcmVudE5vZGUpaC51bnNoaWZ0KGMpO2M9Yjt3aGlsZShjPWMucGFyZW50Tm9kZSlpLnVuc2hpZnQoYyk7d2hpbGUoaFtkXT09PWlbZF0pZCsrO3JldHVybiBkP2xhKGhbZF0saVtkXSk6aFtkXT09PXY/LTE6aVtkXT09PXY/MTowfSxnKTpufSxnYS5tYXRjaGVzPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGdhKGEsbnVsbCxudWxsLGIpfSxnYS5tYXRjaGVzU2VsZWN0b3I9ZnVuY3Rpb24oYSxiKXtpZigoYS5vd25lckRvY3VtZW50fHxhKSE9PW4mJm0oYSksYj1iLnJlcGxhY2UoVSwiPSckMSddIiksISghYy5tYXRjaGVzU2VsZWN0b3J8fCFwfHxyJiZyLnRlc3QoYil8fHEmJnEudGVzdChiKSkpdHJ5e3ZhciBkPXMuY2FsbChhLGIpO2lmKGR8fGMuZGlzY29ubmVjdGVkTWF0Y2h8fGEuZG9jdW1lbnQmJjExIT09YS5kb2N1bWVudC5ub2RlVHlwZSlyZXR1cm4gZH1jYXRjaChlKXt9cmV0dXJuIGdhKGIsbixudWxsLFthXSkubGVuZ3RoPjB9LGdhLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuKGEub3duZXJEb2N1bWVudHx8YSkhPT1uJiZtKGEpLHQoYSxiKX0sZ2EuYXR0cj1mdW5jdGlvbihhLGIpeyhhLm93bmVyRG9jdW1lbnR8fGEpIT09biYmbShhKTt2YXIgZT1kLmF0dHJIYW5kbGVbYi50b0xvd2VyQ2FzZSgpXSxmPWUmJkQuY2FsbChkLmF0dHJIYW5kbGUsYi50b0xvd2VyQ2FzZSgpKT9lKGEsYiwhcCk6dm9pZCAwO3JldHVybiB2b2lkIDAhPT1mP2Y6Yy5hdHRyaWJ1dGVzfHwhcD9hLmdldEF0dHJpYnV0ZShiKTooZj1hLmdldEF0dHJpYnV0ZU5vZGUoYikpJiZmLnNwZWNpZmllZD9mLnZhbHVlOm51bGx9LGdhLmVycm9yPWZ1bmN0aW9uKGEpe3Rocm93IG5ldyBFcnJvcigiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIithKX0sZ2EudW5pcXVlU29ydD1mdW5jdGlvbihhKXt2YXIgYixkPVtdLGU9MCxmPTA7aWYobD0hYy5kZXRlY3REdXBsaWNhdGVzLGs9IWMuc29ydFN0YWJsZSYmYS5zbGljZSgwKSxhLnNvcnQoQiksbCl7d2hpbGUoYj1hW2YrK10pYj09PWFbZl0mJihlPWQucHVzaChmKSk7d2hpbGUoZS0tKWEuc3BsaWNlKGRbZV0sMSl9cmV0dXJuIGs9bnVsbCxhfSxlPWdhLmdldFRleHQ9ZnVuY3Rpb24oYSl7dmFyIGIsYz0iIixkPTAsZj1hLm5vZGVUeXBlO2lmKGYpe2lmKDE9PT1mfHw5PT09Znx8MTE9PT1mKXtpZigic3RyaW5nIj09dHlwZW9mIGEudGV4dENvbnRlbnQpcmV0dXJuIGEudGV4dENvbnRlbnQ7Zm9yKGE9YS5maXJzdENoaWxkO2E7YT1hLm5leHRTaWJsaW5nKWMrPWUoYSl9ZWxzZSBpZigzPT09Znx8ND09PWYpcmV0dXJuIGEubm9kZVZhbHVlfWVsc2Ugd2hpbGUoYj1hW2QrK10pYys9ZShiKTtyZXR1cm4gY30sZD1nYS5zZWxlY3RvcnM9e2NhY2hlTGVuZ3RoOjUwLGNyZWF0ZVBzZXVkbzppYSxtYXRjaDpYLGF0dHJIYW5kbGU6e30sZmluZDp7fSxyZWxhdGl2ZTp7Ij4iOntkaXI6InBhcmVudE5vZGUiLGZpcnN0OiEwfSwiICI6e2RpcjoicGFyZW50Tm9kZSJ9LCIrIjp7ZGlyOiJwcmV2aW91c1NpYmxpbmciLGZpcnN0OiEwfSwifiI6e2RpcjoicHJldmlvdXNTaWJsaW5nIn19LHByZUZpbHRlcjp7QVRUUjpmdW5jdGlvbihhKXtyZXR1cm4gYVsxXT1hWzFdLnJlcGxhY2UoY2EsZGEpLGFbM109KGFbM118fGFbNF18fGFbNV18fCIiKS5yZXBsYWNlKGNhLGRhKSwifj0iPT09YVsyXSYmKGFbM109IiAiK2FbM10rIiAiKSxhLnNsaWNlKDAsNCl9LENISUxEOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdPWFbMV0udG9Mb3dlckNhc2UoKSwibnRoIj09PWFbMV0uc2xpY2UoMCwzKT8oYVszXXx8Z2EuZXJyb3IoYVswXSksYVs0XT0rKGFbNF0/YVs1XSsoYVs2XXx8MSk6MiooImV2ZW4iPT09YVszXXx8Im9kZCI9PT1hWzNdKSksYVs1XT0rKGFbN10rYVs4XXx8Im9kZCI9PT1hWzNdKSk6YVszXSYmZ2EuZXJyb3IoYVswXSksYX0sUFNFVURPOmZ1bmN0aW9uKGEpe3ZhciBiLGM9IWFbNl0mJmFbMl07cmV0dXJuIFguQ0hJTEQudGVzdChhWzBdKT9udWxsOihhWzNdP2FbMl09YVs0XXx8YVs1XXx8IiI6YyYmVi50ZXN0KGMpJiYoYj1nKGMsITApKSYmKGI9Yy5pbmRleE9mKCIpIixjLmxlbmd0aC1iKS1jLmxlbmd0aCkmJihhWzBdPWFbMF0uc2xpY2UoMCxiKSxhWzJdPWMuc2xpY2UoMCxiKSksYS5zbGljZSgwLDMpKX19LGZpbHRlcjp7VEFHOmZ1bmN0aW9uKGEpe3ZhciBiPWEucmVwbGFjZShjYSxkYSkudG9Mb3dlckNhc2UoKTtyZXR1cm4iKiI9PT1hP2Z1bmN0aW9uKCl7cmV0dXJuITB9OmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lJiZhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1ifX0sQ0xBU1M6ZnVuY3Rpb24oYSl7dmFyIGI9eVthKyIgIl07cmV0dXJuIGJ8fChiPW5ldyBSZWdFeHAoIihefCIrTCsiKSIrYSsiKCIrTCsifCQpIikpJiZ5KGEsZnVuY3Rpb24oYSl7cmV0dXJuIGIudGVzdCgic3RyaW5nIj09dHlwZW9mIGEuY2xhc3NOYW1lJiZhLmNsYXNzTmFtZXx8InVuZGVmaW5lZCIhPXR5cGVvZiBhLmdldEF0dHJpYnV0ZSYmYS5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiKX0pfSxBVFRSOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZnVuY3Rpb24oZCl7dmFyIGU9Z2EuYXR0cihkLGEpO3JldHVybiBudWxsPT1lPyIhPSI9PT1iOmI/KGUrPSIiLCI9Ij09PWI/ZT09PWM6IiE9Ij09PWI/ZSE9PWM6Il49Ij09PWI/YyYmMD09PWUuaW5kZXhPZihjKToiKj0iPT09Yj9jJiZlLmluZGV4T2YoYyk+LTE6IiQ9Ij09PWI/YyYmZS5zbGljZSgtYy5sZW5ndGgpPT09Yzoifj0iPT09Yj8oIiAiK2UucmVwbGFjZShRLCIgIikrIiAiKS5pbmRleE9mKGMpPi0xOiJ8PSI9PT1iP2U9PT1jfHxlLnNsaWNlKDAsYy5sZW5ndGgrMSk9PT1jKyItIjohMSk6ITB9fSxDSElMRDpmdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPSJudGgiIT09YS5zbGljZSgwLDMpLGc9Imxhc3QiIT09YS5zbGljZSgtNCksaD0ib2YtdHlwZSI9PT1iO3JldHVybiAxPT09ZCYmMD09PWU/ZnVuY3Rpb24oYSl7cmV0dXJuISFhLnBhcmVudE5vZGV9OmZ1bmN0aW9uKGIsYyxpKXt2YXIgaixrLGwsbSxuLG8scD1mIT09Zz8ibmV4dFNpYmxpbmciOiJwcmV2aW91c1NpYmxpbmciLHE9Yi5wYXJlbnROb2RlLHI9aCYmYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLHM9IWkmJiFoO2lmKHEpe2lmKGYpe3doaWxlKHApe2w9Yjt3aGlsZShsPWxbcF0paWYoaD9sLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1yOjE9PT1sLm5vZGVUeXBlKXJldHVybiExO289cD0ib25seSI9PT1hJiYhbyYmIm5leHRTaWJsaW5nIn1yZXR1cm4hMH1pZihvPVtnP3EuZmlyc3RDaGlsZDpxLmxhc3RDaGlsZF0sZyYmcyl7az1xW3VdfHwocVt1XT17fSksaj1rW2FdfHxbXSxuPWpbMF09PT13JiZqWzFdLG09alswXT09PXcmJmpbMl0sbD1uJiZxLmNoaWxkTm9kZXNbbl07d2hpbGUobD0rK24mJmwmJmxbcF18fChtPW49MCl8fG8ucG9wKCkpaWYoMT09PWwubm9kZVR5cGUmJisrbSYmbD09PWIpe2tbYV09W3csbixtXTticmVha319ZWxzZSBpZihzJiYoaj0oYlt1XXx8KGJbdV09e30pKVthXSkmJmpbMF09PT13KW09alsxXTtlbHNlIHdoaWxlKGw9KytuJiZsJiZsW3BdfHwobT1uPTApfHxvLnBvcCgpKWlmKChoP2wubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PXI6MT09PWwubm9kZVR5cGUpJiYrK20mJihzJiYoKGxbdV18fChsW3VdPXt9KSlbYV09W3csbV0pLGw9PT1iKSlicmVhaztyZXR1cm4gbS09ZSxtPT09ZHx8bSVkPT09MCYmbS9kPj0wfX19LFBTRVVETzpmdW5jdGlvbihhLGIpe3ZhciBjLGU9ZC5wc2V1ZG9zW2FdfHxkLnNldEZpbHRlcnNbYS50b0xvd2VyQ2FzZSgpXXx8Z2EuZXJyb3IoInVuc3VwcG9ydGVkIHBzZXVkbzogIithKTtyZXR1cm4gZVt1XT9lKGIpOmUubGVuZ3RoPjE/KGM9W2EsYSwiIixiXSxkLnNldEZpbHRlcnMuaGFzT3duUHJvcGVydHkoYS50b0xvd2VyQ2FzZSgpKT9pYShmdW5jdGlvbihhLGMpe3ZhciBkLGY9ZShhLGIpLGc9Zi5sZW5ndGg7d2hpbGUoZy0tKWQ9SihhLGZbZ10pLGFbZF09IShjW2RdPWZbZ10pfSk6ZnVuY3Rpb24oYSl7cmV0dXJuIGUoYSwwLGMpfSk6ZX19LHBzZXVkb3M6e25vdDppYShmdW5jdGlvbihhKXt2YXIgYj1bXSxjPVtdLGQ9aChhLnJlcGxhY2UoUiwiJDEiKSk7cmV0dXJuIGRbdV0/aWEoZnVuY3Rpb24oYSxiLGMsZSl7dmFyIGYsZz1kKGEsbnVsbCxlLFtdKSxoPWEubGVuZ3RoO3doaWxlKGgtLSkoZj1nW2hdKSYmKGFbaF09IShiW2hdPWYpKX0pOmZ1bmN0aW9uKGEsZSxmKXtyZXR1cm4gYlswXT1hLGQoYixudWxsLGYsYyksYlswXT1udWxsLCFjLnBvcCgpfX0pLGhhczppYShmdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuIGdhKGEsYikubGVuZ3RoPjB9fSksY29udGFpbnM6aWEoZnVuY3Rpb24oYSl7cmV0dXJuIGE9YS5yZXBsYWNlKGNhLGRhKSxmdW5jdGlvbihiKXtyZXR1cm4oYi50ZXh0Q29udGVudHx8Yi5pbm5lclRleHR8fGUoYikpLmluZGV4T2YoYSk+LTF9fSksbGFuZzppYShmdW5jdGlvbihhKXtyZXR1cm4gVy50ZXN0KGF8fCIiKXx8Z2EuZXJyb3IoInVuc3VwcG9ydGVkIGxhbmc6ICIrYSksYT1hLnJlcGxhY2UoY2EsZGEpLnRvTG93ZXJDYXNlKCksZnVuY3Rpb24oYil7dmFyIGM7ZG8gaWYoYz1wP2IubGFuZzpiLmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKXx8Yi5nZXRBdHRyaWJ1dGUoImxhbmciKSlyZXR1cm4gYz1jLnRvTG93ZXJDYXNlKCksYz09PWF8fDA9PT1jLmluZGV4T2YoYSsiLSIpO3doaWxlKChiPWIucGFyZW50Tm9kZSkmJjE9PT1iLm5vZGVUeXBlKTtyZXR1cm4hMX19KSx0YXJnZXQ6ZnVuY3Rpb24oYil7dmFyIGM9YS5sb2NhdGlvbiYmYS5sb2NhdGlvbi5oYXNoO3JldHVybiBjJiZjLnNsaWNlKDEpPT09Yi5pZH0scm9vdDpmdW5jdGlvbihhKXtyZXR1cm4gYT09PW99LGZvY3VzOmZ1bmN0aW9uKGEpe3JldHVybiBhPT09bi5hY3RpdmVFbGVtZW50JiYoIW4uaGFzRm9jdXN8fG4uaGFzRm9jdXMoKSkmJiEhKGEudHlwZXx8YS5ocmVmfHx+YS50YWJJbmRleCl9LGVuYWJsZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZGlzYWJsZWQ9PT0hMX0sZGlzYWJsZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZGlzYWJsZWQ9PT0hMH0sY2hlY2tlZDpmdW5jdGlvbihhKXt2YXIgYj1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuImlucHV0Ij09PWImJiEhYS5jaGVja2VkfHwib3B0aW9uIj09PWImJiEhYS5zZWxlY3RlZH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucGFyZW50Tm9kZSYmYS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsYS5zZWxlY3RlZD09PSEwfSxlbXB0eTpmdW5jdGlvbihhKXtmb3IoYT1hLmZpcnN0Q2hpbGQ7YTthPWEubmV4dFNpYmxpbmcpaWYoYS5ub2RlVHlwZTw2KXJldHVybiExO3JldHVybiEwfSxwYXJlbnQ6ZnVuY3Rpb24oYSl7cmV0dXJuIWQucHNldWRvcy5lbXB0eShhKX0saGVhZGVyOmZ1bmN0aW9uKGEpe3JldHVybiBaLnRlc3QoYS5ub2RlTmFtZSl9LGlucHV0OmZ1bmN0aW9uKGEpe3JldHVybiBZLnRlc3QoYS5ub2RlTmFtZSl9LGJ1dHRvbjpmdW5jdGlvbihhKXt2YXIgYj1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuImlucHV0Ij09PWImJiJidXR0b24iPT09YS50eXBlfHwiYnV0dG9uIj09PWJ9LHRleHQ6ZnVuY3Rpb24oYSl7dmFyIGI7cmV0dXJuImlucHV0Ij09PWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmInRleHQiPT09YS50eXBlJiYobnVsbD09KGI9YS5nZXRBdHRyaWJ1dGUoInR5cGUiKSl8fCJ0ZXh0Ij09PWIudG9Mb3dlckNhc2UoKSl9LGZpcnN0Om9hKGZ1bmN0aW9uKCl7cmV0dXJuWzBdfSksbGFzdDpvYShmdW5jdGlvbihhLGIpe3JldHVybltiLTFdfSksZXE6b2EoZnVuY3Rpb24oYSxiLGMpe3JldHVyblswPmM/YytiOmNdfSksZXZlbjpvYShmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wO2I+YztjKz0yKWEucHVzaChjKTtyZXR1cm4gYX0pLG9kZDpvYShmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0xO2I+YztjKz0yKWEucHVzaChjKTtyZXR1cm4gYX0pLGx0Om9hKGZ1bmN0aW9uKGEsYixjKXtmb3IodmFyIGQ9MD5jP2MrYjpjOy0tZD49MDspYS5wdXNoKGQpO3JldHVybiBhfSksZ3Q6b2EoZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZD0wPmM/YytiOmM7KytkPGI7KWEucHVzaChkKTtyZXR1cm4gYX0pfX0sZC5wc2V1ZG9zLm50aD1kLnBzZXVkb3MuZXE7Zm9yKGIgaW57cmFkaW86ITAsY2hlY2tib3g6ITAsZmlsZTohMCxwYXNzd29yZDohMCxpbWFnZTohMH0pZC5wc2V1ZG9zW2JdPW1hKGIpO2ZvcihiIGlue3N1Ym1pdDohMCxyZXNldDohMH0pZC5wc2V1ZG9zW2JdPW5hKGIpO2Z1bmN0aW9uIHFhKCl7fXFhLnByb3RvdHlwZT1kLmZpbHRlcnM9ZC5wc2V1ZG9zLGQuc2V0RmlsdGVycz1uZXcgcWEsZz1nYS50b2tlbml6ZT1mdW5jdGlvbihhLGIpe3ZhciBjLGUsZixnLGgsaSxqLGs9elthKyIgIl07aWYoaylyZXR1cm4gYj8wOmsuc2xpY2UoMCk7aD1hLGk9W10saj1kLnByZUZpbHRlcjt3aGlsZShoKXsoIWN8fChlPVMuZXhlYyhoKSkpJiYoZSYmKGg9aC5zbGljZShlWzBdLmxlbmd0aCl8fGgpLGkucHVzaChmPVtdKSksYz0hMSwoZT1ULmV4ZWMoaCkpJiYoYz1lLnNoaWZ0KCksZi5wdXNoKHt2YWx1ZTpjLHR5cGU6ZVswXS5yZXBsYWNlKFIsIiAiKX0pLGg9aC5zbGljZShjLmxlbmd0aCkpO2ZvcihnIGluIGQuZmlsdGVyKSEoZT1YW2ddLmV4ZWMoaCkpfHxqW2ddJiYhKGU9altnXShlKSl8fChjPWUuc2hpZnQoKSxmLnB1c2goe3ZhbHVlOmMsdHlwZTpnLG1hdGNoZXM6ZX0pLGg9aC5zbGljZShjLmxlbmd0aCkpO2lmKCFjKWJyZWFrfXJldHVybiBiP2gubGVuZ3RoOmg/Z2EuZXJyb3IoYSk6eihhLGkpLnNsaWNlKDApfTtmdW5jdGlvbiByYShhKXtmb3IodmFyIGI9MCxjPWEubGVuZ3RoLGQ9IiI7Yz5iO2IrKylkKz1hW2JdLnZhbHVlO3JldHVybiBkfWZ1bmN0aW9uIHNhKGEsYixjKXt2YXIgZD1iLmRpcixlPWMmJiJwYXJlbnROb2RlIj09PWQsZj14Kys7cmV0dXJuIGIuZmlyc3Q/ZnVuY3Rpb24oYixjLGYpe3doaWxlKGI9YltkXSlpZigxPT09Yi5ub2RlVHlwZXx8ZSlyZXR1cm4gYShiLGMsZil9OmZ1bmN0aW9uKGIsYyxnKXt2YXIgaCxpLGo9W3csZl07aWYoZyl7d2hpbGUoYj1iW2RdKWlmKCgxPT09Yi5ub2RlVHlwZXx8ZSkmJmEoYixjLGcpKXJldHVybiEwfWVsc2Ugd2hpbGUoYj1iW2RdKWlmKDE9PT1iLm5vZGVUeXBlfHxlKXtpZihpPWJbdV18fChiW3VdPXt9KSwoaD1pW2RdKSYmaFswXT09PXcmJmhbMV09PT1mKXJldHVybiBqWzJdPWhbMl07aWYoaVtkXT1qLGpbMl09YShiLGMsZykpcmV0dXJuITB9fX1mdW5jdGlvbiB0YShhKXtyZXR1cm4gYS5sZW5ndGg+MT9mdW5jdGlvbihiLGMsZCl7dmFyIGU9YS5sZW5ndGg7d2hpbGUoZS0tKWlmKCFhW2VdKGIsYyxkKSlyZXR1cm4hMTtyZXR1cm4hMH06YVswXX1mdW5jdGlvbiB1YShhLGIsYyl7Zm9yKHZhciBkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKWdhKGEsYltkXSxjKTtyZXR1cm4gY31mdW5jdGlvbiB2YShhLGIsYyxkLGUpe2Zvcih2YXIgZixnPVtdLGg9MCxpPWEubGVuZ3RoLGo9bnVsbCE9YjtpPmg7aCsrKShmPWFbaF0pJiYoIWN8fGMoZixkLGUpKSYmKGcucHVzaChmKSxqJiZiLnB1c2goaCkpO3JldHVybiBnfWZ1bmN0aW9uIHdhKGEsYixjLGQsZSxmKXtyZXR1cm4gZCYmIWRbdV0mJihkPXdhKGQpKSxlJiYhZVt1XSYmKGU9d2EoZSxmKSksaWEoZnVuY3Rpb24oZixnLGgsaSl7dmFyIGosayxsLG09W10sbj1bXSxvPWcubGVuZ3RoLHA9Znx8dWEoYnx8IioiLGgubm9kZVR5cGU/W2hdOmgsW10pLHE9IWF8fCFmJiZiP3A6dmEocCxtLGEsaCxpKSxyPWM/ZXx8KGY/YTpvfHxkKT9bXTpnOnE7aWYoYyYmYyhxLHIsaCxpKSxkKXtqPXZhKHIsbiksZChqLFtdLGgsaSksaz1qLmxlbmd0aDt3aGlsZShrLS0pKGw9altrXSkmJihyW25ba11dPSEocVtuW2tdXT1sKSl9aWYoZil7aWYoZXx8YSl7aWYoZSl7aj1bXSxrPXIubGVuZ3RoO3doaWxlKGstLSkobD1yW2tdKSYmai5wdXNoKHFba109bCk7ZShudWxsLHI9W10saixpKX1rPXIubGVuZ3RoO3doaWxlKGstLSkobD1yW2tdKSYmKGo9ZT9KKGYsbCk6bVtrXSk+LTEmJihmW2pdPSEoZ1tqXT1sKSl9fWVsc2Ugcj12YShyPT09Zz9yLnNwbGljZShvLHIubGVuZ3RoKTpyKSxlP2UobnVsbCxnLHIsaSk6SC5hcHBseShnLHIpfSl9ZnVuY3Rpb24geGEoYSl7Zm9yKHZhciBiLGMsZSxmPWEubGVuZ3RoLGc9ZC5yZWxhdGl2ZVthWzBdLnR5cGVdLGg9Z3x8ZC5yZWxhdGl2ZVsiICJdLGk9Zz8xOjAsaz1zYShmdW5jdGlvbihhKXtyZXR1cm4gYT09PWJ9LGgsITApLGw9c2EoZnVuY3Rpb24oYSl7cmV0dXJuIEooYixhKT4tMX0saCwhMCksbT1bZnVuY3Rpb24oYSxjLGQpe3ZhciBlPSFnJiYoZHx8YyE9PWopfHwoKGI9Yykubm9kZVR5cGU/ayhhLGMsZCk6bChhLGMsZCkpO3JldHVybiBiPW51bGwsZX1dO2Y+aTtpKyspaWYoYz1kLnJlbGF0aXZlW2FbaV0udHlwZV0pbT1bc2EodGEobSksYyldO2Vsc2V7aWYoYz1kLmZpbHRlclthW2ldLnR5cGVdLmFwcGx5KG51bGwsYVtpXS5tYXRjaGVzKSxjW3VdKXtmb3IoZT0rK2k7Zj5lO2UrKylpZihkLnJlbGF0aXZlW2FbZV0udHlwZV0pYnJlYWs7cmV0dXJuIHdhKGk+MSYmdGEobSksaT4xJiZyYShhLnNsaWNlKDAsaS0xKS5jb25jYXQoe3ZhbHVlOiIgIj09PWFbaS0yXS50eXBlPyIqIjoiIn0pKS5yZXBsYWNlKFIsIiQxIiksYyxlPmkmJnhhKGEuc2xpY2UoaSxlKSksZj5lJiZ4YShhPWEuc2xpY2UoZSkpLGY+ZSYmcmEoYSkpfW0ucHVzaChjKX1yZXR1cm4gdGEobSl9ZnVuY3Rpb24geWEoYSxiKXt2YXIgYz1iLmxlbmd0aD4wLGU9YS5sZW5ndGg+MCxmPWZ1bmN0aW9uKGYsZyxoLGksayl7dmFyIGwsbSxvLHA9MCxxPSIwIixyPWYmJltdLHM9W10sdD1qLHU9Znx8ZSYmZC5maW5kLlRBRygiKiIsayksdj13Kz1udWxsPT10PzE6TWF0aC5yYW5kb20oKXx8LjEseD11Lmxlbmd0aDtmb3IoayYmKGo9ZyE9PW4mJmcpO3EhPT14JiZudWxsIT0obD11W3FdKTtxKyspe2lmKGUmJmwpe209MDt3aGlsZShvPWFbbSsrXSlpZihvKGwsZyxoKSl7aS5wdXNoKGwpO2JyZWFrfWsmJih3PXYpfWMmJigobD0hbyYmbCkmJnAtLSxmJiZyLnB1c2gobCkpfWlmKHArPXEsYyYmcSE9PXApe209MDt3aGlsZShvPWJbbSsrXSlvKHIscyxnLGgpO2lmKGYpe2lmKHA+MCl3aGlsZShxLS0pcltxXXx8c1txXXx8KHNbcV09Ri5jYWxsKGkpKTtzPXZhKHMpfUguYXBwbHkoaSxzKSxrJiYhZiYmcy5sZW5ndGg+MCYmcCtiLmxlbmd0aD4xJiZnYS51bmlxdWVTb3J0KGkpfXJldHVybiBrJiYodz12LGo9dCkscn07cmV0dXJuIGM/aWEoZik6Zn1yZXR1cm4gaD1nYS5jb21waWxlPWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1bXSxlPVtdLGY9QVthKyIgIl07aWYoIWYpe2J8fChiPWcoYSkpLGM9Yi5sZW5ndGg7d2hpbGUoYy0tKWY9eGEoYltjXSksZlt1XT9kLnB1c2goZik6ZS5wdXNoKGYpO2Y9QShhLHlhKGUsZCkpLGYuc2VsZWN0b3I9YX1yZXR1cm4gZn0saT1nYS5zZWxlY3Q9ZnVuY3Rpb24oYSxiLGUsZil7dmFyIGksaixrLGwsbSxuPSJmdW5jdGlvbiI9PXR5cGVvZiBhJiZhLG89IWYmJmcoYT1uLnNlbGVjdG9yfHxhKTtpZihlPWV8fFtdLDE9PT1vLmxlbmd0aCl7aWYoaj1vWzBdPW9bMF0uc2xpY2UoMCksai5sZW5ndGg+MiYmIklEIj09PShrPWpbMF0pLnR5cGUmJmMuZ2V0QnlJZCYmOT09PWIubm9kZVR5cGUmJnAmJmQucmVsYXRpdmVbalsxXS50eXBlXSl7aWYoYj0oZC5maW5kLklEKGsubWF0Y2hlc1swXS5yZXBsYWNlKGNhLGRhKSxiKXx8W10pWzBdLCFiKXJldHVybiBlO24mJihiPWIucGFyZW50Tm9kZSksYT1hLnNsaWNlKGouc2hpZnQoKS52YWx1ZS5sZW5ndGgpfWk9WC5uZWVkc0NvbnRleHQudGVzdChhKT8wOmoubGVuZ3RoO3doaWxlKGktLSl7aWYoaz1qW2ldLGQucmVsYXRpdmVbbD1rLnR5cGVdKWJyZWFrO2lmKChtPWQuZmluZFtsXSkmJihmPW0oay5tYXRjaGVzWzBdLnJlcGxhY2UoY2EsZGEpLGFhLnRlc3QoalswXS50eXBlKSYmcGEoYi5wYXJlbnROb2RlKXx8YikpKXtpZihqLnNwbGljZShpLDEpLGE9Zi5sZW5ndGgmJnJhKGopLCFhKXJldHVybiBILmFwcGx5KGUsZiksZTticmVha319fXJldHVybihufHxoKGEsbykpKGYsYiwhcCxlLGFhLnRlc3QoYSkmJnBhKGIucGFyZW50Tm9kZSl8fGIpLGV9LGMuc29ydFN0YWJsZT11LnNwbGl0KCIiKS5zb3J0KEIpLmpvaW4oIiIpPT09dSxjLmRldGVjdER1cGxpY2F0ZXM9ISFsLG0oKSxjLnNvcnREZXRhY2hlZD1qYShmdW5jdGlvbihhKXtyZXR1cm4gMSZhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKG4uY3JlYXRlRWxlbWVudCgiZGl2IikpfSksamEoZnVuY3Rpb24oYSl7cmV0dXJuIGEuaW5uZXJIVE1MPSI8YSBocmVmPScjJz48L2E+IiwiIyI9PT1hLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIil9KXx8a2EoInR5cGV8aHJlZnxoZWlnaHR8d2lkdGgiLGZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYz92b2lkIDA6YS5nZXRBdHRyaWJ1dGUoYiwidHlwZSI9PT1iLnRvTG93ZXJDYXNlKCk/MToyKX0pLGMuYXR0cmlidXRlcyYmamEoZnVuY3Rpb24oYSl7cmV0dXJuIGEuaW5uZXJIVE1MPSI8aW5wdXQvPiIsYS5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSgidmFsdWUiLCIiKSwiIj09PWEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoInZhbHVlIil9KXx8a2EoInZhbHVlIixmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGN8fCJpbnB1dCIhPT1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk/dm9pZCAwOmEuZGVmYXVsdFZhbHVlfSksamEoZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PWEuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpfSl8fGthKEssZnVuY3Rpb24oYSxiLGMpe3ZhciBkO3JldHVybiBjP3ZvaWQgMDphW2JdPT09ITA/Yi50b0xvd2VyQ2FzZSgpOihkPWEuZ2V0QXR0cmlidXRlTm9kZShiKSkmJmQuc3BlY2lmaWVkP2QudmFsdWU6bnVsbH0pLGdhfShhKTttLmZpbmQ9cyxtLmV4cHI9cy5zZWxlY3RvcnMsbS5leHByWyI6Il09bS5leHByLnBzZXVkb3MsbS51bmlxdWU9cy51bmlxdWVTb3J0LG0udGV4dD1zLmdldFRleHQsbS5pc1hNTERvYz1zLmlzWE1MLG0uY29udGFpbnM9cy5jb250YWluczt2YXIgdD1tLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LHU9L148KFx3KylccypcLz8+KD86PFwvXDE+fCkkLyx2PS9eLlteOiNcW1wuLF0qJC87ZnVuY3Rpb24gdyhhLGIsYyl7aWYobS5pc0Z1bmN0aW9uKGIpKXJldHVybiBtLmdyZXAoYSxmdW5jdGlvbihhLGQpe3JldHVybiEhYi5jYWxsKGEsZCxhKSE9PWN9KTtpZihiLm5vZGVUeXBlKXJldHVybiBtLmdyZXAoYSxmdW5jdGlvbihhKXtyZXR1cm4gYT09PWIhPT1jfSk7aWYoInN0cmluZyI9PXR5cGVvZiBiKXtpZih2LnRlc3QoYikpcmV0dXJuIG0uZmlsdGVyKGIsYSxjKTtiPW0uZmlsdGVyKGIsYSl9cmV0dXJuIG0uZ3JlcChhLGZ1bmN0aW9uKGEpe3JldHVybiBtLmluQXJyYXkoYSxiKT49MCE9PWN9KX1tLmZpbHRlcj1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9YlswXTtyZXR1cm4gYyYmKGE9Ijpub3QoIithKyIpIiksMT09PWIubGVuZ3RoJiYxPT09ZC5ub2RlVHlwZT9tLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGQsYSk/W2RdOltdOm0uZmluZC5tYXRjaGVzKGEsbS5ncmVwKGIsZnVuY3Rpb24oYSl7cmV0dXJuIDE9PT1hLm5vZGVUeXBlfSkpfSxtLmZuLmV4dGVuZCh7ZmluZDpmdW5jdGlvbihhKXt2YXIgYixjPVtdLGQ9dGhpcyxlPWQubGVuZ3RoO2lmKCJzdHJpbmciIT10eXBlb2YgYSlyZXR1cm4gdGhpcy5wdXNoU3RhY2sobShhKS5maWx0ZXIoZnVuY3Rpb24oKXtmb3IoYj0wO2U+YjtiKyspaWYobS5jb250YWlucyhkW2JdLHRoaXMpKXJldHVybiEwfSkpO2ZvcihiPTA7ZT5iO2IrKyltLmZpbmQoYSxkW2JdLGMpO3JldHVybiBjPXRoaXMucHVzaFN0YWNrKGU+MT9tLnVuaXF1ZShjKTpjKSxjLnNlbGVjdG9yPXRoaXMuc2VsZWN0b3I/dGhpcy5zZWxlY3RvcisiICIrYTphLGN9LGZpbHRlcjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2sodyh0aGlzLGF8fFtdLCExKSl9LG5vdDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2sodyh0aGlzLGF8fFtdLCEwKSl9LGlzOmZ1bmN0aW9uKGEpe3JldHVybiEhdyh0aGlzLCJzdHJpbmciPT10eXBlb2YgYSYmdC50ZXN0KGEpP20oYSk6YXx8W10sITEpLmxlbmd0aH19KTt2YXIgeCx5PWEuZG9jdW1lbnQsej0vXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLEE9bS5mbi5pbml0PWZ1bmN0aW9uKGEsYil7dmFyIGMsZDtpZighYSlyZXR1cm4gdGhpcztpZigic3RyaW5nIj09dHlwZW9mIGEpe2lmKGM9IjwiPT09YS5jaGFyQXQoMCkmJiI+Ij09PWEuY2hhckF0KGEubGVuZ3RoLTEpJiZhLmxlbmd0aD49Mz9bbnVsbCxhLG51bGxdOnouZXhlYyhhKSwhY3x8IWNbMV0mJmIpcmV0dXJuIWJ8fGIuanF1ZXJ5PyhifHx4KS5maW5kKGEpOnRoaXMuY29uc3RydWN0b3IoYikuZmluZChhKTtpZihjWzFdKXtpZihiPWIgaW5zdGFuY2VvZiBtP2JbMF06YixtLm1lcmdlKHRoaXMsbS5wYXJzZUhUTUwoY1sxXSxiJiZiLm5vZGVUeXBlP2Iub3duZXJEb2N1bWVudHx8Yjp5LCEwKSksdS50ZXN0KGNbMV0pJiZtLmlzUGxhaW5PYmplY3QoYikpZm9yKGMgaW4gYiltLmlzRnVuY3Rpb24odGhpc1tjXSk/dGhpc1tjXShiW2NdKTp0aGlzLmF0dHIoYyxiW2NdKTtyZXR1cm4gdGhpc31pZihkPXkuZ2V0RWxlbWVudEJ5SWQoY1syXSksZCYmZC5wYXJlbnROb2RlKXtpZihkLmlkIT09Y1syXSlyZXR1cm4geC5maW5kKGEpO3RoaXMubGVuZ3RoPTEsdGhpc1swXT1kfXJldHVybiB0aGlzLmNvbnRleHQ9eSx0aGlzLnNlbGVjdG9yPWEsdGhpc31yZXR1cm4gYS5ub2RlVHlwZT8odGhpcy5jb250ZXh0PXRoaXNbMF09YSx0aGlzLmxlbmd0aD0xLHRoaXMpOm0uaXNGdW5jdGlvbihhKT8idW5kZWZpbmVkIiE9dHlwZW9mIHgucmVhZHk/eC5yZWFkeShhKTphKG0pOih2b2lkIDAhPT1hLnNlbGVjdG9yJiYodGhpcy5zZWxlY3Rvcj1hLnNlbGVjdG9yLHRoaXMuY29udGV4dD1hLmNvbnRleHQpLG0ubWFrZUFycmF5KGEsdGhpcykpfTtBLnByb3RvdHlwZT1tLmZuLHg9bSh5KTt2YXIgQj0vXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLyxDPXtjaGlsZHJlbjohMCxjb250ZW50czohMCxuZXh0OiEwLHByZXY6ITB9O20uZXh0ZW5kKHtkaXI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPVtdLGU9YVtiXTt3aGlsZShlJiY5IT09ZS5ub2RlVHlwZSYmKHZvaWQgMD09PWN8fDEhPT1lLm5vZGVUeXBlfHwhbShlKS5pcyhjKSkpMT09PWUubm9kZVR5cGUmJmQucHVzaChlKSxlPWVbYl07cmV0dXJuIGR9LHNpYmxpbmc6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9W107YTthPWEubmV4dFNpYmxpbmcpMT09PWEubm9kZVR5cGUmJmEhPT1iJiZjLnB1c2goYSk7cmV0dXJuIGN9fSksbS5mbi5leHRlbmQoe2hhczpmdW5jdGlvbihhKXt2YXIgYixjPW0oYSx0aGlzKSxkPWMubGVuZ3RoO3JldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpe2ZvcihiPTA7ZD5iO2IrKylpZihtLmNvbnRhaW5zKHRoaXMsY1tiXSkpcmV0dXJuITB9KX0sY2xvc2VzdDpmdW5jdGlvbihhLGIpe2Zvcih2YXIgYyxkPTAsZT10aGlzLmxlbmd0aCxmPVtdLGc9dC50ZXN0KGEpfHwic3RyaW5nIiE9dHlwZW9mIGE/bShhLGJ8fHRoaXMuY29udGV4dCk6MDtlPmQ7ZCsrKWZvcihjPXRoaXNbZF07YyYmYyE9PWI7Yz1jLnBhcmVudE5vZGUpaWYoYy5ub2RlVHlwZTwxMSYmKGc/Zy5pbmRleChjKT4tMToxPT09Yy5ub2RlVHlwZSYmbS5maW5kLm1hdGNoZXNTZWxlY3RvcihjLGEpKSl7Zi5wdXNoKGMpO2JyZWFrfXJldHVybiB0aGlzLnB1c2hTdGFjayhmLmxlbmd0aD4xP20udW5pcXVlKGYpOmYpfSxpbmRleDpmdW5jdGlvbihhKXtyZXR1cm4gYT8ic3RyaW5nIj09dHlwZW9mIGE/bS5pbkFycmF5KHRoaXNbMF0sbShhKSk6bS5pbkFycmF5KGEuanF1ZXJ5P2FbMF06YSx0aGlzKTp0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGU/dGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGg6LTF9LGFkZDpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLnB1c2hTdGFjayhtLnVuaXF1ZShtLm1lcmdlKHRoaXMuZ2V0KCksbShhLGIpKSkpfSxhZGRCYWNrOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmFkZChudWxsPT1hP3RoaXMucHJldk9iamVjdDp0aGlzLnByZXZPYmplY3QuZmlsdGVyKGEpKX19KTtmdW5jdGlvbiBEKGEsYil7ZG8gYT1hW2JdO3doaWxlKGEmJjEhPT1hLm5vZGVUeXBlKTtyZXR1cm4gYX1tLmVhY2goe3BhcmVudDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJjExIT09Yi5ub2RlVHlwZT9iOm51bGx9LHBhcmVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIG0uZGlyKGEsInBhcmVudE5vZGUiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gbS5kaXIoYSwicGFyZW50Tm9kZSIsYyl9LG5leHQ6ZnVuY3Rpb24oYSl7cmV0dXJuIEQoYSwibmV4dFNpYmxpbmciKX0scHJldjpmdW5jdGlvbihhKXtyZXR1cm4gRChhLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dEFsbDpmdW5jdGlvbihhKXtyZXR1cm4gbS5kaXIoYSwibmV4dFNpYmxpbmciKX0scHJldkFsbDpmdW5jdGlvbihhKXtyZXR1cm4gbS5kaXIoYSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIG0uZGlyKGEsIm5leHRTaWJsaW5nIixjKX0scHJldlVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gbS5kaXIoYSwicHJldmlvdXNTaWJsaW5nIixjKX0sc2libGluZ3M6ZnVuY3Rpb24oYSl7cmV0dXJuIG0uc2libGluZygoYS5wYXJlbnROb2RlfHx7fSkuZmlyc3RDaGlsZCxhKX0sY2hpbGRyZW46ZnVuY3Rpb24oYSl7cmV0dXJuIG0uc2libGluZyhhLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihhKXtyZXR1cm4gbS5ub2RlTmFtZShhLCJpZnJhbWUiKT9hLmNvbnRlbnREb2N1bWVudHx8YS5jb250ZW50V2luZG93LmRvY3VtZW50Om0ubWVyZ2UoW10sYS5jaGlsZE5vZGVzKX19LGZ1bmN0aW9uKGEsYil7bS5mblthXT1mdW5jdGlvbihjLGQpe3ZhciBlPW0ubWFwKHRoaXMsYixjKTtyZXR1cm4iVW50aWwiIT09YS5zbGljZSgtNSkmJihkPWMpLGQmJiJzdHJpbmciPT10eXBlb2YgZCYmKGU9bS5maWx0ZXIoZCxlKSksdGhpcy5sZW5ndGg+MSYmKENbYV18fChlPW0udW5pcXVlKGUpKSxCLnRlc3QoYSkmJihlPWUucmV2ZXJzZSgpKSksdGhpcy5wdXNoU3RhY2soZSl9fSk7dmFyIEU9L1xTKy9nLEY9e307ZnVuY3Rpb24gRyhhKXt2YXIgYj1GW2FdPXt9O3JldHVybiBtLmVhY2goYS5tYXRjaChFKXx8W10sZnVuY3Rpb24oYSxjKXtiW2NdPSEwfSksYn1tLkNhbGxiYWNrcz1mdW5jdGlvbihhKXthPSJzdHJpbmciPT10eXBlb2YgYT9GW2FdfHxHKGEpOm0uZXh0ZW5kKHt9LGEpO3ZhciBiLGMsZCxlLGYsZyxoPVtdLGk9IWEub25jZSYmW10saj1mdW5jdGlvbihsKXtmb3IoYz1hLm1lbW9yeSYmbCxkPSEwLGY9Z3x8MCxnPTAsZT1oLmxlbmd0aCxiPSEwO2gmJmU+ZjtmKyspaWYoaFtmXS5hcHBseShsWzBdLGxbMV0pPT09ITEmJmEuc3RvcE9uRmFsc2Upe2M9ITE7YnJlYWt9Yj0hMSxoJiYoaT9pLmxlbmd0aCYmaihpLnNoaWZ0KCkpOmM/aD1bXTprLmRpc2FibGUoKSl9LGs9e2FkZDpmdW5jdGlvbigpe2lmKGgpe3ZhciBkPWgubGVuZ3RoOyFmdW5jdGlvbiBmKGIpe20uZWFjaChiLGZ1bmN0aW9uKGIsYyl7dmFyIGQ9bS50eXBlKGMpOyJmdW5jdGlvbiI9PT1kP2EudW5pcXVlJiZrLmhhcyhjKXx8aC5wdXNoKGMpOmMmJmMubGVuZ3RoJiYic3RyaW5nIiE9PWQmJmYoYyl9KX0oYXJndW1lbnRzKSxiP2U9aC5sZW5ndGg6YyYmKGc9ZCxqKGMpKX1yZXR1cm4gdGhpc30scmVtb3ZlOmZ1bmN0aW9uKCl7cmV0dXJuIGgmJm0uZWFjaChhcmd1bWVudHMsZnVuY3Rpb24oYSxjKXt2YXIgZDt3aGlsZSgoZD1tLmluQXJyYXkoYyxoLGQpKT4tMSloLnNwbGljZShkLDEpLGImJihlPj1kJiZlLS0sZj49ZCYmZi0tKX0pLHRoaXN9LGhhczpmdW5jdGlvbihhKXtyZXR1cm4gYT9tLmluQXJyYXkoYSxoKT4tMTohKCFofHwhaC5sZW5ndGgpfSxlbXB0eTpmdW5jdGlvbigpe3JldHVybiBoPVtdLGU9MCx0aGlzfSxkaXNhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIGg9aT1jPXZvaWQgMCx0aGlzfSxkaXNhYmxlZDpmdW5jdGlvbigpe3JldHVybiFofSxsb2NrOmZ1bmN0aW9uKCl7cmV0dXJuIGk9dm9pZCAwLGN8fGsuZGlzYWJsZSgpLHRoaXN9LGxvY2tlZDpmdW5jdGlvbigpe3JldHVybiFpfSxmaXJlV2l0aDpmdW5jdGlvbihhLGMpe3JldHVybiFofHxkJiYhaXx8KGM9Y3x8W10sYz1bYSxjLnNsaWNlP2Muc2xpY2UoKTpjXSxiP2kucHVzaChjKTpqKGMpKSx0aGlzfSxmaXJlOmZ1bmN0aW9uKCl7cmV0dXJuIGsuZmlyZVdpdGgodGhpcyxhcmd1bWVudHMpLHRoaXN9LGZpcmVkOmZ1bmN0aW9uKCl7cmV0dXJuISFkfX07cmV0dXJuIGt9LG0uZXh0ZW5kKHtEZWZlcnJlZDpmdW5jdGlvbihhKXt2YXIgYj1bWyJyZXNvbHZlIiwiZG9uZSIsbS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksInJlc29sdmVkIl0sWyJyZWplY3QiLCJmYWlsIixtLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwicmVqZWN0ZWQiXSxbIm5vdGlmeSIsInByb2dyZXNzIixtLkNhbGxiYWNrcygibWVtb3J5IildXSxjPSJwZW5kaW5nIixkPXtzdGF0ZTpmdW5jdGlvbigpe3JldHVybiBjfSxhbHdheXM6ZnVuY3Rpb24oKXtyZXR1cm4gZS5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLHRoaXN9LHRoZW46ZnVuY3Rpb24oKXt2YXIgYT1hcmd1bWVudHM7cmV0dXJuIG0uRGVmZXJyZWQoZnVuY3Rpb24oYyl7bS5lYWNoKGIsZnVuY3Rpb24oYixmKXt2YXIgZz1tLmlzRnVuY3Rpb24oYVtiXSkmJmFbYl07ZVtmWzFdXShmdW5jdGlvbigpe3ZhciBhPWcmJmcuYXBwbHkodGhpcyxhcmd1bWVudHMpO2EmJm0uaXNGdW5jdGlvbihhLnByb21pc2UpP2EucHJvbWlzZSgpLmRvbmUoYy5yZXNvbHZlKS5mYWlsKGMucmVqZWN0KS5wcm9ncmVzcyhjLm5vdGlmeSk6Y1tmWzBdKyJXaXRoIl0odGhpcz09PWQ/Yy5wcm9taXNlKCk6dGhpcyxnP1thXTphcmd1bWVudHMpfSl9KSxhPW51bGx9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGwhPWE/bS5leHRlbmQoYSxkKTpkfX0sZT17fTtyZXR1cm4gZC5waXBlPWQudGhlbixtLmVhY2goYixmdW5jdGlvbihhLGYpe3ZhciBnPWZbMl0saD1mWzNdO2RbZlsxXV09Zy5hZGQsaCYmZy5hZGQoZnVuY3Rpb24oKXtjPWh9LGJbMV5hXVsyXS5kaXNhYmxlLGJbMl1bMl0ubG9jayksZVtmWzBdXT1mdW5jdGlvbigpe3JldHVybiBlW2ZbMF0rIldpdGgiXSh0aGlzPT09ZT9kOnRoaXMsYXJndW1lbnRzKSx0aGlzfSxlW2ZbMF0rIldpdGgiXT1nLmZpcmVXaXRofSksZC5wcm9taXNlKGUpLGEmJmEuY2FsbChlLGUpLGV9LHdoZW46ZnVuY3Rpb24oYSl7dmFyIGI9MCxjPWQuY2FsbChhcmd1bWVudHMpLGU9Yy5sZW5ndGgsZj0xIT09ZXx8YSYmbS5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/ZTowLGc9MT09PWY/YTptLkRlZmVycmVkKCksaD1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIGZ1bmN0aW9uKGUpe2JbYV09dGhpcyxjW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9kLmNhbGwoYXJndW1lbnRzKTplLGM9PT1pP2cubm90aWZ5V2l0aChiLGMpOi0tZnx8Zy5yZXNvbHZlV2l0aChiLGMpfX0saSxqLGs7aWYoZT4xKWZvcihpPW5ldyBBcnJheShlKSxqPW5ldyBBcnJheShlKSxrPW5ldyBBcnJheShlKTtlPmI7YisrKWNbYl0mJm0uaXNGdW5jdGlvbihjW2JdLnByb21pc2UpP2NbYl0ucHJvbWlzZSgpLmRvbmUoaChiLGssYykpLmZhaWwoZy5yZWplY3QpLnByb2dyZXNzKGgoYixqLGkpKTotLWY7cmV0dXJuIGZ8fGcucmVzb2x2ZVdpdGgoayxjKSxnLnByb21pc2UoKX19KTt2YXIgSDttLmZuLnJlYWR5PWZ1bmN0aW9uKGEpe3JldHVybiBtLnJlYWR5LnByb21pc2UoKS5kb25lKGEpLHRoaXN9LG0uZXh0ZW5kKHtpc1JlYWR5OiExLHJlYWR5V2FpdDoxLGhvbGRSZWFkeTpmdW5jdGlvbihhKXthP20ucmVhZHlXYWl0Kys6bS5yZWFkeSghMCl9LHJlYWR5OmZ1bmN0aW9uKGEpe2lmKGE9PT0hMD8hLS1tLnJlYWR5V2FpdDohbS5pc1JlYWR5KXtpZigheS5ib2R5KXJldHVybiBzZXRUaW1lb3V0KG0ucmVhZHkpO20uaXNSZWFkeT0hMCxhIT09ITAmJi0tbS5yZWFkeVdhaXQ+MHx8KEgucmVzb2x2ZVdpdGgoeSxbbV0pLG0uZm4udHJpZ2dlckhhbmRsZXImJihtKHkpLnRyaWdnZXJIYW5kbGVyKCJyZWFkeSIpLG0oeSkub2ZmKCJyZWFkeSIpKSl9fX0pO2Z1bmN0aW9uIEkoKXt5LmFkZEV2ZW50TGlzdGVuZXI/KHkucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsSiwhMSksYS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIixKLCExKSk6KHkuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsSiksYS5kZXRhY2hFdmVudCgib25sb2FkIixKKSl9ZnVuY3Rpb24gSigpeyh5LmFkZEV2ZW50TGlzdGVuZXJ8fCJsb2FkIj09PWV2ZW50LnR5cGV8fCJjb21wbGV0ZSI9PT15LnJlYWR5U3RhdGUpJiYoSSgpLG0ucmVhZHkoKSl9bS5yZWFkeS5wcm9taXNlPWZ1bmN0aW9uKGIpe2lmKCFIKWlmKEg9bS5EZWZlcnJlZCgpLCJjb21wbGV0ZSI9PT15LnJlYWR5U3RhdGUpc2V0VGltZW91dChtLnJlYWR5KTtlbHNlIGlmKHkuYWRkRXZlbnRMaXN0ZW5lcil5LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLEosITEpLGEuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsSiwhMSk7ZWxzZXt5LmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLEopLGEuYXR0YWNoRXZlbnQoIm9ubG9hZCIsSik7dmFyIGM9ITE7dHJ5e2M9bnVsbD09YS5mcmFtZUVsZW1lbnQmJnkuZG9jdW1lbnRFbGVtZW50fWNhdGNoKGQpe31jJiZjLmRvU2Nyb2xsJiYhZnVuY3Rpb24gZSgpe2lmKCFtLmlzUmVhZHkpe3RyeXtjLmRvU2Nyb2xsKCJsZWZ0Iil9Y2F0Y2goYSl7cmV0dXJuIHNldFRpbWVvdXQoZSw1MCl9SSgpLG0ucmVhZHkoKX19KCl9cmV0dXJuIEgucHJvbWlzZShiKX07dmFyIEs9InVuZGVmaW5lZCIsTDtmb3IoTCBpbiBtKGspKWJyZWFrO2sub3duTGFzdD0iMCIhPT1MLGsuaW5saW5lQmxvY2tOZWVkc0xheW91dD0hMSxtKGZ1bmN0aW9uKCl7dmFyIGEsYixjLGQ7Yz15LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0sYyYmYy5zdHlsZSYmKGI9eS5jcmVhdGVFbGVtZW50KCJkaXYiKSxkPXkuY3JlYXRlRWxlbWVudCgiZGl2IiksZC5zdHlsZS5jc3NUZXh0PSJwb3NpdGlvbjphYnNvbHV0ZTtib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweCIsYy5hcHBlbmRDaGlsZChkKS5hcHBlbmRDaGlsZChiKSx0eXBlb2YgYi5zdHlsZS56b29tIT09SyYmKGIuc3R5bGUuY3NzVGV4dD0iZGlzcGxheTppbmxpbmU7bWFyZ2luOjA7Ym9yZGVyOjA7cGFkZGluZzoxcHg7d2lkdGg6MXB4O3pvb206MSIsay5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PWE9Mz09PWIub2Zmc2V0V2lkdGgsYSYmKGMuc3R5bGUuem9vbT0xKSksYy5yZW1vdmVDaGlsZChkKSl9KSxmdW5jdGlvbigpe3ZhciBhPXkuY3JlYXRlRWxlbWVudCgiZGl2Iik7aWYobnVsbD09ay5kZWxldGVFeHBhbmRvKXtrLmRlbGV0ZUV4cGFuZG89ITA7dHJ5e2RlbGV0ZSBhLnRlc3R9Y2F0Y2goYil7ay5kZWxldGVFeHBhbmRvPSExfX1hPW51bGx9KCksbS5hY2NlcHREYXRhPWZ1bmN0aW9uKGEpe3ZhciBiPW0ubm9EYXRhWyhhLm5vZGVOYW1lKyIgIikudG9Mb3dlckNhc2UoKV0sYz0rYS5ub2RlVHlwZXx8MTtyZXR1cm4gMSE9PWMmJjkhPT1jPyExOiFifHxiIT09ITAmJmEuZ2V0QXR0cmlidXRlKCJjbGFzc2lkIik9PT1ifTt2YXIgTT0vXig/Olx7W1x3XFddKlx9fFxbW1x3XFddKlxdKSQvLE49LyhbQS1aXSkvZztmdW5jdGlvbiBPKGEsYixjKXtpZih2b2lkIDA9PT1jJiYxPT09YS5ub2RlVHlwZSl7dmFyIGQ9ImRhdGEtIitiLnJlcGxhY2UoTiwiLSQxIikudG9Mb3dlckNhc2UoKTtpZihjPWEuZ2V0QXR0cmlidXRlKGQpLCJzdHJpbmciPT10eXBlb2YgYyl7dHJ5e2M9InRydWUiPT09Yz8hMDoiZmFsc2UiPT09Yz8hMToibnVsbCI9PT1jP251bGw6K2MrIiI9PT1jPytjOk0udGVzdChjKT9tLnBhcnNlSlNPTihjKTpjfWNhdGNoKGUpe31tLmRhdGEoYSxiLGMpfWVsc2UgYz12b2lkIDB9cmV0dXJuIGN9ZnVuY3Rpb24gUChhKXt2YXIgYjtmb3IoYiBpbiBhKWlmKCgiZGF0YSIhPT1ifHwhbS5pc0VtcHR5T2JqZWN0KGFbYl0pKSYmInRvSlNPTiIhPT1iKXJldHVybiExOwoKcmV0dXJuITB9ZnVuY3Rpb24gUShhLGIsZCxlKXtpZihtLmFjY2VwdERhdGEoYSkpe3ZhciBmLGcsaD1tLmV4cGFuZG8saT1hLm5vZGVUeXBlLGo9aT9tLmNhY2hlOmEsaz1pP2FbaF06YVtoXSYmaDtpZihrJiZqW2tdJiYoZXx8altrXS5kYXRhKXx8dm9pZCAwIT09ZHx8InN0cmluZyIhPXR5cGVvZiBiKXJldHVybiBrfHwoaz1pP2FbaF09Yy5wb3AoKXx8bS5ndWlkKys6aCksaltrXXx8KGpba109aT97fTp7dG9KU09OOm0ubm9vcH0pLCgib2JqZWN0Ij09dHlwZW9mIGJ8fCJmdW5jdGlvbiI9PXR5cGVvZiBiKSYmKGU/altrXT1tLmV4dGVuZChqW2tdLGIpOmpba10uZGF0YT1tLmV4dGVuZChqW2tdLmRhdGEsYikpLGc9altrXSxlfHwoZy5kYXRhfHwoZy5kYXRhPXt9KSxnPWcuZGF0YSksdm9pZCAwIT09ZCYmKGdbbS5jYW1lbENhc2UoYildPWQpLCJzdHJpbmciPT10eXBlb2YgYj8oZj1nW2JdLG51bGw9PWYmJihmPWdbbS5jYW1lbENhc2UoYildKSk6Zj1nLGZ9fWZ1bmN0aW9uIFIoYSxiLGMpe2lmKG0uYWNjZXB0RGF0YShhKSl7dmFyIGQsZSxmPWEubm9kZVR5cGUsZz1mP20uY2FjaGU6YSxoPWY/YVttLmV4cGFuZG9dOm0uZXhwYW5kbztpZihnW2hdKXtpZihiJiYoZD1jP2dbaF06Z1toXS5kYXRhKSl7bS5pc0FycmF5KGIpP2I9Yi5jb25jYXQobS5tYXAoYixtLmNhbWVsQ2FzZSkpOmIgaW4gZD9iPVtiXTooYj1tLmNhbWVsQ2FzZShiKSxiPWIgaW4gZD9bYl06Yi5zcGxpdCgiICIpKSxlPWIubGVuZ3RoO3doaWxlKGUtLSlkZWxldGUgZFtiW2VdXTtpZihjPyFQKGQpOiFtLmlzRW1wdHlPYmplY3QoZCkpcmV0dXJufShjfHwoZGVsZXRlIGdbaF0uZGF0YSxQKGdbaF0pKSkmJihmP20uY2xlYW5EYXRhKFthXSwhMCk6ay5kZWxldGVFeHBhbmRvfHxnIT1nLndpbmRvdz9kZWxldGUgZ1toXTpnW2hdPW51bGwpfX19bS5leHRlbmQoe2NhY2hlOnt9LG5vRGF0YTp7ImFwcGxldCAiOiEwLCJlbWJlZCAiOiEwLCJvYmplY3QgIjoiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIn0saGFzRGF0YTpmdW5jdGlvbihhKXtyZXR1cm4gYT1hLm5vZGVUeXBlP20uY2FjaGVbYVttLmV4cGFuZG9dXTphW20uZXhwYW5kb10sISFhJiYhUChhKX0sZGF0YTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIFEoYSxiLGMpfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEsYil7cmV0dXJuIFIoYSxiKX0sX2RhdGE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBRKGEsYixjLCEwKX0sX3JlbW92ZURhdGE6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gUihhLGIsITApfX0pLG0uZm4uZXh0ZW5kKHtkYXRhOmZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGY9dGhpc1swXSxnPWYmJmYuYXR0cmlidXRlcztpZih2b2lkIDA9PT1hKXtpZih0aGlzLmxlbmd0aCYmKGU9bS5kYXRhKGYpLDE9PT1mLm5vZGVUeXBlJiYhbS5fZGF0YShmLCJwYXJzZWRBdHRycyIpKSl7Yz1nLmxlbmd0aDt3aGlsZShjLS0pZ1tjXSYmKGQ9Z1tjXS5uYW1lLDA9PT1kLmluZGV4T2YoImRhdGEtIikmJihkPW0uY2FtZWxDYXNlKGQuc2xpY2UoNSkpLE8oZixkLGVbZF0pKSk7bS5fZGF0YShmLCJwYXJzZWRBdHRycyIsITApfXJldHVybiBlfXJldHVybiJvYmplY3QiPT10eXBlb2YgYT90aGlzLmVhY2goZnVuY3Rpb24oKXttLmRhdGEodGhpcyxhKX0pOmFyZ3VtZW50cy5sZW5ndGg+MT90aGlzLmVhY2goZnVuY3Rpb24oKXttLmRhdGEodGhpcyxhLGIpfSk6Zj9PKGYsYSxtLmRhdGEoZixhKSk6dm9pZCAwfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXttLnJlbW92ZURhdGEodGhpcyxhKX0pfX0pLG0uZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ7cmV0dXJuIGE/KGI9KGJ8fCJmeCIpKyJxdWV1ZSIsZD1tLl9kYXRhKGEsYiksYyYmKCFkfHxtLmlzQXJyYXkoYyk/ZD1tLl9kYXRhKGEsYixtLm1ha2VBcnJheShjKSk6ZC5wdXNoKGMpKSxkfHxbXSk6dm9pZCAwfSxkZXF1ZXVlOmZ1bmN0aW9uKGEsYil7Yj1ifHwiZngiO3ZhciBjPW0ucXVldWUoYSxiKSxkPWMubGVuZ3RoLGU9Yy5zaGlmdCgpLGY9bS5fcXVldWVIb29rcyhhLGIpLGc9ZnVuY3Rpb24oKXttLmRlcXVldWUoYSxiKX07ImlucHJvZ3Jlc3MiPT09ZSYmKGU9Yy5zaGlmdCgpLGQtLSksZSYmKCJmeCI9PT1iJiZjLnVuc2hpZnQoImlucHJvZ3Jlc3MiKSxkZWxldGUgZi5zdG9wLGUuY2FsbChhLGcsZikpLCFkJiZmJiZmLmVtcHR5LmZpcmUoKX0sX3F1ZXVlSG9va3M6ZnVuY3Rpb24oYSxiKXt2YXIgYz1iKyJxdWV1ZUhvb2tzIjtyZXR1cm4gbS5fZGF0YShhLGMpfHxtLl9kYXRhKGEsYyx7ZW1wdHk6bS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IikuYWRkKGZ1bmN0aW9uKCl7bS5fcmVtb3ZlRGF0YShhLGIrInF1ZXVlIiksbS5fcmVtb3ZlRGF0YShhLGMpfSl9KX19KSxtLmZuLmV4dGVuZCh7cXVldWU6ZnVuY3Rpb24oYSxiKXt2YXIgYz0yO3JldHVybiJzdHJpbmciIT10eXBlb2YgYSYmKGI9YSxhPSJmeCIsYy0tKSxhcmd1bWVudHMubGVuZ3RoPGM/bS5xdWV1ZSh0aGlzWzBdLGEpOnZvaWQgMD09PWI/dGhpczp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYz1tLnF1ZXVlKHRoaXMsYSxiKTttLl9xdWV1ZUhvb2tzKHRoaXMsYSksImZ4Ij09PWEmJiJpbnByb2dyZXNzIiE9PWNbMF0mJm0uZGVxdWV1ZSh0aGlzLGEpfSl9LGRlcXVldWU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe20uZGVxdWV1ZSh0aGlzLGEpfSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucXVldWUoYXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPTEsZT1tLkRlZmVycmVkKCksZj10aGlzLGc9dGhpcy5sZW5ndGgsaD1mdW5jdGlvbigpey0tZHx8ZS5yZXNvbHZlV2l0aChmLFtmXSl9OyJzdHJpbmciIT10eXBlb2YgYSYmKGI9YSxhPXZvaWQgMCksYT1hfHwiZngiO3doaWxlKGctLSljPW0uX2RhdGEoZltnXSxhKyJxdWV1ZUhvb2tzIiksYyYmYy5lbXB0eSYmKGQrKyxjLmVtcHR5LmFkZChoKSk7cmV0dXJuIGgoKSxlLnByb21pc2UoYil9fSk7dmFyIFM9L1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLy5zb3VyY2UsVD1bIlRvcCIsIlJpZ2h0IiwiQm90dG9tIiwiTGVmdCJdLFU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYT1ifHxhLCJub25lIj09PW0uY3NzKGEsImRpc3BsYXkiKXx8IW0uY29udGFpbnMoYS5vd25lckRvY3VtZW50LGEpfSxWPW0uYWNjZXNzPWZ1bmN0aW9uKGEsYixjLGQsZSxmLGcpe3ZhciBoPTAsaT1hLmxlbmd0aCxqPW51bGw9PWM7aWYoIm9iamVjdCI9PT1tLnR5cGUoYykpe2U9ITA7Zm9yKGggaW4gYyltLmFjY2VzcyhhLGIsaCxjW2hdLCEwLGYsZyl9ZWxzZSBpZih2b2lkIDAhPT1kJiYoZT0hMCxtLmlzRnVuY3Rpb24oZCl8fChnPSEwKSxqJiYoZz8oYi5jYWxsKGEsZCksYj1udWxsKTooaj1iLGI9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBqLmNhbGwobShhKSxjKX0pKSxiKSlmb3IoO2k+aDtoKyspYihhW2hdLGMsZz9kOmQuY2FsbChhW2hdLGgsYihhW2hdLGMpKSk7cmV0dXJuIGU/YTpqP2IuY2FsbChhKTppP2IoYVswXSxjKTpmfSxXPS9eKD86Y2hlY2tib3h8cmFkaW8pJC9pOyFmdW5jdGlvbigpe3ZhciBhPXkuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSxiPXkuY3JlYXRlRWxlbWVudCgiZGl2IiksYz15LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtpZihiLmlubmVySFRNTD0iICA8bGluay8+PHRhYmxlPjwvdGFibGU+PGEgaHJlZj0nL2EnPmE8L2E+PGlucHV0IHR5cGU9J2NoZWNrYm94Jy8+IixrLmxlYWRpbmdXaGl0ZXNwYWNlPTM9PT1iLmZpcnN0Q2hpbGQubm9kZVR5cGUsay50Ym9keT0hYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsay5odG1sU2VyaWFsaXplPSEhYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGluayIpLmxlbmd0aCxrLmh0bWw1Q2xvbmU9Ijw6bmF2PjwvOm5hdj4iIT09eS5jcmVhdGVFbGVtZW50KCJuYXYiKS5jbG9uZU5vZGUoITApLm91dGVySFRNTCxhLnR5cGU9ImNoZWNrYm94IixhLmNoZWNrZWQ9ITAsYy5hcHBlbmRDaGlsZChhKSxrLmFwcGVuZENoZWNrZWQ9YS5jaGVja2VkLGIuaW5uZXJIVE1MPSI8dGV4dGFyZWE+eDwvdGV4dGFyZWE+IixrLm5vQ2xvbmVDaGVja2VkPSEhYi5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5kZWZhdWx0VmFsdWUsYy5hcHBlbmRDaGlsZChiKSxiLmlubmVySFRNTD0iPGlucHV0IHR5cGU9J3JhZGlvJyBjaGVja2VkPSdjaGVja2VkJyBuYW1lPSd0Jy8+IixrLmNoZWNrQ2xvbmU9Yi5jbG9uZU5vZGUoITApLmNsb25lTm9kZSghMCkubGFzdENoaWxkLmNoZWNrZWQsay5ub0Nsb25lRXZlbnQ9ITAsYi5hdHRhY2hFdmVudCYmKGIuYXR0YWNoRXZlbnQoIm9uY2xpY2siLGZ1bmN0aW9uKCl7ay5ub0Nsb25lRXZlbnQ9ITF9KSxiLmNsb25lTm9kZSghMCkuY2xpY2soKSksbnVsbD09ay5kZWxldGVFeHBhbmRvKXtrLmRlbGV0ZUV4cGFuZG89ITA7dHJ5e2RlbGV0ZSBiLnRlc3R9Y2F0Y2goZCl7ay5kZWxldGVFeHBhbmRvPSExfX19KCksZnVuY3Rpb24oKXt2YXIgYixjLGQ9eS5jcmVhdGVFbGVtZW50KCJkaXYiKTtmb3IoYiBpbntzdWJtaXQ6ITAsY2hhbmdlOiEwLGZvY3VzaW46ITB9KWM9Im9uIitiLChrW2IrIkJ1YmJsZXMiXT1jIGluIGEpfHwoZC5zZXRBdHRyaWJ1dGUoYywidCIpLGtbYisiQnViYmxlcyJdPWQuYXR0cmlidXRlc1tjXS5leHBhbmRvPT09ITEpO2Q9bnVsbH0oKTt2YXIgWD0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2ksWT0vXmtleS8sWj0vXig/Om1vdXNlfHBvaW50ZXJ8Y29udGV4dG1lbnUpfGNsaWNrLywkPS9eKD86Zm9jdXNpbmZvY3VzfGZvY3Vzb3V0Ymx1cikkLyxfPS9eKFteLl0qKSg/OlwuKC4rKXwpJC87ZnVuY3Rpb24gYWEoKXtyZXR1cm4hMH1mdW5jdGlvbiBiYSgpe3JldHVybiExfWZ1bmN0aW9uIGNhKCl7dHJ5e3JldHVybiB5LmFjdGl2ZUVsZW1lbnR9Y2F0Y2goYSl7fX1tLmV2ZW50PXtnbG9iYWw6e30sYWRkOmZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGYsZyxoLGksaixrLGwsbixvLHAscSxyPW0uX2RhdGEoYSk7aWYocil7Yy5oYW5kbGVyJiYoaT1jLGM9aS5oYW5kbGVyLGU9aS5zZWxlY3RvciksYy5ndWlkfHwoYy5ndWlkPW0uZ3VpZCsrKSwoZz1yLmV2ZW50cyl8fChnPXIuZXZlbnRzPXt9KSwoaz1yLmhhbmRsZSl8fChrPXIuaGFuZGxlPWZ1bmN0aW9uKGEpe3JldHVybiB0eXBlb2YgbT09PUt8fGEmJm0uZXZlbnQudHJpZ2dlcmVkPT09YS50eXBlP3ZvaWQgMDptLmV2ZW50LmRpc3BhdGNoLmFwcGx5KGsuZWxlbSxhcmd1bWVudHMpfSxrLmVsZW09YSksYj0oYnx8IiIpLm1hdGNoKEUpfHxbIiJdLGg9Yi5sZW5ndGg7d2hpbGUoaC0tKWY9Xy5leGVjKGJbaF0pfHxbXSxvPXE9ZlsxXSxwPShmWzJdfHwiIikuc3BsaXQoIi4iKS5zb3J0KCksbyYmKGo9bS5ldmVudC5zcGVjaWFsW29dfHx7fSxvPShlP2ouZGVsZWdhdGVUeXBlOmouYmluZFR5cGUpfHxvLGo9bS5ldmVudC5zcGVjaWFsW29dfHx7fSxsPW0uZXh0ZW5kKHt0eXBlOm8sb3JpZ1R5cGU6cSxkYXRhOmQsaGFuZGxlcjpjLGd1aWQ6Yy5ndWlkLHNlbGVjdG9yOmUsbmVlZHNDb250ZXh0OmUmJm0uZXhwci5tYXRjaC5uZWVkc0NvbnRleHQudGVzdChlKSxuYW1lc3BhY2U6cC5qb2luKCIuIil9LGkpLChuPWdbb10pfHwobj1nW29dPVtdLG4uZGVsZWdhdGVDb3VudD0wLGouc2V0dXAmJmouc2V0dXAuY2FsbChhLGQscCxrKSE9PSExfHwoYS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihvLGssITEpOmEuYXR0YWNoRXZlbnQmJmEuYXR0YWNoRXZlbnQoIm9uIitvLGspKSksai5hZGQmJihqLmFkZC5jYWxsKGEsbCksbC5oYW5kbGVyLmd1aWR8fChsLmhhbmRsZXIuZ3VpZD1jLmd1aWQpKSxlP24uc3BsaWNlKG4uZGVsZWdhdGVDb3VudCsrLDAsbCk6bi5wdXNoKGwpLG0uZXZlbnQuZ2xvYmFsW29dPSEwKTthPW51bGx9fSxyZW1vdmU6ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZixnLGgsaSxqLGssbCxuLG8scCxxLHI9bS5oYXNEYXRhKGEpJiZtLl9kYXRhKGEpO2lmKHImJihrPXIuZXZlbnRzKSl7Yj0oYnx8IiIpLm1hdGNoKEUpfHxbIiJdLGo9Yi5sZW5ndGg7d2hpbGUoai0tKWlmKGg9Xy5leGVjKGJbal0pfHxbXSxvPXE9aFsxXSxwPShoWzJdfHwiIikuc3BsaXQoIi4iKS5zb3J0KCksbyl7bD1tLmV2ZW50LnNwZWNpYWxbb118fHt9LG89KGQ/bC5kZWxlZ2F0ZVR5cGU6bC5iaW5kVHlwZSl8fG8sbj1rW29dfHxbXSxoPWhbMl0mJm5ldyBSZWdFeHAoIihefFxcLikiK3Auam9pbigiXFwuKD86LipcXC58KSIpKyIoXFwufCQpIiksaT1mPW4ubGVuZ3RoO3doaWxlKGYtLSlnPW5bZl0sIWUmJnEhPT1nLm9yaWdUeXBlfHxjJiZjLmd1aWQhPT1nLmd1aWR8fGgmJiFoLnRlc3QoZy5uYW1lc3BhY2UpfHxkJiZkIT09Zy5zZWxlY3RvciYmKCIqKiIhPT1kfHwhZy5zZWxlY3Rvcil8fChuLnNwbGljZShmLDEpLGcuc2VsZWN0b3ImJm4uZGVsZWdhdGVDb3VudC0tLGwucmVtb3ZlJiZsLnJlbW92ZS5jYWxsKGEsZykpO2kmJiFuLmxlbmd0aCYmKGwudGVhcmRvd24mJmwudGVhcmRvd24uY2FsbChhLHAsci5oYW5kbGUpIT09ITF8fG0ucmVtb3ZlRXZlbnQoYSxvLHIuaGFuZGxlKSxkZWxldGUga1tvXSl9ZWxzZSBmb3IobyBpbiBrKW0uZXZlbnQucmVtb3ZlKGEsbytiW2pdLGMsZCwhMCk7bS5pc0VtcHR5T2JqZWN0KGspJiYoZGVsZXRlIHIuaGFuZGxlLG0uX3JlbW92ZURhdGEoYSwiZXZlbnRzIikpfX0sdHJpZ2dlcjpmdW5jdGlvbihiLGMsZCxlKXt2YXIgZixnLGgsaSxrLGwsbixvPVtkfHx5XSxwPWouY2FsbChiLCJ0eXBlIik/Yi50eXBlOmIscT1qLmNhbGwoYiwibmFtZXNwYWNlIik/Yi5uYW1lc3BhY2Uuc3BsaXQoIi4iKTpbXTtpZihoPWw9ZD1kfHx5LDMhPT1kLm5vZGVUeXBlJiY4IT09ZC5ub2RlVHlwZSYmISQudGVzdChwK20uZXZlbnQudHJpZ2dlcmVkKSYmKHAuaW5kZXhPZigiLiIpPj0wJiYocT1wLnNwbGl0KCIuIikscD1xLnNoaWZ0KCkscS5zb3J0KCkpLGc9cC5pbmRleE9mKCI6Iik8MCYmIm9uIitwLGI9YlttLmV4cGFuZG9dP2I6bmV3IG0uRXZlbnQocCwib2JqZWN0Ij09dHlwZW9mIGImJmIpLGIuaXNUcmlnZ2VyPWU/MjozLGIubmFtZXNwYWNlPXEuam9pbigiLiIpLGIubmFtZXNwYWNlX3JlPWIubmFtZXNwYWNlP25ldyBSZWdFeHAoIihefFxcLikiK3Euam9pbigiXFwuKD86LipcXC58KSIpKyIoXFwufCQpIik6bnVsbCxiLnJlc3VsdD12b2lkIDAsYi50YXJnZXR8fChiLnRhcmdldD1kKSxjPW51bGw9PWM/W2JdOm0ubWFrZUFycmF5KGMsW2JdKSxrPW0uZXZlbnQuc3BlY2lhbFtwXXx8e30sZXx8IWsudHJpZ2dlcnx8ay50cmlnZ2VyLmFwcGx5KGQsYykhPT0hMSkpe2lmKCFlJiYhay5ub0J1YmJsZSYmIW0uaXNXaW5kb3coZCkpe2ZvcihpPWsuZGVsZWdhdGVUeXBlfHxwLCQudGVzdChpK3ApfHwoaD1oLnBhcmVudE5vZGUpO2g7aD1oLnBhcmVudE5vZGUpby5wdXNoKGgpLGw9aDtsPT09KGQub3duZXJEb2N1bWVudHx8eSkmJm8ucHVzaChsLmRlZmF1bHRWaWV3fHxsLnBhcmVudFdpbmRvd3x8YSl9bj0wO3doaWxlKChoPW9bbisrXSkmJiFiLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpYi50eXBlPW4+MT9pOmsuYmluZFR5cGV8fHAsZj0obS5fZGF0YShoLCJldmVudHMiKXx8e30pW2IudHlwZV0mJm0uX2RhdGEoaCwiaGFuZGxlIiksZiYmZi5hcHBseShoLGMpLGY9ZyYmaFtnXSxmJiZmLmFwcGx5JiZtLmFjY2VwdERhdGEoaCkmJihiLnJlc3VsdD1mLmFwcGx5KGgsYyksYi5yZXN1bHQ9PT0hMSYmYi5wcmV2ZW50RGVmYXVsdCgpKTtpZihiLnR5cGU9cCwhZSYmIWIuaXNEZWZhdWx0UHJldmVudGVkKCkmJighay5fZGVmYXVsdHx8ay5fZGVmYXVsdC5hcHBseShvLnBvcCgpLGMpPT09ITEpJiZtLmFjY2VwdERhdGEoZCkmJmcmJmRbcF0mJiFtLmlzV2luZG93KGQpKXtsPWRbZ10sbCYmKGRbZ109bnVsbCksbS5ldmVudC50cmlnZ2VyZWQ9cDt0cnl7ZFtwXSgpfWNhdGNoKHIpe31tLmV2ZW50LnRyaWdnZXJlZD12b2lkIDAsbCYmKGRbZ109bCl9cmV0dXJuIGIucmVzdWx0fX0sZGlzcGF0Y2g6ZnVuY3Rpb24oYSl7YT1tLmV2ZW50LmZpeChhKTt2YXIgYixjLGUsZixnLGg9W10saT1kLmNhbGwoYXJndW1lbnRzKSxqPShtLl9kYXRhKHRoaXMsImV2ZW50cyIpfHx7fSlbYS50eXBlXXx8W10saz1tLmV2ZW50LnNwZWNpYWxbYS50eXBlXXx8e307aWYoaVswXT1hLGEuZGVsZWdhdGVUYXJnZXQ9dGhpcywhay5wcmVEaXNwYXRjaHx8ay5wcmVEaXNwYXRjaC5jYWxsKHRoaXMsYSkhPT0hMSl7aD1tLmV2ZW50LmhhbmRsZXJzLmNhbGwodGhpcyxhLGopLGI9MDt3aGlsZSgoZj1oW2IrK10pJiYhYS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKXthLmN1cnJlbnRUYXJnZXQ9Zi5lbGVtLGc9MDt3aGlsZSgoZT1mLmhhbmRsZXJzW2crK10pJiYhYS5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKSghYS5uYW1lc3BhY2VfcmV8fGEubmFtZXNwYWNlX3JlLnRlc3QoZS5uYW1lc3BhY2UpKSYmKGEuaGFuZGxlT2JqPWUsYS5kYXRhPWUuZGF0YSxjPSgobS5ldmVudC5zcGVjaWFsW2Uub3JpZ1R5cGVdfHx7fSkuaGFuZGxlfHxlLmhhbmRsZXIpLmFwcGx5KGYuZWxlbSxpKSx2b2lkIDAhPT1jJiYoYS5yZXN1bHQ9Yyk9PT0hMSYmKGEucHJldmVudERlZmF1bHQoKSxhLnN0b3BQcm9wYWdhdGlvbigpKSl9cmV0dXJuIGsucG9zdERpc3BhdGNoJiZrLnBvc3REaXNwYXRjaC5jYWxsKHRoaXMsYSksYS5yZXN1bHR9fSxoYW5kbGVyczpmdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxmLGc9W10saD1iLmRlbGVnYXRlQ291bnQsaT1hLnRhcmdldDtpZihoJiZpLm5vZGVUeXBlJiYoIWEuYnV0dG9ufHwiY2xpY2siIT09YS50eXBlKSlmb3IoO2khPXRoaXM7aT1pLnBhcmVudE5vZGV8fHRoaXMpaWYoMT09PWkubm9kZVR5cGUmJihpLmRpc2FibGVkIT09ITB8fCJjbGljayIhPT1hLnR5cGUpKXtmb3IoZT1bXSxmPTA7aD5mO2YrKylkPWJbZl0sYz1kLnNlbGVjdG9yKyIgIix2b2lkIDA9PT1lW2NdJiYoZVtjXT1kLm5lZWRzQ29udGV4dD9tKGMsdGhpcykuaW5kZXgoaSk+PTA6bS5maW5kKGMsdGhpcyxudWxsLFtpXSkubGVuZ3RoKSxlW2NdJiZlLnB1c2goZCk7ZS5sZW5ndGgmJmcucHVzaCh7ZWxlbTppLGhhbmRsZXJzOmV9KX1yZXR1cm4gaDxiLmxlbmd0aCYmZy5wdXNoKHtlbGVtOnRoaXMsaGFuZGxlcnM6Yi5zbGljZShoKX0pLGd9LGZpeDpmdW5jdGlvbihhKXtpZihhW20uZXhwYW5kb10pcmV0dXJuIGE7dmFyIGIsYyxkLGU9YS50eXBlLGY9YSxnPXRoaXMuZml4SG9va3NbZV07Z3x8KHRoaXMuZml4SG9va3NbZV09Zz1aLnRlc3QoZSk/dGhpcy5tb3VzZUhvb2tzOlkudGVzdChlKT90aGlzLmtleUhvb2tzOnt9KSxkPWcucHJvcHM/dGhpcy5wcm9wcy5jb25jYXQoZy5wcm9wcyk6dGhpcy5wcm9wcyxhPW5ldyBtLkV2ZW50KGYpLGI9ZC5sZW5ndGg7d2hpbGUoYi0tKWM9ZFtiXSxhW2NdPWZbY107cmV0dXJuIGEudGFyZ2V0fHwoYS50YXJnZXQ9Zi5zcmNFbGVtZW50fHx5KSwzPT09YS50YXJnZXQubm9kZVR5cGUmJihhLnRhcmdldD1hLnRhcmdldC5wYXJlbnROb2RlKSxhLm1ldGFLZXk9ISFhLm1ldGFLZXksZy5maWx0ZXI/Zy5maWx0ZXIoYSxmKTphfSxwcm9wczoiYWx0S2V5IGJ1YmJsZXMgY2FuY2VsYWJsZSBjdHJsS2V5IGN1cnJlbnRUYXJnZXQgZXZlbnRQaGFzZSBtZXRhS2V5IHJlbGF0ZWRUYXJnZXQgc2hpZnRLZXkgdGFyZ2V0IHRpbWVTdGFtcCB2aWV3IHdoaWNoIi5zcGxpdCgiICIpLGZpeEhvb2tzOnt9LGtleUhvb2tzOntwcm9wczoiY2hhciBjaGFyQ29kZSBrZXkga2V5Q29kZSIuc3BsaXQoIiAiKSxmaWx0ZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbnVsbD09YS53aGljaCYmKGEud2hpY2g9bnVsbCE9Yi5jaGFyQ29kZT9iLmNoYXJDb2RlOmIua2V5Q29kZSksYX19LG1vdXNlSG9va3M6e3Byb3BzOiJidXR0b24gYnV0dG9ucyBjbGllbnRYIGNsaWVudFkgZnJvbUVsZW1lbnQgb2Zmc2V0WCBvZmZzZXRZIHBhZ2VYIHBhZ2VZIHNjcmVlblggc2NyZWVuWSB0b0VsZW1lbnQiLnNwbGl0KCIgIiksZmlsdGVyOmZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGY9Yi5idXR0b24sZz1iLmZyb21FbGVtZW50O3JldHVybiBudWxsPT1hLnBhZ2VYJiZudWxsIT1iLmNsaWVudFgmJihkPWEudGFyZ2V0Lm93bmVyRG9jdW1lbnR8fHksZT1kLmRvY3VtZW50RWxlbWVudCxjPWQuYm9keSxhLnBhZ2VYPWIuY2xpZW50WCsoZSYmZS5zY3JvbGxMZWZ0fHxjJiZjLnNjcm9sbExlZnR8fDApLShlJiZlLmNsaWVudExlZnR8fGMmJmMuY2xpZW50TGVmdHx8MCksYS5wYWdlWT1iLmNsaWVudFkrKGUmJmUuc2Nyb2xsVG9wfHxjJiZjLnNjcm9sbFRvcHx8MCktKGUmJmUuY2xpZW50VG9wfHxjJiZjLmNsaWVudFRvcHx8MCkpLCFhLnJlbGF0ZWRUYXJnZXQmJmcmJihhLnJlbGF0ZWRUYXJnZXQ9Zz09PWEudGFyZ2V0P2IudG9FbGVtZW50OmcpLGEud2hpY2h8fHZvaWQgMD09PWZ8fChhLndoaWNoPTEmZj8xOjImZj8zOjQmZj8yOjApLGF9fSxzcGVjaWFsOntsb2FkOntub0J1YmJsZTohMH0sZm9jdXM6e3RyaWdnZXI6ZnVuY3Rpb24oKXtpZih0aGlzIT09Y2EoKSYmdGhpcy5mb2N1cyl0cnl7cmV0dXJuIHRoaXMuZm9jdXMoKSwhMX1jYXRjaChhKXt9fSxkZWxlZ2F0ZVR5cGU6ImZvY3VzaW4ifSxibHVyOnt0cmlnZ2VyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXM9PT1jYSgpJiZ0aGlzLmJsdXI/KHRoaXMuYmx1cigpLCExKTp2b2lkIDB9LGRlbGVnYXRlVHlwZToiZm9jdXNvdXQifSxjbGljazp7dHJpZ2dlcjpmdW5jdGlvbigpe3JldHVybiBtLm5vZGVOYW1lKHRoaXMsImlucHV0IikmJiJjaGVja2JveCI9PT10aGlzLnR5cGUmJnRoaXMuY2xpY2s/KHRoaXMuY2xpY2soKSwhMSk6dm9pZCAwfSxfZGVmYXVsdDpmdW5jdGlvbihhKXtyZXR1cm4gbS5ub2RlTmFtZShhLnRhcmdldCwiYSIpfX0sYmVmb3JldW5sb2FkOntwb3N0RGlzcGF0Y2g6ZnVuY3Rpb24oYSl7dm9pZCAwIT09YS5yZXN1bHQmJmEub3JpZ2luYWxFdmVudCYmKGEub3JpZ2luYWxFdmVudC5yZXR1cm5WYWx1ZT1hLnJlc3VsdCl9fX0sc2ltdWxhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9bS5leHRlbmQobmV3IG0uRXZlbnQsYyx7dHlwZTphLGlzU2ltdWxhdGVkOiEwLG9yaWdpbmFsRXZlbnQ6e319KTtkP20uZXZlbnQudHJpZ2dlcihlLG51bGwsYik6bS5ldmVudC5kaXNwYXRjaC5jYWxsKGIsZSksZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmYy5wcmV2ZW50RGVmYXVsdCgpfX0sbS5yZW1vdmVFdmVudD15LnJlbW92ZUV2ZW50TGlzdGVuZXI/ZnVuY3Rpb24oYSxiLGMpe2EucmVtb3ZlRXZlbnRMaXN0ZW5lciYmYS5yZW1vdmVFdmVudExpc3RlbmVyKGIsYywhMSl9OmZ1bmN0aW9uKGEsYixjKXt2YXIgZD0ib24iK2I7YS5kZXRhY2hFdmVudCYmKHR5cGVvZiBhW2RdPT09SyYmKGFbZF09bnVsbCksYS5kZXRhY2hFdmVudChkLGMpKX0sbS5FdmVudD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzIGluc3RhbmNlb2YgbS5FdmVudD8oYSYmYS50eXBlPyh0aGlzLm9yaWdpbmFsRXZlbnQ9YSx0aGlzLnR5cGU9YS50eXBlLHRoaXMuaXNEZWZhdWx0UHJldmVudGVkPWEuZGVmYXVsdFByZXZlbnRlZHx8dm9pZCAwPT09YS5kZWZhdWx0UHJldmVudGVkJiZhLnJldHVyblZhbHVlPT09ITE/YWE6YmEpOnRoaXMudHlwZT1hLGImJm0uZXh0ZW5kKHRoaXMsYiksdGhpcy50aW1lU3RhbXA9YSYmYS50aW1lU3RhbXB8fG0ubm93KCksdm9pZCh0aGlzW20uZXhwYW5kb109ITApKTpuZXcgbS5FdmVudChhLGIpfSxtLkV2ZW50LnByb3RvdHlwZT17aXNEZWZhdWx0UHJldmVudGVkOmJhLGlzUHJvcGFnYXRpb25TdG9wcGVkOmJhLGlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOmJhLHByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50O3RoaXMuaXNEZWZhdWx0UHJldmVudGVkPWFhLGEmJihhLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTphLnJldHVyblZhbHVlPSExKX0sc3RvcFByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50O3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9YWEsYSYmKGEuc3RvcFByb3BhZ2F0aW9uJiZhLnN0b3BQcm9wYWdhdGlvbigpLGEuY2FuY2VsQnViYmxlPSEwKX0sc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50O3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9YWEsYSYmYS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24mJmEuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksdGhpcy5zdG9wUHJvcGFnYXRpb24oKX19LG0uZWFjaCh7bW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCIscG9pbnRlcmVudGVyOiJwb2ludGVyb3ZlciIscG9pbnRlcmxlYXZlOiJwb2ludGVyb3V0In0sZnVuY3Rpb24oYSxiKXttLmV2ZW50LnNwZWNpYWxbYV09e2RlbGVnYXRlVHlwZTpiLGJpbmRUeXBlOmIsaGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBjLGQ9dGhpcyxlPWEucmVsYXRlZFRhcmdldCxmPWEuaGFuZGxlT2JqO3JldHVybighZXx8ZSE9PWQmJiFtLmNvbnRhaW5zKGQsZSkpJiYoYS50eXBlPWYub3JpZ1R5cGUsYz1mLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpLGEudHlwZT1iKSxjfX19KSxrLnN1Ym1pdEJ1YmJsZXN8fChtLmV2ZW50LnNwZWNpYWwuc3VibWl0PXtzZXR1cDpmdW5jdGlvbigpe3JldHVybiBtLm5vZGVOYW1lKHRoaXMsImZvcm0iKT8hMTp2b2lkIG0uZXZlbnQuYWRkKHRoaXMsImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdCIsZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQsYz1tLm5vZGVOYW1lKGIsImlucHV0Iil8fG0ubm9kZU5hbWUoYiwiYnV0dG9uIik/Yi5mb3JtOnZvaWQgMDtjJiYhbS5fZGF0YShjLCJzdWJtaXRCdWJibGVzIikmJihtLmV2ZW50LmFkZChjLCJzdWJtaXQuX3N1Ym1pdCIsZnVuY3Rpb24oYSl7YS5fc3VibWl0X2J1YmJsZT0hMH0pLG0uX2RhdGEoYywic3VibWl0QnViYmxlcyIsITApKX0pfSxwb3N0RGlzcGF0Y2g6ZnVuY3Rpb24oYSl7YS5fc3VibWl0X2J1YmJsZSYmKGRlbGV0ZSBhLl9zdWJtaXRfYnViYmxlLHRoaXMucGFyZW50Tm9kZSYmIWEuaXNUcmlnZ2VyJiZtLmV2ZW50LnNpbXVsYXRlKCJzdWJtaXQiLHRoaXMucGFyZW50Tm9kZSxhLCEwKSl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7cmV0dXJuIG0ubm9kZU5hbWUodGhpcywiZm9ybSIpPyExOnZvaWQgbS5ldmVudC5yZW1vdmUodGhpcywiLl9zdWJtaXQiKX19KSxrLmNoYW5nZUJ1YmJsZXN8fChtLmV2ZW50LnNwZWNpYWwuY2hhbmdlPXtzZXR1cDpmdW5jdGlvbigpe3JldHVybiBYLnRlc3QodGhpcy5ub2RlTmFtZSk/KCgiY2hlY2tib3giPT09dGhpcy50eXBlfHwicmFkaW8iPT09dGhpcy50eXBlKSYmKG0uZXZlbnQuYWRkKHRoaXMsInByb3BlcnR5Y2hhbmdlLl9jaGFuZ2UiLGZ1bmN0aW9uKGEpeyJjaGVja2VkIj09PWEub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUmJih0aGlzLl9qdXN0X2NoYW5nZWQ9ITApfSksbS5ldmVudC5hZGQodGhpcywiY2xpY2suX2NoYW5nZSIsZnVuY3Rpb24oYSl7dGhpcy5fanVzdF9jaGFuZ2VkJiYhYS5pc1RyaWdnZXImJih0aGlzLl9qdXN0X2NoYW5nZWQ9ITEpLG0uZXZlbnQuc2ltdWxhdGUoImNoYW5nZSIsdGhpcyxhLCEwKX0pKSwhMSk6dm9pZCBtLmV2ZW50LmFkZCh0aGlzLCJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlIixmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldDtYLnRlc3QoYi5ub2RlTmFtZSkmJiFtLl9kYXRhKGIsImNoYW5nZUJ1YmJsZXMiKSYmKG0uZXZlbnQuYWRkKGIsImNoYW5nZS5fY2hhbmdlIixmdW5jdGlvbihhKXshdGhpcy5wYXJlbnROb2RlfHxhLmlzU2ltdWxhdGVkfHxhLmlzVHJpZ2dlcnx8bS5ldmVudC5zaW11bGF0ZSgiY2hhbmdlIix0aGlzLnBhcmVudE5vZGUsYSwhMCl9KSxtLl9kYXRhKGIsImNoYW5nZUJ1YmJsZXMiLCEwKSl9KX0saGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O3JldHVybiB0aGlzIT09Ynx8YS5pc1NpbXVsYXRlZHx8YS5pc1RyaWdnZXJ8fCJyYWRpbyIhPT1iLnR5cGUmJiJjaGVja2JveCIhPT1iLnR5cGU/YS5oYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dm9pZCAwfSx0ZWFyZG93bjpmdW5jdGlvbigpe3JldHVybiBtLmV2ZW50LnJlbW92ZSh0aGlzLCIuX2NoYW5nZSIpLCFYLnRlc3QodGhpcy5ub2RlTmFtZSl9fSksay5mb2N1c2luQnViYmxlc3x8bS5lYWNoKHtmb2N1czoiZm9jdXNpbiIsYmx1cjoiZm9jdXNvdXQifSxmdW5jdGlvbihhLGIpe3ZhciBjPWZ1bmN0aW9uKGEpe20uZXZlbnQuc2ltdWxhdGUoYixhLnRhcmdldCxtLmV2ZW50LmZpeChhKSwhMCl9O20uZXZlbnQuc3BlY2lhbFtiXT17c2V0dXA6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLm93bmVyRG9jdW1lbnR8fHRoaXMsZT1tLl9kYXRhKGQsYik7ZXx8ZC5hZGRFdmVudExpc3RlbmVyKGEsYywhMCksbS5fZGF0YShkLGIsKGV8fDApKzEpfSx0ZWFyZG93bjpmdW5jdGlvbigpe3ZhciBkPXRoaXMub3duZXJEb2N1bWVudHx8dGhpcyxlPW0uX2RhdGEoZCxiKS0xO2U/bS5fZGF0YShkLGIsZSk6KGQucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLGMsITApLG0uX3JlbW92ZURhdGEoZCxiKSl9fX0pLG0uZm4uZXh0ZW5kKHtvbjpmdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmLGc7aWYoIm9iamVjdCI9PXR5cGVvZiBhKXsic3RyaW5nIiE9dHlwZW9mIGImJihjPWN8fGIsYj12b2lkIDApO2ZvcihmIGluIGEpdGhpcy5vbihmLGIsYyxhW2ZdLGUpO3JldHVybiB0aGlzfWlmKG51bGw9PWMmJm51bGw9PWQ/KGQ9YixjPWI9dm9pZCAwKTpudWxsPT1kJiYoInN0cmluZyI9PXR5cGVvZiBiPyhkPWMsYz12b2lkIDApOihkPWMsYz1iLGI9dm9pZCAwKSksZD09PSExKWQ9YmE7ZWxzZSBpZighZClyZXR1cm4gdGhpcztyZXR1cm4gMT09PWUmJihnPWQsZD1mdW5jdGlvbihhKXtyZXR1cm4gbSgpLm9mZihhKSxnLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sZC5ndWlkPWcuZ3VpZHx8KGcuZ3VpZD1tLmd1aWQrKykpLHRoaXMuZWFjaChmdW5jdGlvbigpe20uZXZlbnQuYWRkKHRoaXMsYSxkLGMsYil9KX0sb25lOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLm9uKGEsYixjLGQsMSl9LG9mZjpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZTtpZihhJiZhLnByZXZlbnREZWZhdWx0JiZhLmhhbmRsZU9iailyZXR1cm4gZD1hLmhhbmRsZU9iaixtKGEuZGVsZWdhdGVUYXJnZXQpLm9mZihkLm5hbWVzcGFjZT9kLm9yaWdUeXBlKyIuIitkLm5hbWVzcGFjZTpkLm9yaWdUeXBlLGQuc2VsZWN0b3IsZC5oYW5kbGVyKSx0aGlzO2lmKCJvYmplY3QiPT10eXBlb2YgYSl7Zm9yKGUgaW4gYSl0aGlzLm9mZihlLGIsYVtlXSk7cmV0dXJuIHRoaXN9cmV0dXJuKGI9PT0hMXx8ImZ1bmN0aW9uIj09dHlwZW9mIGIpJiYoYz1iLGI9dm9pZCAwKSxjPT09ITEmJihjPWJhKSx0aGlzLmVhY2goZnVuY3Rpb24oKXttLmV2ZW50LnJlbW92ZSh0aGlzLGEsYyxiKX0pfSx0cmlnZ2VyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe20uZXZlbnQudHJpZ2dlcihhLGIsdGhpcyl9KX0sdHJpZ2dlckhhbmRsZXI6ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzWzBdO3JldHVybiBjP20uZXZlbnQudHJpZ2dlcihhLGIsYywhMCk6dm9pZCAwfX0pO2Z1bmN0aW9uIGRhKGEpe3ZhciBiPWVhLnNwbGl0KCJ8IiksYz1hLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtpZihjLmNyZWF0ZUVsZW1lbnQpd2hpbGUoYi5sZW5ndGgpYy5jcmVhdGVFbGVtZW50KGIucG9wKCkpO3JldHVybiBjfXZhciBlYT0iYWJicnxhcnRpY2xlfGFzaWRlfGF1ZGlvfGJkaXxjYW52YXN8ZGF0YXxkYXRhbGlzdHxkZXRhaWxzfGZpZ2NhcHRpb258ZmlndXJlfGZvb3RlcnxoZWFkZXJ8aGdyb3VwfG1hcmt8bWV0ZXJ8bmF2fG91dHB1dHxwcm9ncmVzc3xzZWN0aW9ufHN1bW1hcnl8dGltZXx2aWRlbyIsZmE9LyBqUXVlcnlcZCs9Iig/Om51bGx8XGQrKSIvZyxnYT1uZXcgUmVnRXhwKCI8KD86IitlYSsiKVtcXHMvPl0iLCJpIiksaGE9L15ccysvLGlhPS88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzpdKylbXj5dKilcLz4vZ2ksamE9LzwoW1x3Ol0rKS8sa2E9Lzx0Ym9keS9pLGxhPS88fCYjP1x3KzsvLG1hPS88KD86c2NyaXB0fHN0eWxlfGxpbmspL2ksbmE9L2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksb2E9L14kfFwvKD86amF2YXxlY21hKXNjcmlwdC9pLHBhPS9edHJ1ZVwvKC4qKS8scWE9L15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nLHJhPXtvcHRpb246WzEsIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCI8L3NlbGVjdD4iXSxsZWdlbmQ6WzEsIjxmaWVsZHNldD4iLCI8L2ZpZWxkc2V0PiJdLGFyZWE6WzEsIjxtYXA+IiwiPC9tYXA+Il0scGFyYW06WzEsIjxvYmplY3Q+IiwiPC9vYmplY3Q+Il0sdGhlYWQ6WzEsIjx0YWJsZT4iLCI8L3RhYmxlPiJdLHRyOlsyLCI8dGFibGU+PHRib2R5PiIsIjwvdGJvZHk+PC90YWJsZT4iXSxjb2w6WzIsIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwiPC9jb2xncm91cD48L3RhYmxlPiJdLHRkOlszLCI8dGFibGU+PHRib2R5Pjx0cj4iLCI8L3RyPjwvdGJvZHk+PC90YWJsZT4iXSxfZGVmYXVsdDprLmh0bWxTZXJpYWxpemU/WzAsIiIsIiJdOlsxLCJYPGRpdj4iLCI8L2Rpdj4iXX0sc2E9ZGEoeSksdGE9c2EuYXBwZW5kQ2hpbGQoeS5jcmVhdGVFbGVtZW50KCJkaXYiKSk7cmEub3B0Z3JvdXA9cmEub3B0aW9uLHJhLnRib2R5PXJhLnRmb290PXJhLmNvbGdyb3VwPXJhLmNhcHRpb249cmEudGhlYWQscmEudGg9cmEudGQ7ZnVuY3Rpb24gdWEoYSxiKXt2YXIgYyxkLGU9MCxmPXR5cGVvZiBhLmdldEVsZW1lbnRzQnlUYWdOYW1lIT09Sz9hLmdldEVsZW1lbnRzQnlUYWdOYW1lKGJ8fCIqIik6dHlwZW9mIGEucXVlcnlTZWxlY3RvckFsbCE9PUs/YS5xdWVyeVNlbGVjdG9yQWxsKGJ8fCIqIik6dm9pZCAwO2lmKCFmKWZvcihmPVtdLGM9YS5jaGlsZE5vZGVzfHxhO251bGwhPShkPWNbZV0pO2UrKykhYnx8bS5ub2RlTmFtZShkLGIpP2YucHVzaChkKTptLm1lcmdlKGYsdWEoZCxiKSk7cmV0dXJuIHZvaWQgMD09PWJ8fGImJm0ubm9kZU5hbWUoYSxiKT9tLm1lcmdlKFthXSxmKTpmfWZ1bmN0aW9uIHZhKGEpe1cudGVzdChhLnR5cGUpJiYoYS5kZWZhdWx0Q2hlY2tlZD1hLmNoZWNrZWQpfWZ1bmN0aW9uIHdhKGEsYil7cmV0dXJuIG0ubm9kZU5hbWUoYSwidGFibGUiKSYmbS5ub2RlTmFtZSgxMSE9PWIubm9kZVR5cGU/YjpiLmZpcnN0Q2hpbGQsInRyIik/YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKVswXXx8YS5hcHBlbmRDaGlsZChhLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGJvZHkiKSk6YX1mdW5jdGlvbiB4YShhKXtyZXR1cm4gYS50eXBlPShudWxsIT09bS5maW5kLmF0dHIoYSwidHlwZSIpKSsiLyIrYS50eXBlLGF9ZnVuY3Rpb24geWEoYSl7dmFyIGI9cGEuZXhlYyhhLnR5cGUpO3JldHVybiBiP2EudHlwZT1iWzFdOmEucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIiksYX1mdW5jdGlvbiB6YShhLGIpe2Zvcih2YXIgYyxkPTA7bnVsbCE9KGM9YVtkXSk7ZCsrKW0uX2RhdGEoYywiZ2xvYmFsRXZhbCIsIWJ8fG0uX2RhdGEoYltkXSwiZ2xvYmFsRXZhbCIpKX1mdW5jdGlvbiBBYShhLGIpe2lmKDE9PT1iLm5vZGVUeXBlJiZtLmhhc0RhdGEoYSkpe3ZhciBjLGQsZSxmPW0uX2RhdGEoYSksZz1tLl9kYXRhKGIsZiksaD1mLmV2ZW50cztpZihoKXtkZWxldGUgZy5oYW5kbGUsZy5ldmVudHM9e307Zm9yKGMgaW4gaClmb3IoZD0wLGU9aFtjXS5sZW5ndGg7ZT5kO2QrKyltLmV2ZW50LmFkZChiLGMsaFtjXVtkXSl9Zy5kYXRhJiYoZy5kYXRhPW0uZXh0ZW5kKHt9LGcuZGF0YSkpfX1mdW5jdGlvbiBCYShhLGIpe3ZhciBjLGQsZTtpZigxPT09Yi5ub2RlVHlwZSl7aWYoYz1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksIWsubm9DbG9uZUV2ZW50JiZiW20uZXhwYW5kb10pe2U9bS5fZGF0YShiKTtmb3IoZCBpbiBlLmV2ZW50cyltLnJlbW92ZUV2ZW50KGIsZCxlLmhhbmRsZSk7Yi5yZW1vdmVBdHRyaWJ1dGUobS5leHBhbmRvKX0ic2NyaXB0Ij09PWMmJmIudGV4dCE9PWEudGV4dD8oeGEoYikudGV4dD1hLnRleHQseWEoYikpOiJvYmplY3QiPT09Yz8oYi5wYXJlbnROb2RlJiYoYi5vdXRlckhUTUw9YS5vdXRlckhUTUwpLGsuaHRtbDVDbG9uZSYmYS5pbm5lckhUTUwmJiFtLnRyaW0oYi5pbm5lckhUTUwpJiYoYi5pbm5lckhUTUw9YS5pbm5lckhUTUwpKToiaW5wdXQiPT09YyYmVy50ZXN0KGEudHlwZSk/KGIuZGVmYXVsdENoZWNrZWQ9Yi5jaGVja2VkPWEuY2hlY2tlZCxiLnZhbHVlIT09YS52YWx1ZSYmKGIudmFsdWU9YS52YWx1ZSkpOiJvcHRpb24iPT09Yz9iLmRlZmF1bHRTZWxlY3RlZD1iLnNlbGVjdGVkPWEuZGVmYXVsdFNlbGVjdGVkOigiaW5wdXQiPT09Y3x8InRleHRhcmVhIj09PWMpJiYoYi5kZWZhdWx0VmFsdWU9YS5kZWZhdWx0VmFsdWUpfX1tLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZixnLGgsaT1tLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudCxhKTtpZihrLmh0bWw1Q2xvbmV8fG0uaXNYTUxEb2MoYSl8fCFnYS50ZXN0KCI8IithLm5vZGVOYW1lKyI+Iik/Zj1hLmNsb25lTm9kZSghMCk6KHRhLmlubmVySFRNTD1hLm91dGVySFRNTCx0YS5yZW1vdmVDaGlsZChmPXRhLmZpcnN0Q2hpbGQpKSwhKGsubm9DbG9uZUV2ZW50JiZrLm5vQ2xvbmVDaGVja2VkfHwxIT09YS5ub2RlVHlwZSYmMTEhPT1hLm5vZGVUeXBlfHxtLmlzWE1MRG9jKGEpKSlmb3IoZD11YShmKSxoPXVhKGEpLGc9MDtudWxsIT0oZT1oW2ddKTsrK2cpZFtnXSYmQmEoZSxkW2ddKTtpZihiKWlmKGMpZm9yKGg9aHx8dWEoYSksZD1kfHx1YShmKSxnPTA7bnVsbCE9KGU9aFtnXSk7ZysrKUFhKGUsZFtnXSk7ZWxzZSBBYShhLGYpO3JldHVybiBkPXVhKGYsInNjcmlwdCIpLGQubGVuZ3RoPjAmJnphKGQsIWkmJnVhKGEsInNjcmlwdCIpKSxkPWg9ZT1udWxsLGZ9LGJ1aWxkRnJhZ21lbnQ6ZnVuY3Rpb24oYSxiLGMsZCl7Zm9yKHZhciBlLGYsZyxoLGksaixsLG49YS5sZW5ndGgsbz1kYShiKSxwPVtdLHE9MDtuPnE7cSsrKWlmKGY9YVtxXSxmfHwwPT09ZilpZigib2JqZWN0Ij09PW0udHlwZShmKSltLm1lcmdlKHAsZi5ub2RlVHlwZT9bZl06Zik7ZWxzZSBpZihsYS50ZXN0KGYpKXtoPWh8fG8uYXBwZW5kQ2hpbGQoYi5jcmVhdGVFbGVtZW50KCJkaXYiKSksaT0oamEuZXhlYyhmKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKSxsPXJhW2ldfHxyYS5fZGVmYXVsdCxoLmlubmVySFRNTD1sWzFdK2YucmVwbGFjZShpYSwiPCQxPjwvJDI+IikrbFsyXSxlPWxbMF07d2hpbGUoZS0tKWg9aC5sYXN0Q2hpbGQ7aWYoIWsubGVhZGluZ1doaXRlc3BhY2UmJmhhLnRlc3QoZikmJnAucHVzaChiLmNyZWF0ZVRleHROb2RlKGhhLmV4ZWMoZilbMF0pKSwhay50Ym9keSl7Zj0idGFibGUiIT09aXx8a2EudGVzdChmKT8iPHRhYmxlPiIhPT1sWzFdfHxrYS50ZXN0KGYpPzA6aDpoLmZpcnN0Q2hpbGQsZT1mJiZmLmNoaWxkTm9kZXMubGVuZ3RoO3doaWxlKGUtLSltLm5vZGVOYW1lKGo9Zi5jaGlsZE5vZGVzW2VdLCJ0Ym9keSIpJiYhai5jaGlsZE5vZGVzLmxlbmd0aCYmZi5yZW1vdmVDaGlsZChqKX1tLm1lcmdlKHAsaC5jaGlsZE5vZGVzKSxoLnRleHRDb250ZW50PSIiO3doaWxlKGguZmlyc3RDaGlsZCloLnJlbW92ZUNoaWxkKGguZmlyc3RDaGlsZCk7aD1vLmxhc3RDaGlsZH1lbHNlIHAucHVzaChiLmNyZWF0ZVRleHROb2RlKGYpKTtoJiZvLnJlbW92ZUNoaWxkKGgpLGsuYXBwZW5kQ2hlY2tlZHx8bS5ncmVwKHVhKHAsImlucHV0IiksdmEpLHE9MDt3aGlsZShmPXBbcSsrXSlpZigoIWR8fC0xPT09bS5pbkFycmF5KGYsZCkpJiYoZz1tLmNvbnRhaW5zKGYub3duZXJEb2N1bWVudCxmKSxoPXVhKG8uYXBwZW5kQ2hpbGQoZiksInNjcmlwdCIpLGcmJnphKGgpLGMpKXtlPTA7d2hpbGUoZj1oW2UrK10pb2EudGVzdChmLnR5cGV8fCIiKSYmYy5wdXNoKGYpfXJldHVybiBoPW51bGwsb30sY2xlYW5EYXRhOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBkLGUsZixnLGg9MCxpPW0uZXhwYW5kbyxqPW0uY2FjaGUsbD1rLmRlbGV0ZUV4cGFuZG8sbj1tLmV2ZW50LnNwZWNpYWw7bnVsbCE9KGQ9YVtoXSk7aCsrKWlmKChifHxtLmFjY2VwdERhdGEoZCkpJiYoZj1kW2ldLGc9ZiYmaltmXSkpe2lmKGcuZXZlbnRzKWZvcihlIGluIGcuZXZlbnRzKW5bZV0/bS5ldmVudC5yZW1vdmUoZCxlKTptLnJlbW92ZUV2ZW50KGQsZSxnLmhhbmRsZSk7altmXSYmKGRlbGV0ZSBqW2ZdLGw/ZGVsZXRlIGRbaV06dHlwZW9mIGQucmVtb3ZlQXR0cmlidXRlIT09Sz9kLnJlbW92ZUF0dHJpYnV0ZShpKTpkW2ldPW51bGwsYy5wdXNoKGYpKX19fSksbS5mbi5leHRlbmQoe3RleHQ6ZnVuY3Rpb24oYSl7cmV0dXJuIFYodGhpcyxmdW5jdGlvbihhKXtyZXR1cm4gdm9pZCAwPT09YT9tLnRleHQodGhpcyk6dGhpcy5lbXB0eSgpLmFwcGVuZCgodGhpc1swXSYmdGhpc1swXS5vd25lckRvY3VtZW50fHx5KS5jcmVhdGVUZXh0Tm9kZShhKSl9LG51bGwsYSxhcmd1bWVudHMubGVuZ3RoKX0sYXBwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLGZ1bmN0aW9uKGEpe2lmKDE9PT10aGlzLm5vZGVUeXBlfHwxMT09PXRoaXMubm9kZVR5cGV8fDk9PT10aGlzLm5vZGVUeXBlKXt2YXIgYj13YSh0aGlzLGEpO2IuYXBwZW5kQ2hpbGQoYSl9fSl9LHByZXBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYSl7aWYoMT09PXRoaXMubm9kZVR5cGV8fDExPT09dGhpcy5ub2RlVHlwZXx8OT09PXRoaXMubm9kZVR5cGUpe3ZhciBiPXdhKHRoaXMsYSk7Yi5pbnNlcnRCZWZvcmUoYSxiLmZpcnN0Q2hpbGQpfX0pfSxiZWZvcmU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlJiZ0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcyl9KX0sYWZ0ZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlJiZ0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcy5uZXh0U2libGluZyl9KX0scmVtb3ZlOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjLGQ9YT9tLmZpbHRlcihhLHRoaXMpOnRoaXMsZT0wO251bGwhPShjPWRbZV0pO2UrKylifHwxIT09Yy5ub2RlVHlwZXx8bS5jbGVhbkRhdGEodWEoYykpLGMucGFyZW50Tm9kZSYmKGImJm0uY29udGFpbnMoYy5vd25lckRvY3VtZW50LGMpJiZ6YSh1YShjLCJzY3JpcHQiKSksYy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGMpKTtyZXR1cm4gdGhpc30sZW1wdHk6ZnVuY3Rpb24oKXtmb3IodmFyIGEsYj0wO251bGwhPShhPXRoaXNbYl0pO2IrKyl7MT09PWEubm9kZVR5cGUmJm0uY2xlYW5EYXRhKHVhKGEsITEpKTt3aGlsZShhLmZpcnN0Q2hpbGQpYS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpO2Eub3B0aW9ucyYmbS5ub2RlTmFtZShhLCJzZWxlY3QiKSYmKGEub3B0aW9ucy5sZW5ndGg9MCl9cmV0dXJuIHRoaXN9LGNsb25lOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGE9bnVsbD09YT8hMTphLGI9bnVsbD09Yj9hOmIsdGhpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gbS5jbG9uZSh0aGlzLGEsYil9KX0saHRtbDpmdW5jdGlvbihhKXtyZXR1cm4gVih0aGlzLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF18fHt9LGM9MCxkPXRoaXMubGVuZ3RoO2lmKHZvaWQgMD09PWEpcmV0dXJuIDE9PT1iLm5vZGVUeXBlP2IuaW5uZXJIVE1MLnJlcGxhY2UoZmEsIiIpOnZvaWQgMDtpZighKCJzdHJpbmciIT10eXBlb2YgYXx8bWEudGVzdChhKXx8IWsuaHRtbFNlcmlhbGl6ZSYmZ2EudGVzdChhKXx8IWsubGVhZGluZ1doaXRlc3BhY2UmJmhhLnRlc3QoYSl8fHJhWyhqYS5leGVjKGEpfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpXSkpe2E9YS5yZXBsYWNlKGlhLCI8JDE+PC8kMj4iKTt0cnl7Zm9yKDtkPmM7YysrKWI9dGhpc1tjXXx8e30sMT09PWIubm9kZVR5cGUmJihtLmNsZWFuRGF0YSh1YShiLCExKSksYi5pbm5lckhUTUw9YSk7Yj0wfWNhdGNoKGUpe319YiYmdGhpcy5lbXB0eSgpLmFwcGVuZChhKX0sbnVsbCxhLGFyZ3VtZW50cy5sZW5ndGgpfSxyZXBsYWNlV2l0aDpmdW5jdGlvbigpe3ZhciBhPWFyZ3VtZW50c1swXTtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYil7YT10aGlzLnBhcmVudE5vZGUsbS5jbGVhbkRhdGEodWEodGhpcykpLGEmJmEucmVwbGFjZUNoaWxkKGIsdGhpcyl9KSxhJiYoYS5sZW5ndGh8fGEubm9kZVR5cGUpP3RoaXM6dGhpcy5yZW1vdmUoKX0sZGV0YWNoOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnJlbW92ZShhLCEwKX0sZG9tTWFuaXA6ZnVuY3Rpb24oYSxiKXthPWUuYXBwbHkoW10sYSk7dmFyIGMsZCxmLGcsaCxpLGo9MCxsPXRoaXMubGVuZ3RoLG49dGhpcyxvPWwtMSxwPWFbMF0scT1tLmlzRnVuY3Rpb24ocCk7aWYocXx8bD4xJiYic3RyaW5nIj09dHlwZW9mIHAmJiFrLmNoZWNrQ2xvbmUmJm5hLnRlc3QocCkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXt2YXIgZD1uLmVxKGMpO3EmJihhWzBdPXAuY2FsbCh0aGlzLGMsZC5odG1sKCkpKSxkLmRvbU1hbmlwKGEsYil9KTtpZihsJiYoaT1tLmJ1aWxkRnJhZ21lbnQoYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQsITEsdGhpcyksYz1pLmZpcnN0Q2hpbGQsMT09PWkuY2hpbGROb2Rlcy5sZW5ndGgmJihpPWMpLGMpKXtmb3IoZz1tLm1hcCh1YShpLCJzY3JpcHQiKSx4YSksZj1nLmxlbmd0aDtsPmo7aisrKWQ9aSxqIT09byYmKGQ9bS5jbG9uZShkLCEwLCEwKSxmJiZtLm1lcmdlKGcsdWEoZCwic2NyaXB0IikpKSxiLmNhbGwodGhpc1tqXSxkLGopO2lmKGYpZm9yKGg9Z1tnLmxlbmd0aC0xXS5vd25lckRvY3VtZW50LG0ubWFwKGcseWEpLGo9MDtmPmo7aisrKWQ9Z1tqXSxvYS50ZXN0KGQudHlwZXx8IiIpJiYhbS5fZGF0YShkLCJnbG9iYWxFdmFsIikmJm0uY29udGFpbnMoaCxkKSYmKGQuc3JjP20uX2V2YWxVcmwmJm0uX2V2YWxVcmwoZC5zcmMpOm0uZ2xvYmFsRXZhbCgoZC50ZXh0fHxkLnRleHRDb250ZW50fHxkLmlubmVySFRNTHx8IiIpLnJlcGxhY2UocWEsIiIpKSk7aT1jPW51bGx9cmV0dXJuIHRoaXN9fSksbS5lYWNoKHthcHBlbmRUbzoiYXBwZW5kIixwcmVwZW5kVG86InByZXBlbmQiLGluc2VydEJlZm9yZToiYmVmb3JlIixpbnNlcnRBZnRlcjoiYWZ0ZXIiLHJlcGxhY2VBbGw6InJlcGxhY2VXaXRoIn0sZnVuY3Rpb24oYSxiKXttLmZuW2FdPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYyxkPTAsZT1bXSxnPW0oYSksaD1nLmxlbmd0aC0xO2g+PWQ7ZCsrKWM9ZD09PWg/dGhpczp0aGlzLmNsb25lKCEwKSxtKGdbZF0pW2JdKGMpLGYuYXBwbHkoZSxjLmdldCgpKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soZSl9fSk7dmFyIENhLERhPXt9O2Z1bmN0aW9uIEVhKGIsYyl7dmFyIGQsZT1tKGMuY3JlYXRlRWxlbWVudChiKSkuYXBwZW5kVG8oYy5ib2R5KSxmPWEuZ2V0RGVmYXVsdENvbXB1dGVkU3R5bGUmJihkPWEuZ2V0RGVmYXVsdENvbXB1dGVkU3R5bGUoZVswXSkpP2QuZGlzcGxheTptLmNzcyhlWzBdLCJkaXNwbGF5Iik7cmV0dXJuIGUuZGV0YWNoKCksZn1mdW5jdGlvbiBGYShhKXt2YXIgYj15LGM9RGFbYV07cmV0dXJuIGN8fChjPUVhKGEsYiksIm5vbmUiIT09YyYmY3x8KENhPShDYXx8bSgiPGlmcmFtZSBmcmFtZWJvcmRlcj0nMCcgd2lkdGg9JzAnIGhlaWdodD0nMCcvPiIpKS5hcHBlbmRUbyhiLmRvY3VtZW50RWxlbWVudCksYj0oQ2FbMF0uY29udGVudFdpbmRvd3x8Q2FbMF0uY29udGVudERvY3VtZW50KS5kb2N1bWVudCxiLndyaXRlKCksYi5jbG9zZSgpLGM9RWEoYSxiKSxDYS5kZXRhY2goKSksRGFbYV09YyksY30hZnVuY3Rpb24oKXt2YXIgYTtrLnNocmlua1dyYXBCbG9ja3M9ZnVuY3Rpb24oKXtpZihudWxsIT1hKXJldHVybiBhO2E9ITE7dmFyIGIsYyxkO3JldHVybiBjPXkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXSxjJiZjLnN0eWxlPyhiPXkuY3JlYXRlRWxlbWVudCgiZGl2IiksZD15LmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQuc3R5bGUuY3NzVGV4dD0icG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDt0b3A6MDtsZWZ0Oi05OTk5cHgiLGMuYXBwZW5kQ2hpbGQoZCkuYXBwZW5kQ2hpbGQoYiksdHlwZW9mIGIuc3R5bGUuem9vbSE9PUsmJihiLnN0eWxlLmNzc1RleHQ9Ii13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7Ym94LXNpemluZzpjb250ZW50LWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbjowO2JvcmRlcjowO3BhZGRpbmc6MXB4O3dpZHRoOjFweDt6b29tOjEiLGIuYXBwZW5kQ2hpbGQoeS5jcmVhdGVFbGVtZW50KCJkaXYiKSkuc3R5bGUud2lkdGg9IjVweCIsYT0zIT09Yi5vZmZzZXRXaWR0aCksYy5yZW1vdmVDaGlsZChkKSxhKTp2b2lkIDB9fSgpO3ZhciBHYT0vXm1hcmdpbi8sSGE9bmV3IFJlZ0V4cCgiXigiK1MrIikoPyFweClbYS16JV0rJCIsImkiKSxJYSxKYSxLYT0vXih0b3B8cmlnaHR8Ym90dG9tfGxlZnQpJC87YS5nZXRDb21wdXRlZFN0eWxlPyhJYT1mdW5jdGlvbihiKXtyZXR1cm4gYi5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3Lm9wZW5lcj9iLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmEuZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpfSxKYT1mdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmLGcsaD1hLnN0eWxlO3JldHVybiBjPWN8fElhKGEpLGc9Yz9jLmdldFByb3BlcnR5VmFsdWUoYil8fGNbYl06dm9pZCAwLGMmJigiIiE9PWd8fG0uY29udGFpbnMoYS5vd25lckRvY3VtZW50LGEpfHwoZz1tLnN0eWxlKGEsYikpLEhhLnRlc3QoZykmJkdhLnRlc3QoYikmJihkPWgud2lkdGgsZT1oLm1pbldpZHRoLGY9aC5tYXhXaWR0aCxoLm1pbldpZHRoPWgubWF4V2lkdGg9aC53aWR0aD1nLGc9Yy53aWR0aCxoLndpZHRoPWQsaC5taW5XaWR0aD1lLGgubWF4V2lkdGg9ZikpLHZvaWQgMD09PWc/ZzpnKyIifSk6eS5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlJiYoSWE9ZnVuY3Rpb24oYSl7cmV0dXJuIGEuY3VycmVudFN0eWxlfSxKYT1mdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmLGcsaD1hLnN0eWxlO3JldHVybiBjPWN8fElhKGEpLGc9Yz9jW2JdOnZvaWQgMCxudWxsPT1nJiZoJiZoW2JdJiYoZz1oW2JdKSxIYS50ZXN0KGcpJiYhS2EudGVzdChiKSYmKGQ9aC5sZWZ0LGU9YS5ydW50aW1lU3R5bGUsZj1lJiZlLmxlZnQsZiYmKGUubGVmdD1hLmN1cnJlbnRTdHlsZS5sZWZ0KSxoLmxlZnQ9ImZvbnRTaXplIj09PWI/IjFlbSI6ZyxnPWgucGl4ZWxMZWZ0KyJweCIsaC5sZWZ0PWQsZiYmKGUubGVmdD1mKSksdm9pZCAwPT09Zz9nOmcrIiJ8fCJhdXRvIn0pO2Z1bmN0aW9uIExhKGEsYil7cmV0dXJue2dldDpmdW5jdGlvbigpe3ZhciBjPWEoKTtpZihudWxsIT1jKXJldHVybiBjP3ZvaWQgZGVsZXRlIHRoaXMuZ2V0Oih0aGlzLmdldD1iKS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fX0hZnVuY3Rpb24oKXt2YXIgYixjLGQsZSxmLGcsaDtpZihiPXkuY3JlYXRlRWxlbWVudCgiZGl2IiksYi5pbm5lckhUTUw9IiAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiIsZD1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIilbMF0sYz1kJiZkLnN0eWxlKXtjLmNzc1RleHQ9ImZsb2F0OmxlZnQ7b3BhY2l0eTouNSIsay5vcGFjaXR5PSIwLjUiPT09Yy5vcGFjaXR5LGsuY3NzRmxvYXQ9ISFjLmNzc0Zsb2F0LGIuc3R5bGUuYmFja2dyb3VuZENsaXA9ImNvbnRlbnQtYm94IixiLmNsb25lTm9kZSghMCkuc3R5bGUuYmFja2dyb3VuZENsaXA9IiIsay5jbGVhckNsb25lU3R5bGU9ImNvbnRlbnQtYm94Ij09PWIuc3R5bGUuYmFja2dyb3VuZENsaXAsay5ib3hTaXppbmc9IiI9PT1jLmJveFNpemluZ3x8IiI9PT1jLk1vekJveFNpemluZ3x8IiI9PT1jLldlYmtpdEJveFNpemluZyxtLmV4dGVuZChrLHtyZWxpYWJsZUhpZGRlbk9mZnNldHM6ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09ZyYmaSgpLGd9LGJveFNpemluZ1JlbGlhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PWYmJmkoKSxmfSxwaXhlbFBvc2l0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PWUmJmkoKSxlfSxyZWxpYWJsZU1hcmdpblJpZ2h0OmZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PWgmJmkoKSxofX0pO2Z1bmN0aW9uIGkoKXt2YXIgYixjLGQsaTtjPXkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXSxjJiZjLnN0eWxlJiYoYj15LmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQ9eS5jcmVhdGVFbGVtZW50KCJkaXYiKSxkLnN0eWxlLmNzc1RleHQ9InBvc2l0aW9uOmFic29sdXRlO2JvcmRlcjowO3dpZHRoOjA7aGVpZ2h0OjA7dG9wOjA7bGVmdDotOTk5OXB4IixjLmFwcGVuZENoaWxkKGQpLmFwcGVuZENoaWxkKGIpLGIuc3R5bGUuY3NzVGV4dD0iLXdlYmtpdC1ib3gtc2l6aW5nOmJvcmRlci1ib3g7LW1vei1ib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6YmxvY2s7bWFyZ2luLXRvcDoxJTt0b3A6MSU7Ym9yZGVyOjFweDtwYWRkaW5nOjFweDt3aWR0aDo0cHg7cG9zaXRpb246YWJzb2x1dGUiLGU9Zj0hMSxoPSEwLGEuZ2V0Q29tcHV0ZWRTdHlsZSYmKGU9IjElIiE9PShhLmdldENvbXB1dGVkU3R5bGUoYixudWxsKXx8e30pLnRvcCxmPSI0cHgiPT09KGEuZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpfHx7d2lkdGg6IjRweCJ9KS53aWR0aCxpPWIuYXBwZW5kQ2hpbGQoeS5jcmVhdGVFbGVtZW50KCJkaXYiKSksaS5zdHlsZS5jc3NUZXh0PWIuc3R5bGUuY3NzVGV4dD0iLXdlYmtpdC1ib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy1tb3otYm94LXNpemluZzpjb250ZW50LWJveDtib3gtc2l6aW5nOmNvbnRlbnQtYm94O2Rpc3BsYXk6YmxvY2s7bWFyZ2luOjA7Ym9yZGVyOjA7cGFkZGluZzowIixpLnN0eWxlLm1hcmdpblJpZ2h0PWkuc3R5bGUud2lkdGg9IjAiLGIuc3R5bGUud2lkdGg9IjFweCIsaD0hcGFyc2VGbG9hdCgoYS5nZXRDb21wdXRlZFN0eWxlKGksbnVsbCl8fHt9KS5tYXJnaW5SaWdodCksYi5yZW1vdmVDaGlsZChpKSksYi5pbm5lckhUTUw9Ijx0YWJsZT48dHI+PHRkPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT4iLGk9Yi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGQiKSxpWzBdLnN0eWxlLmNzc1RleHQ9Im1hcmdpbjowO2JvcmRlcjowO3BhZGRpbmc6MDtkaXNwbGF5Om5vbmUiLGc9MD09PWlbMF0ub2Zmc2V0SGVpZ2h0LGcmJihpWzBdLnN0eWxlLmRpc3BsYXk9IiIsaVsxXS5zdHlsZS5kaXNwbGF5PSJub25lIixnPTA9PT1pWzBdLm9mZnNldEhlaWdodCksYy5yZW1vdmVDaGlsZChkKSl9fX0oKSxtLnN3YXA9ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGUsZixnPXt9O2ZvcihmIGluIGIpZ1tmXT1hLnN0eWxlW2ZdLGEuc3R5bGVbZl09YltmXTtlPWMuYXBwbHkoYSxkfHxbXSk7Zm9yKGYgaW4gYilhLnN0eWxlW2ZdPWdbZl07cmV0dXJuIGV9O3ZhciBNYT0vYWxwaGFcKFteKV0qXCkvaSxOYT0vb3BhY2l0eVxzKj1ccyooW14pXSopLyxPYT0vXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sUGE9bmV3IFJlZ0V4cCgiXigiK1MrIikoLiopJCIsImkiKSxRYT1uZXcgUmVnRXhwKCJeKFsrLV0pPSgiK1MrIikiLCJpIiksUmE9e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToiaGlkZGVuIixkaXNwbGF5OiJibG9jayJ9LFNhPXtsZXR0ZXJTcGFjaW5nOiIwIixmb250V2VpZ2h0OiI0MDAifSxUYT1bIldlYmtpdCIsIk8iLCJNb3oiLCJtcyJdO2Z1bmN0aW9uIFVhKGEsYil7aWYoYiBpbiBhKXJldHVybiBiO3ZhciBjPWIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrYi5zbGljZSgxKSxkPWIsZT1UYS5sZW5ndGg7d2hpbGUoZS0tKWlmKGI9VGFbZV0rYyxiIGluIGEpcmV0dXJuIGI7cmV0dXJuIGR9ZnVuY3Rpb24gVmEoYSxiKXtmb3IodmFyIGMsZCxlLGY9W10sZz0wLGg9YS5sZW5ndGg7aD5nO2crKylkPWFbZ10sZC5zdHlsZSYmKGZbZ109bS5fZGF0YShkLCJvbGRkaXNwbGF5IiksYz1kLnN0eWxlLmRpc3BsYXksYj8oZltnXXx8Im5vbmUiIT09Y3x8KGQuc3R5bGUuZGlzcGxheT0iIiksIiI9PT1kLnN0eWxlLmRpc3BsYXkmJlUoZCkmJihmW2ddPW0uX2RhdGEoZCwib2xkZGlzcGxheSIsRmEoZC5ub2RlTmFtZSkpKSk6KGU9VShkKSwoYyYmIm5vbmUiIT09Y3x8IWUpJiZtLl9kYXRhKGQsIm9sZGRpc3BsYXkiLGU/YzptLmNzcyhkLCJkaXNwbGF5IikpKSk7Zm9yKGc9MDtoPmc7ZysrKWQ9YVtnXSxkLnN0eWxlJiYoYiYmIm5vbmUiIT09ZC5zdHlsZS5kaXNwbGF5JiYiIiE9PWQuc3R5bGUuZGlzcGxheXx8KGQuc3R5bGUuZGlzcGxheT1iP2ZbZ118fCIiOiJub25lIikpO3JldHVybiBhfWZ1bmN0aW9uIFdhKGEsYixjKXt2YXIgZD1QYS5leGVjKGIpO3JldHVybiBkP01hdGgubWF4KDAsZFsxXS0oY3x8MCkpKyhkWzJdfHwicHgiKTpifWZ1bmN0aW9uIFhhKGEsYixjLGQsZSl7Zm9yKHZhciBmPWM9PT0oZD8iYm9yZGVyIjoiY29udGVudCIpPzQ6IndpZHRoIj09PWI/MTowLGc9MDs0PmY7Zis9MikibWFyZ2luIj09PWMmJihnKz1tLmNzcyhhLGMrVFtmXSwhMCxlKSksZD8oImNvbnRlbnQiPT09YyYmKGctPW0uY3NzKGEsInBhZGRpbmciK1RbZl0sITAsZSkpLCJtYXJnaW4iIT09YyYmKGctPW0uY3NzKGEsImJvcmRlciIrVFtmXSsiV2lkdGgiLCEwLGUpKSk6KGcrPW0uY3NzKGEsInBhZGRpbmciK1RbZl0sITAsZSksInBhZGRpbmciIT09YyYmKGcrPW0uY3NzKGEsImJvcmRlciIrVFtmXSsiV2lkdGgiLCEwLGUpKSk7cmV0dXJuIGd9ZnVuY3Rpb24gWWEoYSxiLGMpe3ZhciBkPSEwLGU9IndpZHRoIj09PWI/YS5vZmZzZXRXaWR0aDphLm9mZnNldEhlaWdodCxmPUlhKGEpLGc9ay5ib3hTaXppbmcmJiJib3JkZXItYm94Ij09PW0uY3NzKGEsImJveFNpemluZyIsITEsZik7aWYoMD49ZXx8bnVsbD09ZSl7aWYoZT1KYShhLGIsZiksKDA+ZXx8bnVsbD09ZSkmJihlPWEuc3R5bGVbYl0pLEhhLnRlc3QoZSkpcmV0dXJuIGU7ZD1nJiYoay5ib3hTaXppbmdSZWxpYWJsZSgpfHxlPT09YS5zdHlsZVtiXSksZT1wYXJzZUZsb2F0KGUpfHwwfXJldHVybiBlK1hhKGEsYixjfHwoZz8iYm9yZGVyIjoiY29udGVudCIpLGQsZikrInB4In1tLmV4dGVuZCh7Y3NzSG9va3M6e29wYWNpdHk6e2dldDpmdW5jdGlvbihhLGIpe2lmKGIpe3ZhciBjPUphKGEsIm9wYWNpdHkiKTtyZXR1cm4iIj09PWM/IjEiOmN9fX19LGNzc051bWJlcjp7Y29sdW1uQ291bnQ6ITAsZmlsbE9wYWNpdHk6ITAsZmxleEdyb3c6ITAsZmxleFNocmluazohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcmRlcjohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6eyJmbG9hdCI6ay5jc3NGbG9hdD8iY3NzRmxvYXQiOiJzdHlsZUZsb2F0In0sc3R5bGU6ZnVuY3Rpb24oYSxiLGMsZCl7aWYoYSYmMyE9PWEubm9kZVR5cGUmJjghPT1hLm5vZGVUeXBlJiZhLnN0eWxlKXt2YXIgZSxmLGcsaD1tLmNhbWVsQ2FzZShiKSxpPWEuc3R5bGU7aWYoYj1tLmNzc1Byb3BzW2hdfHwobS5jc3NQcm9wc1toXT1VYShpLGgpKSxnPW0uY3NzSG9va3NbYl18fG0uY3NzSG9va3NbaF0sdm9pZCAwPT09YylyZXR1cm4gZyYmImdldCJpbiBnJiZ2b2lkIDAhPT0oZT1nLmdldChhLCExLGQpKT9lOmlbYl07aWYoZj10eXBlb2YgYywic3RyaW5nIj09PWYmJihlPVFhLmV4ZWMoYykpJiYoYz0oZVsxXSsxKSplWzJdK3BhcnNlRmxvYXQobS5jc3MoYSxiKSksZj0ibnVtYmVyIiksbnVsbCE9YyYmYz09PWMmJigibnVtYmVyIiE9PWZ8fG0uY3NzTnVtYmVyW2hdfHwoYys9InB4Iiksay5jbGVhckNsb25lU3R5bGV8fCIiIT09Y3x8MCE9PWIuaW5kZXhPZigiYmFja2dyb3VuZCIpfHwoaVtiXT0iaW5oZXJpdCIpLCEoZyYmInNldCJpbiBnJiZ2b2lkIDA9PT0oYz1nLnNldChhLGMsZCkpKSkpdHJ5e2lbYl09Y31jYXRjaChqKXt9fX0sY3NzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlLGYsZyxoPW0uY2FtZWxDYXNlKGIpO3JldHVybiBiPW0uY3NzUHJvcHNbaF18fChtLmNzc1Byb3BzW2hdPVVhKGEuc3R5bGUsaCkpLGc9bS5jc3NIb29rc1tiXXx8bS5jc3NIb29rc1toXSxnJiYiZ2V0ImluIGcmJihmPWcuZ2V0KGEsITAsYykpLHZvaWQgMD09PWYmJihmPUphKGEsYixkKSksIm5vcm1hbCI9PT1mJiZiIGluIFNhJiYoZj1TYVtiXSksIiI9PT1jfHxjPyhlPXBhcnNlRmxvYXQoZiksYz09PSEwfHxtLmlzTnVtZXJpYyhlKT9lfHwwOmYpOmZ9fSksbS5lYWNoKFsiaGVpZ2h0Iiwid2lkdGgiXSxmdW5jdGlvbihhLGIpe20uY3NzSG9va3NbYl09e2dldDpmdW5jdGlvbihhLGMsZCl7cmV0dXJuIGM/T2EudGVzdChtLmNzcyhhLCJkaXNwbGF5IikpJiYwPT09YS5vZmZzZXRXaWR0aD9tLnN3YXAoYSxSYSxmdW5jdGlvbigpe3JldHVybiBZYShhLGIsZCl9KTpZYShhLGIsZCk6dm9pZCAwfSxzZXQ6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPWQmJklhKGEpO3JldHVybiBXYShhLGMsZD9YYShhLGIsZCxrLmJveFNpemluZyYmImJvcmRlci1ib3giPT09bS5jc3MoYSwiYm94U2l6aW5nIiwhMSxlKSxlKTowKX19fSksay5vcGFjaXR5fHwobS5jc3NIb29rcy5vcGFjaXR5PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gTmEudGVzdCgoYiYmYS5jdXJyZW50U3R5bGU/YS5jdXJyZW50U3R5bGUuZmlsdGVyOmEuc3R5bGUuZmlsdGVyKXx8IiIpPy4wMSpwYXJzZUZsb2F0KFJlZ0V4cC4kMSkrIiI6Yj8iMSI6IiJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZSxlPW0uaXNOdW1lcmljKGIpPyJhbHBoYShvcGFjaXR5PSIrMTAwKmIrIikiOiIiLGY9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHwiIjtjLnpvb209MSwoYj49MXx8IiI9PT1iKSYmIiI9PT1tLnRyaW0oZi5yZXBsYWNlKE1hLCIiKSkmJmMucmVtb3ZlQXR0cmlidXRlJiYoYy5yZW1vdmVBdHRyaWJ1dGUoImZpbHRlciIpLCIiPT09Ynx8ZCYmIWQuZmlsdGVyKXx8KGMuZmlsdGVyPU1hLnRlc3QoZik/Zi5yZXBsYWNlKE1hLGUpOmYrIiAiK2UpfX0pLG0uY3NzSG9va3MubWFyZ2luUmlnaHQ9TGEoay5yZWxpYWJsZU1hcmdpblJpZ2h0LGZ1bmN0aW9uKGEsYil7cmV0dXJuIGI/bS5zd2FwKGEse2Rpc3BsYXk6ImlubGluZS1ibG9jayJ9LEphLFthLCJtYXJnaW5SaWdodCJdKTp2b2lkIDB9KSxtLmVhY2goe21hcmdpbjoiIixwYWRkaW5nOiIiLGJvcmRlcjoiV2lkdGgifSxmdW5jdGlvbihhLGIpe20uY3NzSG9va3NbYStiXT17ZXhwYW5kOmZ1bmN0aW9uKGMpe2Zvcih2YXIgZD0wLGU9e30sZj0ic3RyaW5nIj09dHlwZW9mIGM/Yy5zcGxpdCgiICIpOltjXTs0PmQ7ZCsrKWVbYStUW2RdK2JdPWZbZF18fGZbZC0yXXx8ZlswXTtyZXR1cm4gZX19LEdhLnRlc3QoYSl8fChtLmNzc0hvb2tzW2ErYl0uc2V0PVdhKX0pLG0uZm4uZXh0ZW5kKHtjc3M6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gVih0aGlzLGZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGY9e30sZz0wO2lmKG0uaXNBcnJheShiKSl7Zm9yKGQ9SWEoYSksZT1iLmxlbmd0aDtlPmc7ZysrKWZbYltnXV09bS5jc3MoYSxiW2ddLCExLGQpO3JldHVybiBmfXJldHVybiB2b2lkIDAhPT1jP20uc3R5bGUoYSxiLGMpOm0uY3NzKGEsYil9LGEsYixhcmd1bWVudHMubGVuZ3RoPjEpfSxzaG93OmZ1bmN0aW9uKCl7cmV0dXJuIFZhKHRoaXMsITApfSxoaWRlOmZ1bmN0aW9uKCl7cmV0dXJuIFZhKHRoaXMpfSx0b2dnbGU6ZnVuY3Rpb24oYSl7cmV0dXJuImJvb2xlYW4iPT10eXBlb2YgYT9hP3RoaXMuc2hvdygpOnRoaXMuaGlkZSgpOnRoaXMuZWFjaChmdW5jdGlvbigpe1UodGhpcyk/bSh0aGlzKS5zaG93KCk6bSh0aGlzKS5oaWRlKCl9KX19KTtmdW5jdGlvbiBaYShhLGIsYyxkLGUpewpyZXR1cm4gbmV3IFphLnByb3RvdHlwZS5pbml0KGEsYixjLGQsZSl9bS5Ud2Vlbj1aYSxaYS5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOlphLGluaXQ6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe3RoaXMuZWxlbT1hLHRoaXMucHJvcD1jLHRoaXMuZWFzaW5nPWV8fCJzd2luZyIsdGhpcy5vcHRpb25zPWIsdGhpcy5zdGFydD10aGlzLm5vdz10aGlzLmN1cigpLHRoaXMuZW5kPWQsdGhpcy51bml0PWZ8fChtLmNzc051bWJlcltjXT8iIjoicHgiKX0sY3VyOmZ1bmN0aW9uKCl7dmFyIGE9WmEucHJvcEhvb2tzW3RoaXMucHJvcF07cmV0dXJuIGEmJmEuZ2V0P2EuZ2V0KHRoaXMpOlphLnByb3BIb29rcy5fZGVmYXVsdC5nZXQodGhpcyl9LHJ1bjpmdW5jdGlvbihhKXt2YXIgYixjPVphLnByb3BIb29rc1t0aGlzLnByb3BdO3JldHVybiB0aGlzLm9wdGlvbnMuZHVyYXRpb24/dGhpcy5wb3M9Yj1tLmVhc2luZ1t0aGlzLmVhc2luZ10oYSx0aGlzLm9wdGlvbnMuZHVyYXRpb24qYSwwLDEsdGhpcy5vcHRpb25zLmR1cmF0aW9uKTp0aGlzLnBvcz1iPWEsdGhpcy5ub3c9KHRoaXMuZW5kLXRoaXMuc3RhcnQpKmIrdGhpcy5zdGFydCx0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksYyYmYy5zZXQ/Yy5zZXQodGhpcyk6WmEucHJvcEhvb2tzLl9kZWZhdWx0LnNldCh0aGlzKSx0aGlzfX0sWmEucHJvdG90eXBlLmluaXQucHJvdG90eXBlPVphLnByb3RvdHlwZSxaYS5wcm9wSG9va3M9e19kZWZhdWx0OntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI7cmV0dXJuIG51bGw9PWEuZWxlbVthLnByb3BdfHxhLmVsZW0uc3R5bGUmJm51bGwhPWEuZWxlbS5zdHlsZVthLnByb3BdPyhiPW0uY3NzKGEuZWxlbSxhLnByb3AsIiIpLGImJiJhdXRvIiE9PWI/YjowKTphLmVsZW1bYS5wcm9wXX0sc2V0OmZ1bmN0aW9uKGEpe20uZnguc3RlcFthLnByb3BdP20uZnguc3RlcFthLnByb3BdKGEpOmEuZWxlbS5zdHlsZSYmKG51bGwhPWEuZWxlbS5zdHlsZVttLmNzc1Byb3BzW2EucHJvcF1dfHxtLmNzc0hvb2tzW2EucHJvcF0pP20uc3R5bGUoYS5lbGVtLGEucHJvcCxhLm5vdythLnVuaXQpOmEuZWxlbVthLnByb3BdPWEubm93fX19LFphLnByb3BIb29rcy5zY3JvbGxUb3A9WmEucHJvcEhvb2tzLnNjcm9sbExlZnQ9e3NldDpmdW5jdGlvbihhKXthLmVsZW0ubm9kZVR5cGUmJmEuZWxlbS5wYXJlbnROb2RlJiYoYS5lbGVtW2EucHJvcF09YS5ub3cpfX0sbS5lYXNpbmc9e2xpbmVhcjpmdW5jdGlvbihhKXtyZXR1cm4gYX0sc3dpbmc6ZnVuY3Rpb24oYSl7cmV0dXJuLjUtTWF0aC5jb3MoYSpNYXRoLlBJKS8yfX0sbS5meD1aYS5wcm90b3R5cGUuaW5pdCxtLmZ4LnN0ZXA9e307dmFyICRhLF9hLGFiPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxiYj1uZXcgUmVnRXhwKCJeKD86KFsrLV0pPXwpKCIrUysiKShbYS16JV0qKSQiLCJpIiksY2I9L3F1ZXVlSG9va3MkLyxkYj1baWJdLGViPXsiKiI6W2Z1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5jcmVhdGVUd2VlbihhLGIpLGQ9Yy5jdXIoKSxlPWJiLmV4ZWMoYiksZj1lJiZlWzNdfHwobS5jc3NOdW1iZXJbYV0/IiI6InB4IiksZz0obS5jc3NOdW1iZXJbYV18fCJweCIhPT1mJiYrZCkmJmJiLmV4ZWMobS5jc3MoYy5lbGVtLGEpKSxoPTEsaT0yMDtpZihnJiZnWzNdIT09Zil7Zj1mfHxnWzNdLGU9ZXx8W10sZz0rZHx8MTtkbyBoPWh8fCIuNSIsZy89aCxtLnN0eWxlKGMuZWxlbSxhLGcrZik7d2hpbGUoaCE9PShoPWMuY3VyKCkvZCkmJjEhPT1oJiYtLWkpfXJldHVybiBlJiYoZz1jLnN0YXJ0PStnfHwrZHx8MCxjLnVuaXQ9ZixjLmVuZD1lWzFdP2crKGVbMV0rMSkqZVsyXTorZVsyXSksY31dfTtmdW5jdGlvbiBmYigpe3JldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7JGE9dm9pZCAwfSksJGE9bS5ub3coKX1mdW5jdGlvbiBnYihhLGIpe3ZhciBjLGQ9e2hlaWdodDphfSxlPTA7Zm9yKGI9Yj8xOjA7ND5lO2UrPTItYiljPVRbZV0sZFsibWFyZ2luIitjXT1kWyJwYWRkaW5nIitjXT1hO3JldHVybiBiJiYoZC5vcGFjaXR5PWQud2lkdGg9YSksZH1mdW5jdGlvbiBoYihhLGIsYyl7Zm9yKHZhciBkLGU9KGViW2JdfHxbXSkuY29uY2F0KGViWyIqIl0pLGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspaWYoZD1lW2ZdLmNhbGwoYyxiLGEpKXJldHVybiBkfWZ1bmN0aW9uIGliKGEsYixjKXt2YXIgZCxlLGYsZyxoLGksaixsLG49dGhpcyxvPXt9LHA9YS5zdHlsZSxxPWEubm9kZVR5cGUmJlUoYSkscj1tLl9kYXRhKGEsImZ4c2hvdyIpO2MucXVldWV8fChoPW0uX3F1ZXVlSG9va3MoYSwiZngiKSxudWxsPT1oLnVucXVldWVkJiYoaC51bnF1ZXVlZD0wLGk9aC5lbXB0eS5maXJlLGguZW1wdHkuZmlyZT1mdW5jdGlvbigpe2gudW5xdWV1ZWR8fGkoKX0pLGgudW5xdWV1ZWQrKyxuLmFsd2F5cyhmdW5jdGlvbigpe24uYWx3YXlzKGZ1bmN0aW9uKCl7aC51bnF1ZXVlZC0tLG0ucXVldWUoYSwiZngiKS5sZW5ndGh8fGguZW1wdHkuZmlyZSgpfSl9KSksMT09PWEubm9kZVR5cGUmJigiaGVpZ2h0ImluIGJ8fCJ3aWR0aCJpbiBiKSYmKGMub3ZlcmZsb3c9W3Aub3ZlcmZsb3cscC5vdmVyZmxvd1gscC5vdmVyZmxvd1ldLGo9bS5jc3MoYSwiZGlzcGxheSIpLGw9Im5vbmUiPT09aj9tLl9kYXRhKGEsIm9sZGRpc3BsYXkiKXx8RmEoYS5ub2RlTmFtZSk6aiwiaW5saW5lIj09PWwmJiJub25lIj09PW0uY3NzKGEsImZsb2F0IikmJihrLmlubGluZUJsb2NrTmVlZHNMYXlvdXQmJiJpbmxpbmUiIT09RmEoYS5ub2RlTmFtZSk/cC56b29tPTE6cC5kaXNwbGF5PSJpbmxpbmUtYmxvY2siKSksYy5vdmVyZmxvdyYmKHAub3ZlcmZsb3c9ImhpZGRlbiIsay5zaHJpbmtXcmFwQmxvY2tzKCl8fG4uYWx3YXlzKGZ1bmN0aW9uKCl7cC5vdmVyZmxvdz1jLm92ZXJmbG93WzBdLHAub3ZlcmZsb3dYPWMub3ZlcmZsb3dbMV0scC5vdmVyZmxvd1k9Yy5vdmVyZmxvd1syXX0pKTtmb3IoZCBpbiBiKWlmKGU9YltkXSxhYi5leGVjKGUpKXtpZihkZWxldGUgYltkXSxmPWZ8fCJ0b2dnbGUiPT09ZSxlPT09KHE/ImhpZGUiOiJzaG93Iikpe2lmKCJzaG93IiE9PWV8fCFyfHx2b2lkIDA9PT1yW2RdKWNvbnRpbnVlO3E9ITB9b1tkXT1yJiZyW2RdfHxtLnN0eWxlKGEsZCl9ZWxzZSBqPXZvaWQgMDtpZihtLmlzRW1wdHlPYmplY3QobykpImlubGluZSI9PT0oIm5vbmUiPT09aj9GYShhLm5vZGVOYW1lKTpqKSYmKHAuZGlzcGxheT1qKTtlbHNle3I/ImhpZGRlbiJpbiByJiYocT1yLmhpZGRlbik6cj1tLl9kYXRhKGEsImZ4c2hvdyIse30pLGYmJihyLmhpZGRlbj0hcSkscT9tKGEpLnNob3coKTpuLmRvbmUoZnVuY3Rpb24oKXttKGEpLmhpZGUoKX0pLG4uZG9uZShmdW5jdGlvbigpe3ZhciBiO20uX3JlbW92ZURhdGEoYSwiZnhzaG93Iik7Zm9yKGIgaW4gbyltLnN0eWxlKGEsYixvW2JdKX0pO2ZvcihkIGluIG8pZz1oYihxP3JbZF06MCxkLG4pLGQgaW4gcnx8KHJbZF09Zy5zdGFydCxxJiYoZy5lbmQ9Zy5zdGFydCxnLnN0YXJ0PSJ3aWR0aCI9PT1kfHwiaGVpZ2h0Ij09PWQ/MTowKSl9fWZ1bmN0aW9uIGpiKGEsYil7dmFyIGMsZCxlLGYsZztmb3IoYyBpbiBhKWlmKGQ9bS5jYW1lbENhc2UoYyksZT1iW2RdLGY9YVtjXSxtLmlzQXJyYXkoZikmJihlPWZbMV0sZj1hW2NdPWZbMF0pLGMhPT1kJiYoYVtkXT1mLGRlbGV0ZSBhW2NdKSxnPW0uY3NzSG9va3NbZF0sZyYmImV4cGFuZCJpbiBnKXtmPWcuZXhwYW5kKGYpLGRlbGV0ZSBhW2RdO2ZvcihjIGluIGYpYyBpbiBhfHwoYVtjXT1mW2NdLGJbY109ZSl9ZWxzZSBiW2RdPWV9ZnVuY3Rpb24ga2IoYSxiLGMpe3ZhciBkLGUsZj0wLGc9ZGIubGVuZ3RoLGg9bS5EZWZlcnJlZCgpLmFsd2F5cyhmdW5jdGlvbigpe2RlbGV0ZSBpLmVsZW19KSxpPWZ1bmN0aW9uKCl7aWYoZSlyZXR1cm4hMTtmb3IodmFyIGI9JGF8fGZiKCksYz1NYXRoLm1heCgwLGouc3RhcnRUaW1lK2ouZHVyYXRpb24tYiksZD1jL2ouZHVyYXRpb258fDAsZj0xLWQsZz0wLGk9ai50d2VlbnMubGVuZ3RoO2k+ZztnKyspai50d2VlbnNbZ10ucnVuKGYpO3JldHVybiBoLm5vdGlmeVdpdGgoYSxbaixmLGNdKSwxPmYmJmk/YzooaC5yZXNvbHZlV2l0aChhLFtqXSksITEpfSxqPWgucHJvbWlzZSh7ZWxlbTphLHByb3BzOm0uZXh0ZW5kKHt9LGIpLG9wdHM6bS5leHRlbmQoITAse3NwZWNpYWxFYXNpbmc6e319LGMpLG9yaWdpbmFsUHJvcGVydGllczpiLG9yaWdpbmFsT3B0aW9uczpjLHN0YXJ0VGltZTokYXx8ZmIoKSxkdXJhdGlvbjpjLmR1cmF0aW9uLHR3ZWVuczpbXSxjcmVhdGVUd2VlbjpmdW5jdGlvbihiLGMpe3ZhciBkPW0uVHdlZW4oYSxqLm9wdHMsYixjLGoub3B0cy5zcGVjaWFsRWFzaW5nW2JdfHxqLm9wdHMuZWFzaW5nKTtyZXR1cm4gai50d2VlbnMucHVzaChkKSxkfSxzdG9wOmZ1bmN0aW9uKGIpe3ZhciBjPTAsZD1iP2oudHdlZW5zLmxlbmd0aDowO2lmKGUpcmV0dXJuIHRoaXM7Zm9yKGU9ITA7ZD5jO2MrKylqLnR3ZWVuc1tjXS5ydW4oMSk7cmV0dXJuIGI/aC5yZXNvbHZlV2l0aChhLFtqLGJdKTpoLnJlamVjdFdpdGgoYSxbaixiXSksdGhpc319KSxrPWoucHJvcHM7Zm9yKGpiKGssai5vcHRzLnNwZWNpYWxFYXNpbmcpO2c+ZjtmKyspaWYoZD1kYltmXS5jYWxsKGosYSxrLGoub3B0cykpcmV0dXJuIGQ7cmV0dXJuIG0ubWFwKGssaGIsaiksbS5pc0Z1bmN0aW9uKGoub3B0cy5zdGFydCkmJmoub3B0cy5zdGFydC5jYWxsKGEsaiksbS5meC50aW1lcihtLmV4dGVuZChpLHtlbGVtOmEsYW5pbTpqLHF1ZXVlOmoub3B0cy5xdWV1ZX0pKSxqLnByb2dyZXNzKGoub3B0cy5wcm9ncmVzcykuZG9uZShqLm9wdHMuZG9uZSxqLm9wdHMuY29tcGxldGUpLmZhaWwoai5vcHRzLmZhaWwpLmFsd2F5cyhqLm9wdHMuYWx3YXlzKX1tLkFuaW1hdGlvbj1tLmV4dGVuZChrYix7dHdlZW5lcjpmdW5jdGlvbihhLGIpe20uaXNGdW5jdGlvbihhKT8oYj1hLGE9WyIqIl0pOmE9YS5zcGxpdCgiICIpO2Zvcih2YXIgYyxkPTAsZT1hLmxlbmd0aDtlPmQ7ZCsrKWM9YVtkXSxlYltjXT1lYltjXXx8W10sZWJbY10udW5zaGlmdChiKX0scHJlZmlsdGVyOmZ1bmN0aW9uKGEsYil7Yj9kYi51bnNoaWZ0KGEpOmRiLnB1c2goYSl9fSksbS5zcGVlZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9YSYmIm9iamVjdCI9PXR5cGVvZiBhP20uZXh0ZW5kKHt9LGEpOntjb21wbGV0ZTpjfHwhYyYmYnx8bS5pc0Z1bmN0aW9uKGEpJiZhLGR1cmF0aW9uOmEsZWFzaW5nOmMmJmJ8fGImJiFtLmlzRnVuY3Rpb24oYikmJmJ9O3JldHVybiBkLmR1cmF0aW9uPW0uZngub2ZmPzA6Im51bWJlciI9PXR5cGVvZiBkLmR1cmF0aW9uP2QuZHVyYXRpb246ZC5kdXJhdGlvbiBpbiBtLmZ4LnNwZWVkcz9tLmZ4LnNwZWVkc1tkLmR1cmF0aW9uXTptLmZ4LnNwZWVkcy5fZGVmYXVsdCwobnVsbD09ZC5xdWV1ZXx8ZC5xdWV1ZT09PSEwKSYmKGQucXVldWU9ImZ4IiksZC5vbGQ9ZC5jb21wbGV0ZSxkLmNvbXBsZXRlPWZ1bmN0aW9uKCl7bS5pc0Z1bmN0aW9uKGQub2xkKSYmZC5vbGQuY2FsbCh0aGlzKSxkLnF1ZXVlJiZtLmRlcXVldWUodGhpcyxkLnF1ZXVlKX0sZH0sbS5mbi5leHRlbmQoe2ZhZGVUbzpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5maWx0ZXIoVSkuY3NzKCJvcGFjaXR5IiwwKS5zaG93KCkuZW5kKCkuYW5pbWF0ZSh7b3BhY2l0eTpifSxhLGMsZCl9LGFuaW1hdGU6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9bS5pc0VtcHR5T2JqZWN0KGEpLGY9bS5zcGVlZChiLGMsZCksZz1mdW5jdGlvbigpe3ZhciBiPWtiKHRoaXMsbS5leHRlbmQoe30sYSksZik7KGV8fG0uX2RhdGEodGhpcywiZmluaXNoIikpJiZiLnN0b3AoITApfTtyZXR1cm4gZy5maW5pc2g9ZyxlfHxmLnF1ZXVlPT09ITE/dGhpcy5lYWNoKGcpOnRoaXMucXVldWUoZi5xdWV1ZSxnKX0sc3RvcDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5zdG9wO2RlbGV0ZSBhLnN0b3AsYihjKX07cmV0dXJuInN0cmluZyIhPXR5cGVvZiBhJiYoYz1iLGI9YSxhPXZvaWQgMCksYiYmYSE9PSExJiZ0aGlzLnF1ZXVlKGF8fCJmeCIsW10pLHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPSEwLGU9bnVsbCE9YSYmYSsicXVldWVIb29rcyIsZj1tLnRpbWVycyxnPW0uX2RhdGEodGhpcyk7aWYoZSlnW2VdJiZnW2VdLnN0b3AmJmQoZ1tlXSk7ZWxzZSBmb3IoZSBpbiBnKWdbZV0mJmdbZV0uc3RvcCYmY2IudGVzdChlKSYmZChnW2VdKTtmb3IoZT1mLmxlbmd0aDtlLS07KWZbZV0uZWxlbSE9PXRoaXN8fG51bGwhPWEmJmZbZV0ucXVldWUhPT1hfHwoZltlXS5hbmltLnN0b3AoYyksYj0hMSxmLnNwbGljZShlLDEpKTsoYnx8IWMpJiZtLmRlcXVldWUodGhpcyxhKX0pfSxmaW5pc2g6ZnVuY3Rpb24oYSl7cmV0dXJuIGEhPT0hMSYmKGE9YXx8ImZ4IiksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGIsYz1tLl9kYXRhKHRoaXMpLGQ9Y1thKyJxdWV1ZSJdLGU9Y1thKyJxdWV1ZUhvb2tzIl0sZj1tLnRpbWVycyxnPWQ/ZC5sZW5ndGg6MDtmb3IoYy5maW5pc2g9ITAsbS5xdWV1ZSh0aGlzLGEsW10pLGUmJmUuc3RvcCYmZS5zdG9wLmNhbGwodGhpcywhMCksYj1mLmxlbmd0aDtiLS07KWZbYl0uZWxlbT09PXRoaXMmJmZbYl0ucXVldWU9PT1hJiYoZltiXS5hbmltLnN0b3AoITApLGYuc3BsaWNlKGIsMSkpO2ZvcihiPTA7Zz5iO2IrKylkW2JdJiZkW2JdLmZpbmlzaCYmZFtiXS5maW5pc2guY2FsbCh0aGlzKTtkZWxldGUgYy5maW5pc2h9KX19KSxtLmVhY2goWyJ0b2dnbGUiLCJzaG93IiwiaGlkZSJdLGZ1bmN0aW9uKGEsYil7dmFyIGM9bS5mbltiXTttLmZuW2JdPWZ1bmN0aW9uKGEsZCxlKXtyZXR1cm4gbnVsbD09YXx8ImJvb2xlYW4iPT10eXBlb2YgYT9jLmFwcGx5KHRoaXMsYXJndW1lbnRzKTp0aGlzLmFuaW1hdGUoZ2IoYiwhMCksYSxkLGUpfX0pLG0uZWFjaCh7c2xpZGVEb3duOmdiKCJzaG93Iiksc2xpZGVVcDpnYigiaGlkZSIpLHNsaWRlVG9nZ2xlOmdiKCJ0b2dnbGUiKSxmYWRlSW46e29wYWNpdHk6InNob3cifSxmYWRlT3V0OntvcGFjaXR5OiJoaWRlIn0sZmFkZVRvZ2dsZTp7b3BhY2l0eToidG9nZ2xlIn19LGZ1bmN0aW9uKGEsYil7bS5mblthXT1mdW5jdGlvbihhLGMsZCl7cmV0dXJuIHRoaXMuYW5pbWF0ZShiLGEsYyxkKX19KSxtLnRpbWVycz1bXSxtLmZ4LnRpY2s9ZnVuY3Rpb24oKXt2YXIgYSxiPW0udGltZXJzLGM9MDtmb3IoJGE9bS5ub3coKTtjPGIubGVuZ3RoO2MrKylhPWJbY10sYSgpfHxiW2NdIT09YXx8Yi5zcGxpY2UoYy0tLDEpO2IubGVuZ3RofHxtLmZ4LnN0b3AoKSwkYT12b2lkIDB9LG0uZngudGltZXI9ZnVuY3Rpb24oYSl7bS50aW1lcnMucHVzaChhKSxhKCk/bS5meC5zdGFydCgpOm0udGltZXJzLnBvcCgpfSxtLmZ4LmludGVydmFsPTEzLG0uZnguc3RhcnQ9ZnVuY3Rpb24oKXtfYXx8KF9hPXNldEludGVydmFsKG0uZngudGljayxtLmZ4LmludGVydmFsKSl9LG0uZnguc3RvcD1mdW5jdGlvbigpe2NsZWFySW50ZXJ2YWwoX2EpLF9hPW51bGx9LG0uZnguc3BlZWRzPXtzbG93OjYwMCxmYXN0OjIwMCxfZGVmYXVsdDo0MDB9LG0uZm4uZGVsYXk9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYT1tLmZ4P20uZnguc3BlZWRzW2FdfHxhOmEsYj1ifHwiZngiLHRoaXMucXVldWUoYixmdW5jdGlvbihiLGMpe3ZhciBkPXNldFRpbWVvdXQoYixhKTtjLnN0b3A9ZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQoZCl9fSl9LGZ1bmN0aW9uKCl7dmFyIGEsYixjLGQsZTtiPXkuY3JlYXRlRWxlbWVudCgiZGl2IiksYi5zZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIsInQiKSxiLmlubmVySFRNTD0iICA8bGluay8+PHRhYmxlPjwvdGFibGU+PGEgaHJlZj0nL2EnPmE8L2E+PGlucHV0IHR5cGU9J2NoZWNrYm94Jy8+IixkPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImEiKVswXSxjPXkuY3JlYXRlRWxlbWVudCgic2VsZWN0IiksZT1jLmFwcGVuZENoaWxkKHkuY3JlYXRlRWxlbWVudCgib3B0aW9uIikpLGE9Yi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKVswXSxkLnN0eWxlLmNzc1RleHQ9InRvcDoxcHgiLGsuZ2V0U2V0QXR0cmlidXRlPSJ0IiE9PWIuY2xhc3NOYW1lLGsuc3R5bGU9L3RvcC8udGVzdChkLmdldEF0dHJpYnV0ZSgic3R5bGUiKSksay5ocmVmTm9ybWFsaXplZD0iL2EiPT09ZC5nZXRBdHRyaWJ1dGUoImhyZWYiKSxrLmNoZWNrT249ISFhLnZhbHVlLGsub3B0U2VsZWN0ZWQ9ZS5zZWxlY3RlZCxrLmVuY3R5cGU9ISF5LmNyZWF0ZUVsZW1lbnQoImZvcm0iKS5lbmN0eXBlLGMuZGlzYWJsZWQ9ITAsay5vcHREaXNhYmxlZD0hZS5kaXNhYmxlZCxhPXkuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSxhLnNldEF0dHJpYnV0ZSgidmFsdWUiLCIiKSxrLmlucHV0PSIiPT09YS5nZXRBdHRyaWJ1dGUoInZhbHVlIiksYS52YWx1ZT0idCIsYS5zZXRBdHRyaWJ1dGUoInR5cGUiLCJyYWRpbyIpLGsucmFkaW9WYWx1ZT0idCI9PT1hLnZhbHVlfSgpO3ZhciBsYj0vXHIvZzttLmZuLmV4dGVuZCh7dmFsOmZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlPXRoaXNbMF07e2lmKGFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGQ9bS5pc0Z1bmN0aW9uKGEpLHRoaXMuZWFjaChmdW5jdGlvbihjKXt2YXIgZTsxPT09dGhpcy5ub2RlVHlwZSYmKGU9ZD9hLmNhbGwodGhpcyxjLG0odGhpcykudmFsKCkpOmEsbnVsbD09ZT9lPSIiOiJudW1iZXIiPT10eXBlb2YgZT9lKz0iIjptLmlzQXJyYXkoZSkmJihlPW0ubWFwKGUsZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PWE/IiI6YSsiIn0pKSxiPW0udmFsSG9va3NbdGhpcy50eXBlXXx8bS52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldLGImJiJzZXQiaW4gYiYmdm9pZCAwIT09Yi5zZXQodGhpcyxlLCJ2YWx1ZSIpfHwodGhpcy52YWx1ZT1lKSl9KTtpZihlKXJldHVybiBiPW0udmFsSG9va3NbZS50eXBlXXx8bS52YWxIb29rc1tlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldLGImJiJnZXQiaW4gYiYmdm9pZCAwIT09KGM9Yi5nZXQoZSwidmFsdWUiKSk/YzooYz1lLnZhbHVlLCJzdHJpbmciPT10eXBlb2YgYz9jLnJlcGxhY2UobGIsIiIpOm51bGw9PWM/IiI6Yyl9fX0pLG0uZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9bS5maW5kLmF0dHIoYSwidmFsdWUiKTtyZXR1cm4gbnVsbCE9Yj9iOm0udHJpbShtLnRleHQoYSkpfX0sc2VsZWN0OntnZXQ6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiLGMsZD1hLm9wdGlvbnMsZT1hLnNlbGVjdGVkSW5kZXgsZj0ic2VsZWN0LW9uZSI9PT1hLnR5cGV8fDA+ZSxnPWY/bnVsbDpbXSxoPWY/ZSsxOmQubGVuZ3RoLGk9MD5lP2g6Zj9lOjA7aD5pO2krKylpZihjPWRbaV0sISghYy5zZWxlY3RlZCYmaSE9PWV8fChrLm9wdERpc2FibGVkP2MuZGlzYWJsZWQ6bnVsbCE9PWMuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpKXx8Yy5wYXJlbnROb2RlLmRpc2FibGVkJiZtLm5vZGVOYW1lKGMucGFyZW50Tm9kZSwib3B0Z3JvdXAiKSkpe2lmKGI9bShjKS52YWwoKSxmKXJldHVybiBiO2cucHVzaChiKX1yZXR1cm4gZ30sc2V0OmZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlPWEub3B0aW9ucyxmPW0ubWFrZUFycmF5KGIpLGc9ZS5sZW5ndGg7d2hpbGUoZy0tKWlmKGQ9ZVtnXSxtLmluQXJyYXkobS52YWxIb29rcy5vcHRpb24uZ2V0KGQpLGYpPj0wKXRyeXtkLnNlbGVjdGVkPWM9ITB9Y2F0Y2goaCl7ZC5zY3JvbGxIZWlnaHR9ZWxzZSBkLnNlbGVjdGVkPSExO3JldHVybiBjfHwoYS5zZWxlY3RlZEluZGV4PS0xKSxlfX19fSksbS5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7bS52YWxIb29rc1t0aGlzXT17c2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIG0uaXNBcnJheShiKT9hLmNoZWNrZWQ9bS5pbkFycmF5KG0oYSkudmFsKCksYik+PTA6dm9pZCAwfX0say5jaGVja09ufHwobS52YWxIb29rc1t0aGlzXS5nZXQ9ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PT1hLmdldEF0dHJpYnV0ZSgidmFsdWUiKT8ib24iOmEudmFsdWV9KX0pO3ZhciBtYixuYixvYj1tLmV4cHIuYXR0ckhhbmRsZSxwYj0vXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLHFiPWsuZ2V0U2V0QXR0cmlidXRlLHJiPWsuaW5wdXQ7bS5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gVih0aGlzLG0uYXR0cixhLGIsYXJndW1lbnRzLmxlbmd0aD4xKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7bS5yZW1vdmVBdHRyKHRoaXMsYSl9KX19KSxtLmV4dGVuZCh7YXR0cjpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmPWEubm9kZVR5cGU7aWYoYSYmMyE9PWYmJjghPT1mJiYyIT09ZilyZXR1cm4gdHlwZW9mIGEuZ2V0QXR0cmlidXRlPT09Sz9tLnByb3AoYSxiLGMpOigxPT09ZiYmbS5pc1hNTERvYyhhKXx8KGI9Yi50b0xvd2VyQ2FzZSgpLGQ9bS5hdHRySG9va3NbYl18fChtLmV4cHIubWF0Y2guYm9vbC50ZXN0KGIpP25iOm1iKSksdm9pZCAwPT09Yz9kJiYiZ2V0ImluIGQmJm51bGwhPT0oZT1kLmdldChhLGIpKT9lOihlPW0uZmluZC5hdHRyKGEsYiksbnVsbD09ZT92b2lkIDA6ZSk6bnVsbCE9PWM/ZCYmInNldCJpbiBkJiZ2b2lkIDAhPT0oZT1kLnNldChhLGMsYikpP2U6KGEuc2V0QXR0cmlidXRlKGIsYysiIiksYyk6dm9pZCBtLnJlbW92ZUF0dHIoYSxiKSl9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGU9MCxmPWImJmIubWF0Y2goRSk7aWYoZiYmMT09PWEubm9kZVR5cGUpd2hpbGUoYz1mW2UrK10pZD1tLnByb3BGaXhbY118fGMsbS5leHByLm1hdGNoLmJvb2wudGVzdChjKT9yYiYmcWJ8fCFwYi50ZXN0KGMpP2FbZF09ITE6YVttLmNhbWVsQ2FzZSgiZGVmYXVsdC0iK2MpXT1hW2RdPSExOm0uYXR0cihhLGMsIiIpLGEucmVtb3ZlQXR0cmlidXRlKHFiP2M6ZCl9LGF0dHJIb29rczp7dHlwZTp7c2V0OmZ1bmN0aW9uKGEsYil7aWYoIWsucmFkaW9WYWx1ZSYmInJhZGlvIj09PWImJm0ubm9kZU5hbWUoYSwiaW5wdXQiKSl7dmFyIGM9YS52YWx1ZTtyZXR1cm4gYS5zZXRBdHRyaWJ1dGUoInR5cGUiLGIpLGMmJihhLnZhbHVlPWMpLGJ9fX19fSksbmI9e3NldDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGI9PT0hMT9tLnJlbW92ZUF0dHIoYSxjKTpyYiYmcWJ8fCFwYi50ZXN0KGMpP2Euc2V0QXR0cmlidXRlKCFxYiYmbS5wcm9wRml4W2NdfHxjLGMpOmFbbS5jYW1lbENhc2UoImRlZmF1bHQtIitjKV09YVtjXT0hMCxjfX0sbS5lYWNoKG0uZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCgvXHcrL2cpLGZ1bmN0aW9uKGEsYil7dmFyIGM9b2JbYl18fG0uZmluZC5hdHRyO29iW2JdPXJiJiZxYnx8IXBiLnRlc3QoYik/ZnVuY3Rpb24oYSxiLGQpe3ZhciBlLGY7cmV0dXJuIGR8fChmPW9iW2JdLG9iW2JdPWUsZT1udWxsIT1jKGEsYixkKT9iLnRvTG93ZXJDYXNlKCk6bnVsbCxvYltiXT1mKSxlfTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGM/dm9pZCAwOmFbbS5jYW1lbENhc2UoImRlZmF1bHQtIitiKV0/Yi50b0xvd2VyQ2FzZSgpOm51bGx9fSkscmImJnFifHwobS5hdHRySG9va3MudmFsdWU9e3NldDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIG0ubm9kZU5hbWUoYSwiaW5wdXQiKT92b2lkKGEuZGVmYXVsdFZhbHVlPWIpOm1iJiZtYi5zZXQoYSxiLGMpfX0pLHFifHwobWI9e3NldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkfHxhLnNldEF0dHJpYnV0ZU5vZGUoZD1hLm93bmVyRG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKGMpKSxkLnZhbHVlPWIrPSIiLCJ2YWx1ZSI9PT1jfHxiPT09YS5nZXRBdHRyaWJ1dGUoYyk/Yjp2b2lkIDB9fSxvYi5pZD1vYi5uYW1lPW9iLmNvb3Jkcz1mdW5jdGlvbihhLGIsYyl7dmFyIGQ7cmV0dXJuIGM/dm9pZCAwOihkPWEuZ2V0QXR0cmlidXRlTm9kZShiKSkmJiIiIT09ZC52YWx1ZT9kLnZhbHVlOm51bGx9LG0udmFsSG9va3MuYnV0dG9uPXtnZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmdldEF0dHJpYnV0ZU5vZGUoYik7cmV0dXJuIGMmJmMuc3BlY2lmaWVkP2MudmFsdWU6dm9pZCAwfSxzZXQ6bWIuc2V0fSxtLmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGU9e3NldDpmdW5jdGlvbihhLGIsYyl7bWIuc2V0KGEsIiI9PT1iPyExOmIsYyl9fSxtLmVhY2goWyJ3aWR0aCIsImhlaWdodCJdLGZ1bmN0aW9uKGEsYil7bS5hdHRySG9va3NbYl09e3NldDpmdW5jdGlvbihhLGMpe3JldHVybiIiPT09Yz8oYS5zZXRBdHRyaWJ1dGUoYiwiYXV0byIpLGMpOnZvaWQgMH19fSkpLGsuc3R5bGV8fChtLmF0dHJIb29rcy5zdHlsZT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLnN0eWxlLmNzc1RleHR8fHZvaWQgMH0sc2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuc3R5bGUuY3NzVGV4dD1iKyIifX0pO3ZhciBzYj0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaSx0Yj0vXig/OmF8YXJlYSkkL2k7bS5mbi5leHRlbmQoe3Byb3A6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gVih0aGlzLG0ucHJvcCxhLGIsYXJndW1lbnRzLmxlbmd0aD4xKX0scmVtb3ZlUHJvcDpmdW5jdGlvbihhKXtyZXR1cm4gYT1tLnByb3BGaXhbYV18fGEsdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dHJ5e3RoaXNbYV09dm9pZCAwLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGIpe319KX19KSxtLmV4dGVuZCh7cHJvcEZpeDp7ImZvciI6Imh0bWxGb3IiLCJjbGFzcyI6ImNsYXNzTmFtZSJ9LHByb3A6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZixnPWEubm9kZVR5cGU7aWYoYSYmMyE9PWcmJjghPT1nJiYyIT09ZylyZXR1cm4gZj0xIT09Z3x8IW0uaXNYTUxEb2MoYSksZiYmKGI9bS5wcm9wRml4W2JdfHxiLGU9bS5wcm9wSG9va3NbYl0pLHZvaWQgMCE9PWM/ZSYmInNldCJpbiBlJiZ2b2lkIDAhPT0oZD1lLnNldChhLGMsYikpP2Q6YVtiXT1jOmUmJiJnZXQiaW4gZSYmbnVsbCE9PShkPWUuZ2V0KGEsYikpP2Q6YVtiXX0scHJvcEhvb2tzOnt0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPW0uZmluZC5hdHRyKGEsInRhYmluZGV4Iik7cmV0dXJuIGI/cGFyc2VJbnQoYiwxMCk6c2IudGVzdChhLm5vZGVOYW1lKXx8dGIudGVzdChhLm5vZGVOYW1lKSYmYS5ocmVmPzA6LTF9fX19KSxrLmhyZWZOb3JtYWxpemVkfHxtLmVhY2goWyJocmVmIiwic3JjIl0sZnVuY3Rpb24oYSxiKXttLnByb3BIb29rc1tiXT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZShiLDQpfX19KSxrLm9wdFNlbGVjdGVkfHwobS5wcm9wSG9va3Muc2VsZWN0ZWQ9e2dldDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJihiLnNlbGVjdGVkSW5kZXgsYi5wYXJlbnROb2RlJiZiLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCksbnVsbH19KSxtLmVhY2goWyJ0YWJJbmRleCIsInJlYWRPbmx5IiwibWF4TGVuZ3RoIiwiY2VsbFNwYWNpbmciLCJjZWxsUGFkZGluZyIsInJvd1NwYW4iLCJjb2xTcGFuIiwidXNlTWFwIiwiZnJhbWVCb3JkZXIiLCJjb250ZW50RWRpdGFibGUiXSxmdW5jdGlvbigpe20ucHJvcEZpeFt0aGlzLnRvTG93ZXJDYXNlKCldPXRoaXN9KSxrLmVuY3R5cGV8fChtLnByb3BGaXguZW5jdHlwZT0iZW5jb2RpbmciKTt2YXIgdWI9L1tcdFxyXG5cZl0vZzttLmZuLmV4dGVuZCh7YWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZixnLGg9MCxpPXRoaXMubGVuZ3RoLGo9InN0cmluZyI9PXR5cGVvZiBhJiZhO2lmKG0uaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe20odGhpcykuYWRkQ2xhc3MoYS5jYWxsKHRoaXMsYix0aGlzLmNsYXNzTmFtZSkpfSk7aWYoailmb3IoYj0oYXx8IiIpLm1hdGNoKEUpfHxbXTtpPmg7aCsrKWlmKGM9dGhpc1toXSxkPTE9PT1jLm5vZGVUeXBlJiYoYy5jbGFzc05hbWU/KCIgIitjLmNsYXNzTmFtZSsiICIpLnJlcGxhY2UodWIsIiAiKToiICIpKXtmPTA7d2hpbGUoZT1iW2YrK10pZC5pbmRleE9mKCIgIitlKyIgIik8MCYmKGQrPWUrIiAiKTtnPW0udHJpbShkKSxjLmNsYXNzTmFtZSE9PWcmJihjLmNsYXNzTmFtZT1nKX1yZXR1cm4gdGhpc30scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZixnLGg9MCxpPXRoaXMubGVuZ3RoLGo9MD09PWFyZ3VtZW50cy5sZW5ndGh8fCJzdHJpbmciPT10eXBlb2YgYSYmYTtpZihtLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXttKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGopZm9yKGI9KGF8fCIiKS5tYXRjaChFKXx8W107aT5oO2grKylpZihjPXRoaXNbaF0sZD0xPT09Yy5ub2RlVHlwZSYmKGMuY2xhc3NOYW1lPygiICIrYy5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKHViLCIgIik6IiIpKXtmPTA7d2hpbGUoZT1iW2YrK10pd2hpbGUoZC5pbmRleE9mKCIgIitlKyIgIik+PTApZD1kLnJlcGxhY2UoIiAiK2UrIiAiLCIgIik7Zz1hP20udHJpbShkKToiIixjLmNsYXNzTmFtZSE9PWcmJihjLmNsYXNzTmFtZT1nKX1yZXR1cm4gdGhpc30sdG9nZ2xlQ2xhc3M6ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYTtyZXR1cm4iYm9vbGVhbiI9PXR5cGVvZiBiJiYic3RyaW5nIj09PWM/Yj90aGlzLmFkZENsYXNzKGEpOnRoaXMucmVtb3ZlQ2xhc3MoYSk6dGhpcy5lYWNoKG0uaXNGdW5jdGlvbihhKT9mdW5jdGlvbihjKXttKHRoaXMpLnRvZ2dsZUNsYXNzKGEuY2FsbCh0aGlzLGMsdGhpcy5jbGFzc05hbWUsYiksYil9OmZ1bmN0aW9uKCl7aWYoInN0cmluZyI9PT1jKXt2YXIgYixkPTAsZT1tKHRoaXMpLGY9YS5tYXRjaChFKXx8W107d2hpbGUoYj1mW2QrK10pZS5oYXNDbGFzcyhiKT9lLnJlbW92ZUNsYXNzKGIpOmUuYWRkQ2xhc3MoYil9ZWxzZShjPT09S3x8ImJvb2xlYW4iPT09YykmJih0aGlzLmNsYXNzTmFtZSYmbS5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT8iIjptLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiIpfSl9LGhhc0NsYXNzOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYj0iICIrYSsiICIsYz0wLGQ9dGhpcy5sZW5ndGg7ZD5jO2MrKylpZigxPT09dGhpc1tjXS5ub2RlVHlwZSYmKCIgIit0aGlzW2NdLmNsYXNzTmFtZSsiICIpLnJlcGxhY2UodWIsIiAiKS5pbmRleE9mKGIpPj0wKXJldHVybiEwO3JldHVybiExfX0pLG0uZWFjaCgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe20uZm5bYl09ZnVuY3Rpb24oYSxjKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4wP3RoaXMub24oYixudWxsLGEsYyk6dGhpcy50cmlnZ2VyKGIpfX0pLG0uZm4uZXh0ZW5kKHtob3ZlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLm1vdXNlZW50ZXIoYSkubW91c2VsZWF2ZShifHxhKX0sYmluZDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIHRoaXMub24oYSxudWxsLGIsYyl9LHVuYmluZDpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLm9mZihhLG51bGwsYil9LGRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLm9uKGIsYSxjLGQpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gMT09PWFyZ3VtZW50cy5sZW5ndGg/dGhpcy5vZmYoYSwiKioiKTp0aGlzLm9mZihiLGF8fCIqKiIsYyl9fSk7dmFyIHZiPW0ubm93KCksd2I9L1w/Lyx4Yj0vKCwpfChcW3x7KXwofXxdKXwiKD86W14iXFxcclxuXXxcXFsiXFxcL2JmbnJ0XXxcXHVbXGRhLWZBLUZdezR9KSoiXHMqOj98dHJ1ZXxmYWxzZXxudWxsfC0/KD8hMFxkKVxkKyg/OlwuXGQrfCkoPzpbZUVdWystXT9cZCt8KS9nO20ucGFyc2VKU09OPWZ1bmN0aW9uKGIpe2lmKGEuSlNPTiYmYS5KU09OLnBhcnNlKXJldHVybiBhLkpTT04ucGFyc2UoYisiIik7dmFyIGMsZD1udWxsLGU9bS50cmltKGIrIiIpO3JldHVybiBlJiYhbS50cmltKGUucmVwbGFjZSh4YixmdW5jdGlvbihhLGIsZSxmKXtyZXR1cm4gYyYmYiYmKGQ9MCksMD09PWQ/YTooYz1lfHxiLGQrPSFmLSFlLCIiKX0pKT9GdW5jdGlvbigicmV0dXJuICIrZSkoKTptLmVycm9yKCJJbnZhbGlkIEpTT046ICIrYil9LG0ucGFyc2VYTUw9ZnVuY3Rpb24oYil7dmFyIGMsZDtpZighYnx8InN0cmluZyIhPXR5cGVvZiBiKXJldHVybiBudWxsO3RyeXthLkRPTVBhcnNlcj8oZD1uZXcgRE9NUGFyc2VyLGM9ZC5wYXJzZUZyb21TdHJpbmcoYiwidGV4dC94bWwiKSk6KGM9bmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxET00iKSxjLmFzeW5jPSJmYWxzZSIsYy5sb2FkWE1MKGIpKX1jYXRjaChlKXtjPXZvaWQgMH1yZXR1cm4gYyYmYy5kb2N1bWVudEVsZW1lbnQmJiFjLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpLmxlbmd0aHx8bS5lcnJvcigiSW52YWxpZCBYTUw6ICIrYiksY307dmFyIHliLHpiLEFiPS8jLiokLyxCYj0vKFs/Jl0pXz1bXiZdKi8sQ2I9L14oLio/KTpbIFx0XSooW15cclxuXSopXHI/JC9nbSxEYj0vXig/OmFib3V0fGFwcHxhcHAtc3RvcmFnZXwuKy1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLyxFYj0vXig/OkdFVHxIRUFEKSQvLEZiPS9eXC9cLy8sR2I9L14oW1x3ListXSs6KSg/OlwvXC8oPzpbXlwvPyNdKkB8KShbXlwvPyM6XSopKD86OihcZCspfCl8KS8sSGI9e30sSWI9e30sSmI9IiovIi5jb25jYXQoIioiKTt0cnl7emI9bG9jYXRpb24uaHJlZn1jYXRjaChLYil7emI9eS5jcmVhdGVFbGVtZW50KCJhIiksemIuaHJlZj0iIix6Yj16Yi5ocmVmfXliPUdiLmV4ZWMoemIudG9Mb3dlckNhc2UoKSl8fFtdO2Z1bmN0aW9uIExiKGEpe3JldHVybiBmdW5jdGlvbihiLGMpeyJzdHJpbmciIT10eXBlb2YgYiYmKGM9YixiPSIqIik7dmFyIGQsZT0wLGY9Yi50b0xvd2VyQ2FzZSgpLm1hdGNoKEUpfHxbXTtpZihtLmlzRnVuY3Rpb24oYykpd2hpbGUoZD1mW2UrK10pIisiPT09ZC5jaGFyQXQoMCk/KGQ9ZC5zbGljZSgxKXx8IioiLChhW2RdPWFbZF18fFtdKS51bnNoaWZ0KGMpKTooYVtkXT1hW2RdfHxbXSkucHVzaChjKX19ZnVuY3Rpb24gTWIoYSxiLGMsZCl7dmFyIGU9e30sZj1hPT09SWI7ZnVuY3Rpb24gZyhoKXt2YXIgaTtyZXR1cm4gZVtoXT0hMCxtLmVhY2goYVtoXXx8W10sZnVuY3Rpb24oYSxoKXt2YXIgaj1oKGIsYyxkKTtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGp8fGZ8fGVbal0/Zj8hKGk9aik6dm9pZCAwOihiLmRhdGFUeXBlcy51bnNoaWZ0KGopLGcoaiksITEpfSksaX1yZXR1cm4gZyhiLmRhdGFUeXBlc1swXSl8fCFlWyIqIl0mJmcoIioiKX1mdW5jdGlvbiBOYihhLGIpe3ZhciBjLGQsZT1tLmFqYXhTZXR0aW5ncy5mbGF0T3B0aW9uc3x8e307Zm9yKGQgaW4gYil2b2lkIDAhPT1iW2RdJiYoKGVbZF0/YTpjfHwoYz17fSkpW2RdPWJbZF0pO3JldHVybiBjJiZtLmV4dGVuZCghMCxhLGMpLGF9ZnVuY3Rpb24gT2IoYSxiLGMpe3ZhciBkLGUsZixnLGg9YS5jb250ZW50cyxpPWEuZGF0YVR5cGVzO3doaWxlKCIqIj09PWlbMF0paS5zaGlmdCgpLHZvaWQgMD09PWUmJihlPWEubWltZVR5cGV8fGIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpKTtpZihlKWZvcihnIGluIGgpaWYoaFtnXSYmaFtnXS50ZXN0KGUpKXtpLnVuc2hpZnQoZyk7YnJlYWt9aWYoaVswXWluIGMpZj1pWzBdO2Vsc2V7Zm9yKGcgaW4gYyl7aWYoIWlbMF18fGEuY29udmVydGVyc1tnKyIgIitpWzBdXSl7Zj1nO2JyZWFrfWR8fChkPWcpfWY9Znx8ZH1yZXR1cm4gZj8oZiE9PWlbMF0mJmkudW5zaGlmdChmKSxjW2ZdKTp2b2lkIDB9ZnVuY3Rpb24gUGIoYSxiLGMsZCl7dmFyIGUsZixnLGgsaSxqPXt9LGs9YS5kYXRhVHlwZXMuc2xpY2UoKTtpZihrWzFdKWZvcihnIGluIGEuY29udmVydGVycylqW2cudG9Mb3dlckNhc2UoKV09YS5jb252ZXJ0ZXJzW2ddO2Y9ay5zaGlmdCgpO3doaWxlKGYpaWYoYS5yZXNwb25zZUZpZWxkc1tmXSYmKGNbYS5yZXNwb25zZUZpZWxkc1tmXV09YiksIWkmJmQmJmEuZGF0YUZpbHRlciYmKGI9YS5kYXRhRmlsdGVyKGIsYS5kYXRhVHlwZSkpLGk9ZixmPWsuc2hpZnQoKSlpZigiKiI9PT1mKWY9aTtlbHNlIGlmKCIqIiE9PWkmJmkhPT1mKXtpZihnPWpbaSsiICIrZl18fGpbIiogIitmXSwhZylmb3IoZSBpbiBqKWlmKGg9ZS5zcGxpdCgiICIpLGhbMV09PT1mJiYoZz1qW2krIiAiK2hbMF1dfHxqWyIqICIraFswXV0pKXtnPT09ITA/Zz1qW2VdOmpbZV0hPT0hMCYmKGY9aFswXSxrLnVuc2hpZnQoaFsxXSkpO2JyZWFrfWlmKGchPT0hMClpZihnJiZhWyJ0aHJvd3MiXSliPWcoYik7ZWxzZSB0cnl7Yj1nKGIpfWNhdGNoKGwpe3JldHVybntzdGF0ZToicGFyc2VyZXJyb3IiLGVycm9yOmc/bDoiTm8gY29udmVyc2lvbiBmcm9tICIraSsiIHRvICIrZn19fXJldHVybntzdGF0ZToic3VjY2VzcyIsZGF0YTpifX1tLmV4dGVuZCh7YWN0aXZlOjAsbGFzdE1vZGlmaWVkOnt9LGV0YWc6e30sYWpheFNldHRpbmdzOnt1cmw6emIsdHlwZToiR0VUIixpc0xvY2FsOkRiLnRlc3QoeWJbMV0pLGdsb2JhbDohMCxwcm9jZXNzRGF0YTohMCxhc3luYzohMCxjb250ZW50VHlwZToiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IixhY2NlcHRzOnsiKiI6SmIsdGV4dDoidGV4dC9wbGFpbiIsaHRtbDoidGV4dC9odG1sIix4bWw6ImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLGpzb246ImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCJ9LGNvbnRlbnRzOnt4bWw6L3htbC8saHRtbDovaHRtbC8sanNvbjovanNvbi99LHJlc3BvbnNlRmllbGRzOnt4bWw6InJlc3BvbnNlWE1MIix0ZXh0OiJyZXNwb25zZVRleHQiLGpzb246InJlc3BvbnNlSlNPTiJ9LGNvbnZlcnRlcnM6eyIqIHRleHQiOlN0cmluZywidGV4dCBodG1sIjohMCwidGV4dCBqc29uIjptLnBhcnNlSlNPTiwidGV4dCB4bWwiOm0ucGFyc2VYTUx9LGZsYXRPcHRpb25zOnt1cmw6ITAsY29udGV4dDohMH19LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe3JldHVybiBiP05iKE5iKGEsbS5hamF4U2V0dGluZ3MpLGIpOk5iKG0uYWpheFNldHRpbmdzLGEpfSxhamF4UHJlZmlsdGVyOkxiKEhiKSxhamF4VHJhbnNwb3J0OkxiKEliKSxhamF4OmZ1bmN0aW9uKGEsYil7Im9iamVjdCI9PXR5cGVvZiBhJiYoYj1hLGE9dm9pZCAwKSxiPWJ8fHt9O3ZhciBjLGQsZSxmLGcsaCxpLGosaz1tLmFqYXhTZXR1cCh7fSxiKSxsPWsuY29udGV4dHx8ayxuPWsuY29udGV4dCYmKGwubm9kZVR5cGV8fGwuanF1ZXJ5KT9tKGwpOm0uZXZlbnQsbz1tLkRlZmVycmVkKCkscD1tLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSxxPWsuc3RhdHVzQ29kZXx8e30scj17fSxzPXt9LHQ9MCx1PSJjYW5jZWxlZCIsdj17cmVhZHlTdGF0ZTowLGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGEpe3ZhciBiO2lmKDI9PT10KXtpZighail7aj17fTt3aGlsZShiPUNiLmV4ZWMoZikpaltiWzFdLnRvTG93ZXJDYXNlKCldPWJbMl19Yj1qW2EudG9Mb3dlckNhc2UoKV19cmV0dXJuIG51bGw9PWI/bnVsbDpifSxnZXRBbGxSZXNwb25zZUhlYWRlcnM6ZnVuY3Rpb24oKXtyZXR1cm4gMj09PXQ/ZjpudWxsfSxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7dmFyIGM9YS50b0xvd2VyQ2FzZSgpO3JldHVybiB0fHwoYT1zW2NdPXNbY118fGEsclthXT1iKSx0aGlzfSxvdmVycmlkZU1pbWVUeXBlOmZ1bmN0aW9uKGEpe3JldHVybiB0fHwoay5taW1lVHlwZT1hKSx0aGlzfSxzdGF0dXNDb2RlOmZ1bmN0aW9uKGEpe3ZhciBiO2lmKGEpaWYoMj50KWZvcihiIGluIGEpcVtiXT1bcVtiXSxhW2JdXTtlbHNlIHYuYWx3YXlzKGFbdi5zdGF0dXNdKTtyZXR1cm4gdGhpc30sYWJvcnQ6ZnVuY3Rpb24oYSl7dmFyIGI9YXx8dTtyZXR1cm4gaSYmaS5hYm9ydChiKSx4KDAsYiksdGhpc319O2lmKG8ucHJvbWlzZSh2KS5jb21wbGV0ZT1wLmFkZCx2LnN1Y2Nlc3M9di5kb25lLHYuZXJyb3I9di5mYWlsLGsudXJsPSgoYXx8ay51cmx8fHpiKSsiIikucmVwbGFjZShBYiwiIikucmVwbGFjZShGYix5YlsxXSsiLy8iKSxrLnR5cGU9Yi5tZXRob2R8fGIudHlwZXx8ay5tZXRob2R8fGsudHlwZSxrLmRhdGFUeXBlcz1tLnRyaW0oay5kYXRhVHlwZXx8IioiKS50b0xvd2VyQ2FzZSgpLm1hdGNoKEUpfHxbIiJdLG51bGw9PWsuY3Jvc3NEb21haW4mJihjPUdiLmV4ZWMoay51cmwudG9Mb3dlckNhc2UoKSksay5jcm9zc0RvbWFpbj0hKCFjfHxjWzFdPT09eWJbMV0mJmNbMl09PT15YlsyXSYmKGNbM118fCgiaHR0cDoiPT09Y1sxXT8iODAiOiI0NDMiKSk9PT0oeWJbM118fCgiaHR0cDoiPT09eWJbMV0/IjgwIjoiNDQzIikpKSksay5kYXRhJiZrLnByb2Nlc3NEYXRhJiYic3RyaW5nIiE9dHlwZW9mIGsuZGF0YSYmKGsuZGF0YT1tLnBhcmFtKGsuZGF0YSxrLnRyYWRpdGlvbmFsKSksTWIoSGIsayxiLHYpLDI9PT10KXJldHVybiB2O2g9bS5ldmVudCYmay5nbG9iYWwsaCYmMD09PW0uYWN0aXZlKysmJm0uZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iiksay50eXBlPWsudHlwZS50b1VwcGVyQ2FzZSgpLGsuaGFzQ29udGVudD0hRWIudGVzdChrLnR5cGUpLGU9ay51cmwsay5oYXNDb250ZW50fHwoay5kYXRhJiYoZT1rLnVybCs9KHdiLnRlc3QoZSk/IiYiOiI/Iikray5kYXRhLGRlbGV0ZSBrLmRhdGEpLGsuY2FjaGU9PT0hMSYmKGsudXJsPUJiLnRlc3QoZSk/ZS5yZXBsYWNlKEJiLCIkMV89Iit2YisrKTplKyh3Yi50ZXN0KGUpPyImIjoiPyIpKyJfPSIrdmIrKykpLGsuaWZNb2RpZmllZCYmKG0ubGFzdE1vZGlmaWVkW2VdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIixtLmxhc3RNb2RpZmllZFtlXSksbS5ldGFnW2VdJiZ2LnNldFJlcXVlc3RIZWFkZXIoIklmLU5vbmUtTWF0Y2giLG0uZXRhZ1tlXSkpLChrLmRhdGEmJmsuaGFzQ29udGVudCYmay5jb250ZW50VHlwZSE9PSExfHxiLmNvbnRlbnRUeXBlKSYmdi5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLGsuY29udGVudFR5cGUpLHYuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IixrLmRhdGFUeXBlc1swXSYmay5hY2NlcHRzW2suZGF0YVR5cGVzWzBdXT9rLmFjY2VwdHNbay5kYXRhVHlwZXNbMF1dKygiKiIhPT1rLmRhdGFUeXBlc1swXT8iLCAiK0piKyI7IHE9MC4wMSI6IiIpOmsuYWNjZXB0c1siKiJdKTtmb3IoZCBpbiBrLmhlYWRlcnMpdi5zZXRSZXF1ZXN0SGVhZGVyKGQsay5oZWFkZXJzW2RdKTtpZihrLmJlZm9yZVNlbmQmJihrLmJlZm9yZVNlbmQuY2FsbChsLHYsayk9PT0hMXx8Mj09PXQpKXJldHVybiB2LmFib3J0KCk7dT0iYWJvcnQiO2ZvcihkIGlue3N1Y2Nlc3M6MSxlcnJvcjoxLGNvbXBsZXRlOjF9KXZbZF0oa1tkXSk7aWYoaT1NYihJYixrLGIsdikpe3YucmVhZHlTdGF0ZT0xLGgmJm4udHJpZ2dlcigiYWpheFNlbmQiLFt2LGtdKSxrLmFzeW5jJiZrLnRpbWVvdXQ+MCYmKGc9c2V0VGltZW91dChmdW5jdGlvbigpe3YuYWJvcnQoInRpbWVvdXQiKX0say50aW1lb3V0KSk7dHJ5e3Q9MSxpLnNlbmQocix4KX1jYXRjaCh3KXtpZighKDI+dCkpdGhyb3cgdzt4KC0xLHcpfX1lbHNlIHgoLTEsIk5vIFRyYW5zcG9ydCIpO2Z1bmN0aW9uIHgoYSxiLGMsZCl7dmFyIGoscixzLHUsdyx4PWI7MiE9PXQmJih0PTIsZyYmY2xlYXJUaW1lb3V0KGcpLGk9dm9pZCAwLGY9ZHx8IiIsdi5yZWFkeVN0YXRlPWE+MD80OjAsaj1hPj0yMDAmJjMwMD5hfHwzMDQ9PT1hLGMmJih1PU9iKGssdixjKSksdT1QYihrLHUsdixqKSxqPyhrLmlmTW9kaWZpZWQmJih3PXYuZ2V0UmVzcG9uc2VIZWFkZXIoIkxhc3QtTW9kaWZpZWQiKSx3JiYobS5sYXN0TW9kaWZpZWRbZV09dyksdz12LmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIiksdyYmKG0uZXRhZ1tlXT13KSksMjA0PT09YXx8IkhFQUQiPT09ay50eXBlP3g9Im5vY29udGVudCI6MzA0PT09YT94PSJub3Rtb2RpZmllZCI6KHg9dS5zdGF0ZSxyPXUuZGF0YSxzPXUuZXJyb3Isaj0hcykpOihzPXgsKGF8fCF4KSYmKHg9ImVycm9yIiwwPmEmJihhPTApKSksdi5zdGF0dXM9YSx2LnN0YXR1c1RleHQ9KGJ8fHgpKyIiLGo/by5yZXNvbHZlV2l0aChsLFtyLHgsdl0pOm8ucmVqZWN0V2l0aChsLFt2LHgsc10pLHYuc3RhdHVzQ29kZShxKSxxPXZvaWQgMCxoJiZuLnRyaWdnZXIoaj8iYWpheFN1Y2Nlc3MiOiJhamF4RXJyb3IiLFt2LGssaj9yOnNdKSxwLmZpcmVXaXRoKGwsW3YseF0pLGgmJihuLnRyaWdnZXIoImFqYXhDb21wbGV0ZSIsW3Ysa10pLC0tbS5hY3RpdmV8fG0uZXZlbnQudHJpZ2dlcigiYWpheFN0b3AiKSkpfXJldHVybiB2fSxnZXRKU09OOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gbS5nZXQoYSxiLGMsImpzb24iKX0sZ2V0U2NyaXB0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIG0uZ2V0KGEsdm9pZCAwLGIsInNjcmlwdCIpfX0pLG0uZWFjaChbImdldCIsInBvc3QiXSxmdW5jdGlvbihhLGIpe21bYl09ZnVuY3Rpb24oYSxjLGQsZSl7cmV0dXJuIG0uaXNGdW5jdGlvbihjKSYmKGU9ZXx8ZCxkPWMsYz12b2lkIDApLG0uYWpheCh7dXJsOmEsdHlwZTpiLGRhdGFUeXBlOmUsZGF0YTpjLHN1Y2Nlc3M6ZH0pfX0pLG0uX2V2YWxVcmw9ZnVuY3Rpb24oYSl7cmV0dXJuIG0uYWpheCh7dXJsOmEsdHlwZToiR0VUIixkYXRhVHlwZToic2NyaXB0Iixhc3luYzohMSxnbG9iYWw6ITEsInRocm93cyI6ITB9KX0sbS5mbi5leHRlbmQoe3dyYXBBbGw6ZnVuY3Rpb24oYSl7aWYobS5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7bSh0aGlzKS53cmFwQWxsKGEuY2FsbCh0aGlzLGIpKX0pO2lmKHRoaXNbMF0pe3ZhciBiPW0oYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKTt0aGlzWzBdLnBhcmVudE5vZGUmJmIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLGIubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt3aGlsZShhLmZpcnN0Q2hpbGQmJjE9PT1hLmZpcnN0Q2hpbGQubm9kZVR5cGUpYT1hLmZpcnN0Q2hpbGQ7cmV0dXJuIGF9KS5hcHBlbmQodGhpcyl9cmV0dXJuIHRoaXN9LHdyYXBJbm5lcjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKG0uaXNGdW5jdGlvbihhKT9mdW5jdGlvbihiKXttKHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcyxiKSl9OmZ1bmN0aW9uKCl7dmFyIGI9bSh0aGlzKSxjPWIuY29udGVudHMoKTtjLmxlbmd0aD9jLndyYXBBbGwoYSk6Yi5hcHBlbmQoYSl9KX0sd3JhcDpmdW5jdGlvbihhKXt2YXIgYj1tLmlzRnVuY3Rpb24oYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXttKHRoaXMpLndyYXBBbGwoYj9hLmNhbGwodGhpcyxjKTphKX0pfSx1bndyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7bS5ub2RlTmFtZSh0aGlzLCJib2R5Iil8fG0odGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKX0pLmVuZCgpfX0pLG0uZXhwci5maWx0ZXJzLmhpZGRlbj1mdW5jdGlvbihhKXtyZXR1cm4gYS5vZmZzZXRXaWR0aDw9MCYmYS5vZmZzZXRIZWlnaHQ8PTB8fCFrLnJlbGlhYmxlSGlkZGVuT2Zmc2V0cygpJiYibm9uZSI9PT0oYS5zdHlsZSYmYS5zdHlsZS5kaXNwbGF5fHxtLmNzcyhhLCJkaXNwbGF5IikpfSxtLmV4cHIuZmlsdGVycy52aXNpYmxlPWZ1bmN0aW9uKGEpe3JldHVybiFtLmV4cHIuZmlsdGVycy5oaWRkZW4oYSl9O3ZhciBRYj0vJTIwL2csUmI9L1xbXF0kLyxTYj0vXHI/XG4vZyxUYj0vXig/OnN1Ym1pdHxidXR0b258aW1hZ2V8cmVzZXR8ZmlsZSkkL2ksVWI9L14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pO2Z1bmN0aW9uIFZiKGEsYixjLGQpe3ZhciBlO2lmKG0uaXNBcnJheShiKSltLmVhY2goYixmdW5jdGlvbihiLGUpe2N8fFJiLnRlc3QoYSk/ZChhLGUpOlZiKGErIlsiKygib2JqZWN0Ij09dHlwZW9mIGU/YjoiIikrIl0iLGUsYyxkKX0pO2Vsc2UgaWYoY3x8Im9iamVjdCIhPT1tLnR5cGUoYikpZChhLGIpO2Vsc2UgZm9yKGUgaW4gYilWYihhKyJbIitlKyJdIixiW2VdLGMsZCl9bS5wYXJhbT1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9W10sZT1mdW5jdGlvbihhLGIpe2I9bS5pc0Z1bmN0aW9uKGIpP2IoKTpudWxsPT1iPyIiOmIsZFtkLmxlbmd0aF09ZW5jb2RlVVJJQ29tcG9uZW50KGEpKyI9IitlbmNvZGVVUklDb21wb25lbnQoYil9O2lmKHZvaWQgMD09PWImJihiPW0uYWpheFNldHRpbmdzJiZtLmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbCksbS5pc0FycmF5KGEpfHxhLmpxdWVyeSYmIW0uaXNQbGFpbk9iamVjdChhKSltLmVhY2goYSxmdW5jdGlvbigpe2UodGhpcy5uYW1lLHRoaXMudmFsdWUpfSk7ZWxzZSBmb3IoYyBpbiBhKVZiKGMsYVtjXSxiLGUpO3JldHVybiBkLmpvaW4oIiYiKS5yZXBsYWNlKFFiLCIrIil9LG0uZm4uZXh0ZW5kKHtzZXJpYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gbS5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpfSxzZXJpYWxpemVBcnJheTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBhPW0ucHJvcCh0aGlzLCJlbGVtZW50cyIpO3JldHVybiBhP20ubWFrZUFycmF5KGEpOnRoaXN9KS5maWx0ZXIoZnVuY3Rpb24oKXt2YXIgYT10aGlzLnR5cGU7cmV0dXJuIHRoaXMubmFtZSYmIW0odGhpcykuaXMoIjpkaXNhYmxlZCIpJiZVYi50ZXN0KHRoaXMubm9kZU5hbWUpJiYhVGIudGVzdChhKSYmKHRoaXMuY2hlY2tlZHx8IVcudGVzdChhKSl9KS5tYXAoZnVuY3Rpb24oYSxiKXt2YXIgYz1tKHRoaXMpLnZhbCgpO3JldHVybiBudWxsPT1jP251bGw6bS5pc0FycmF5KGMpP20ubWFwKGMsZnVuY3Rpb24oYSl7cmV0dXJue25hbWU6Yi5uYW1lLHZhbHVlOmEucmVwbGFjZShTYiwiXHJcbiIpfX0pOntuYW1lOmIubmFtZSx2YWx1ZTpjLnJlcGxhY2UoU2IsIlxyXG4iKX19KS5nZXQoKX19KSxtLmFqYXhTZXR0aW5ncy54aHI9dm9pZCAwIT09YS5BY3RpdmVYT2JqZWN0P2Z1bmN0aW9uKCl7cmV0dXJuIXRoaXMuaXNMb2NhbCYmL14oZ2V0fHBvc3R8aGVhZHxwdXR8ZGVsZXRlfG9wdGlvbnMpJC9pLnRlc3QodGhpcy50eXBlKSYmWmIoKXx8JGIoKX06WmI7dmFyIFdiPTAsWGI9e30sWWI9bS5hamF4U2V0dGluZ3MueGhyKCk7YS5hdHRhY2hFdmVudCYmYS5hdHRhY2hFdmVudCgib251bmxvYWQiLGZ1bmN0aW9uKCl7Zm9yKHZhciBhIGluIFhiKVhiW2FdKHZvaWQgMCwhMCl9KSxrLmNvcnM9ISFZYiYmIndpdGhDcmVkZW50aWFscyJpbiBZYixZYj1rLmFqYXg9ISFZYixZYiYmbS5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKGEpe2lmKCFhLmNyb3NzRG9tYWlufHxrLmNvcnMpe3ZhciBiO3JldHVybntzZW5kOmZ1bmN0aW9uKGMsZCl7dmFyIGUsZj1hLnhocigpLGc9KytXYjtpZihmLm9wZW4oYS50eXBlLGEudXJsLGEuYXN5bmMsYS51c2VybmFtZSxhLnBhc3N3b3JkKSxhLnhockZpZWxkcylmb3IoZSBpbiBhLnhockZpZWxkcylmW2VdPWEueGhyRmllbGRzW2VdO2EubWltZVR5cGUmJmYub3ZlcnJpZGVNaW1lVHlwZSYmZi5vdmVycmlkZU1pbWVUeXBlKGEubWltZVR5cGUpLGEuY3Jvc3NEb21haW58fGNbIlgtUmVxdWVzdGVkLVdpdGgiXXx8KGNbIlgtUmVxdWVzdGVkLVdpdGgiXT0iWE1MSHR0cFJlcXVlc3QiKTtmb3IoZSBpbiBjKXZvaWQgMCE9PWNbZV0mJmYuc2V0UmVxdWVzdEhlYWRlcihlLGNbZV0rIiIpO2Yuc2VuZChhLmhhc0NvbnRlbnQmJmEuZGF0YXx8bnVsbCksYj1mdW5jdGlvbihjLGUpe3ZhciBoLGksajtpZihiJiYoZXx8ND09PWYucmVhZHlTdGF0ZSkpaWYoZGVsZXRlIFhiW2ddLGI9dm9pZCAwLGYub25yZWFkeXN0YXRlY2hhbmdlPW0ubm9vcCxlKTQhPT1mLnJlYWR5U3RhdGUmJmYuYWJvcnQoKTtlbHNle2o9e30saD1mLnN0YXR1cywic3RyaW5nIj09dHlwZW9mIGYucmVzcG9uc2VUZXh0JiYoai50ZXh0PWYucmVzcG9uc2VUZXh0KTt0cnl7aT1mLnN0YXR1c1RleHR9Y2F0Y2goayl7aT0iIn1ofHwhYS5pc0xvY2FsfHxhLmNyb3NzRG9tYWluPzEyMjM9PT1oJiYoaD0yMDQpOmg9ai50ZXh0PzIwMDo0MDR9aiYmZChoLGksaixmLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKX0sYS5hc3luYz80PT09Zi5yZWFkeVN0YXRlP3NldFRpbWVvdXQoYik6Zi5vbnJlYWR5c3RhdGVjaGFuZ2U9WGJbZ109YjpiKCl9LGFib3J0OmZ1bmN0aW9uKCl7YiYmYih2b2lkIDAsITApfX19fSk7ZnVuY3Rpb24gWmIoKXt0cnl7cmV0dXJuIG5ldyBhLlhNTEh0dHBSZXF1ZXN0fWNhdGNoKGIpe319ZnVuY3Rpb24gJGIoKXt0cnl7cmV0dXJuIG5ldyBhLkFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIil9Y2F0Y2goYil7fX1tLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6Lyg/OmphdmF8ZWNtYSlzY3JpcHQvfSxjb252ZXJ0ZXJzOnsidGV4dCBzY3JpcHQiOmZ1bmN0aW9uKGEpe3JldHVybiBtLmdsb2JhbEV2YWwoYSksYX19fSksbS5hamF4UHJlZmlsdGVyKCJzY3JpcHQiLGZ1bmN0aW9uKGEpe3ZvaWQgMD09PWEuY2FjaGUmJihhLmNhY2hlPSExKSxhLmNyb3NzRG9tYWluJiYoYS50eXBlPSJHRVQiLGEuZ2xvYmFsPSExKX0pLG0uYWpheFRyYW5zcG9ydCgic2NyaXB0IixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgYixjPXkuaGVhZHx8bSgiaGVhZCIpWzBdfHx5LmRvY3VtZW50RWxlbWVudDtyZXR1cm57c2VuZDpmdW5jdGlvbihkLGUpe2I9eS5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSxiLmFzeW5jPSEwLGEuc2NyaXB0Q2hhcnNldCYmKGIuY2hhcnNldD1hLnNjcmlwdENoYXJzZXQpLGIuc3JjPWEudXJsLGIub25sb2FkPWIub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKGEsYyl7KGN8fCFiLnJlYWR5U3RhdGV8fC9sb2FkZWR8Y29tcGxldGUvLnRlc3QoYi5yZWFkeVN0YXRlKSkmJihiLm9ubG9hZD1iLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLGIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpLGI9bnVsbCxjfHxlKDIwMCwic3VjY2VzcyIpKX0sYy5pbnNlcnRCZWZvcmUoYixjLmZpcnN0Q2hpbGQpfSxhYm9ydDpmdW5jdGlvbigpe2ImJmIub25sb2FkKHZvaWQgMCwhMCl9fX19KTt2YXIgX2I9W10sYWM9Lyg9KVw/KD89JnwkKXxcP1w/LzttLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGE9X2IucG9wKCl8fG0uZXhwYW5kbysiXyIrdmIrKztyZXR1cm4gdGhpc1thXT0hMCxhfX0pLG0uYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsZnVuY3Rpb24oYixjLGQpe3ZhciBlLGYsZyxoPWIuanNvbnAhPT0hMSYmKGFjLnRlc3QoYi51cmwpPyJ1cmwiOiJzdHJpbmciPT10eXBlb2YgYi5kYXRhJiYhKGIuY29udGVudFR5cGV8fCIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSYmYWMudGVzdChiLmRhdGEpJiYiZGF0YSIpO3JldHVybiBofHwianNvbnAiPT09Yi5kYXRhVHlwZXNbMF0/KGU9Yi5qc29ucENhbGxiYWNrPW0uaXNGdW5jdGlvbihiLmpzb25wQ2FsbGJhY2spP2IuanNvbnBDYWxsYmFjaygpOmIuanNvbnBDYWxsYmFjayxoP2JbaF09YltoXS5yZXBsYWNlKGFjLCIkMSIrZSk6Yi5qc29ucCE9PSExJiYoYi51cmwrPSh3Yi50ZXN0KGIudXJsKT8iJiI6Ij8iKStiLmpzb25wKyI9IitlKSxiLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl09ZnVuY3Rpb24oKXtyZXR1cm4gZ3x8bS5lcnJvcihlKyIgd2FzIG5vdCBjYWxsZWQiKSxnWzBdfSxiLmRhdGFUeXBlc1swXT0ianNvbiIsZj1hW2VdLGFbZV09ZnVuY3Rpb24oKXtnPWFyZ3VtZW50c30sZC5hbHdheXMoZnVuY3Rpb24oKXthW2VdPWYsYltlXSYmKGIuanNvbnBDYWxsYmFjaz1jLmpzb25wQ2FsbGJhY2ssX2IucHVzaChlKSksZyYmbS5pc0Z1bmN0aW9uKGYpJiZmKGdbMF0pLGc9Zj12b2lkIDB9KSwic2NyaXB0Iik6dm9pZCAwfSksbS5wYXJzZUhUTUw9ZnVuY3Rpb24oYSxiLGMpe2lmKCFhfHwic3RyaW5nIiE9dHlwZW9mIGEpcmV0dXJuIG51bGw7ImJvb2xlYW4iPT10eXBlb2YgYiYmKGM9YixiPSExKSxiPWJ8fHk7dmFyIGQ9dS5leGVjKGEpLGU9IWMmJltdO3JldHVybiBkP1tiLmNyZWF0ZUVsZW1lbnQoZFsxXSldOihkPW0uYnVpbGRGcmFnbWVudChbYV0sYixlKSxlJiZlLmxlbmd0aCYmbShlKS5yZW1vdmUoKSxtLm1lcmdlKFtdLGQuY2hpbGROb2RlcykpfTt2YXIgYmM9bS5mbi5sb2FkO20uZm4ubG9hZD1mdW5jdGlvbihhLGIsYyl7aWYoInN0cmluZyIhPXR5cGVvZiBhJiZiYylyZXR1cm4gYmMuYXBwbHkodGhpcyxhcmd1bWVudHMpO3ZhciBkLGUsZixnPXRoaXMsaD1hLmluZGV4T2YoIiAiKTtyZXR1cm4gaD49MCYmKGQ9bS50cmltKGEuc2xpY2UoaCxhLmxlbmd0aCkpLGE9YS5zbGljZSgwLGgpKSxtLmlzRnVuY3Rpb24oYik/KGM9YixiPXZvaWQgMCk6YiYmIm9iamVjdCI9PXR5cGVvZiBiJiYoZj0iUE9TVCIpLGcubGVuZ3RoPjAmJm0uYWpheCh7dXJsOmEsdHlwZTpmLGRhdGFUeXBlOiJodG1sIixkYXRhOmJ9KS5kb25lKGZ1bmN0aW9uKGEpe2U9YXJndW1lbnRzLGcuaHRtbChkP20oIjxkaXY+IikuYXBwZW5kKG0ucGFyc2VIVE1MKGEpKS5maW5kKGQpOmEpfSkuY29tcGxldGUoYyYmZnVuY3Rpb24oYSxiKXtnLmVhY2goYyxlfHxbYS5yZXNwb25zZVRleHQsYixhXSl9KSx0aGlzfSxtLmVhY2goWyJhamF4U3RhcnQiLCJhamF4U3RvcCIsImFqYXhDb21wbGV0ZSIsImFqYXhFcnJvciIsImFqYXhTdWNjZXNzIiwiYWpheFNlbmQiXSxmdW5jdGlvbihhLGIpe20uZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMub24oYixhKX19KSxtLmV4cHIuZmlsdGVycy5hbmltYXRlZD1mdW5jdGlvbihhKXtyZXR1cm4gbS5ncmVwKG0udGltZXJzLGZ1bmN0aW9uKGIpe3JldHVybiBhPT09Yi5lbGVtfSkubGVuZ3RofTt2YXIgY2M9YS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7ZnVuY3Rpb24gZGMoYSl7cmV0dXJuIG0uaXNXaW5kb3coYSk/YTo5PT09YS5ub2RlVHlwZT9hLmRlZmF1bHRWaWV3fHxhLnBhcmVudFdpbmRvdzohMX1tLm9mZnNldD17c2V0T2Zmc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGYsZyxoLGksaixrPW0uY3NzKGEsInBvc2l0aW9uIiksbD1tKGEpLG49e307InN0YXRpYyI9PT1rJiYoYS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKSxoPWwub2Zmc2V0KCksZj1tLmNzcyhhLCJ0b3AiKSxpPW0uY3NzKGEsImxlZnQiKSxqPSgiYWJzb2x1dGUiPT09a3x8ImZpeGVkIj09PWspJiZtLmluQXJyYXkoImF1dG8iLFtmLGldKT4tMSxqPyhkPWwucG9zaXRpb24oKSxnPWQudG9wLGU9ZC5sZWZ0KTooZz1wYXJzZUZsb2F0KGYpfHwwLGU9cGFyc2VGbG9hdChpKXx8MCksbS5pc0Z1bmN0aW9uKGIpJiYoYj1iLmNhbGwoYSxjLGgpKSxudWxsIT1iLnRvcCYmKG4udG9wPWIudG9wLWgudG9wK2cpLG51bGwhPWIubGVmdCYmKG4ubGVmdD1iLmxlZnQtaC5sZWZ0K2UpLCJ1c2luZyJpbiBiP2IudXNpbmcuY2FsbChhLG4pOmwuY3NzKG4pfX0sbS5mbi5leHRlbmQoe29mZnNldDpmdW5jdGlvbihhKXtpZihhcmd1bWVudHMubGVuZ3RoKXJldHVybiB2b2lkIDA9PT1hP3RoaXM6dGhpcy5lYWNoKGZ1bmN0aW9uKGIpe20ub2Zmc2V0LnNldE9mZnNldCh0aGlzLGEsYil9KTt2YXIgYixjLGQ9e3RvcDowLGxlZnQ6MH0sZT10aGlzWzBdLGY9ZSYmZS5vd25lckRvY3VtZW50O2lmKGYpcmV0dXJuIGI9Zi5kb2N1bWVudEVsZW1lbnQsbS5jb250YWlucyhiLGUpPyh0eXBlb2YgZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QhPT1LJiYoZD1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSxjPWRjKGYpLHt0b3A6ZC50b3ArKGMucGFnZVlPZmZzZXR8fGIuc2Nyb2xsVG9wKS0oYi5jbGllbnRUb3B8fDApLGxlZnQ6ZC5sZWZ0KyhjLnBhZ2VYT2Zmc2V0fHxiLnNjcm9sbExlZnQpLShiLmNsaWVudExlZnR8fDApfSk6ZH0scG9zaXRpb246ZnVuY3Rpb24oKXtpZih0aGlzWzBdKXt2YXIgYSxiLGM9e3RvcDowLGxlZnQ6MH0sZD10aGlzWzBdO3JldHVybiJmaXhlZCI9PT1tLmNzcyhkLCJwb3NpdGlvbiIpP2I9ZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTooYT10aGlzLm9mZnNldFBhcmVudCgpLGI9dGhpcy5vZmZzZXQoKSxtLm5vZGVOYW1lKGFbMF0sImh0bWwiKXx8KGM9YS5vZmZzZXQoKSksYy50b3ArPW0uY3NzKGFbMF0sImJvcmRlclRvcFdpZHRoIiwhMCksYy5sZWZ0Kz1tLmNzcyhhWzBdLCJib3JkZXJMZWZ0V2lkdGgiLCEwKSkse3RvcDpiLnRvcC1jLnRvcC1tLmNzcyhkLCJtYXJnaW5Ub3AiLCEwKSxsZWZ0OmIubGVmdC1jLmxlZnQtbS5jc3MoZCwibWFyZ2luTGVmdCIsITApfX19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBhPXRoaXMub2Zmc2V0UGFyZW50fHxjYzt3aGlsZShhJiYhbS5ub2RlTmFtZShhLCJodG1sIikmJiJzdGF0aWMiPT09bS5jc3MoYSwicG9zaXRpb24iKSlhPWEub2Zmc2V0UGFyZW50O3JldHVybiBhfHxjY30pfX0pLG0uZWFjaCh7c2Nyb2xsTGVmdDoicGFnZVhPZmZzZXQiLHNjcm9sbFRvcDoicGFnZVlPZmZzZXQifSxmdW5jdGlvbihhLGIpe3ZhciBjPS9ZLy50ZXN0KGIpO20uZm5bYV09ZnVuY3Rpb24oZCl7cmV0dXJuIFYodGhpcyxmdW5jdGlvbihhLGQsZSl7dmFyIGY9ZGMoYSk7cmV0dXJuIHZvaWQgMD09PWU/Zj9iIGluIGY/ZltiXTpmLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFtkXTphW2RdOnZvaWQoZj9mLnNjcm9sbFRvKGM/bShmKS5zY3JvbGxMZWZ0KCk6ZSxjP2U6bShmKS5zY3JvbGxUb3AoKSk6YVtkXT1lKX0sYSxkLGFyZ3VtZW50cy5sZW5ndGgsbnVsbCl9fSksbS5lYWNoKFsidG9wIiwibGVmdCJdLGZ1bmN0aW9uKGEsYil7bS5jc3NIb29rc1tiXT1MYShrLnBpeGVsUG9zaXRpb24sZnVuY3Rpb24oYSxjKXtyZXR1cm4gYz8oYz1KYShhLGIpLEhhLnRlc3QoYyk/bShhKS5wb3NpdGlvbigpW2JdKyJweCI6Yyk6dm9pZCAwfSl9KSxtLmVhY2goe0hlaWdodDoiaGVpZ2h0IixXaWR0aDoid2lkdGgifSxmdW5jdGlvbihhLGIpe20uZWFjaCh7cGFkZGluZzoiaW5uZXIiK2EsY29udGVudDpiLCIiOiJvdXRlciIrYX0sZnVuY3Rpb24oYyxkKXttLmZuW2RdPWZ1bmN0aW9uKGQsZSl7dmFyIGY9YXJndW1lbnRzLmxlbmd0aCYmKGN8fCJib29sZWFuIiE9dHlwZW9mIGQpLGc9Y3x8KGQ9PT0hMHx8ZT09PSEwPyJtYXJnaW4iOiJib3JkZXIiKTtyZXR1cm4gVih0aGlzLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZTtyZXR1cm4gbS5pc1dpbmRvdyhiKT9iLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IithXTo5PT09Yi5ub2RlVHlwZT8oZT1iLmRvY3VtZW50RWxlbWVudCxNYXRoLm1heChiLmJvZHlbInNjcm9sbCIrYV0sZVsic2Nyb2xsIithXSxiLmJvZHlbIm9mZnNldCIrYV0sZVsib2Zmc2V0IithXSxlWyJjbGllbnQiK2FdKSk6dm9pZCAwPT09ZD9tLmNzcyhiLGMsZyk6bS5zdHlsZShiLGMsZCxnKX0sYixmP2Q6dm9pZCAwLGYsbnVsbCl9fSl9KSxtLmZuLnNpemU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sZW5ndGh9LG0uZm4uYW5kU2VsZj1tLmZuLmFkZEJhY2ssImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZCYmZGVmaW5lKCJqcXVlcnkiLFtdLGZ1bmN0aW9uKCl7cmV0dXJuIG19KTt2YXIgZWM9YS5qUXVlcnksZmM9YS4kO3JldHVybiBtLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oYil7cmV0dXJuIGEuJD09PW0mJihhLiQ9ZmMpLGImJmEualF1ZXJ5PT09bSYmKGEualF1ZXJ5PWVjKSxtfSx0eXBlb2YgYj09PUsmJihhLmpRdWVyeT1hLiQ9bSksbX0pOwo="></script>
<link href="data:text/css;charset=utf-8,%2Ejqstooltip%20%7B%0A%2Dwebkit%2Dbox%2Dsizing%3A%20content%2Dbox%3B%0A%2Dmoz%2Dbox%2Dsizing%3A%20content%2Dbox%3B%0Abox%2Dsizing%3A%20content%2Dbox%3B%0A%7D%0A" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyoqCioKKiBqcXVlcnkuc3BhcmtsaW5lLmpzCioKKiB2QFZFUlNJT05ACiogKGMpIFNwbHVuaywgSW5jCiogQ29udGFjdDogR2FyZXRoIFdhdHRzIChnYXJldGhAc3BsdW5rLmNvbSkKKiBodHRwOi8vb21uaXBvdGVudC5uZXQvanF1ZXJ5LnNwYXJrbGluZS8KKgoqIEdlbmVyYXRlcyBpbmxpbmUgc3BhcmtsaW5lIGNoYXJ0cyBmcm9tIGRhdGEgc3VwcGxpZWQgZWl0aGVyIHRvIHRoZSBtZXRob2QKKiBvciBpbmxpbmUgaW4gSFRNTAoqCiogQ29tcGF0aWJsZSB3aXRoIEludGVybmV0IEV4cGxvcmVyIDYuMCsgYW5kIG1vZGVybiBicm93c2VycyBlcXVpcHBlZCB3aXRoIHRoZSBjYW52YXMgdGFnCiogKEZpcmVmb3ggMi4wKywgU2FmYXJpLCBPcGVyYSwgZXRjKQoqCiogTGljZW5zZTogTmV3IEJTRCBMaWNlbnNlCioKKiBDb3B5cmlnaHQgKGMpIDIwMTIsIFNwbHVuayBJbmMuCiogQWxsIHJpZ2h0cyByZXNlcnZlZC4KKgoqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sCiogYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgoqCiogICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAoqICAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiogICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAoqICAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KKiAgICAgICBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KKiAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIFNwbHVuayBJbmMgbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heQoqICAgICAgIGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQKKiAgICAgICBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCioKKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5EIEFOWQoqIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UCiogU0hBTEwgVEhFIENPUFlSSUdIVCBPV05FUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwKKiBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UCiogT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikKKiBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksCiogT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUwoqIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoqCioKKiBVc2FnZToKKiAgJChzZWxlY3Rvcikuc3BhcmtsaW5lKHZhbHVlcywgb3B0aW9ucykKKgoqIElmIHZhbHVlcyBpcyB1bmRlZmluZWQgb3Igc2V0IHRvICdodG1sJyB0aGVuIHRoZSBkYXRhIHZhbHVlcyBhcmUgcmVhZCBmcm9tIHRoZSBzcGVjaWZpZWQgdGFnOgoqICAgPHA+U3BhcmtsaW5lOiA8c3BhbiBjbGFzcz0ic3BhcmtsaW5lIj4xLDQsNiw2LDgsNSwzLDU8L3NwYW4+PC9wPgoqICAgJCgnLnNwYXJrbGluZScpLnNwYXJrbGluZSgpOwoqIFRoZXJlIG11c3QgYmUgbm8gc3BhY2VzIGluIHRoZSBlbmNsb3NlZCBkYXRhIHNldAoqCiogT3RoZXJ3aXNlIHZhbHVlcyBtdXN0IGJlIGFuIGFycmF5IG9mIG51bWJlcnMgb3IgbnVsbCB2YWx1ZXMKKiAgICA8cD5TcGFya2xpbmU6IDxzcGFuIGlkPSJzcGFya2xpbmUxIj5UaGlzIHRleHQgcmVwbGFjZWQgaWYgdGhlIGJyb3dzZXIgaXMgY29tcGF0aWJsZTwvc3Bhbj48L3A+CiogICAgJCgnI3NwYXJrbGluZTEnKS5zcGFya2xpbmUoWzEsNCw2LDYsOCw1LDMsNV0pCiogICAgJCgnI3NwYXJrbGluZTInKS5zcGFya2xpbmUoWzEsNCw2LG51bGwsbnVsbCw1LDMsNV0pCioKKiBWYWx1ZXMgY2FuIGFsc28gYmUgc3BlY2lmaWVkIGluIGFuIEhUTUwgY29tbWVudCwgb3IgYXMgYSB2YWx1ZXMgYXR0cmlidXRlOgoqICAgIDxwPlNwYXJrbGluZTogPHNwYW4gY2xhc3M9InNwYXJrbGluZSI+PCEtLTEsNCw2LDYsOCw1LDMsNSAtLT48L3NwYW4+PC9wPgoqICAgIDxwPlNwYXJrbGluZTogPHNwYW4gY2xhc3M9InNwYXJrbGluZSIgdmFsdWVzPSIxLDQsNiw2LDgsNSwzLDUiPjwvc3Bhbj48L3A+CiogICAgJCgnLnNwYXJrbGluZScpLnNwYXJrbGluZSgpOwoqCiogRm9yIGxpbmUgY2hhcnRzLCB4IHZhbHVlcyBjYW4gYWxzbyBiZSBzcGVjaWZpZWQ6CiogICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPSJzcGFya2xpbmUiPjE6MSwyLjc6NCwzLjQ6Niw1OjYsNjo4LDguNzo1LDk6MywxMDo1PC9zcGFuPjwvcD4KKiAgICAkKCcjc3BhcmtsaW5lMScpLnNwYXJrbGluZShbIFsxLDFdLCBbMi43LDRdLCBbMy40LDZdLCBbNSw2XSwgWzYsOF0sIFs4LjcsNV0sIFs5LDNdLCBbMTAsNV0gXSkKKgoqIEJ5IGRlZmF1bHQsIG9wdGlvbnMgc2hvdWxkIGJlIHBhc3NlZCBpbiBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50IHRvIHRoZSBzcGFya2xpbmUgZnVuY3Rpb246CiogICAkKCcuc3BhcmtsaW5lJykuc3BhcmtsaW5lKFsxLDIsMyw0XSwge3R5cGU6ICdiYXInfSkKKgoqIE9wdGlvbnMgY2FuIGFsc28gYmUgc2V0IGJ5IHBhc3NpbmcgdGhlbSBvbiB0aGUgdGFnIGl0c2VsZi4gIFRoaXMgZmVhdHVyZSBpcyBkaXNhYmxlZCBieSBkZWZhdWx0IHRob3VnaAoqIGFzIHRoZXJlJ3MgYSBzbGlnaHQgcGVyZm9ybWFuY2Ugb3ZlcmhlYWQ6CiogICAkKCcuc3BhcmtsaW5lJykuc3BhcmtsaW5lKFsxLDIsMyw0XSwge2VuYWJsZVRhZ09wdGlvbnM6IHRydWV9KQoqICAgPHA+U3BhcmtsaW5lOiA8c3BhbiBjbGFzcz0ic3BhcmtsaW5lIiBzcGFya1R5cGU9ImJhciIgc3BhcmtCYXJDb2xvcj0icmVkIj5sb2FkaW5nPC9zcGFuPjwvcD4KKiBQcmVmaXggYWxsIG9wdGlvbnMgc3VwcGxpZWQgYXMgdGFnIGF0dHJpYnV0ZSB3aXRoICJzcGFyayIgKGNvbmZpZ3VyYWJsZSBieSBzZXR0aW5nIHRhZ09wdGlvbnNQcmVmaXgpCioKKiBTdXBwb3J0ZWQgb3B0aW9uczoKKiAgIGxpbmVDb2xvciAtIENvbG9yIG9mIHRoZSBsaW5lIHVzZWQgZm9yIHRoZSBjaGFydAoqICAgZmlsbENvbG9yIC0gQ29sb3IgdXNlZCB0byBmaWxsIGluIHRoZSBjaGFydCAtIFNldCB0byAnJyBvciBmYWxzZSBmb3IgYSB0cmFuc3BhcmVudCBjaGFydAoqICAgd2lkdGggLSBXaWR0aCBvZiB0aGUgY2hhcnQgLSBEZWZhdWx0cyB0byAzIHRpbWVzIHRoZSBudW1iZXIgb2YgdmFsdWVzIGluIHBpeGVscwoqICAgaGVpZ2h0IC0gSGVpZ2h0IG9mIHRoZSBjaGFydCAtIERlZmF1bHRzIHRvIHRoZSBoZWlnaHQgb2YgdGhlIGNvbnRhaW5pbmcgZWxlbWVudAoqICAgY2hhcnRSYW5nZU1pbiAtIFNwZWNpZnkgdGhlIG1pbmltdW0gdmFsdWUgdG8gdXNlIGZvciB0aGUgWSByYW5nZSBvZiB0aGUgY2hhcnQgLSBEZWZhdWx0cyB0byB0aGUgbWluaW11bSB2YWx1ZSBzdXBwbGllZAoqICAgY2hhcnRSYW5nZU1heCAtIFNwZWNpZnkgdGhlIG1heGltdW0gdmFsdWUgdG8gdXNlIGZvciB0aGUgWSByYW5nZSBvZiB0aGUgY2hhcnQgLSBEZWZhdWx0cyB0byB0aGUgbWF4aW11bSB2YWx1ZSBzdXBwbGllZAoqICAgY2hhcnRSYW5nZUNsaXAgLSBDbGlwIG91dCBvZiByYW5nZSB2YWx1ZXMgdG8gdGhlIG1heC9taW4gc3BlY2lmaWVkIGJ5IGNoYXJ0UmFuZ2VNaW4gYW5kIGNoYXJ0UmFuZ2VNYXgKKiAgIGNoYXJ0UmFuZ2VNaW5YIC0gU3BlY2lmeSB0aGUgbWluaW11bSB2YWx1ZSB0byB1c2UgZm9yIHRoZSBYIHJhbmdlIG9mIHRoZSBjaGFydCAtIERlZmF1bHRzIHRvIHRoZSBtaW5pbXVtIHZhbHVlIHN1cHBsaWVkCiogICBjaGFydFJhbmdlTWF4WCAtIFNwZWNpZnkgdGhlIG1heGltdW0gdmFsdWUgdG8gdXNlIGZvciB0aGUgWCByYW5nZSBvZiB0aGUgY2hhcnQgLSBEZWZhdWx0cyB0byB0aGUgbWF4aW11bSB2YWx1ZSBzdXBwbGllZAoqICAgY29tcG9zaXRlIC0gSWYgdHJ1ZSB0aGVuIGRvbid0IGVyYXNlIGFueSBleGlzdGluZyBjaGFydCBhdHRhY2hlZCB0byB0aGUgdGFnLCBidXQgZHJhdwoqICAgICAgICAgICBhbm90aGVyIGNoYXJ0IG92ZXIgdGhlIHRvcCAtIE5vdGUgdGhhdCB3aWR0aCBhbmQgaGVpZ2h0IGFyZSBpZ25vcmVkIGlmIGFuCiogICAgICAgICAgIGV4aXN0aW5nIGNoYXJ0IGlzIGRldGVjdGVkLgoqICAgdGFnVmFsdWVzQXR0cmlidXRlIC0gTmFtZSBvZiB0YWcgYXR0cmlidXRlIHRvIGNoZWNrIGZvciBkYXRhIHZhbHVlcyAtIERlZmF1bHRzIHRvICd2YWx1ZXMnCiogICBlbmFibGVUYWdPcHRpb25zIC0gV2hldGhlciB0byBjaGVjayB0YWdzIGZvciBzcGFya2xpbmUgb3B0aW9ucwoqICAgdGFnT3B0aW9uc1ByZWZpeCAtIFByZWZpeCB1c2VkIGZvciBvcHRpb25zIHN1cHBsaWVkIGFzIHRhZyBhdHRyaWJ1dGVzIC0gRGVmYXVsdHMgdG8gJ3NwYXJrJwoqICAgZGlzYWJsZUhpZGRlbkNoZWNrIC0gSWYgc2V0IHRvIHRydWUsIHRoZW4gdGhlIHBsdWdpbiB3aWxsIGFzc3VtZSB0aGF0IGNoYXJ0cyB3aWxsIG5ldmVyIGJlIGRyYXduIGludG8gYQoqICAgICAgICAgICBoaWRkZW4gZG9tIGVsZW1lbnQsIGF2b2lkaW5nIGEgYnJvd3NlciByZWZsb3cKKiAgIGRpc2FibGVJbnRlcmFjdGlvbiAtIElmIHNldCB0byB0cnVlIHRoZW4gYWxsIG1vdXNlb3Zlci9jbGljayBpbnRlcmFjdGlvbiBiZWhhdmlvdXIgd2lsbCBiZSBkaXNhYmxlZCwKKiAgICAgICBtYWtpbmcgdGhlIHBsdWdpbiBwZXJmb3JtIG11Y2ggbGlrZSBpdCBkaWQgaW4gMS54CiogICBkaXNhYmxlVG9vbHRpcHMgLSBJZiBzZXQgdG8gdHJ1ZSB0aGVuIHRvb2x0aXBzIHdpbGwgYmUgZGlzYWJsZWQgLSBEZWZhdWx0cyB0byBmYWxzZSAodG9vbHRpcHMgZW5hYmxlZCkKKiAgIGRpc2FibGVIaWdobGlnaHQgLSBJZiBzZXQgdG8gdHJ1ZSB0aGVuIGhpZ2hsaWdodGluZyBvZiBzZWxlY3RlZCBjaGFydCBlbGVtZW50cyBvbiBtb3VzZW92ZXIgd2lsbCBiZSBkaXNhYmxlZAoqICAgICAgICAgICBkZWZhdWx0cyB0byBmYWxzZSAoaGlnaGxpZ2h0cyBlbmFibGVkKQoqICAgaGlnaGxpZ2h0TGlnaHRlbiAtIEZhY3RvciB0byBsaWdodGVuL2RhcmtlbiBoaWdobGlnaHRlZCBjaGFydCB2YWx1ZXMgYnkgLSBEZWZhdWx0cyB0byAxLjQgZm9yIGEgNDAlIGluY3JlYXNlCiogICB0b29sdGlwQ29udGFpbmVyIC0gU3BlY2lmeSB3aGljaCBET00gZWxlbWVudCB0aGUgdG9vbHRpcCBzaG91bGQgYmUgcmVuZGVyZWQgaW50byAtIGRlZmF1bHRzIHRvIGRvY3VtZW50LmJvZHkKKiAgIHRvb2x0aXBDbGFzc25hbWUgLSBPcHRpb25hbCBDU1MgY2xhc3NuYW1lIHRvIGFwcGx5IHRvIHRvb2x0aXBzIC0gSWYgbm90IHNwZWNpZmllZCB0aGVuIGEgZGVmYXVsdCBzdHlsZSB3aWxsIGJlIGFwcGxpZWQKKiAgIHRvb2x0aXBPZmZzZXRYIC0gSG93IG1hbnkgcGl4ZWxzIGF3YXkgZnJvbSB0aGUgbW91c2UgcG9pbnRlciB0byByZW5kZXIgdGhlIHRvb2x0aXAgb24gdGhlIFggYXhpcwoqICAgdG9vbHRpcE9mZnNldFkgLSBIb3cgbWFueSBwaXhlbHMgYXdheSBmcm9tIHRoZSBtb3VzZSBwb2ludGVyIHRvIHJlbmRlciB0aGUgdG9vbHRpcCBvbiB0aGUgciBheGlzCiogICB0b29sdGlwRm9ybWF0dGVyICAtIE9wdGlvbmFsIGNhbGxiYWNrIHRoYXQgYWxsb3dzIHlvdSB0byBvdmVycmlkZSB0aGUgSFRNTCBkaXNwbGF5ZWQgaW4gdGhlIHRvb2x0aXAKKiAgICAgICAgICAgY2FsbGJhY2sgaXMgZ2l2ZW4gYXJndW1lbnRzIG9mIChzcGFya2xpbmUsIG9wdGlvbnMsIGZpZWxkcykKKiAgIHRvb2x0aXBDaGFydFRpdGxlIC0gSWYgc3BlY2lmaWVkIHRoZW4gdGhlIHRvb2x0aXAgdXNlcyB0aGUgc3RyaW5nIHNwZWNpZmllZCBieSB0aGlzIHNldHRpbmcgYXMgYSB0aXRsZQoqICAgdG9vbHRpcEZvcm1hdCAtIEEgZm9ybWF0IHN0cmluZyBvciBTUEZvcm1hdCBvYmplY3QgIChvciBhbiBhcnJheSB0aGVyZW9mIGZvciBtdWx0aXBsZSBlbnRyaWVzKQoqICAgICAgICAgICB0byBjb250cm9sIHRoZSBmb3JtYXQgb2YgdGhlIHRvb2x0aXAKKiAgIHRvb2x0aXBQcmVmaXggLSBBIHN0cmluZyB0byBwcmVwZW5kIHRvIGVhY2ggZmllbGQgZGlzcGxheWVkIGluIGEgdG9vbHRpcAoqICAgdG9vbHRpcFN1ZmZpeCAtIEEgc3RyaW5nIHRvIGFwcGVuZCB0byBlYWNoIGZpZWxkIGRpc3BsYXllZCBpbiBhIHRvb2x0aXAKKiAgIHRvb2x0aXBQcmVmaXhCaW5MYWJlbHMgLSBBbiBhcnJheSBvZiBCaW4gTGFiZWxzIGZvciBlYWNoIG9mZnNldCB2YWx1ZSB0byBhZGQgYXMgdGhlIHN0YXJ0CiogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2YgdGhlIHRvb2x0aXAgcHJlZml4LiAgRXhhbXBsZToKKiAgICAgICAgdmFyIGdpYW50c19nYW1lX3Jlc3VsdHMgPSBbMSwtMSwxLC0xLC0xLC0xLDEsMSwxLC0xLDEsLTEsLTEsMSwxLDEsMSwxLDEsMV0sCiogICAgICAgICAgICBnaWFudHNfZ2FtZV9kYXRlcyAgPSBbIjkvMzAiLCAiMTAvMSIsICIxMC8yIiwgIjEwLzMiLCAiMTAvNiIsICIxMC83IiwgIjEwLzkiLCAiMTAvMTAiLCAiMTAvMTEiLCAiMTAvMTQiLCAiMTAvMTUiLAoqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIxMC8xNyIsICIxMC8xOCIsICIxMC8xOSIsICIxMC8yMSIsICIxMC8yMiIsICIxMC8yNCIsICIxMC8yNSIsICIxMC8yNyIsICIxMC8yOCJdOwoqICAgICAgICAkKCcjZ2lhbnRzJykuc3BhcmtsaW5lKGdpYW50c19yZXN1bHRzLCB7dHlwZTogJ3RyaXN0YXRlJywgdG9vbHRpcFByZWZpeEJpbkxhYmVsczogZ2lhbnRzX2RhdGVzLCB0b29sdGlwUHJlZml4OiAnIC0gJ307CiogICB0b29sdGlwU3VmZml4QmluTGFiZWxzIC0gQW4gYXJyYXkgb2YgQmluIExhYmVscyBmb3IgZWFjaCBvZmZzZXQgdmFsdWUgdG8gYWRkIGFzIHRoZSBlbmQKKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZiB0aGUgdG9vbHRpcCBzdWZmaXguCiogICB0b29sdGlwU2tpcE51bGwgLSBJZiB0cnVlIHRoZW4gbnVsbCB2YWx1ZXMgd2lsbCBub3QgaGF2ZSBhIHRvb2x0aXAgZGlzcGxheWVkIChkZWZhdWx0cyB0byB0cnVlKQoqICAgdG9vbHRpcFZhbHVlTG9va3VwcyAtIEFuIG9iamVjdCBvciByYW5nZSBtYXAgdG8gbWFwIGZpZWxkIHZhbHVlcyB0byB0b29sdGlwIHN0cmluZ3MKKiAgICAgICAgICAgICAgICAgICAgICAgICAoZWcuIHRvIG1hcCAtMSB0byAiTG9zdCIsIDAgdG8gIkRyYXciLCBhbmQgMSB0byAiV2luIikKKiAgIHRvb2xUaXBQb3NpdGlvbiAtIERpc3BsYXkgdG9vbHRpcCB0byB0aGUgJ2xlZnQnIG9yICdyaWdodCcgb2YgdGhlIG1vdXNlIC0gRGVmYXVsdHMgdG8gInJpZ2h0IgoqICAgbnVtYmVyRm9ybWF0dGVyIC0gT3B0aW9uYWwgY2FsbGJhY2sgZm9yIGZvcm1hdHRpbmcgbnVtYmVycyBpbiB0b29sdGlwcwoqICAgbnVtYmVyRGlnaXRHcm91cFNlcCAtIENoYXJhY3RlciB0byB1c2UgZm9yIGdyb3VwIHNlcGFyYXRvciBpbiBudW1iZXJzICIxLDIzNCIgLSBEZWZhdWx0cyB0byAiLCIKKiAgIG51bWJlckRlY2ltYWxNYXJrIC0gQ2hhcmFjdGVyIHRvIHVzZSBmb3IgdGhlIGRlY2ltYWwgcG9pbnQgd2hlbiBmb3JtYXR0aW5nIG51bWJlcnMgLSBEZWZhdWx0cyB0byAiLiIKKiAgIG51bWJlckRpZ2l0R3JvdXBDb3VudCAtIE51bWJlciBvZiBkaWdpdHMgYmV0d2VlbiBncm91cCBzZXBhcmF0b3IgLSBEZWZhdWx0cyB0byAzCioKKiBUaGVyZSBhcmUgOCB0eXBlcyBvZiBzcGFya2xpbmUsIHNlbGVjdGVkIGJ5IHN1cHBseWluZyBhICJ0eXBlIiBvcHRpb24gb2YgJ2xpbmUnIChkZWZhdWx0KSwKKiAnYmFyJywgJ3RyaXN0YXRlJywgJ2J1bGxldCcsICdkaXNjcmV0ZScsICdwaWUnLCAnYm94JyBvciAnc3RhY2snCiogICAgbGluZSAtIExpbmUgY2hhcnQuICBPcHRpb25zOgoqICAgICAgIHNwb3RDb2xvciAtIFNldCB0byAnJyB0byBub3QgZW5kIGVhY2ggbGluZSBpbiBhIGNpcmN1bGFyIHNwb3QKKiAgICAgICBtaW5TcG90Q29sb3IgLSBJZiBzZXQsIGNvbG9yIG9mIHNwb3QgYXQgbWluaW11bSB2YWx1ZQoqICAgICAgIG1heFNwb3RDb2xvciAtIElmIHNldCwgY29sb3Igb2Ygc3BvdCBhdCBtYXhpbXVtIHZhbHVlCiogICAgICAgc3BvdFJhZGl1cyAtIFJhZGl1cyBpbiBwaXhlbHMKKiAgICAgICBsaW5lV2lkdGggLSBXaWR0aCBvZiBsaW5lIGluIHBpeGVscwoqICAgICAgIG5vcm1hbFJhbmdlTWluCiogICAgICAgbm9ybWFsUmFuZ2VNYXggLSBJZiBzZXQgZHJhd3MgYSBmaWxsZWQgaG9yaXpvbnRhbCBiYXIgYmV0d2VlbiB0aGVzZSB0d28gdmFsdWVzIG1hcmtpbmcgdGhlICJub3JtYWwiCiogICAgICAgICAgICAgICAgICAgICAgICBvciBleHBlY3RlZCByYW5nZSBvZiB2YWx1ZXMKKiAgICAgICBub3JtYWxSYW5nZUNvbG9yIC0gQ29sb3IgdG8gdXNlIGZvciB0aGUgYWJvdmUgYmFyCiogICAgICAgZHJhd05vcm1hbE9uVG9wIC0gRHJhdyB0aGUgbm9ybWFsIHJhbmdlIGFib3ZlIHRoZSBjaGFydCBmaWxsIGNvbG9yIGlmIHRydWUKKiAgICAgICBkZWZhdWx0UGl4ZWxzUGVyVmFsdWUgLSBEZWZhdWx0cyB0byAzIHBpeGVscyBvZiB3aWR0aCBmb3IgZWFjaCB2YWx1ZSBpbiB0aGUgY2hhcnQKKiAgICAgICBoaWdobGlnaHRTcG90Q29sb3IgLSBUaGUgY29sb3IgdG8gdXNlIGZvciBkcmF3aW5nIGEgaGlnaGxpZ2h0IHNwb3Qgb24gbW91c2VvdmVyIC0gU2V0IHRvIG51bGwgdG8gZGlzYWJsZQoqICAgICAgIGhpZ2hsaWdodExpbmVDb2xvciAtIFRoZSBjb2xvciB0byB1c2UgZm9yIGRyYXdpbmcgYSBoaWdobGlnaHQgbGluZSBvbiBtb3VzZW92ZXIgLSBTZXQgdG8gbnVsbCB0byBkaXNhYmxlCiogICAgICAgdmFsdWVTcG90cyAtIFNwZWNpZnkgd2hpY2ggcG9pbnRzIHRvIGRyYXcgc3BvdHMgb24sIGFuZCBpbiB3aGljaCBjb2xvci4gIEFjY2VwdHMgYSByYW5nZSBtYXAKKgoqICAgYmFyIC0gQmFyIGNoYXJ0LiAgT3B0aW9uczoKKiAgICAgICBiYXJDb2xvciAtIENvbG9yIG9mIGJhcnMgZm9yIHBvc2l0aXZlIHZhbHVlcwoqICAgICAgIG5lZ0JhckNvbG9yIC0gQ29sb3Igb2YgYmFycyBmb3IgbmVnYXRpdmUgdmFsdWVzCiogICAgICAgemVyb0NvbG9yIC0gQ29sb3Igb2YgYmFycyB3aXRoIHplcm8gdmFsdWVzCiogICAgICAgbnVsbENvbG9yIC0gQ29sb3Igb2YgYmFycyB3aXRoIG51bGwgdmFsdWVzIC0gRGVmYXVsdHMgdG8gb21pdHRpbmcgdGhlIGJhciBlbnRpcmVseQoqICAgICAgIGJhcldpZHRoIC0gV2lkdGggb2YgYmFycyBpbiBwaXhlbHMKKiAgICAgICBjb2xvck1hcCAtIE9wdGlvbmFsIG1hcHBpbmcgb2YgdmFsdWVzIHRvIGNvbG9ycyB0byBvdmVycmlkZSB0aGUgKkJhckNvbG9yIHZhbHVlcyBhYm92ZQoqICAgICAgICAgICAgICAgICAgY2FuIGJlIGFuIEFycmF5IG9mIHZhbHVlcyB0byBjb250cm9sIHRoZSBjb2xvciBvZiBpbmRpdmlkdWFsIGJhcnMgb3IgYSByYW5nZSBtYXAKKiAgICAgICAgICAgICAgICAgIHRvIHNwZWNpZnkgY29sb3JzIGZvciBpbmRpdmlkdWFsIHJhbmdlcyBvZiB2YWx1ZXMKKiAgICAgICBiYXJTcGFjaW5nIC0gR2FwIGJldHdlZW4gYmFycyBpbiBwaXhlbHMKKiAgICAgICB6ZXJvQXhpcyAtIENlbnRlcnMgdGhlIHktYXhpcyBhcm91bmQgemVybyBpZiB0cnVlCioKKiAgIHRyaXN0YXRlIC0gQ2hhcnRzIHZhbHVlcyBvZiB3aW4gKD4wKSwgbG9zZSAoPDApIG9yIGRyYXcgKD0wKQoqICAgICAgIHBvc0JhckNvbG9yIC0gQ29sb3Igb2Ygd2luIHZhbHVlcwoqICAgICAgIG5lZ0JhckNvbG9yIC0gQ29sb3Igb2YgbG9zZSB2YWx1ZXMKKiAgICAgICB6ZXJvQmFyQ29sb3IgLSBDb2xvciBvZiBkcmF3IHZhbHVlcwoqICAgICAgIGJhcldpZHRoIC0gV2lkdGggb2YgYmFycyBpbiBwaXhlbHMKKiAgICAgICBiYXJTcGFjaW5nIC0gR2FwIGJldHdlZW4gYmFycyBpbiBwaXhlbHMKKiAgICAgICBjb2xvck1hcCAtIE9wdGlvbmFsIG1hcHBpbmcgb2YgdmFsdWVzIHRvIGNvbG9ycyB0byBvdmVycmlkZSB0aGUgKkJhckNvbG9yIHZhbHVlcyBhYm92ZQoqICAgICAgICAgICAgICAgICAgY2FuIGJlIGFuIEFycmF5IG9mIHZhbHVlcyB0byBjb250cm9sIHRoZSBjb2xvciBvZiBpbmRpdmlkdWFsIGJhcnMgb3IgYSByYW5nZSBtYXAKKiAgICAgICAgICAgICAgICAgIHRvIHNwZWNpZnkgY29sb3JzIGZvciBpbmRpdmlkdWFsIHJhbmdlcyBvZiB2YWx1ZXMKKgoqICAgZGlzY3JldGUgLSBPcHRpb25zOgoqICAgICAgIGxpbmVIZWlnaHQgLSBIZWlnaHQgb2YgZWFjaCBsaW5lIGluIHBpeGVscyAtIERlZmF1bHRzIHRvIDMwJSBvZiB0aGUgZ3JhcGggaGVpZ2h0CiogICAgICAgdGhlc2hvbGRWYWx1ZSAtIFZhbHVlcyBsZXNzIHRoYW4gdGhpcyB2YWx1ZSB3aWxsIGJlIGRyYXduIHVzaW5nIHRocmVzaG9sZENvbG9yIGluc3RlYWQgb2YgbGluZUNvbG9yCiogICAgICAgdGhyZXNob2xkQ29sb3IKKgoqICAgYnVsbGV0IC0gVmFsdWVzIGZvciBidWxsZXQgZ3JhcGhzIG1zdXQgYmUgaW4gdGhlIG9yZGVyOiB0YXJnZXQsIHBlcmZvcm1hbmNlLCByYW5nZTEsIHJhbmdlMiwgcmFuZ2UzLCAuLi4KKiAgICAgICBvcHRpb25zOgoqICAgICAgIHRhcmdldENvbG9yIC0gVGhlIGNvbG9yIG9mIHRoZSB2ZXJ0aWNhbCB0YXJnZXQgbWFya2VyCiogICAgICAgdGFyZ2V0V2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHRhcmdldCBtYXJrZXIgaW4gcGl4ZWxzCiogICAgICAgcGVyZm9ybWFuY2VDb2xvciAtIFRoZSBjb2xvciBvZiB0aGUgcGVyZm9ybWFuY2UgbWVhc3VyZSBob3Jpem9udGFsIGJhcgoqICAgICAgIHJhbmdlQ29sb3JzIC0gQ29sb3JzIHRvIHVzZSBmb3IgZWFjaCBxdWFsaXRhdGl2ZSByYW5nZSBiYWNrZ3JvdW5kIGNvbG9yCioKKiAgIHBpZSAtIFBpZSBjaGFydC4gT3B0aW9uczoKKiAgICAgICBzbGljZUNvbG9ycyAtIEFuIGFycmF5IG9mIGNvbG9ycyB0byB1c2UgZm9yIHBpZSBzbGljZXMKKiAgICAgICBvZmZzZXQgLSBBbmdsZSBpbiBkZWdyZWVzIHRvIG9mZnNldCB0aGUgZmlyc3Qgc2xpY2UgLSBUcnkgLTkwIG9yICs5MAoqICAgICAgIGJvcmRlcldpZHRoIC0gV2lkdGggb2YgYm9yZGVyIHRvIGRyYXcgYXJvdW5kIHRoZSBwaWUgY2hhcnQsIGluIHBpeGVscyAtIERlZmF1bHRzIHRvIDAgKG5vIGJvcmRlcikKKiAgICAgICBib3JkZXJDb2xvciAtIENvbG9yIHRvIHVzZSBmb3IgdGhlIHBpZSBjaGFydCBib3JkZXIgLSBEZWZhdWx0cyB0byAjMDAwCiogICBzdGFjayAtIEhvcml6b250YWwgc3RhY2sgY2hhcnQuIE9wdGlvbnM6CiogICAgICAgc2xpY2VDb2xvcnMgLSBBbiBhcnJheSBvZiBjb2xvcnMgdG8gdXNlIGZvciBwaWUgc2xpY2VzCioKKiAgIGJveCAtIEJveCBwbG90LiBPcHRpb25zOgoqICAgICAgIHJhdyAtIFNldCB0byB0cnVlIHRvIHN1cHBseSBwcmUtY29tcHV0ZWQgcGxvdCBwb2ludHMgYXMgdmFsdWVzCiogICAgICAgICAgICAgdmFsdWVzIHNob3VsZCBiZTogbG93X291dGxpZXIsIGxvd193aGlza2VyLCBxMSwgbWVkaWFuLCBxMywgaGlnaF93aGlza2VyLCBoaWdoX291dGxpZXIKKiAgICAgICAgICAgICBXaGVuIHNldCB0byBmYWxzZSB5b3UgY2FuIHN1cHBseSBhbnkgbnVtYmVyIG9mIHZhbHVlcyBhbmQgdGhlIGJveCBwbG90IHdpbGwKKiAgICAgICAgICAgICBiZSBjb21wdXRlZCBmb3IgeW91LiAgRGVmYXVsdCBpcyBmYWxzZS4KKiAgICAgICBzaG93T3V0bGllcnMgLSBTZXQgdG8gdHJ1ZSAoZGVmYXVsdCkgdG8gZGlzcGxheSBvdXRsaWVycyBhcyBjaXJjbGVzCiogICAgICAgb3V0bGllcklRUiAtIEludGVycXVhcnRpbGUgcmFuZ2UgdXNlZCB0byBkZXRlcm1pbmUgb3V0bGllcnMuICBEZWZhdWx0IDEuNQoqICAgICAgIGJveExpbmVDb2xvciAtIE91dGxpbmUgY29sb3Igb2YgdGhlIGJveAoqICAgICAgIGJveEZpbGxDb2xvciAtIEZpbGwgY29sb3IgZm9yIHRoZSBib3gKKiAgICAgICB3aGlza2VyQ29sb3IgLSBMaW5lIGNvbG9yIHVzZWQgZm9yIHdoaXNrZXJzCiogICAgICAgb3V0bGllckxpbmVDb2xvciAtIE91dGxpbmUgY29sb3Igb2Ygb3V0bGllciBjaXJjbGVzCiogICAgICAgb3V0bGllckZpbGxDb2xvciAtIEZpbGwgY29sb3Igb2YgdGhlIG91dGxpZXIgY2lyY2xlcwoqICAgICAgIHNwb3RSYWRpdXMgLSBSYWRpdXMgb2Ygb3V0bGllciBjaXJjbGVzCiogICAgICAgbWVkaWFuQ29sb3IgLSBMaW5lIGNvbG9yIG9mIHRoZSBtZWRpYW4gbGluZQoqICAgICAgIHRhcmdldCAtIERyYXcgYSB0YXJnZXQgY3Jvc3MgaGFpciBhdCB0aGUgc3VwcGxpZWQgdmFsdWUgKGRlZmF1bHQgdW5kZWZpbmVkKQoqCioKKgoqICAgRXhhbXBsZXM6CiogICAkKCcjc3BhcmtsaW5lMScpLnNwYXJrbGluZShteXZhbHVlcywgeyBsaW5lQ29sb3I6ICcjZjAwJywgZmlsbENvbG9yOiBmYWxzZSB9KTsKKiAgICQoJy5iYXJzcGFya3MnKS5zcGFya2xpbmUoJ2h0bWwnLCB7IHR5cGU6J2JhcicsIGhlaWdodDonNDBweCcsIGJhcldpZHRoOjUgfSk7CiogICAkKCcjdHJpc3RhdGUnKS5zcGFya2xpbmUoWzEsMSwtMSwxLDAsMCwtMV0sIHsgdHlwZTondHJpc3RhdGUnIH0pOgoqICAgJCgnI2Rpc2NyZXRlJykuc3BhcmtsaW5lKFsxLDMsNCw1LDUsMyw0LDVdLCB7IHR5cGU6J2Rpc2NyZXRlJyB9KTsKKiAgICQoJyNidWxsZXQnKS5zcGFya2xpbmUoWzEwLDEyLDEyLDksN10sIHsgdHlwZTonYnVsbGV0JyB9KTsKKiAgICQoJyNwaWUnKS5zcGFya2xpbmUoWzEsMSwyXSwgeyB0eXBlOidwaWUnIH0pOwoqLwoKLypqc2xpbnQgcmVnZXhwOiB0cnVlLCBicm93c2VyOiB0cnVlLCBqcXVlcnk6IHRydWUsIHdoaXRlOiB0cnVlLCBub21lbjogZmFsc2UsIHBsdXNwbHVzOiBmYWxzZSwgbWF4ZXJyOiA1MDAsIGluZGVudDogNCAqLwoKKGZ1bmN0aW9uKGRvY3VtZW50LCBNYXRoLCB1bmRlZmluZWQpIHsgLy8gcGVyZm9ybWFuY2UvbWluaWZpZWQtc2l6ZSBvcHRpbWl6YXRpb24KKGZ1bmN0aW9uKGZhY3RvcnkpIHsKICAgIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgnanF1ZXJ5LnNwYXJrbGluZScsIFsnanF1ZXJ5J10sIGZhY3RvcnkpOwogICAgfSBlbHNlIGlmIChqUXVlcnkgJiYgIWpRdWVyeS5mbi5zcGFya2xpbmUpIHsKICAgICAgICBmYWN0b3J5KGpRdWVyeSk7CiAgICB9Cn0KKGZ1bmN0aW9uKCQpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICAvLyBDVVNUT00gTU9EOiBtZWRpYW4gdmFyIGFkZGVkCiAgICB2YXIgVU5TRVRfT1BUSU9OID0ge30sCiAgICAgICAgZ2V0RGVmYXVsdHMsIGNyZWF0ZUNsYXNzLCBTUEZvcm1hdCwgY2xpcHZhbCwgbWVkaWFuLCBxdWFydGlsZSwgbm9ybWFsaXplVmFsdWUsIG5vcm1hbGl6ZVZhbHVlcywKICAgICAgICByZW1vdmUsIGlzTnVtYmVyLCBhbGwsIHN1bSwgYWRkQ1NTLCBlbnN1cmVBcnJheSwgZm9ybWF0TnVtYmVyLCBSYW5nZU1hcCwKICAgICAgICBNb3VzZUhhbmRsZXIsIFRvb2x0aXAsIGJhckhpZ2hsaWdodE1peGluLAogICAgICAgIGxpbmUsIGJhciwgdHJpc3RhdGUsIGRpc2NyZXRlLCBidWxsZXQsIHBpZSwgc3RhY2ssIGJveCwgdGltZWxpbmUsIGRlZmF1bHRTdHlsZXMsIGluaXRTdHlsZXMsCiAgICAgICAgVlNoYXBlLCBWQ2FudmFzX2Jhc2UsIFZDYW52YXNfY2FudmFzLCBWQ2FudmFzX3ZtbCwgcGVuZGluZywgc2hhcGVDb3VudCA9IDA7CgoKICAgIC8qKgogICAgICogRGVmYXVsdCBjb25maWd1cmF0aW9uIHNldHRpbmdzCiAgICAgKi8KICAgIGdldERlZmF1bHRzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIC8vIFNldHRpbmdzIGNvbW1vbiB0byBtb3N0L2FsbCBjaGFydCB0eXBlcwogICAgICAgICAgICBjb21tb246IHsKICAgICAgICAgICAgICAgIHR5cGU6ICdsaW5lJywKICAgICAgICAgICAgICAgIGxpbmVDb2xvcjogJyMwMGYnLAogICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnI2NkZicsCiAgICAgICAgICAgICAgICBkZWZhdWx0UGl4ZWxzUGVyVmFsdWU6IDMsCiAgICAgICAgICAgICAgICB3aWR0aDogJ2F1dG8nLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnYXV0bycsCiAgICAgICAgICAgICAgICBjb21wb3NpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgdGFnVmFsdWVzQXR0cmlidXRlOiAndmFsdWVzJywKICAgICAgICAgICAgICAgIHRhZ09wdGlvbnNQcmVmaXg6ICdzcGFyaycsCiAgICAgICAgICAgICAgICBlbmFibGVUYWdPcHRpb25zOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVuYWJsZUhpZ2hsaWdodDogdHJ1ZSwKICAgICAgICAgICAgICAgIGhpZ2hsaWdodExpZ2h0ZW46IDEuNCwKICAgICAgICAgICAgICAgIHRvb2x0aXBTa2lwTnVsbDogdHJ1ZSwKICAgICAgICAgICAgICAgIHRvb2x0aXBQcmVmaXg6ICcnLAogICAgICAgICAgICAgICAgdG9vbHRpcFN1ZmZpeDogJycsCiAgICAgICAgICAgICAgICBkaXNhYmxlSGlkZGVuQ2hlY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgbnVtYmVyRm9ybWF0dGVyOiBmYWxzZSwKICAgICAgICAgICAgICAgIG51bWJlckRpZ2l0R3JvdXBDb3VudDogMywKICAgICAgICAgICAgICAgIG51bWJlckRpZ2l0R3JvdXBTZXA6ICcsJywKICAgICAgICAgICAgICAgIG51bWJlckRlY2ltYWxNYXJrOiAnLicsCiAgICAgICAgICAgICAgICBkaXNhYmxlVG9vbHRpcHM6IGZhbHNlLAogICAgICAgICAgICAgICAgZGlzYWJsZUludGVyYWN0aW9uOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgbGluZSBjaGFydHMKICAgICAgICAgICAgbGluZTogewogICAgICAgICAgICAgICAgc3BvdENvbG9yOiAnI2Y4MCcsCiAgICAgICAgICAgICAgICBoaWdobGlnaHRTcG90Q29sb3I6ICcjNWY1JywKICAgICAgICAgICAgICAgIGhpZ2hsaWdodExpbmVDb2xvcjogJyNmMjInLAogICAgICAgICAgICAgICAgcmVmTGluZUNvbG9yOiAnI2YyMicsCiAgICAgICAgICAgICAgICAvLyByZWZMaW5lWDogbnVsbCwKICAgICAgICAgICAgICAgIC8vIHJlZkxpbmVZOiBudWxsLAogICAgICAgICAgICAgICAgc3BvdFJhZGl1czogMS41LAogICAgICAgICAgICAgICAgbWluU3BvdENvbG9yOiAnI2Y4MCcsCiAgICAgICAgICAgICAgICBtYXhTcG90Q29sb3I6ICcjZjgwJywKICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMSwKICAgICAgICAgICAgICAgIG5vcm1hbFJhbmdlTWluOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBub3JtYWxSYW5nZU1heDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgbm9ybWFsUmFuZ2VDb2xvcjogJyNjY2MnLAogICAgICAgICAgICAgICAgZHJhd05vcm1hbE9uVG9wOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW46IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNYXg6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW5YOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWF4WDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDogbmV3IFNQRm9ybWF0KCc8c3BhbiBzdHlsZT0iY29sb3I6IHt7Y29sb3J9fSI+JiM5Njc5Ozwvc3Bhbj4ge3twcmVmaXh9fXt7eX19e3tzdWZmaXh9fScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBiYXIgY2hhcnRzCiAgICAgICAgICAgIGJhcjogewogICAgICAgICAgICAgICAgYmFyQ29sb3I6ICcjMzM2NmNjJywKICAgICAgICAgICAgICAgIG5lZ0JhckNvbG9yOiAnI2Y0NCcsCiAgICAgICAgICAgICAgICBzdGFja2VkQmFyQ29sb3I6IFsnIzMzNjZjYycsICcjZGMzOTEyJywgJyNmZjk5MDAnLCAnIzEwOTYxOCcsICcjNjZhYTAwJywKICAgICAgICAgICAgICAgICAgICAnI2RkNDQ3NycsICcjMDA5OWM2JywgJyM5OTAwOTknXSwKICAgICAgICAgICAgICAgIHplcm9Db2xvcjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgbnVsbENvbG9yOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICB6ZXJvQXhpczogdHJ1ZSwKICAgICAgICAgICAgICAgIGJhcldpZHRoOiA0LAogICAgICAgICAgICAgICAgYmFyU3BhY2luZzogMSwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNYXg6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW46IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VDbGlwOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNvbG9yTWFwOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJzxzcGFuIHN0eWxlPSJjb2xvcjoge3tjb2xvcn19Ij4mIzk2Nzk7PC9zcGFuPiB7e3ByZWZpeH19e3t2YWx1ZX19e3tzdWZmaXh9fScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciB0aW1lbGluZSBjaGFydHMKICAgICAgICAgICAgdGltZWxpbmU6IHsKICAgICAgICAgICAgICAgIHdpZHRoOiAxMjAsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDMsCiAgICAgICAgICAgICAgICBsaW5lQ29sb3I6ICcjNjc5MmM2JywKICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyNiYWQ3ZmInLAogICAgICAgICAgICAgICAgb3JpZW50YXRpb246ICdob3Jpem9udGFsJywgLy8gb3IgJ3ZlcnRpY2FsJwogICAgICAgICAgICAgICAgLy8gbnVtYmVyIG9mIG1pbnV0ZXMgdG8gbW9kdWxhdGUgdGltZSBtYXJrZXJzIGZyb20gYmVnaW4gb3B0aW9uCiAgICAgICAgICAgICAgICB0aW1lTWFya0ludGVydmFsOiAwLAogICAgICAgICAgICAgICAgLy8gbWluaW11bSBkYXRlL3RpbWUgdG8gc2hvdyBpbiB0aW1lbGluZQogICAgICAgICAgICAgICAgYmVnaW46IG5ldyBEYXRlKDIwMDAsIDEsIDEsIDAsIDApLAogICAgICAgICAgICAgICAgLy8gbWF4aW11bSBkYXRlL3RpbWUgdG8gc2hvdyBpbiB0aW1lbGluZQogICAgICAgICAgICAgICAgZmluaXNoOiBuZXcgRGF0ZSgyMDAwLCAxLCAxLCAyMywgNTkpLAogICAgICAgICAgICAgICAgLy8gYWxsb3cgdXNlciB0byBwcm92aWRlIHRoZWlyIG93biBkYXRlIHBhcnNpbmcgYWJpbGl0aWVzCiAgICAgICAgICAgICAgICAvLyBkYXRhIG11c3QgcHJvdmlkZSBiZWdpbiwgZmluaXNoLCB0aXRsZSBhbmQgY29sb3IgaGFzaCBvYmplY3QKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiB7YmVnaW46IG5ldyBEYXRlKGRhdGEuYmVnaW4pLCBmaW5pc2g6IG5ldyBEYXRlKGRhdGEuZmluaXNoKSwgdGl0bGU6IGRhdGEudGl0bGUsIGNvbG9yOiBkYXRhLmNvbG9yfTsgfSwKICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgnPHNwYW4gc3R5bGU9ImNvbG9yOiB7e2NvbG9yfX0iPiYjOTY3OTs8L3NwYW4+IHt7dGl0bGV9fToge3tiZWdpbn19IC8ge3tmaW5pc2h9fScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciB0cmlzdGF0ZSBjaGFydHMKICAgICAgICAgICAgdHJpc3RhdGU6IHsKICAgICAgICAgICAgICAgIGJhcldpZHRoOiA0LAogICAgICAgICAgICAgICAgYmFyU3BhY2luZzogMSwKICAgICAgICAgICAgICAgIHBvc0JhckNvbG9yOiAnIzZmNicsCiAgICAgICAgICAgICAgICBuZWdCYXJDb2xvcjogJyNmNDQnLAogICAgICAgICAgICAgICAgemVyb0JhckNvbG9yOiAnIzk5OScsCiAgICAgICAgICAgICAgICBjb2xvck1hcDoge30sCiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJzxzcGFuIHN0eWxlPSJjb2xvcjoge3tjb2xvcn19Ij4mIzk2Nzk7PC9zcGFuPiB7e3ByZWZpeH19e3t2YWx1ZTptYXB9fXt7c3VmZml4fX0nKSwKICAgICAgICAgICAgICAgIHRvb2x0aXBWYWx1ZUxvb2t1cHM6IHsgbWFwOiB7ICctMSc6ICdMb3NzJywgJzAnOiAnRHJhdycsICcxJzogJ1dpbicgfSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBkaXNjcmV0ZSBjaGFydHMKICAgICAgICAgICAgZGlzY3JldGU6IHsKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICdhdXRvJywKICAgICAgICAgICAgICAgIHRocmVzaG9sZENvbG9yOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICB0aHJlc2hvbGRWYWx1ZTogMCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNYXg6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW46IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VDbGlwOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgne3twcmVmaXh9fXt7dmFsdWV9fXt7c3VmZml4fX0nKQogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgYnVsbGV0IGNoYXJ0cwogICAgICAgICAgICBidWxsZXQ6IHsKICAgICAgICAgICAgICAgIHRhcmdldENvbG9yOiAnI2YzMycsCiAgICAgICAgICAgICAgICB0YXJnZXRXaWR0aDogMywgLy8gd2lkdGggb2YgdGhlIHRhcmdldCBiYXIgaW4gcGl4ZWxzCiAgICAgICAgICAgICAgICBwZXJmb3JtYW5jZUNvbG9yOiAnIzMzZicsCiAgICAgICAgICAgICAgICByYW5nZUNvbG9yczogWycjZDNkYWZlJywgJyNhOGI2ZmYnLCAnIzdmOTRmZiddLAogICAgICAgICAgICAgICAgYmFzZTogdW5kZWZpbmVkLCAvLyBzZXQgdGhpcyB0byBhIG51bWJlciB0byBjaGFuZ2UgdGhlIGJhc2Ugc3RhcnQgbnVtYmVyCiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJ3t7ZmllbGRrZXk6ZmllbGRzfX0gLSB7e3ZhbHVlfX0nKSwKICAgICAgICAgICAgICAgIHRvb2x0aXBWYWx1ZUxvb2t1cHM6IHsgZmllbGRzOiB7cjogJ1JhbmdlJywgcDogJ1BlcmZvcm1hbmNlJywgdDogJ1RhcmdldCd9IH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gRGVmYXVsdHMgZm9yIHBpZSBjaGFydHMKICAgICAgICAgICAgcGllOiB7CiAgICAgICAgICAgICAgICBvZmZzZXQ6IDAsCiAgICAgICAgICAgICAgICBzbGljZUNvbG9yczogWycjMzM2NmNjJywgJyNkYzM5MTInLCAnI2ZmOTkwMCcsICcjMTA5NjE4JywgJyM2NmFhMDAnLAogICAgICAgICAgICAgICAgICAgICcjZGQ0NDc3JywgJyMwMDk5YzYnLCAnIzk5MDA5OSddLAogICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDAsCiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogJyMwMDAnLAogICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDogbmV3IFNQRm9ybWF0KCc8c3BhbiBzdHlsZT0iY29sb3I6IHt7Y29sb3J9fSI+JiM5Njc5Ozwvc3Bhbj4ge3twcmVmaXh9fXt7dmFsdWV9fSAoe3twZXJjZW50LjF9fSUpe3tzdWZmaXh9fScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBzdGFjayBjaGFydHMKICAgICAgICAgICAgc3RhY2s6IHsKICAgICAgICAgICAgICAgIG9mZnNldDogMCwKICAgICAgICAgICAgICAgIHNsaWNlQ29sb3JzOiBbJyMzMzY2Y2MnLCAnI2RjMzkxMicsICcjZmY5OTAwJywgJyMxMDk2MTgnLCAnIzY2YWEwMCcsCiAgICAgICAgICAgICAgICAgICAgJyNkZDQ0NzcnLCAnIzAwOTljNicsICcjOTkwMDk5J10sCiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMCwKICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnIzAwMCcsCiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJzxzcGFuIHN0eWxlPSJjb2xvcjoge3tjb2xvcn19Ij4mIzk2Nzk7PC9zcGFuPiB7e3ZhbHVlfX0gKHt7cGVyY2VudC4xfX0lKScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBib3ggcGxvdHMKICAgICAgICAgICAgYm94OiB7CiAgICAgICAgICAgICAgICByYXc6IGZhbHNlLAogICAgICAgICAgICAgICAgYm94TGluZUNvbG9yOiAnIzAwMCcsCiAgICAgICAgICAgICAgICBib3hGaWxsQ29sb3I6ICcjY2RmJywKICAgICAgICAgICAgICAgIHdoaXNrZXJDb2xvcjogJyMwMDAnLAogICAgICAgICAgICAgICAgb3V0bGllckxpbmVDb2xvcjogJyMzMzMnLAogICAgICAgICAgICAgICAgb3V0bGllckZpbGxDb2xvcjogJyNmZmYnLAogICAgICAgICAgICAgICAgbWVkaWFuQ29sb3I6ICcjZjAwJywKICAgICAgICAgICAgICAgIHNob3dPdXRsaWVyczogdHJ1ZSwKICAgICAgICAgICAgICAgIG91dGxpZXJJUVI6IDEuNSwKICAgICAgICAgICAgICAgIHNwb3RSYWRpdXM6IDEuNSwKICAgICAgICAgICAgICAgIHRhcmdldDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdGFyZ2V0Q29sb3I6ICcjNGEyJywKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNYXg6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW46IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgne3tmaWVsZDpmaWVsZHN9fToge3t2YWx1ZX19JyksCiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0RmllbGRsaXN0S2V5OiAnZmllbGQnLAogICAgICAgICAgICAgICAgdG9vbHRpcFZhbHVlTG9va3VwczogeyBmaWVsZHM6IHsgbHE6ICdMb3dlciBRdWFydGlsZScsIG1lZDogJ01lZGlhbicsCiAgICAgICAgICAgICAgICAgICAgdXE6ICdVcHBlciBRdWFydGlsZScsIGxvOiAnTGVmdCBPdXRsaWVyJywgcm86ICdSaWdodCBPdXRsaWVyJywKICAgICAgICAgICAgICAgICAgICBsdzogJ0xlZnQgV2hpc2tlcicsIHJ3OiAnUmlnaHQgV2hpc2tlcid9IH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9OwoKICAgIC8vIEJvb3RzdHJhcCBhZGRzIGJveC1zaXppbmcgdGhhdCBtZXNzZXMgd2l0aCBhbGlnbm1lbnQgaW4gdGhlIHRvb2x0aXAuCiAgICB2YXIgYm94X3NpemluZyA9ICctd2Via2l0LWJveC1zaXppbmc6IGNvbnRlbnQtYm94ICFpbXBvcnRhbnQ7JyArCiAgICAgICAgICAnLW1vei1ib3gtc2l6aW5nOiBjb250ZW50LWJveCAhaW1wb3J0YW50OycgKwogICAgICAgICAgJ2JveC1zaXppbmc6IGNvbnRlbnQtYm94ICFpbXBvcnRhbnQ7JzsKCiAgICAvLyBZb3UgY2FuIGhhdmUgdG9vbHRpcHMgdXNlIGEgY3NzIGNsYXNzIG90aGVyIHRoYW4ganFzdG9vbHRpcCBieSBzcGVjaWZ5aW5nIHRvb2x0aXBDbGFzc25hbWUKICAgIGRlZmF1bHRTdHlsZXMgPSAnLmpxc3Rvb2x0aXAgeyAnICsKICAgICAgICAgICAgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsnICsKICAgICAgICAgICAgJ2xlZnQ6IDBweDsnICsKICAgICAgICAgICAgJ3RvcDogMHB4OycgKwogICAgICAgICAgICAndmlzaWJpbGl0eTogaGlkZGVuOycgKwogICAgICAgICAgICAnYmFja2dyb3VuZDogcmdiKDAsIDAsIDApIHRyYW5zcGFyZW50OycgKwogICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLDAsMCwwLjYpOycgKwogICAgICAgICAgICAnZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yc3RyPSM5OTAwMDAwMCwgZW5kQ29sb3JzdHI9Izk5MDAwMDAwKTsnICsKICAgICAgICAgICAgJy1tcy1maWx0ZXI6ICJwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj0jOTkwMDAwMDAsIGVuZENvbG9yc3RyPSM5OTAwMDAwMCkiOycgKwogICAgICAgICAgICAnY29sb3I6IHdoaXRlOycgKwogICAgICAgICAgICAnZm9udDogMTBweCBhcmlhbCwgc2FuIHNlcmlmOycgKwogICAgICAgICAgICAndGV4dC1hbGlnbjogbGVmdDsnICsKICAgICAgICAgICAgJ3doaXRlLXNwYWNlOiBub3dyYXA7JyArCiAgICAgICAgICAgICdwYWRkaW5nOiA1cHg7JyArCiAgICAgICAgICAgICdib3JkZXI6IDFweCBzb2xpZCB3aGl0ZTsnICsKICAgICAgICAgICAgJ3otaW5kZXg6IDEwMDAwOycgKwogICAgICAgICAgICBib3hfc2l6aW5nICsKICAgICAgICAgICAgJ30nICsKICAgICAgICAgICAgJy5qcXNmaWVsZCB7ICcgKwogICAgICAgICAgICAnY29sb3I6IHdoaXRlOycgKwogICAgICAgICAgICAnZm9udDogMTBweCBhcmlhbCwgc2FuIHNlcmlmOycgKwogICAgICAgICAgICAndGV4dC1hbGlnbjogbGVmdDsnICsKICAgICAgICAgICAgJ30nICsKICAgICAgICAgICAgJy5qcXN0b29sdGlwOmJlZm9yZSwgLmpxc3Rvb2x0aXA6YWZ0ZXIgeyAnICsKICAgICAgICAgICAgYm94X3NpemluZyArCiAgICAgICAgICAgICd9JzsKCiAgICAvKioKICAgICAqIFV0aWxpdGllcwogICAgICovCgogICAgY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoLyogW2Jhc2VjbGFzcywgW21peGluLCAuLi5dXSwgZGVmaW5pdGlvbiAqLykgewogICAgICAgIHZhciBDbGFzcywgYXJnczsKICAgICAgICBDbGFzcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgaWYgKGFyZ3VtZW50c1swXSkgewogICAgICAgICAgICAgICAgQ2xhc3MucHJvdG90eXBlID0gJC5leHRlbmQobmV3IGFyZ3VtZW50c1swXSgpLCBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdKTsKICAgICAgICAgICAgICAgIENsYXNzLl9zdXBlciA9IGFyZ3VtZW50c1swXS5wcm90b3R5cGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFzcy5wcm90b3R5cGUgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSwgLTEpOwogICAgICAgICAgICAgICAgYXJncy51bnNoaWZ0KENsYXNzLnByb3RvdHlwZSk7CiAgICAgICAgICAgICAgICAkLmV4dGVuZC5hcHBseSgkLCBhcmdzKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENsYXNzLnByb3RvdHlwZSA9IGFyZ3VtZW50c1swXTsKICAgICAgICB9CiAgICAgICAgQ2xhc3MucHJvdG90eXBlLmNscyA9IENsYXNzOwogICAgICAgIHJldHVybiBDbGFzczsKICAgIH07CgogICAgLyoqCiAgICAgKiBXcmFwcyBhIGZvcm1hdCBzdHJpbmcgZm9yIHRvb2x0aXBzCiAgICAgKiB7e3h9fQogICAgICoge3t4LjJ9CiAgICAgKiB7e3g6bW9udGhzfX0KICAgICAqLwogICAgJC5TUEZvcm1hdENsYXNzID0gU1BGb3JtYXQgPSBjcmVhdGVDbGFzcyh7CiAgICAgICAgZnJlOiAvXHtceyhbXHcuXSs/KSg6KC4rPykpP1x9XH0vZywKICAgICAgICBwcmVjcmU6IC8oXHcrKVwuKFxkKykvLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoZm9ybWF0LCBmY2xhc3MpIHsKICAgICAgICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICAgICAgICAgIHRoaXMuZmNsYXNzID0gZmNsYXNzOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGZpZWxkc2V0LCBsb29rdXBzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICAgICAgICAgIGZpZWxkcyA9IGZpZWxkc2V0LAogICAgICAgICAgICAgICAgbWF0Y2gsIHRva2VuLCBsb29rdXBrZXksIGZpZWxkdmFsdWUsIHByZWM7CgogICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQucmVwbGFjZSh0aGlzLmZyZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGxvb2t1cDsKICAgICAgICAgICAgICAgIHRva2VuID0gYXJndW1lbnRzWzFdOwogICAgICAgICAgICAgICAgbG9va3Vwa2V5ID0gYXJndW1lbnRzWzNdOwogICAgICAgICAgICAgICAgbWF0Y2ggPSBzZWxmLnByZWNyZS5leGVjKHRva2VuKTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgICAgICAgIHByZWMgPSBtYXRjaFsyXTsKICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IG1hdGNoWzFdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwcmVjID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaWVsZHZhbHVlID0gZmllbGRzW3Rva2VuXTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobG9va3Vwa2V5ICYmIGxvb2t1cHMgJiYgbG9va3Vwc1tsb29rdXBrZXldKSB7CiAgICAgICAgICAgICAgICAgICAgbG9va3VwID0gbG9va3Vwc1tsb29rdXBrZXldOwogICAgICAgICAgICAgICAgICAgIGlmIChsb29rdXAuZ2V0KSB7IC8vIFJhbmdlTWFwCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsb29rdXBzW2xvb2t1cGtleV0uZ2V0KGZpZWxkdmFsdWUpIHx8IGZpZWxkdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvb2t1cHNbbG9va3Vwa2V5XVtmaWVsZHZhbHVlXSB8fCBmaWVsZHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc051bWJlcihmaWVsZHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnbnVtYmVyRm9ybWF0dGVyJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGR2YWx1ZSA9IG9wdGlvbnMuZ2V0KCdudW1iZXJGb3JtYXR0ZXInKShmaWVsZHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHZhbHVlID0gZm9ybWF0TnVtYmVyKGZpZWxkdmFsdWUsIHByZWMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbnVtYmVyRGlnaXRHcm91cENvdW50JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbnVtYmVyRGlnaXRHcm91cFNlcCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ251bWJlckRlY2ltYWxNYXJrJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZHZhbHVlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyBjb252ZW5pZW5jZSBtZXRob2QgdG8gYXZvaWQgbmVlZGluZyB0aGUgbmV3IG9wZXJhdG9yCiAgICAkLnNwZm9ybWF0ID0gZnVuY3Rpb24gKGZvcm1hdCwgZmNsYXNzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTUEZvcm1hdChmb3JtYXQsIGZjbGFzcyk7CiAgICB9OwoKICAgIGNsaXB2YWwgPSBmdW5jdGlvbiAodmFsLCBtaW4sIG1heCkgewogICAgICAgIGlmICh2YWwgPCBtaW4pIHsKICAgICAgICAgICAgcmV0dXJuIG1pbjsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbCA+IG1heCkgewogICAgICAgICAgICByZXR1cm4gbWF4OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsOwogICAgfTsKCiAgICAvLyBDVVNUT00gTU9EOiBjb21wbGV0ZWx5IG5ldyBtZWRpYW4gZnVuY3Rpb24KICAgIG1lZGlhbiA9IGZ1bmN0aW9uICh2YWx1ZXMpIHsKICAgICAgICB2YXIgcmV0LCBpZHg7CiAgICAgICAgaWYgKDAgPT09IHZhbHVlcy5sZW5ndGggJSAyKSB7CiAgICAgICAgICAgIHZhciB2MSwgdjI7CiAgICAgICAgICAgIGlkeCA9IHZhbHVlcy5sZW5ndGggLyAyOwogICAgICAgICAgICB2MSA9IHZhbHVlc1tpZHggLSAxXTsKICAgICAgICAgICAgdjIgPSB2YWx1ZXNbaWR4XTsKICAgICAgICAgICAgcmV0ID0gKHYxICsgdjIpIC8gMjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlkeCA9IHBhcnNlSW50KHZhbHVlcy5sZW5ndGggLyAyKTsKICAgICAgICAgICAgcmV0ID0gdmFsdWVzW2lkeF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyAKICAgICAgICAgICAgbTogcmV0LCAKICAgICAgICAgICAgaWR4OiBpZHggCiAgICAgICAgfTsKICAgIH07CgogICAgLy8gQ1VTVE9NIE1PRDogY29tcGxldGVseSByZXdyaXR0ZW4gcXVhcnRpbGUgZnVuY3Rpb24KICAgIHF1YXJ0aWxlID0gZnVuY3Rpb24gKHZhbHVlcywgcSkgewogICAgICAgIHZhciByZXQsIG0sIG1lZDsKICAgICAgICBtID0gbWVkaWFuKHZhbHVlcyk7CgogICAgICAgIGlmIChxID09PSAyKSB7CiAgICAgICAgICAgIHJldCA9IG0ubTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhcnIgPSBbXTsKICAgICAgICAgICAgbWVkID0gbS5tOwoKICAgICAgICAgICAgaWYgKG1lZCAhPSBudWxsKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmUKICAgICAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgICAgIGlmIChxID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBtLmlkeCkgewogICAgICAgICAgICAgICAgICAgICAgYXJyW2ldID0gdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWFyci5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICBhcnIgPSBbIHZhbHVlc1swXSBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAocSA9PT0gMykgewogICAgICAgICAgICAgICAgICAgIHZhciBqID0gdmFsdWVzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGogPiBtLmlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICBhcnJbaV0gPSB2YWx1ZXNbal07CiAgICAgICAgICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgICAgICAgICAgai0tOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWFyci5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICBhcnIgPSBbIHZhbHVlc1t2YWx1ZXMubGVuZ3RoIC0gMV0gXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBtID0gbWVkaWFuKGFycik7CiAgICAgICAgICAgIHJldCA9IG0ubTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH07CgogICAgbm9ybWFsaXplVmFsdWUgPSBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgdmFyIG5mOwogICAgICAgIHN3aXRjaCAodmFsKSB7CiAgICAgICAgY2FzZSAndW5kZWZpbmVkJzoKICAgICAgICAgICAgdmFsID0gdW5kZWZpbmVkOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdudWxsJzoKICAgICAgICAgICAgdmFsID0gbnVsbDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndHJ1ZSc6CiAgICAgICAgICAgIHZhbCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2ZhbHNlJzoKICAgICAgICAgICAgdmFsID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIG5mID0gcGFyc2VGbG9hdCh2YWwpOwogICAgICAgICAgICBpZiAodmFsID09IG5mKSB7CiAgICAgICAgICAgICAgICB2YWwgPSBuZjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsOwogICAgfTsKCiAgICBub3JtYWxpemVWYWx1ZXMgPSBmdW5jdGlvbiAodmFscykgewogICAgICAgIHZhciBpLCByZXN1bHQgPSBbXTsKICAgICAgICBmb3IgKGkgPSB2YWxzLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICByZXN1bHRbaV0gPSBub3JtYWxpemVWYWx1ZSh2YWxzW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgogICAgcmVtb3ZlID0gZnVuY3Rpb24gKHZhbHMsIGZpbHRlcikgewogICAgICAgIHZhciBpLCB2bCwgcmVzdWx0ID0gW107CiAgICAgICAgZm9yIChpID0gMCwgdmwgPSB2YWxzLmxlbmd0aDsgaSA8IHZsOyBpKyspIHsKICAgICAgICAgICAgaWYgKHZhbHNbaV0gIT09IGZpbHRlcikgewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godmFsc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgogICAgaXNOdW1iZXIgPSBmdW5jdGlvbiAobnVtKSB7CiAgICAgICAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG51bSkpICYmIGlzRmluaXRlKG51bSk7CiAgICB9OwoKICAgIGZvcm1hdE51bWJlciA9IGZ1bmN0aW9uIChudW0sIHByZWMsIGdyb3Vwc2l6ZSwgZ3JvdXBzZXAsIGRlY3NlcCkgewogICAgICAgIHZhciBwLCBpOwogICAgICAgIG51bSA9IChwcmVjID09PSBmYWxzZSA/IHBhcnNlRmxvYXQobnVtKS50b1N0cmluZygpIDogbnVtLnRvRml4ZWQocHJlYykpLnNwbGl0KCcnKTsKICAgICAgICBwID0gKHAgPSAkLmluQXJyYXkoJy4nLCBudW0pKSA8IDAgPyBudW0ubGVuZ3RoIDogcDsKICAgICAgICBpZiAocCA8IG51bS5sZW5ndGgpIHsKICAgICAgICAgICAgbnVtW3BdID0gZGVjc2VwOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSBwIC0gZ3JvdXBzaXplOyBpID4gMDsgaSAtPSBncm91cHNpemUpIHsKICAgICAgICAgICAgbnVtLnNwbGljZShpLCAwLCBncm91cHNlcCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudW0uam9pbignJyk7CiAgICB9OwoKICAgIC8vIGRldGVybWluZSBpZiBhbGwgdmFsdWVzIG9mIGFuIGFycmF5IG1hdGNoIGEgdmFsdWUKICAgIC8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgYXJyYXkgaXMgZW1wdHkKICAgIGFsbCA9IGZ1bmN0aW9uICh2YWwsIGFyciwgaWdub3JlTnVsbCkgewogICAgICAgIHZhciBpOwogICAgICAgIGZvciAoaSA9IGFyci5sZW5ndGg7IGktLTsgKSB7CiAgICAgICAgICAgIGlmIChpZ25vcmVOdWxsICYmIGFycltpXSA9PT0gbnVsbCkgY29udGludWU7CiAgICAgICAgICAgIGlmIChhcnJbaV0gIT09IHZhbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfTsKCiAgICAvLyBzdW1zIHRoZSBudW1lcmljIHZhbHVlcyBpbiBhbiBhcnJheSwgaWdub3Jpbmcgb3RoZXIgdmFsdWVzCiAgICBzdW0gPSBmdW5jdGlvbiAodmFscykgewogICAgICAgIHZhciB0b3RhbCA9IDAsIGk7CiAgICAgICAgZm9yIChpID0gdmFscy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgdG90YWwgKz0gdHlwZW9mIHZhbHNbaV0gPT09ICdudW1iZXInID8gdmFsc1tpXSA6IDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b3RhbDsKICAgIH07CgogICAgZW5zdXJlQXJyYXkgPSBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuICQuaXNBcnJheSh2YWwpID8gdmFsIDogW3ZhbF07CiAgICB9OwoKICAgIC8vIGh0dHA6Ly9wYXVsaXJpc2guY29tLzIwMDgvYm9va21hcmtsZXQtaW5qZWN0LW5ldy1jc3MtcnVsZXMvCiAgICBhZGRDU1MgPSBmdW5jdGlvbiAoY3NzKSB7CiAgICAgICAgdmFyIHRhZywgaWVmYWlsOwogICAgICAgIGlmIChkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KCkuY3NzVGV4dCA9IGNzczsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gSUUgPD0gOSBtYXhlcyBvdXQgYXQgMzEgc3R5bGVzaGVldHM7IGluamVjdCBpbnRvIHBhZ2UgaW5zdGVhZC4KICAgICAgICAgICAgICAgIGllZmFpbCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICB0YWcudHlwZSA9ICd0ZXh0L2Nzcyc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZCh0YWcpOwogICAgICAgIGlmIChpZWZhaWwpIHsKICAgICAgICAgICAgZG9jdW1lbnQuc3R5bGVTaGVldHNbZG9jdW1lbnQuc3R5bGVTaGVldHMubGVuZ3RoIC0gMV0uY3NzVGV4dCA9IGNzczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWdbKHR5cGVvZiBkb2N1bWVudC5ib2R5LnN0eWxlLldlYmtpdEFwcGVhcmFuY2UgPT0gJ3N0cmluZycpIC8qIHdlYmtpdCBvbmx5ICovID8gJ2lubmVyVGV4dCcgOiAnaW5uZXJIVE1MJ10gPSBjc3M7CiAgICAgICAgfQogICAgfTsKCgogICAgLy8gUHJvdmlkZSBhIGNyb3NzLWJyb3dzZXIgaW50ZXJmYWNlIHRvIGEgZmV3IHNpbXBsZSBkcmF3aW5nIHByaW1pdGl2ZXMKICAgICQuZm4uc2ltcGxlZHJhdyA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCB1c2VFeGlzdGluZywgaW50ZXJhY3QpIHsKICAgICAgICB2YXIgdGFyZ2V0LCBtaGFuZGxlcjsKICAgICAgICBpZiAodXNlRXhpc3RpbmcgJiYgKHRhcmdldCA9IHRoaXMuZGF0YSgnX2pxc192Y2FudmFzJykpKSB7CiAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgfQoKICAgICAgICBpZiAoJC5mbi5zcGFya2xpbmUuY2FudmFzID09PSBmYWxzZSkgewogICAgICAgICAgICAvLyBXZSd2ZSBhbHJlYWR5IGRldGVybWluZWQgdGhhdCBuZWl0aGVyIENhbnZhcyBub3IgVk1MIGFyZSBhdmFpbGFibGUKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoJC5mbi5zcGFya2xpbmUuY2FudmFzID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy8gTm8gZnVuY3Rpb24gZGVmaW5lZCB5ZXQgLS0gbmVlZCB0byBzZWUgaWYgd2Ugc3VwcG9ydCBDYW52YXMgb3IgVk1MCiAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICBpZiAoISEoZWwuZ2V0Q29udGV4dCAmJiBlbC5nZXRDb250ZXh0KCcyZCcpKSkgewogICAgICAgICAgICAgICAgLy8gQ2FudmFzIGlzIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgJC5mbi5zcGFya2xpbmUuY2FudmFzID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCwgdGFyZ2V0LCBpbnRlcmFjdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVkNhbnZhc19jYW52YXMod2lkdGgsIGhlaWdodCwgdGFyZ2V0LCBpbnRlcmFjdCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm5hbWVzcGFjZXMgJiYgIWRvY3VtZW50Lm5hbWVzcGFjZXMudikgewogICAgICAgICAgICAgICAgLy8gVk1MIGlzIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgZG9jdW1lbnQubmFtZXNwYWNlcy5hZGQoJ3YnLCAndXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp2bWwnLCAnI2RlZmF1bHQjVk1MJyk7CiAgICAgICAgICAgICAgICAkLmZuLnNwYXJrbGluZS5jYW52YXMgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0LCB0YXJnZXQsIGludGVyYWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWQ2FudmFzX3ZtbCh3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE5laXRoZXIgQ2FudmFzIG5vciBWTUwgYXJlIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgJC5mbi5zcGFya2xpbmUuY2FudmFzID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh3aWR0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHdpZHRoID0gJCh0aGlzKS5pbm5lcldpZHRoKCk7CiAgICAgICAgfQogICAgICAgIGlmIChoZWlnaHQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBoZWlnaHQgPSAkKHRoaXMpLmlubmVySGVpZ2h0KCk7CiAgICAgICAgfQoKICAgICAgICB0YXJnZXQgPSAkLmZuLnNwYXJrbGluZS5jYW52YXMod2lkdGgsIGhlaWdodCwgdGhpcywgaW50ZXJhY3QpOwoKICAgICAgICBtaGFuZGxlciA9ICQodGhpcykuZGF0YSgnX2pxc19taGFuZGxlcicpOwogICAgICAgIGlmIChtaGFuZGxlcikgewogICAgICAgICAgICBtaGFuZGxlci5yZWdpc3RlckNhbnZhcyh0YXJnZXQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgfTsKCiAgICAkLmZuLmNsZWFyZHJhdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5kYXRhKCdfanFzX3ZjYW52YXMnKTsKICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgIHRhcmdldC5yZXNldCgpOwogICAgICAgIH0KICAgIH07CgoKICAgICQuUmFuZ2VNYXBDbGFzcyA9IFJhbmdlTWFwID0gY3JlYXRlQ2xhc3MoewogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChtYXApIHsKICAgICAgICAgICAgdmFyIGtleSwgcmFuZ2UsIHJhbmdlbGlzdCA9IFtdOwogICAgICAgICAgICBmb3IgKGtleSBpbiBtYXApIHsKICAgICAgICAgICAgICAgIGlmIChtYXAuaGFzT3duUHJvcGVydHkoa2V5KSAmJiB0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiBrZXkuaW5kZXhPZignOicpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICByYW5nZSA9IGtleS5zcGxpdCgnOicpOwogICAgICAgICAgICAgICAgICAgIHJhbmdlWzBdID0gcmFuZ2VbMF0ubGVuZ3RoID09PSAwID8gLUluZmluaXR5IDogcGFyc2VGbG9hdChyYW5nZVswXSk7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2VbMV0gPSByYW5nZVsxXS5sZW5ndGggPT09IDAgPyBJbmZpbml0eSA6IHBhcnNlRmxvYXQocmFuZ2VbMV0pOwogICAgICAgICAgICAgICAgICAgIHJhbmdlWzJdID0gbWFwW2tleV07CiAgICAgICAgICAgICAgICAgICAgcmFuZ2VsaXN0LnB1c2gocmFuZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMubWFwID0gbWFwOwogICAgICAgICAgICB0aGlzLnJhbmdlbGlzdCA9IHJhbmdlbGlzdCB8fCBmYWxzZTsKICAgICAgICB9LAoKICAgICAgICBnZXQ6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICB2YXIgcmFuZ2VsaXN0ID0gdGhpcy5yYW5nZWxpc3QsCiAgICAgICAgICAgICAgICBpLCByYW5nZSwgcmVzdWx0OwogICAgICAgICAgICBpZiAoKHJlc3VsdCA9IHRoaXMubWFwW3ZhbHVlXSkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmFuZ2VsaXN0KSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSByYW5nZWxpc3QubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSByYW5nZWxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmdlWzBdIDw9IHZhbHVlICYmIHJhbmdlWzFdID49IHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByYW5nZVsyXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyBDb252ZW5pZW5jZSBmdW5jdGlvbgogICAgJC5yYW5nZV9tYXAgPSBmdW5jdGlvbihtYXApIHsKICAgICAgICByZXR1cm4gbmV3IFJhbmdlTWFwKG1hcCk7CiAgICB9OwoKCiAgICBNb3VzZUhhbmRsZXIgPSBjcmVhdGVDbGFzcyh7CiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgICAgICAgdGhpcy4kZWwgPSAkZWw7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gMDsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZVkgPSAwOwogICAgICAgICAgICB0aGlzLmVsID0gZWw7CiAgICAgICAgICAgIHRoaXMuc3BsaXN0ID0gW107CiAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMub3ZlciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmRpc3BsYXlUb29sdGlwcyA9ICFvcHRpb25zLmdldCgnZGlzYWJsZVRvb2x0aXBzJyk7CiAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0RW5hYmxlZCA9ICFvcHRpb25zLmdldCgnZGlzYWJsZUhpZ2hsaWdodCcpOwogICAgICAgIH0sCgogICAgICAgIHJlZ2lzdGVyU3BhcmtsaW5lOiBmdW5jdGlvbiAoc3ApIHsKICAgICAgICAgICAgdGhpcy5zcGxpc3QucHVzaChzcCk7CiAgICAgICAgICAgIGlmICh0aGlzLm92ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGlzcGxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgcmVnaXN0ZXJDYW52YXM6IGZ1bmN0aW9uIChjYW52YXMpIHsKICAgICAgICAgICAgdmFyICRjYW52YXMgPSAkKGNhbnZhcy5jYW52YXMpOwogICAgICAgICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhczsKICAgICAgICAgICAgdGhpcy4kY2FudmFzID0gJGNhbnZhczsKICAgICAgICAgICAgJGNhbnZhcy5tb3VzZWVudGVyKCQucHJveHkodGhpcy5tb3VzZWVudGVyLCB0aGlzKSk7CiAgICAgICAgICAgICRjYW52YXMubW91c2VsZWF2ZSgkLnByb3h5KHRoaXMubW91c2VsZWF2ZSwgdGhpcykpOwogICAgICAgICAgICAkY2FudmFzLmNsaWNrKCQucHJveHkodGhpcy5tb3VzZWNsaWNrLCB0aGlzKSk7CiAgICAgICAgfSwKCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIChyZW1vdmVUb29sdGlwKSB7CiAgICAgICAgICAgIHRoaXMuc3BsaXN0ID0gW107CiAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXAgJiYgcmVtb3ZlVG9vbHRpcCkgewogICAgICAgICAgICAgICAgdGhpcy50b29sdGlwLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdGhpcy50b29sdGlwID0gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgbW91c2VjbGljazogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIGNsaWNrRXZlbnQgPSAkLkV2ZW50KCdzcGFya2xpbmVDbGljaycpOwogICAgICAgICAgICBjbGlja0V2ZW50Lm9yaWdpbmFsRXZlbnQgPSBlOwogICAgICAgICAgICBjbGlja0V2ZW50LnNwYXJrbGluZXMgPSB0aGlzLnNwbGlzdDsKICAgICAgICAgICAgdGhpcy4kZWwudHJpZ2dlcihjbGlja0V2ZW50KTsKICAgICAgICB9LAoKICAgICAgICBtb3VzZWVudGVyOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLnVuYmluZCgnbW91c2Vtb3ZlLmpxcycpOwogICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLmJpbmQoJ21vdXNlbW92ZS5qcXMnLCAkLnByb3h5KHRoaXMubW91c2Vtb3ZlLCB0aGlzKSk7CiAgICAgICAgICAgIHRoaXMub3ZlciA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gZS5wYWdlWDsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZVkgPSBlLnBhZ2VZOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRFbCA9IGUudGFyZ2V0OwogICAgICAgICAgICBpZiAoIXRoaXMudG9vbHRpcCAmJiB0aGlzLmRpc3BsYXlUb29sdGlwcykgewogICAgICAgICAgICAgICAgdGhpcy50b29sdGlwID0gbmV3IFRvb2x0aXAodGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC51cGRhdGVQb3NpdGlvbihlLnBhZ2VYLCBlLnBhZ2VZKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnVwZGF0ZURpc3BsYXkoKTsKICAgICAgICB9LAoKICAgICAgICBtb3VzZWxlYXZlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkudW5iaW5kKCdtb3VzZW1vdmUuanFzJyk7CiAgICAgICAgICAgIHZhciBzcGxpc3QgPSB0aGlzLnNwbGlzdCwKICAgICAgICAgICAgICAgICBzcGNvdW50ID0gc3BsaXN0Lmxlbmd0aCwKICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSBmYWxzZSwKICAgICAgICAgICAgICAgICBzcCwgaTsKICAgICAgICAgICAgdGhpcy5vdmVyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEVsID0gbnVsbDsKCiAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXApIHsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHNwID0gc3BsaXN0W2ldOwogICAgICAgICAgICAgICAgaWYgKHNwLmNsZWFyUmVnaW9uSGlnaGxpZ2h0KCkpIHsKICAgICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobmVlZHNSZWZyZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIG1vdXNlbW92ZTogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZVggPSBlLnBhZ2VYOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlWSA9IGUucGFnZVk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEVsID0gZS50YXJnZXQ7CiAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXApIHsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC51cGRhdGVQb3NpdGlvbihlLnBhZ2VYLCBlLnBhZ2VZKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnVwZGF0ZURpc3BsYXkoKTsKICAgICAgICB9LAoKICAgICAgICB1cGRhdGVEaXNwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzcGxpc3QgPSB0aGlzLnNwbGlzdCwKICAgICAgICAgICAgICAgICBzcGNvdW50ID0gc3BsaXN0Lmxlbmd0aCwKICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSBmYWxzZSwKICAgICAgICAgICAgICAgICBvZmZzZXQgPSB0aGlzLiRjYW52YXMub2Zmc2V0KCksCiAgICAgICAgICAgICAgICAgbG9jYWxYID0gTWF0aC5yb3VuZCh0aGlzLmN1cnJlbnRQYWdlWCAtIG9mZnNldC5sZWZ0KSwKICAgICAgICAgICAgICAgICBsb2NhbFkgPSBNYXRoLnJvdW5kKHRoaXMuY3VycmVudFBhZ2VZIC0gb2Zmc2V0LnRvcCksCiAgICAgICAgICAgICAgICAgdG9vbHRpcGh0bWwsIHNwLCBpLCByZXN1bHQsIGNoYW5nZUV2ZW50OwogICAgICAgICAgICAvLyBsb2NhbFgvbG9jYWxZIGZpeCBpc3N1ZSAjNTAgd2l0aCBHb29nbGUgQ2hyb21lCiAgICAgICAgICAgIC8vIGFuZCBzdWJwaXhlbCByZW5kZXJpbmcKCiAgICAgICAgICAgIGlmICghdGhpcy5vdmVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNwY291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgc3AgPSBzcGxpc3RbaV07CiAgICAgICAgICAgICAgICByZXN1bHQgPSBzcC5zZXRSZWdpb25IaWdobGlnaHQodGhpcy5jdXJyZW50RWwsIGxvY2FsWCwgbG9jYWxZKTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZWVkc1JlZnJlc2gpIHsKICAgICAgICAgICAgICAgIGNoYW5nZUV2ZW50ID0gJC5FdmVudCgnc3BhcmtsaW5lUmVnaW9uQ2hhbmdlJyk7CiAgICAgICAgICAgICAgICBjaGFuZ2VFdmVudC5zcGFya2xpbmVzID0gdGhpcy5zcGxpc3Q7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKGNoYW5nZUV2ZW50KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXApIHsKICAgICAgICAgICAgICAgICAgICB0b29sdGlwaHRtbCA9ICcnOwogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3AgPSBzcGxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXBodG1sICs9IHNwLmdldEN1cnJlbnRSZWdpb25Ub29sdGlwKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC5zZXRDb250ZW50KHRvb2x0aXBodG1sKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5kaXNhYmxlSGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhpcy5tb3VzZWxlYXZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKCgogICAgVG9vbHRpcCA9IGNyZWF0ZUNsYXNzKHsKICAgICAgICBzaXplU3R5bGU6ICdwb3NpdGlvbjogc3RhdGljICFpbXBvcnRhbnQ7JyArCiAgICAgICAgICAgICdkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OycgKwogICAgICAgICAgICAndmlzaWJpbGl0eTogaGlkZGVuICFpbXBvcnRhbnQ7JyArCiAgICAgICAgICAgICdmbG9hdDogbGVmdCAhaW1wb3J0YW50OycsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciB0b29sdGlwQ2xhc3NuYW1lID0gb3B0aW9ucy5nZXQoJ3Rvb2x0aXBDbGFzc25hbWUnLCAnanFzdG9vbHRpcCcpLAogICAgICAgICAgICAgICAgc2l6ZXRpcFN0eWxlID0gdGhpcy5zaXplU3R5bGUsCiAgICAgICAgICAgICAgICBvZmZzZXQ7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gb3B0aW9ucy5nZXQoJ3Rvb2x0aXBDb250YWluZXInKSB8fCBkb2N1bWVudC5ib2R5OwogICAgICAgICAgICB0aGlzLnRvb2x0aXBPZmZzZXRYID0gb3B0aW9ucy5nZXQoJ3Rvb2x0aXBPZmZzZXRYJywgMTApOwogICAgICAgICAgICB0aGlzLnRvb2x0aXBPZmZzZXRZID0gb3B0aW9ucy5nZXQoJ3Rvb2x0aXBPZmZzZXRZJywgMTIpOwogICAgICAgICAgICB0aGlzLmRpc3BsYXlPbkxlZnQgID0gb3B0aW9ucy5nZXQoJ3Rvb2xUaXBQb3NpdGlvbicpID09PSAnbGVmdCc7CiAgICAgICAgICAgIC8vIHJlbW92ZSBhbnkgcHJldmlvdXMgbGluZ2VyaW5nIHRvb2x0aXAKICAgICAgICAgICAgJCgnI2pxc3NpemV0aXAnKS5yZW1vdmUoKTsKICAgICAgICAgICAgJCgnI2pxc3Rvb2x0aXAnKS5yZW1vdmUoKTsKICAgICAgICAgICAgdGhpcy5zaXpldGlwID0gJCgnPGRpdi8+JywgewogICAgICAgICAgICAgICAgaWQ6ICdqcXNzaXpldGlwJywKICAgICAgICAgICAgICAgIHN0eWxlOiBzaXpldGlwU3R5bGUsCiAgICAgICAgICAgICAgICAnY2xhc3MnOiB0b29sdGlwQ2xhc3NuYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnRvb2x0aXAgPSAkKCc8ZGl2Lz4nLCB7CiAgICAgICAgICAgICAgICBpZDogJ2pxc3Rvb2x0aXAnLAogICAgICAgICAgICAgICAgJ2NsYXNzJzogdG9vbHRpcENsYXNzbmFtZQogICAgICAgICAgICB9KS5hcHBlbmRUbyh0aGlzLmNvbnRhaW5lcik7CiAgICAgICAgICAgIC8vIGFjY291bnQgZm9yIHRoZSBjb250YWluZXIncyBsb2NhdGlvbgogICAgICAgICAgICBvZmZzZXQgPSB0aGlzLnRvb2x0aXAub2Zmc2V0KCk7CiAgICAgICAgICAgIHRoaXMub2Zmc2V0TGVmdCA9IG9mZnNldC5sZWZ0OwogICAgICAgICAgICB0aGlzLm9mZnNldFRvcCA9IG9mZnNldC50b3A7CiAgICAgICAgICAgIHRoaXMuaGlkZGVuID0gdHJ1ZTsKICAgICAgICAgICAgJCh3aW5kb3cpLnVuYmluZCgncmVzaXplLmpxcyBzY3JvbGwuanFzJyk7CiAgICAgICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUuanFzIHNjcm9sbC5qcXMnLCAkLnByb3h5KHRoaXMudXBkYXRlV2luZG93RGltcywgdGhpcykpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZVdpbmRvd0RpbXMoKTsKICAgICAgICB9LAoKICAgICAgICB1cGRhdGVXaW5kb3dEaW1zOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpOwogICAgICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSAkKHdpbmRvdykuc2Nyb2xsTGVmdCgpOwogICAgICAgICAgICB0aGlzLnNjcm9sbFJpZ2h0ID0gdGhpcy5zY3JvbGxMZWZ0ICsgJCh3aW5kb3cpLndpZHRoKCk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oKTsKICAgICAgICB9LAoKICAgICAgICBnZXRTaXplOiBmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgICB0aGlzLnNpemV0aXAuaHRtbChjb250ZW50KS5hcHBlbmRUbyh0aGlzLmNvbnRhaW5lcik7CiAgICAgICAgICAgIHZhciBscGFkZGluZyA9IHBhcnNlSW50KHRoaXMuc2l6ZXRpcC5jc3MoJ3BhZGRpbmctbGVmdCcpLCAxMCk7CiAgICAgICAgICAgIHZhciBycGFkZGluZyA9IHBhcnNlSW50KHRoaXMuc2l6ZXRpcC5jc3MoJ3BhZGRpbmctcmlnaHQnKSwgMTApOwogICAgICAgICAgICB0aGlzLnBhZGRpbmcgPSBscGFkZGluZyArIHJwYWRkaW5nICsgMTsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuc2l6ZXRpcC53aWR0aCgpICsgMTsKICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnNpemV0aXAuaGVpZ2h0KCk7CiAgICAgICAgICAgIHRoaXMuc2l6ZXRpcC5yZW1vdmUoKTsKICAgICAgICB9LAoKICAgICAgICBzZXRDb250ZW50OiBmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgICBpZiAoIWNvbnRlbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICB0aGlzLmhpZGRlbiA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5nZXRTaXplKGNvbnRlbnQpOwogICAgICAgICAgICB0aGlzLnRvb2x0aXAuaHRtbChjb250ZW50KQogICAgICAgICAgICAgICAgLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogdGhpcy53aWR0aCwKICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JzogdGhpcy5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknOiAndmlzaWJsZScKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAodGhpcy5oaWRkZW4pIHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICB1cGRhdGVQb3NpdGlvbjogZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICAgICAgaWYgKHggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubW91c2V4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4ID0gdGhpcy5tb3VzZXggLSB0aGlzLm9mZnNldExlZnQ7CiAgICAgICAgICAgICAgICB5ID0gdGhpcy5tb3VzZXkgLSB0aGlzLm9mZnNldFRvcDsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vdXNleCA9IHggPSB4IC0gdGhpcy5vZmZzZXRMZWZ0OwogICAgICAgICAgICAgICAgdGhpcy5tb3VzZXkgPSB5ID0geSAtIHRoaXMub2Zmc2V0VG9wOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5oZWlnaHQgfHwgIXRoaXMud2lkdGggfHwgdGhpcy5oaWRkZW4pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgeSAtPSB0aGlzLmhlaWdodCArIHRoaXMudG9vbHRpcE9mZnNldFk7CiAgICAgICAgICAgIGlmICh5IDwgdGhpcy5zY3JvbGxUb3ApIHsKICAgICAgICAgICAgICAgIHkgPSB0aGlzLnNjcm9sbFRvcDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheU9uTGVmdCkgewogICAgICAgICAgICAgICAgeCAtPSB0aGlzLnRvb2x0aXBPZmZzZXRYICsgdGhpcy53aWR0aCArIHRoaXMucGFkZGluZzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHggKz0gdGhpcy50b29sdGlwT2Zmc2V0WDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoeCA8IHRoaXMuc2Nyb2xsTGVmdCkgewogICAgICAgICAgICAgICAgeCA9IHRoaXMuc2Nyb2xsTGVmdDsKICAgICAgICAgICAgfSBlbHNlIGlmICh4ICsgdGhpcy53aWR0aCA+IHRoaXMuc2Nyb2xsUmlnaHQpIHsKICAgICAgICAgICAgICAgIHggPSB0aGlzLnNjcm9sbFJpZ2h0IC0gdGhpcy53aWR0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy50b29sdGlwLmNzcyh7CiAgICAgICAgICAgICAgICAnbGVmdCc6IHgsCiAgICAgICAgICAgICAgICAndG9wJzogeQogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy50b29sdGlwLnJlbW92ZSgpOwogICAgICAgICAgICB0aGlzLnNpemV0aXAucmVtb3ZlKCk7CiAgICAgICAgICAgIHRoaXMuc2l6ZXRpcCA9IHRoaXMudG9vbHRpcCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgJCh3aW5kb3cpLnVuYmluZCgncmVzaXplLmpxcyBzY3JvbGwuanFzJyk7CiAgICAgICAgfQogICAgfSk7CgoKICAgIGluaXRTdHlsZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICBhZGRDU1MoZGVmYXVsdFN0eWxlcyk7CiAgICB9OwoKICAgICQoaW5pdFN0eWxlcyk7CgogICAgcGVuZGluZyA9IFtdOwogICAgJC5mbi5zcGFya2xpbmUgPSBmdW5jdGlvbiAodXNlclZhbHVlcywgdXNlck9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBuZXcgJC5mbi5zcGFya2xpbmUub3B0aW9ucyh0aGlzLCB1c2VyT3B0aW9ucyksCiAgICAgICAgICAgICAgICAgJHRoaXMgPSAkKHRoaXMpLAogICAgICAgICAgICAgICAgIHJlbmRlciwgaTsKICAgICAgICAgICAgcmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlcywgd2lkdGgsIGhlaWdodCwgdG1wLCBtaGFuZGxlciwgc3AsIHZhbHM7CiAgICAgICAgICAgICAgICBpZiAodXNlclZhbHVlcyA9PT0gJ2h0bWwnIHx8IHVzZXJWYWx1ZXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHZhbHMgPSB0aGlzLmdldEF0dHJpYnV0ZShvcHRpb25zLmdldCgndGFnVmFsdWVzQXR0cmlidXRlJykpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWxzID09PSB1bmRlZmluZWQgfHwgdmFscyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWxzID0gJHRoaXMuaHRtbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB2YWxzLnJlcGxhY2UoLyheXHMqPCEtLSl8KC0tPlxzKiQpfFxzKy9nLCAnJykuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdXNlclZhbHVlczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aWR0aCA9IG9wdGlvbnMuZ2V0KCd3aWR0aCcpID09PSAnYXV0bycgPyB2YWx1ZXMubGVuZ3RoICogb3B0aW9ucy5nZXQoJ2RlZmF1bHRQaXhlbHNQZXJWYWx1ZScpIDogb3B0aW9ucy5nZXQoJ3dpZHRoJyk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2hlaWdodCcpID09PSAnYXV0bycpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSB8fCAhJC5kYXRhKHRoaXMsICdfanFzX3ZjYW52YXMnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBtdXN0IGJlIGEgYmV0dGVyIHdheSB0byBnZXQgdGhlIGxpbmUgaGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmlubmVySFRNTCA9ICdhJzsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuaHRtbCh0bXApOwogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSAkKHRtcCkuaW5uZXJIZWlnaHQoKSB8fCAkKHRtcCkuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQodG1wKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IG9wdGlvbnMuZ2V0KCdoZWlnaHQnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuZ2V0KCdkaXNhYmxlSW50ZXJhY3Rpb24nKSkgewogICAgICAgICAgICAgICAgICAgIG1oYW5kbGVyID0gJC5kYXRhKHRoaXMsICdfanFzX21oYW5kbGVyJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFtaGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICBtaGFuZGxlciA9IG5ldyBNb3VzZUhhbmRsZXIodGhpcywgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQuZGF0YSh0aGlzLCAnX2pxc19taGFuZGxlcicsIG1oYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFvcHRpb25zLmdldCgnY29tcG9zaXRlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWhhbmRsZXIucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1oYW5kbGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSAmJiAhJC5kYXRhKHRoaXMsICdfanFzX3ZjYW52YXMnKSkgewogICAgICAgICAgICAgICAgICAgIGlmICghJC5kYXRhKHRoaXMsICdfanFzX2Vycm5vdGlmeScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdBdHRlbXB0ZWQgdG8gYXR0YWNoIGEgY29tcG9zaXRlIHNwYXJrbGluZSB0byBhbiBlbGVtZW50IHdpdGggbm8gZXhpc3Rpbmcgc3BhcmtsaW5lJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQuZGF0YSh0aGlzLCAnX2pxc19lcnJub3RpZnknLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHNwID0gbmV3ICQuZm4uc3BhcmtsaW5lW29wdGlvbnMuZ2V0KCd0eXBlJyldKHRoaXMsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICAgICAgc3AucmVuZGVyKCk7CgogICAgICAgICAgICAgICAgaWYgKG1oYW5kbGVyKSB7CiAgICAgICAgICAgICAgICAgICAgbWhhbmRsZXIucmVnaXN0ZXJTcGFya2xpbmUoc3ApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoKCQodGhpcykuaHRtbCgpICYmICFvcHRpb25zLmdldCgnZGlzYWJsZUhpZGRlbkNoZWNrJykgJiYgJCh0aGlzKS5pcygnOmhpZGRlbicpKSB8fCAhJCh0aGlzKS5wYXJlbnRzKCdib2R5JykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSAmJiAkLmRhdGEodGhpcywgJ19qcXNfcGVuZGluZycpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGFueSBleGlzdGluZyByZWZlcmVuY2VzIHRvIHRoZSBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gcGVuZGluZy5sZW5ndGg7IGk7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGVuZGluZ1tpIC0gMV1bMF0gPT0gdGhpcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZy5zcGxpY2UoaSAtIDEsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGVuZGluZy5wdXNoKFt0aGlzLCByZW5kZXJdKTsKICAgICAgICAgICAgICAgICQuZGF0YSh0aGlzLCAnX2pxc19wZW5kaW5nJywgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZW5kZXIuY2FsbCh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICAkLmZuLnNwYXJrbGluZS5kZWZhdWx0cyA9IGdldERlZmF1bHRzKCk7CgoKICAgICQuc3BhcmtsaW5lX2Rpc3BsYXlfdmlzaWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZWwsIGksIHBsOwogICAgICAgIHZhciBkb25lID0gW107CiAgICAgICAgZm9yIChpID0gMCwgcGwgPSBwZW5kaW5nLmxlbmd0aDsgaSA8IHBsOyBpKyspIHsKICAgICAgICAgICAgZWwgPSBwZW5kaW5nW2ldWzBdOwogICAgICAgICAgICBpZiAoJChlbCkuaXMoJzp2aXNpYmxlJykgJiYgISQoZWwpLnBhcmVudHMoKS5pcygnOmhpZGRlbicpKSB7CiAgICAgICAgICAgICAgICBwZW5kaW5nW2ldWzFdLmNhbGwoZWwpOwogICAgICAgICAgICAgICAgJC5kYXRhKHBlbmRpbmdbaV1bMF0sICdfanFzX3BlbmRpbmcnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBkb25lLnB1c2goaSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoISQoZWwpLmNsb3Nlc3QoJ2h0bWwnKS5sZW5ndGggJiYgISQuZGF0YShlbCwgJ19qcXNfcGVuZGluZycpKSB7CiAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGhhcyBiZWVuIGluc2VydGVkIGFuZCByZW1vdmVkIGZyb20gdGhlIERPTQogICAgICAgICAgICAgICAgLy8gSWYgaXQgd2FzIG5vdCB5ZXQgaW5zZXJ0ZWQgaW50byB0aGUgZG9tIHRoZW4gdGhlIC5kYXRhIHJlcXVlc3QKICAgICAgICAgICAgICAgIC8vIHdpbGwgcmV0dXJuIHRydWUuCiAgICAgICAgICAgICAgICAvLyByZW1vdmluZyBmcm9tIHRoZSBkb20gY2F1c2VzIHRoZSBkYXRhIHRvIGJlIHJlbW92ZWQuCiAgICAgICAgICAgICAgICAkLmRhdGEocGVuZGluZ1tpXVswXSwgJ19qcXNfcGVuZGluZycsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGRvbmUucHVzaChpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSBkb25lLmxlbmd0aDsgaTsgaS0tKSB7CiAgICAgICAgICAgIHBlbmRpbmcuc3BsaWNlKGRvbmVbaSAtIDFdLCAxKTsKICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICAqIFVzZXIgb3B0aW9uIGhhbmRsZXIKICAgICAqLwogICAgJC5mbi5zcGFya2xpbmUub3B0aW9ucyA9IGNyZWF0ZUNsYXNzKHsKICAgICAgICBpbml0OiBmdW5jdGlvbiAodGFnLCB1c2VyT3B0aW9ucykgewogICAgICAgICAgICB2YXIgZXh0ZW5kZWRPcHRpb25zLCBkZWZhdWx0cywgYmFzZSwgdGFnT3B0aW9uVHlwZTsKICAgICAgICAgICAgdGhpcy51c2VyT3B0aW9ucyA9IHVzZXJPcHRpb25zID0gdXNlck9wdGlvbnMgfHwge307CiAgICAgICAgICAgIHRoaXMudGFnID0gdGFnOwogICAgICAgICAgICB0aGlzLnRhZ1ZhbENhY2hlID0ge307CiAgICAgICAgICAgIGRlZmF1bHRzID0gJC5mbi5zcGFya2xpbmUuZGVmYXVsdHM7CiAgICAgICAgICAgIGJhc2UgPSBkZWZhdWx0cy5jb21tb247CiAgICAgICAgICAgIHRoaXMudGFnT3B0aW9uc1ByZWZpeCA9IHVzZXJPcHRpb25zLmVuYWJsZVRhZ09wdGlvbnMgJiYgKHVzZXJPcHRpb25zLnRhZ09wdGlvbnNQcmVmaXggfHwgYmFzZS50YWdPcHRpb25zUHJlZml4KTsKCiAgICAgICAgICAgIHRhZ09wdGlvblR5cGUgPSB0aGlzLmdldFRhZ1NldHRpbmcoJ3R5cGUnKTsKICAgICAgICAgICAgaWYgKHRhZ09wdGlvblR5cGUgPT09IFVOU0VUX09QVElPTikgewogICAgICAgICAgICAgICAgZXh0ZW5kZWRPcHRpb25zID0gZGVmYXVsdHNbdXNlck9wdGlvbnMudHlwZSB8fCBiYXNlLnR5cGVdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZXh0ZW5kZWRPcHRpb25zID0gZGVmYXVsdHNbdGFnT3B0aW9uVHlwZV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5tZXJnZWRPcHRpb25zID0gJC5leHRlbmQoe30sIGJhc2UsIGV4dGVuZGVkT3B0aW9ucywgdXNlck9wdGlvbnMpOwogICAgICAgIH0sCgoKICAgICAgICBnZXRUYWdTZXR0aW5nOiBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHZhciBwcmVmaXggPSB0aGlzLnRhZ09wdGlvbnNQcmVmaXgsCiAgICAgICAgICAgICAgICB2YWwsIGksIHBhaXJzLCBrZXl2YWw7CiAgICAgICAgICAgIGlmIChwcmVmaXggPT09IGZhbHNlIHx8IHByZWZpeCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVU5TRVRfT1BUSU9OOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnRhZ1ZhbENhY2hlLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMudGFnVmFsQ2FjaGUua2V5OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFsID0gdGhpcy50YWcuZ2V0QXR0cmlidXRlKHByZWZpeCArIGtleSk7CiAgICAgICAgICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQgfHwgdmFsID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gVU5TRVRfT1BUSU9OOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwuc3Vic3RyKDAsIDEpID09PSAnWycpIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwuc3Vic3RyKDEsIHZhbC5sZW5ndGggLSAyKS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IHZhbC5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsW2ldID0gbm9ybWFsaXplVmFsdWUodmFsW2ldLnJlcGxhY2UoLyheXHMqKXwoXHMqJCkvZywgJycpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbC5zdWJzdHIoMCwgMSkgPT09ICd7JykgewogICAgICAgICAgICAgICAgICAgIHBhaXJzID0gdmFsLnN1YnN0cigxLCB2YWwubGVuZ3RoIC0gMikuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgICB2YWwgPSB7fTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBwYWlycy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5dmFsID0gcGFpcnNbaV0uc3BsaXQoJzonLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsW2tleXZhbFswXS5yZXBsYWNlKC8oXlxzKil8KFxzKiQpL2csICcnKV0gPSBub3JtYWxpemVWYWx1ZShrZXl2YWxbMV0ucmVwbGFjZSgvKF5ccyopfChccyokKS9nLCAnJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gbm9ybWFsaXplVmFsdWUodmFsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudGFnVmFsQ2FjaGUua2V5ID0gdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoa2V5LCBkZWZhdWx0dmFsKSB7CiAgICAgICAgICAgIHZhciB0YWdPcHRpb24gPSB0aGlzLmdldFRhZ1NldHRpbmcoa2V5KSwKICAgICAgICAgICAgICAgIHJlc3VsdDsKICAgICAgICAgICAgaWYgKHRhZ09wdGlvbiAhPT0gVU5TRVRfT1BUSU9OKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGFnT3B0aW9uOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAocmVzdWx0ID0gdGhpcy5tZXJnZWRPcHRpb25zW2tleV0pID09PSB1bmRlZmluZWQgPyBkZWZhdWx0dmFsIDogcmVzdWx0OwogICAgICAgIH0KICAgIH0pOwoKCiAgICAkLmZuLnNwYXJrbGluZS5fYmFzZSA9IGNyZWF0ZUNsYXNzKHsKICAgICAgICBkaXNhYmxlZDogZmFsc2UsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIHRoaXMuZWwgPSBlbDsKICAgICAgICAgICAgdGhpcy4kZWwgPSAkKGVsKTsKICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFJlZ2lvbiA9IHVuZGVmaW5lZDsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBTZXR1cCB0aGUgY2FudmFzCiAgICAgICAgICovCiAgICAgICAgaW5pdFRhcmdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaW50ZXJhY3RpdmUgPSAhdGhpcy5vcHRpb25zLmdldCgnZGlzYWJsZUludGVyYWN0aW9uJyk7CiAgICAgICAgICAgIGlmICghKHRoaXMudGFyZ2V0ID0gdGhpcy4kZWwuc2ltcGxlZHJhdyh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5vcHRpb25zLmdldCgnY29tcG9zaXRlJyksIGludGVyYWN0aXZlKSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5jYW52YXNXaWR0aCA9IHRoaXMudGFyZ2V0LnBpeGVsV2lkdGg7CiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc0hlaWdodCA9IHRoaXMudGFyZ2V0LnBpeGVsSGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0dXAgY29sb3JNYXAgZnJvbSBvcHRpb25zCiAgICAgICAgICovCiAgICAgICAgaW5pdENvbG9yTWFwOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGNvbG9yTWFwID0gdGhpcy5vcHRpb25zLmdldCgnY29sb3JNYXAnKTsKICAgICAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihjb2xvck1hcCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBGdW5jdGlvbiA9IGNvbG9yTWFwOwogICAgICAgICAgICB9IGVsc2UgaWYgKCQuaXNBcnJheShjb2xvck1hcCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBGdW5jdGlvbiA9IGZ1bmN0aW9uKHNwYXJrbGluZSwgb3B0aW9ucywgaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgY29sb3JNYXAubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xvck1hcFtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIGVsc2UgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbG9yTWFwKSB7CiAgICAgICAgICAgICAgICBpZiAoY29sb3JNYXAuZ2V0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBjb2xvck1hcCA9IG5ldyBSYW5nZU1hcChjb2xvck1hcCk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5jb2xvck1hcEZ1bmN0aW9uID0gZnVuY3Rpb24oc3BhcmtsaW5lLCBvcHRpb25zLCBpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sb3JNYXAuZ2V0KHZhbHVlKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBBY3R1YWxseSByZW5kZXIgdGhlIGNoYXJ0IHRvIHRoZSBjYW52YXMKICAgICAgICAgKi8KICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgcmVnaW9uIGlkIGZvciBhIGdpdmVuIHgveSBjby1vcmRpbmF0ZQogICAgICAgICAqLwogICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBIaWdobGlnaHQgYW4gaXRlbSBiYXNlZCBvbiB0aGUgbW91c2VkLW92ZXIgeCx5IGNvLW9yZGluYXRlCiAgICAgICAgICovCiAgICAgICAgc2V0UmVnaW9uSGlnaGxpZ2h0OiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sCiAgICAgICAgICAgICAgICBoaWdobGlnaHRFbmFibGVkID0gIXRoaXMub3B0aW9ucy5nZXQoJ2Rpc2FibGVIaWdobGlnaHQnKSwKICAgICAgICAgICAgICAgIG5ld1JlZ2lvbjsKICAgICAgICAgICAgLy8gQ1VTVE9NIE1PRDogcHJvcGVyIGhvdmVyIGRldGVjdGlvbiBjb25zaWRlcmluZyBwYWRkaW5nIGFzIHdlbGwKICAgICAgICAgICAgdmFyIGNXID0gJCgnY2FudmFzJyx0aGlzLmVsKS53aWR0aCgpICsgcGFyc2VJbnQoJCgnY2FudmFzJyx0aGlzLmVsKS5jc3MoJ3BhZGRpbmctbGVmdCcpKSArIHBhcnNlSW50KCQoJ2NhbnZhcycsdGhpcy5lbCkuY3NzKCdwYWRkaW5nLXJpZ2h0JykpCiAgICAgICAgICAgIC8vIGlmICh4ID4gdGhpcy5jYW52YXNXaWR0aCB8fCB5ID4gdGhpcy5jYW52YXNIZWlnaHQgfHwgeCA8IDAgfHwgeSA8IDApIHsKICAgICAgICAgICAgaWYgKHggPiBjVyB8fCB5ID4gdGhpcy5jYW52YXNIZWlnaHQgfHwgeCA8IDAgfHwgeSA8IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5ld1JlZ2lvbiA9IHRoaXMuZ2V0UmVnaW9uKGVsLCB4LCB5KTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRSZWdpb24gIT09IG5ld1JlZ2lvbikgewogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSZWdpb24gIT09IHVuZGVmaW5lZCAmJiBoaWdobGlnaHRFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFJlZ2lvbiA9IG5ld1JlZ2lvbjsKICAgICAgICAgICAgICAgIGlmIChuZXdSZWdpb24gIT09IHVuZGVmaW5lZCAmJiBoaWdobGlnaHRFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJIaWdobGlnaHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBSZXNldCBhbnkgY3VycmVudGx5IGhpZ2hsaWdodGVkIGl0ZW0KICAgICAgICAgKi8KICAgICAgICBjbGVhclJlZ2lvbkhpZ2hsaWdodDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UmVnaW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSGlnaGxpZ2h0KCk7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRSZWdpb24gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVySGlnaGxpZ2h0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuY2hhbmdlSGlnaGxpZ2h0KHRydWUpOwogICAgICAgIH0sCgogICAgICAgIHJlbW92ZUhpZ2hsaWdodDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmNoYW5nZUhpZ2hsaWdodChmYWxzZSk7CiAgICAgICAgfSwKCiAgICAgICAgY2hhbmdlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSAge30sCgogICAgICAgIC8qKgogICAgICAgICAqIEZldGNoIHRoZSBIVE1MIHRvIGRpc3BsYXkgYXMgYSB0b29sdGlwCiAgICAgICAgICovCiAgICAgICAgZ2V0Q3VycmVudFJlZ2lvblRvb2x0aXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICBoZWFkZXIgPSAnJywKICAgICAgICAgICAgICAgIGVudHJpZXMgPSBbXSwKICAgICAgICAgICAgICAgIGZpZWxkcywgZm9ybWF0cywgZm9ybWF0bGVuLCBmY2xhc3MsIHRleHQsIGksCiAgICAgICAgICAgICAgICBzaG93RmllbGRzLCBzaG93RmllbGRzS2V5LCBuZXdGaWVsZHMsIGZ2LAogICAgICAgICAgICAgICAgZm9ybWF0dGVyLCBmb3JtYXQsIGZpZWxkbGVuLCBqLAogICAgICAgICAgICAgICAgbGFiZWxfcHJlZml4LCBsYWJlbF9zdWZmaXg7CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRSZWdpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpZWxkcyA9IHRoaXMuZ2V0Q3VycmVudFJlZ2lvbkZpZWxkcygpOwogICAgICAgICAgICBmb3JtYXR0ZXIgPSBvcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdHRlcicpOwogICAgICAgICAgICBpZiAoZm9ybWF0dGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyKHRoaXMsIG9wdGlvbnMsIGZpZWxkcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCd0b29sdGlwQ2hhcnRUaXRsZScpKSB7CiAgICAgICAgICAgICAgICBoZWFkZXIgKz0gJzxkaXYgY2xhc3M9ImpxcyBqcXN0aXRsZSI+JyArIG9wdGlvbnMuZ2V0KCd0b29sdGlwQ2hhcnRUaXRsZScpICsgJzwvZGl2PlxuJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JtYXRzID0gdGhpcy5vcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdCcpOwogICAgICAgICAgICBpZiAoIWZvcm1hdHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoISQuaXNBcnJheShmb3JtYXRzKSkgewogICAgICAgICAgICAgICAgZm9ybWF0cyA9IFtmb3JtYXRzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoISQuaXNBcnJheShmaWVsZHMpKSB7CiAgICAgICAgICAgICAgICBmaWVsZHMgPSBbZmllbGRzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaG93RmllbGRzID0gdGhpcy5vcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdEZpZWxkbGlzdCcpOwogICAgICAgICAgICBzaG93RmllbGRzS2V5ID0gdGhpcy5vcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdEZpZWxkbGlzdEtleScpOwogICAgICAgICAgICBpZiAoc2hvd0ZpZWxkcyAmJiBzaG93RmllbGRzS2V5KSB7CiAgICAgICAgICAgICAgICAvLyB1c2VyLXNlbGVjdGVkIG9yZGVyaW5nIG9mIGZpZWxkcwogICAgICAgICAgICAgICAgbmV3RmllbGRzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGkgPSBmaWVsZHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICAgICAgZnYgPSBmaWVsZHNbaV1bc2hvd0ZpZWxkc0tleV07CiAgICAgICAgICAgICAgICAgICAgaWYgKChqID0gJC5pbkFycmF5KGZ2LCBzaG93RmllbGRzKSkgIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3RmllbGRzW2pdID0gZmllbGRzW2ldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5ld0ZpZWxkczsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JtYXRsZW4gPSBmb3JtYXRzLmxlbmd0aDsKICAgICAgICAgICAgZmllbGRsZW4gPSBmaWVsZHMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZm9ybWF0bGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdHNbaV07CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZvcm1hdCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXQgPSBuZXcgU1BGb3JtYXQoZm9ybWF0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZjbGFzcyA9IGZvcm1hdC5mY2xhc3MgfHwgJ2pxc2ZpZWxkJzsKCiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgZmllbGRsZW47IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRzW2pdLmlzTnVsbCB8fCAhb3B0aW9ucy5nZXQoJ3Rvb2x0aXBTa2lwTnVsbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3ByZWZpeCA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9zdWZmaXggPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCd0b29sdGlwUHJlZml4QmluTGFiZWxzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIChvcHRpb25zLmdldCgndG9vbHRpcFByZWZpeEJpbkxhYmVscycpLmxlbmd0aCA+IGZpZWxkc1tqXS5vZmZzZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9wcmVmaXggPSBvcHRpb25zLmdldCgndG9vbHRpcFByZWZpeEJpbkxhYmVscycpW2ZpZWxkc1tqXS5vZmZzZXRdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgndG9vbHRpcFN1ZmZpeEJpbkxhYmVscycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAob3B0aW9ucy5nZXQoJ3Rvb2x0aXBTdWZmaXhCaW5MYWJlbHMnKS5sZW5ndGggPiBmaWVsZHNbal0ub2Zmc2V0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfc3VmZml4ID0gb3B0aW9ucy5nZXQoJ3Rvb2x0aXBTdWZmaXhCaW5MYWJlbHMnKVtmaWVsZHNbal0ub2Zmc2V0XTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkLmV4dGVuZChmaWVsZHNbal0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWZpeDogbGFiZWxfcHJlZml4ICsgb3B0aW9ucy5nZXQoJ3Rvb2x0aXBQcmVmaXgnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeDogb3B0aW9ucy5nZXQoJ3Rvb2x0aXBTdWZmaXgnKSArIGxhYmVsX3N1ZmZpeAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBmb3JtYXQucmVuZGVyKGZpZWxkc1tqXSwgb3B0aW9ucy5nZXQoJ3Rvb2x0aXBWYWx1ZUxvb2t1cHMnKSwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaCgnPGRpdiBjbGFzcz0iJyArIGZjbGFzcyArICciPicgKyB0ZXh0ICsgJzwvZGl2PicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW50cmllcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBoZWFkZXIgKyBlbnRyaWVzLmpvaW4oJ1xuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHt9LAoKICAgICAgICBjYWxjSGlnaGxpZ2h0Q29sb3I6IGZ1bmN0aW9uIChjb2xvciwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgaGlnaGxpZ2h0Q29sb3IgPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0Q29sb3InKSwKICAgICAgICAgICAgICAgIGxpZ2h0ZW4gPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0TGlnaHRlbicpLAogICAgICAgICAgICAgICAgcGFyc2UsIG11bHQsIHJnYm5ldywgaTsKICAgICAgICAgICAgaWYgKGhpZ2hsaWdodENvbG9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaGlnaGxpZ2h0Q29sb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpZ2h0ZW4pIHsKICAgICAgICAgICAgICAgIC8vIGV4dHJhY3QgUkdCIHZhbHVlcwogICAgICAgICAgICAgICAgcGFyc2UgPSAvXiMoWzAtOWEtZl0pKFswLTlhLWZdKShbMC05YS1mXSkkL2kuZXhlYyhjb2xvcikgfHwgL14jKFswLTlhLWZdezJ9KShbMC05YS1mXXsyfSkoWzAtOWEtZl17Mn0pJC9pLmV4ZWMoY29sb3IpOwogICAgICAgICAgICAgICAgaWYgKHBhcnNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmdibmV3ID0gW107CiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IGNvbG9yLmxlbmd0aCA9PT0gNCA/IDE2IDogMTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJnYm5ld1tpXSA9IGNsaXB2YWwoTWF0aC5yb3VuZChwYXJzZUludChwYXJzZVtpICsgMV0sIDE2KSAqIG11bHQgKiBsaWdodGVuKSwgMCwgMjU1KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyZ2IoJyArIHJnYm5ldy5qb2luKCcsJykgKyAnKSc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb2xvcjsKICAgICAgICB9CgogICAgfSk7CgogICAgYmFySGlnaGxpZ2h0TWl4aW4gPSB7CiAgICAgICAgY2hhbmdlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLAogICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGhpcy50YXJnZXQsCiAgICAgICAgICAgICAgICBzaGFwZWlkcyA9IHRoaXMucmVnaW9uU2hhcGVzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgbmV3U2hhcGVzOwogICAgICAgICAgICAvLyB3aWxsIGJlIG51bGwgaWYgdGhlIHJlZ2lvbiB2YWx1ZSB3YXMgbnVsbAogICAgICAgICAgICBpZiAoc2hhcGVpZHMgPj0gMCkgewogICAgICAgICAgICAgICAgbmV3U2hhcGVzID0gdGhpcy5yZW5kZXJSZWdpb24oY3VycmVudFJlZ2lvbiwgaGlnaGxpZ2h0KTsKICAgICAgICAgICAgICAgIGlmICgkLmlzQXJyYXkobmV3U2hhcGVzKSB8fCAkLmlzQXJyYXkoc2hhcGVpZHMpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnJlcGxhY2VXaXRoU2hhcGVzKHNoYXBlaWRzLCBuZXdTaGFwZXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaW9uU2hhcGVzW2N1cnJlbnRSZWdpb25dID0gJC5tYXAobmV3U2hhcGVzLCBmdW5jdGlvbiAobmV3U2hhcGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld1NoYXBlLmlkOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQucmVwbGFjZVdpdGhTaGFwZShzaGFwZWlkcywgbmV3U2hhcGVzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lvblNoYXBlc1tjdXJyZW50UmVnaW9uXSA9IG5ld1NoYXBlcy5pZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIHJlZ2lvblNoYXBlcyA9IHRoaXMucmVnaW9uU2hhcGVzLAogICAgICAgICAgICAgICAgc2hhcGVzLCBpZHMsIGksIGo7CgogICAgICAgICAgICBpZiAoIXRoaXMuY2xzLl9zdXBlci5yZW5kZXIuY2FsbCh0aGlzKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IHZhbHVlcy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgICAgIHNoYXBlcyA9IHRoaXMucmVuZGVyUmVnaW9uKGkpOwogICAgICAgICAgICAgICAgaWYgKHNoYXBlcykgewogICAgICAgICAgICAgICAgICAgIGlmICgkLmlzQXJyYXkoc2hhcGVzKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gc2hhcGVzLmxlbmd0aDsgai0tOykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGVzW2pdLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRzLnB1c2goc2hhcGVzW2pdLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZWdpb25TaGFwZXNbaV0gPSBpZHM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGVzLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZWdpb25TaGFwZXNbaV0gPSBzaGFwZXMuaWQ7IC8vIHN0b3JlIGp1c3QgdGhlIHNoYXBlaWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIG51bGwgdmFsdWUKICAgICAgICAgICAgICAgICAgICByZWdpb25TaGFwZXNbaV0gPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRhcmdldC5yZW5kZXIoKTsKICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICAqIExpbmUgY2hhcnRzCiAgICAgKi8KICAgICQuZm4uc3BhcmtsaW5lLmxpbmUgPSBsaW5lID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIHsKICAgICAgICB0eXBlOiAnbGluZScsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIGxpbmUuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgdGhpcy52ZXJ0aWNlcyA9IFtdOwogICAgICAgICAgICB0aGlzLnJlZ2lvbk1hcCA9IFtdOwogICAgICAgICAgICB0aGlzLnh2YWx1ZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy55dmFsdWVzID0gW107CiAgICAgICAgICAgIHRoaXMueW1pbm1heCA9IFtdOwogICAgICAgICAgICB0aGlzLmhpZ2h0bGlnaHRTcG90SWQgPSBudWxsOwogICAgICAgICAgICB0aGlzLmxhc3RTaGFwZUlkID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5pbml0VGFyZ2V0KCk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgdmFyIGksCiAgICAgICAgICAgICAgICByZWdpb25NYXAgPSB0aGlzLnJlZ2lvbk1hcDsgLy8gbWFwcyByZWdpb25zIHRvIHZhbHVlIHBvc2l0aW9ucwogICAgICAgICAgICBmb3IgKGkgPSByZWdpb25NYXAubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBpZiAocmVnaW9uTWFwW2ldICE9PSBudWxsICYmIHggKiB0aGlzLnRhcmdldC5yYXRpbyA+PSByZWdpb25NYXBbaV1bMF0gJiYgeCAqIHRoaXMudGFyZ2V0LnJhdGlvIDw9IHJlZ2lvbk1hcFtpXVsxXSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdpb25NYXBbaV1bMl07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9LAoKICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaXNOdWxsOiB0aGlzLnl2YWx1ZXNbY3VycmVudFJlZ2lvbl0gPT09IG51bGwsCiAgICAgICAgICAgICAgICB4OiB0aGlzLnh2YWx1ZXNbY3VycmVudFJlZ2lvbl0sCiAgICAgICAgICAgICAgICB5OiB0aGlzLnl2YWx1ZXNbY3VycmVudFJlZ2lvbl0sCiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5vcHRpb25zLmdldCgnbGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICBmaWxsQ29sb3I6IHRoaXMub3B0aW9ucy5nZXQoJ2ZpbGxDb2xvcicpLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBjdXJyZW50UmVnaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVySGlnaGxpZ2h0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLAogICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGhpcy50YXJnZXQsCiAgICAgICAgICAgICAgICB2ZXJ0ZXggPSB0aGlzLnZlcnRpY2VzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMgPSBvcHRpb25zLmdldCgnc3BvdFJhZGl1cycpLAogICAgICAgICAgICAgICAgaGlnaGxpZ2h0U3BvdENvbG9yID0gb3B0aW9ucy5nZXQoJ2hpZ2hsaWdodFNwb3RDb2xvcicpLAogICAgICAgICAgICAgICAgaGlnaGxpZ2h0TGluZUNvbG9yID0gb3B0aW9ucy5nZXQoJ2hpZ2hsaWdodExpbmVDb2xvcicpLAogICAgICAgICAgICAgICAgaGlnaGxpZ2h0U3BvdCwgaGlnaGxpZ2h0TGluZTsKCiAgICAgICAgICAgIGlmICghdmVydGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNwb3RSYWRpdXMgJiYgaGlnaGxpZ2h0U3BvdENvbG9yKSB7CiAgICAgICAgICAgICAgICBoaWdobGlnaHRTcG90ID0gdGFyZ2V0LmRyYXdDaXJjbGUodmVydGV4WzBdLCB2ZXJ0ZXhbMV0sCiAgICAgICAgICAgICAgICAgICAgc3BvdFJhZGl1cywgdW5kZWZpbmVkLCBoaWdobGlnaHRTcG90Q29sb3IpOwogICAgICAgICAgICAgICAgdGhpcy5oaWdobGlnaHRTcG90SWQgPSBoaWdobGlnaHRTcG90LmlkOwogICAgICAgICAgICAgICAgdGFyZ2V0Lmluc2VydEFmdGVyU2hhcGUodGhpcy5sYXN0U2hhcGVJZCwgaGlnaGxpZ2h0U3BvdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhpZ2hsaWdodExpbmVDb2xvcikgewogICAgICAgICAgICAgICAgaGlnaGxpZ2h0TGluZSA9IHRhcmdldC5kcmF3TGluZSh2ZXJ0ZXhbMF0sIHRoaXMuY2FudmFzVG9wLCB2ZXJ0ZXhbMF0sCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW52YXNUb3AgKyB0aGlzLmNhbnZhc0hlaWdodCwgaGlnaGxpZ2h0TGluZUNvbG9yKTsKICAgICAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0TGluZUlkID0gaGlnaGxpZ2h0TGluZS5pZDsKICAgICAgICAgICAgICAgIHRhcmdldC5pbnNlcnRBZnRlclNoYXBlKHRoaXMubGFzdFNoYXBlSWQsIGhpZ2hsaWdodExpbmUpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgcmVtb3ZlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldDsKICAgICAgICAgICAgaWYgKHRoaXMuaGlnaGxpZ2h0U3BvdElkKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQucmVtb3ZlU2hhcGVJZCh0aGlzLmhpZ2hsaWdodFNwb3RJZCk7CiAgICAgICAgICAgICAgICB0aGlzLmhpZ2hsaWdodFNwb3RJZCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuaGlnaGxpZ2h0TGluZUlkKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQucmVtb3ZlU2hhcGVJZCh0aGlzLmhpZ2hsaWdodExpbmVJZCk7CiAgICAgICAgICAgICAgICB0aGlzLmhpZ2hsaWdodExpbmVJZCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBzY2FuVmFsdWVzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcywKICAgICAgICAgICAgICAgIHZhbGNvdW50ID0gdmFsdWVzLmxlbmd0aCwKICAgICAgICAgICAgICAgIHh2YWx1ZXMgPSB0aGlzLnh2YWx1ZXMsCiAgICAgICAgICAgICAgICB5dmFsdWVzID0gdGhpcy55dmFsdWVzLAogICAgICAgICAgICAgICAgeW1pbm1heCA9IHRoaXMueW1pbm1heCwKICAgICAgICAgICAgICAgIGksIHZhbCwgaXNTdHIsIGlzQXJyYXksIHNwOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmFsY291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgdmFsID0gdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgaXNTdHIgPSB0eXBlb2YodmFsdWVzW2ldKSA9PT0gJ3N0cmluZyc7CiAgICAgICAgICAgICAgICBpc0FycmF5ID0gdHlwZW9mKHZhbHVlc1tpXSkgPT09ICdvYmplY3QnICYmIHZhbHVlc1tpXSBpbnN0YW5jZW9mIEFycmF5OwogICAgICAgICAgICAgICAgc3AgPSBpc1N0ciAmJiB2YWx1ZXNbaV0uc3BsaXQoJzonKTsKICAgICAgICAgICAgICAgIGlmIChpc1N0ciAmJiBzcC5sZW5ndGggPT09IDIpIHsgLy8geDp5CiAgICAgICAgICAgICAgICAgICAgeHZhbHVlcy5wdXNoKE51bWJlcihzcFswXSkpOwogICAgICAgICAgICAgICAgICAgIHl2YWx1ZXMucHVzaChOdW1iZXIoc3BbMV0pKTsKICAgICAgICAgICAgICAgICAgICB5bWlubWF4LnB1c2goTnVtYmVyKHNwWzFdKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQXJyYXkpIHsKICAgICAgICAgICAgICAgICAgICB4dmFsdWVzLnB1c2godmFsWzBdKTsKICAgICAgICAgICAgICAgICAgICB5dmFsdWVzLnB1c2godmFsWzFdKTsKICAgICAgICAgICAgICAgICAgICB5bWlubWF4LnB1c2godmFsWzFdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeHZhbHVlcy5wdXNoKGkpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPT09IG51bGwgfHwgdmFsdWVzW2ldID09PSAnbnVsbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeXZhbHVlcy5wdXNoKG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHl2YWx1ZXMucHVzaChOdW1iZXIodmFsKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHltaW5tYXgucHVzaChOdW1iZXIodmFsKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZ2V0KCd4dmFsdWVzJykpIHsKICAgICAgICAgICAgICAgIHh2YWx1ZXMgPSB0aGlzLm9wdGlvbnMuZ2V0KCd4dmFsdWVzJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubWF4eSA9IHRoaXMubWF4eW9yZyA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHltaW5tYXgpOwogICAgICAgICAgICB0aGlzLm1pbnkgPSB0aGlzLm1pbnlvcmcgPSBNYXRoLm1pbi5hcHBseShNYXRoLCB5bWlubWF4KTsKCiAgICAgICAgICAgIHRoaXMubWF4eCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHh2YWx1ZXMpOwogICAgICAgICAgICB0aGlzLm1pbnggPSBNYXRoLm1pbi5hcHBseShNYXRoLCB4dmFsdWVzKTsKCiAgICAgICAgICAgIHRoaXMueHZhbHVlcyA9IHh2YWx1ZXM7CiAgICAgICAgICAgIHRoaXMueXZhbHVlcyA9IHl2YWx1ZXM7CiAgICAgICAgICAgIHRoaXMueW1pbm1heCA9IHltaW5tYXg7CiAgICAgICAgfSwKCiAgICAgICAgcHJvY2Vzc1JhbmdlT3B0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIG5vcm1hbFJhbmdlTWluID0gb3B0aW9ucy5nZXQoJ25vcm1hbFJhbmdlTWluJyksCiAgICAgICAgICAgICAgICBub3JtYWxSYW5nZU1heCA9IG9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1heCcpOwoKICAgICAgICAgICAgaWYgKG5vcm1hbFJhbmdlTWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGlmIChub3JtYWxSYW5nZU1pbiA8IHRoaXMubWlueSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubWlueSA9IG5vcm1hbFJhbmdlTWluOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG5vcm1hbFJhbmdlTWF4ID4gdGhpcy5tYXh5KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXh5ID0gbm9ybWFsUmFuZ2VNYXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSA8IHRoaXMubWlueSkpIHsKICAgICAgICAgICAgICAgIHRoaXMubWlueSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4JykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSA+IHRoaXMubWF4eSkpIHsKICAgICAgICAgICAgICAgIHRoaXMubWF4eSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluWCcpICE9PSB1bmRlZmluZWQgJiYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlQ2xpcFgnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pblgnKSA8IHRoaXMubWlueCkpIHsKICAgICAgICAgICAgICAgIHRoaXMubWlueCA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluWCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heFgnKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXBYJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXhYJykgPiB0aGlzLm1heHgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1heHggPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heFgnKTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAoKICAgICAgICBkcmF3Tm9ybWFsUmFuZ2U6IGZ1bmN0aW9uIChjYW52YXNMZWZ0LCBjYW52YXNUb3AsIGNhbnZhc0hlaWdodCwgY2FudmFzV2lkdGgsIHJhbmdleSkgewogICAgICAgICAgICB2YXIgbm9ybWFsUmFuZ2VNaW4gPSB0aGlzLm9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1pbicpLAogICAgICAgICAgICAgICAgbm9ybWFsUmFuZ2VNYXggPSB0aGlzLm9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1heCcpLAogICAgICAgICAgICAgICAgeXRvcCA9IGNhbnZhc1RvcCArIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gKGNhbnZhc0hlaWdodCAqICgobm9ybWFsUmFuZ2VNYXggLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5yb3VuZCgoY2FudmFzSGVpZ2h0ICogKG5vcm1hbFJhbmdlTWF4IC0gbm9ybWFsUmFuZ2VNaW4pKSAvIHJhbmdleSk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0LmRyYXdSZWN0KGNhbnZhc0xlZnQsIHl0b3AsIGNhbnZhc1dpZHRoLCBoZWlnaHQsIHVuZGVmaW5lZCwgdGhpcy5vcHRpb25zLmdldCgnbm9ybWFsUmFuZ2VDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoID0gdGhpcy5jYW52YXNXaWR0aCwKICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0LAogICAgICAgICAgICAgICAgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLAogICAgICAgICAgICAgICAgc3BvdFJhZGl1cyA9IG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksCiAgICAgICAgICAgICAgICByZWdpb25NYXAgPSB0aGlzLnJlZ2lvbk1hcCwKICAgICAgICAgICAgICAgIHJhbmdleCwgcmFuZ2V5LCB5dmFsbGFzdCwKICAgICAgICAgICAgICAgIGNhbnZhc1RvcCwgY2FudmFzTGVmdCwKICAgICAgICAgICAgICAgIHZlcnRleCwgcGF0aCwgcGF0aHMsIHgsIHksIHhuZXh0LCB4cG9zLCB4cG9zbmV4dCwKICAgICAgICAgICAgICAgIGxhc3QsIG5leHQsIHl2YWxjb3VudCwgbGluZVNoYXBlcywgZmlsbFNoYXBlcywgcGxlbiwKICAgICAgICAgICAgICAgIHZhbHVlU3BvdHMsIGhsU3BvdHNFbmFibGVkLCBjb2xvciwgeHZhbHVlcywgeXZhbHVlcywgaTsKCiAgICAgICAgICAgIGlmICghbGluZS5fc3VwZXIucmVuZGVyLmNhbGwodGhpcykpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zY2FuVmFsdWVzKCk7CiAgICAgICAgICAgIHRoaXMucHJvY2Vzc1JhbmdlT3B0aW9ucygpOwoKICAgICAgICAgICAgeHZhbHVlcyA9IHRoaXMueHZhbHVlczsKICAgICAgICAgICAgeXZhbHVlcyA9IHRoaXMueXZhbHVlczsKCiAgICAgICAgICAgIGlmICghdGhpcy55bWlubWF4Lmxlbmd0aCB8fCB0aGlzLnl2YWx1ZXMubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgLy8gZW1wdHkgb3IgYWxsIG51bGwgdmFsdWVzcwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYW52YXNUb3AgPSBjYW52YXNMZWZ0ID0gMDsKCiAgICAgICAgICAgIHJhbmdleCA9IHRoaXMubWF4eCAtIHRoaXMubWlueCA9PT0gMCA/IDEgOiB0aGlzLm1heHggLSB0aGlzLm1pbng7CiAgICAgICAgICAgIHJhbmdleSA9IHRoaXMubWF4eSAtIHRoaXMubWlueSA9PT0gMCA/IDEgOiB0aGlzLm1heHkgLSB0aGlzLm1pbnk7CiAgICAgICAgICAgIHl2YWxsYXN0ID0gdGhpcy55dmFsdWVzLmxlbmd0aCAtIDE7CgogICAgICAgICAgICBpZiAoc3BvdFJhZGl1cyAmJiAoY2FudmFzV2lkdGggPCAoc3BvdFJhZGl1cyAqIDQpIHx8IGNhbnZhc0hlaWdodCA8IChzcG90UmFkaXVzICogNCkpKSB7CiAgICAgICAgICAgICAgICBzcG90UmFkaXVzID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3BvdFJhZGl1cykgewogICAgICAgICAgICAgICAgLy8gYWRqdXN0IHRoZSBjYW52YXMgc2l6ZSBhcyByZXF1aXJlZCBzbyB0aGF0IHNwb3RzIHdpbGwgZml0CiAgICAgICAgICAgICAgICBobFNwb3RzRW5hYmxlZCA9IG9wdGlvbnMuZ2V0KCdoaWdobGlnaHRTcG90Q29sb3InKSAmJiAgIW9wdGlvbnMuZ2V0KCdkaXNhYmxlSW50ZXJhY3Rpb24nKTsKICAgICAgICAgICAgICAgIGlmIChobFNwb3RzRW5hYmxlZCB8fCBvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykgfHwgKG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSAmJiB5dmFsdWVzW3l2YWxsYXN0XSA9PT0gdGhpcy5taW55KSkgewogICAgICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCAtPSBNYXRoLmNlaWwoc3BvdFJhZGl1cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaGxTcG90c0VuYWJsZWQgfHwgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpIHx8IChvcHRpb25zLmdldCgnc3BvdENvbG9yJykgJiYgeXZhbHVlc1t5dmFsbGFzdF0gPT09IHRoaXMubWF4eSkpIHsKICAgICAgICAgICAgICAgICAgICBjYW52YXNIZWlnaHQgLT0gTWF0aC5jZWlsKHNwb3RSYWRpdXMpOwogICAgICAgICAgICAgICAgICAgIGNhbnZhc1RvcCArPSBNYXRoLmNlaWwoc3BvdFJhZGl1cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaGxTcG90c0VuYWJsZWQgfHwKICAgICAgICAgICAgICAgICAgICAgKChvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykgfHwgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpKSAmJiAoeXZhbHVlc1swXSA9PT0gdGhpcy5taW55IHx8IHl2YWx1ZXNbMF0gPT09IHRoaXMubWF4eSkpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FudmFzTGVmdCArPSBNYXRoLmNlaWwoc3BvdFJhZGl1cyk7CiAgICAgICAgICAgICAgICAgICAgY2FudmFzV2lkdGggLT0gTWF0aC5jZWlsKHNwb3RSYWRpdXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhsU3BvdHNFbmFibGVkIHx8IG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSB8fAogICAgICAgICAgICAgICAgICAgIChvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykgfHwgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICh5dmFsdWVzW3l2YWxsYXN0XSA9PT0gdGhpcy5taW55IHx8IHl2YWx1ZXNbeXZhbGxhc3RdID09PSB0aGlzLm1heHkpKSkgewogICAgICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoIC09IE1hdGguY2VpbChzcG90UmFkaXVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIGNhbnZhc0hlaWdodC0tOwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1pbicpICE9PSB1bmRlZmluZWQgJiYgIW9wdGlvbnMuZ2V0KCdkcmF3Tm9ybWFsT25Ub3AnKSkgewogICAgICAgICAgICAgICAgdGhpcy5kcmF3Tm9ybWFsUmFuZ2UoY2FudmFzTGVmdCwgY2FudmFzVG9wLCBjYW52YXNIZWlnaHQsIGNhbnZhc1dpZHRoLCByYW5nZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwYXRoID0gW107CiAgICAgICAgICAgIHBhdGhzID0gW3BhdGhdOwogICAgICAgICAgICBsYXN0ID0gbmV4dCA9IG51bGw7CiAgICAgICAgICAgIHl2YWxjb3VudCA9IHl2YWx1ZXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgeXZhbGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHggPSB4dmFsdWVzW2ldOwogICAgICAgICAgICAgICAgeG5leHQgPSB4dmFsdWVzW2kgKyAxXTsKICAgICAgICAgICAgICAgIHkgPSB5dmFsdWVzW2ldOwogICAgICAgICAgICAgICAgeHBvcyA9IGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4IC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpOwogICAgICAgICAgICAgICAgeHBvc25leHQgPSBpIDwgeXZhbGNvdW50IC0gMSA/IGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4bmV4dCAtIHRoaXMubWlueCkgKiAoY2FudmFzV2lkdGggLyByYW5nZXgpKSA6IGNhbnZhc1dpZHRoOwogICAgICAgICAgICAgICAgbmV4dCA9IHhwb3MgKyAoKHhwb3NuZXh0IC0geHBvcykgLyAyKTsKICAgICAgICAgICAgICAgIHJlZ2lvbk1hcFtpXSA9IFtsYXN0IHx8IDAsIG5leHQsIGldOwogICAgICAgICAgICAgICAgbGFzdCA9IG5leHQ7CiAgICAgICAgICAgICAgICBpZiAoeSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5dmFsdWVzW2kgLSAxXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHMucHVzaChwYXRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPCB0aGlzLm1pbnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHRoaXMubWlueTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPiB0aGlzLm1heHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHRoaXMubWF4eTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXRoLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmV2aW91cyB2YWx1ZSB3YXMgbnVsbAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoLnB1c2goW3hwb3MsIGNhbnZhc1RvcCArIGNhbnZhc0hlaWdodF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXggPSBbeHBvcywgY2FudmFzVG9wICsgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSAoY2FudmFzSGVpZ2h0ICogKCh5IC0gdGhpcy5taW55KSAvIHJhbmdleSkpKV07CiAgICAgICAgICAgICAgICAgICAgcGF0aC5wdXNoKHZlcnRleCk7CiAgICAgICAgICAgICAgICAgICAgdmVydGljZXMucHVzaCh2ZXJ0ZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsaW5lU2hhcGVzID0gW107CiAgICAgICAgICAgIGZpbGxTaGFwZXMgPSBbXTsKICAgICAgICAgICAgcGxlbiA9IHBhdGhzLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBsZW47IGkrKykgewogICAgICAgICAgICAgICAgcGF0aCA9IHBhdGhzW2ldOwogICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdmaWxsQ29sb3InKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoLnB1c2goW3BhdGhbcGF0aC5sZW5ndGggLSAxXVswXSwgKGNhbnZhc1RvcCArIGNhbnZhc0hlaWdodCldKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsbFNoYXBlcy5wdXNoKHBhdGguc2xpY2UoMCkpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXRoLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIG9ubHkgYSBzaW5nbGUgcG9pbnQgaW4gdGhpcyBwYXRoLCB0aGVuIHdlIHdhbnQgdG8gZGlzcGxheSBpdAogICAgICAgICAgICAgICAgICAgIC8vIGFzIGEgdmVydGljYWwgbGluZSB3aGljaCBtZWFucyB3ZSBrZWVwIHBhdGhbMF0gIGFzIGlzCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIHdlIHdhbnQgdGhlIGZpcnN0IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhbMF0gPSBbcGF0aFswXVswXSwgcGF0aFsxXVsxXV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpbmVTaGFwZXMucHVzaChwYXRoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZHJhdyB0aGUgZmlsbCBmaXJzdCwgdGhlbiBvcHRpb25hbGx5IHRoZSBub3JtYWwgcmFuZ2UsIHRoZW4gdGhlIGxpbmUgb24gdG9wIG9mIHRoYXQKICAgICAgICAgICAgcGxlbiA9IGZpbGxTaGFwZXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd1NoYXBlKGZpbGxTaGFwZXNbaV0sCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2ZpbGxDb2xvcicpLCBvcHRpb25zLmdldCgnZmlsbENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ25vcm1hbFJhbmdlTWluJykgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmdldCgnZHJhd05vcm1hbE9uVG9wJykpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJhd05vcm1hbFJhbmdlKGNhbnZhc0xlZnQsIGNhbnZhc1RvcCwgY2FudmFzSGVpZ2h0LCBjYW52YXNXaWR0aCwgcmFuZ2V5KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGxlbiA9IGxpbmVTaGFwZXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd1NoYXBlKGxpbmVTaGFwZXNbaV0sIG9wdGlvbnMuZ2V0KCdsaW5lQ29sb3InKSwgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdsaW5lV2lkdGgnKSkuYXBwZW5kKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzcG90UmFkaXVzICYmIG9wdGlvbnMuZ2V0KCd2YWx1ZVNwb3RzJykpIHsKICAgICAgICAgICAgICAgIHZhbHVlU3BvdHMgPSBvcHRpb25zLmdldCgndmFsdWVTcG90cycpOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlU3BvdHMuZ2V0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVNwb3RzID0gbmV3IFJhbmdlTWFwKHZhbHVlU3BvdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHl2YWxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSB2YWx1ZVNwb3RzLmdldCh5dmFsdWVzW2ldKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY29sb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmRyYXdDaXJjbGUoY2FudmFzTGVmdCArIE1hdGgucm91bmQoKHh2YWx1ZXNbaV0gLSB0aGlzLm1pbngpICogKGNhbnZhc1dpZHRoIC8gcmFuZ2V4KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNUb3AgKyBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAtIChjYW52YXNIZWlnaHQgKiAoKHl2YWx1ZXNbaV0gLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvdFJhZGl1cywgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNwb3RSYWRpdXMgJiYgb3B0aW9ucy5nZXQoJ3Nwb3RDb2xvcicpICYmIHl2YWx1ZXNbeXZhbGxhc3RdICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShjYW52YXNMZWZ0ICsgTWF0aC5yb3VuZCgoeHZhbHVlc1t4dmFsdWVzLmxlbmd0aCAtIDFdIC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpLAogICAgICAgICAgICAgICAgICAgIGNhbnZhc1RvcCArIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gKGNhbnZhc0hlaWdodCAqICgoeXZhbHVlc1t5dmFsbGFzdF0gLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMsIHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnc3BvdENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLm1heHkgIT09IHRoaXMubWlueW9yZykgewogICAgICAgICAgICAgICAgaWYgKHNwb3RSYWRpdXMgJiYgb3B0aW9ucy5nZXQoJ21pblNwb3RDb2xvcicpKSB7CiAgICAgICAgICAgICAgICAgICAgeCA9IHh2YWx1ZXNbJC5pbkFycmF5KHRoaXMubWlueW9yZywgeXZhbHVlcyldOwogICAgICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3Q2lyY2xlKGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4IC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpLAogICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNUb3AgKyBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAtIChjYW52YXNIZWlnaHQgKiAoKHRoaXMubWlueW9yZyAtIHRoaXMubWlueSkgLyByYW5nZXkpKSksCiAgICAgICAgICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMsIHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ21pblNwb3RDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzcG90UmFkaXVzICYmIG9wdGlvbnMuZ2V0KCdtYXhTcG90Q29sb3InKSkgewogICAgICAgICAgICAgICAgICAgIHggPSB4dmFsdWVzWyQuaW5BcnJheSh0aGlzLm1heHlvcmcsIHl2YWx1ZXMpXTsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShjYW52YXNMZWZ0ICsgTWF0aC5yb3VuZCgoeCAtIHRoaXMubWlueCkgKiAoY2FudmFzV2lkdGggLyByYW5nZXgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzVG9wICsgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSAoY2FudmFzSGVpZ2h0ICogKCh0aGlzLm1heHlvcmcgLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgICAgICAgICBzcG90UmFkaXVzLCB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdtYXhTcG90Q29sb3InKSkuYXBwZW5kKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGV4cGxpY2l0bHkgY29tcGFyZSB0aGUgcmVmTGluZVgvWSBvcHRpb24gdmFsdWVzIHdpdGggJ251bGwnIGFzIG51bWVyaWMgemVybygwKSBzaG91bGQgcGxvdCBhIHJlZi1saW5lIGF0IHplcm8hCiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgncmVmTGluZVgnKSAhPSBudWxsKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8ganNoaW50IGlnbm9yZTpsaW5lCiAgICAgICAgICAgICAgICB5ID0gTWF0aC5yb3VuZCh0aGlzLmNhbnZhc0hlaWdodCAtIChvcHRpb25zLmdldCgncmVmTGluZVgnKSAtIHRoaXMubWlueSkgKiAodGhpcy5jYW52YXNIZWlnaHQvcmFuZ2V5KSk7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoMCwgeSwgdGhpcy5jYW52YXNXaWR0aCwgeSwgb3B0aW9ucy5nZXQoJ3JlZkxpbmVDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdyZWZMaW5lWScpICE9IG51bGwpIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmUKICAgICAgICAgICAgICAgIHggPSBNYXRoLnJvdW5kKChvcHRpb25zLmdldCgncmVmTGluZVknKSAtIHRoaXMubWlueCkgKiAodGhpcy5jYW52YXNXaWR0aC9yYW5nZXgpKTsKICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3TGluZSh4LCB0aGlzLmNhbnZhc0hlaWdodCwgeCwgMCwgb3B0aW9ucy5nZXQoJ3JlZkxpbmVDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5sYXN0U2hhcGVJZCA9IHRhcmdldC5nZXRMYXN0U2hhcGVJZCgpOwogICAgICAgICAgICB0aGlzLmNhbnZhc1RvcCA9IGNhbnZhc1RvcDsKICAgICAgICAgICAgdGFyZ2V0LnJlbmRlcigpOwogICAgICAgIH0KICAgIH0pOwoKCiAgICAvKioKICAgICAqIEJhciBjaGFydHMKICAgICAqLwogICAgJC5mbi5zcGFya2xpbmUuYmFyID0gYmFyID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIGJhckhpZ2hsaWdodE1peGluLCB7CiAgICAgICAgdHlwZTogJ2JhcicsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIHZhciBiYXJXaWR0aCA9IHBhcnNlSW50KG9wdGlvbnMuZ2V0KCdiYXJXaWR0aCcpLCAxMCksCiAgICAgICAgICAgICAgICBiYXJTcGFjaW5nID0gcGFyc2VJbnQob3B0aW9ucy5nZXQoJ2JhclNwYWNpbmcnKSwgMTApLAogICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1pbiA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJyksCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWF4ID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VDbGlwID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJyksCiAgICAgICAgICAgICAgICBzdGFja01pbiA9IEluZmluaXR5LAogICAgICAgICAgICAgICAgc3RhY2tNYXggPSAtSW5maW5pdHksCiAgICAgICAgICAgICAgICBpc1N0YWNrU3RyaW5nLCBncm91cE1pbiwgZ3JvdXBNYXgsIHN0YWNrUmFuZ2VzLCBzdGFja1Jhbmdlc05lZywgc3RhY2tUb3RhbHMsIGFjdHVhbE1pbiwgYWN0dWFsTWF4LAogICAgICAgICAgICAgICAgbnVtVmFsdWVzLCBpLCB2bGVuLCByYW5nZSwgemVyb0F4aXMsIHhheGlzT2Zmc2V0LCBtaW4sIG1heCwgY2xpcE1pbiwgY2xpcE1heCwKICAgICAgICAgICAgICAgIHN0YWNrZWQsIHZsaXN0LCBqLCBzbGVuLCBzdmFscywgdmFsLCB5b2Zmc2V0LCB5TWF4Q2FsYywgY2FudmFzSGVpZ2h0RWY7CiAgICAgICAgICAgIGJhci5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAgICAgLy8gc2NhbiB2YWx1ZXMgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdG8gc3RhY2sgYmFycwogICAgICAgICAgICBmb3IgKGkgPSAwLCB2bGVuID0gdmFsdWVzLmxlbmd0aDsgaSA8IHZsZW47IGkrKykgewogICAgICAgICAgICAgICAgdmFsID0gdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgaXNTdGFja1N0cmluZyA9IHR5cGVvZih2YWwpID09PSAnc3RyaW5nJyAmJiB2YWwuaW5kZXhPZignOicpID4gLTE7CiAgICAgICAgICAgICAgICBpZiAoaXNTdGFja1N0cmluZyB8fCAkLmlzQXJyYXkodmFsKSkgewogICAgICAgICAgICAgICAgICAgIHN0YWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1N0YWNrU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbHVlc1tpXSA9IG5vcm1hbGl6ZVZhbHVlcyh2YWwuc3BsaXQoJzonKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhbCA9IHJlbW92ZSh2YWwsIG51bGwpOyAvLyBtaW4vbWF4IHdpbGwgdHJlYXQgbnVsbCBhcyB6ZXJvCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBNaW4gPSBNYXRoLm1pbi5hcHBseShNYXRoLCB2YWwpOwogICAgICAgICAgICAgICAgICAgIGdyb3VwTWF4ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgdmFsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBNaW4gPCBzdGFja01pbikgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFja01pbiA9IGdyb3VwTWluOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBNYXggPiBzdGFja01heCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFja01heCA9IGdyb3VwTWF4OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5pbml0VGFyZ2V0KCk7CgogICAgICAgICAgICB0aGlzLnN0YWNrZWQgPSBzdGFja2VkOwogICAgICAgICAgICB0aGlzLnJlZ2lvblNoYXBlcyA9IHt9OwogICAgICAgICAgICB0aGlzLmJhcldpZHRoID0gYmFyV2lkdGggKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICB0aGlzLmJhclNwYWNpbmcgPSBiYXJTcGFjaW5nICogdGhpcy50YXJnZXQuZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICAgICAgdGhpcy50b3RhbEJhcldpZHRoID0gKGJhcldpZHRoICsgYmFyU3BhY2luZykgKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICB2YXIgcmF3V2lkdGggPSAodmFsdWVzLmxlbmd0aCAqIGJhcldpZHRoICogdGhpcy50YXJnZXQuZGV2aWNlUGl4ZWxSYXRpbykgKyAoKHZhbHVlcy5sZW5ndGggLSAxKSAqIGJhclNwYWNpbmcgKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvKTsKICAgICAgICAgICAgdGhpcy54U2NhbGUgPSBNYXRoLm1pbigxLCByYXdXaWR0aCA/IHdpZHRoICogdGhpcy50YXJnZXQuZGV2aWNlUGl4ZWxSYXRpbyAvIHJhd1dpZHRoIDogMSk7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSByYXdXaWR0aCAqIHRoaXMueFNjYWxlOwoKICAgICAgICAgICAgaWYgKGNoYXJ0UmFuZ2VDbGlwKSB7CiAgICAgICAgICAgICAgICBjbGlwTWluID0gY2hhcnRSYW5nZU1pbiA9PT0gdW5kZWZpbmVkID8gLUluZmluaXR5IDogY2hhcnRSYW5nZU1pbjsKICAgICAgICAgICAgICAgIGNsaXBNYXggPSBjaGFydFJhbmdlTWF4ID09PSB1bmRlZmluZWQgPyBJbmZpbml0eSA6IGNoYXJ0UmFuZ2VNYXg7CiAgICAgICAgICAgIH0KCQkJaWYgKHN0YWNrZWQpIHsKCQkJCWFjdHVhbE1pbiA9IGNoYXJ0UmFuZ2VNaW4gPT09IHVuZGVmaW5lZCA/IHN0YWNrTWluIDogTWF0aC5taW4oc3RhY2tNaW4sIGNoYXJ0UmFuZ2VNaW4pOwoJCQkJYWN0dWFsTWF4ID0gY2hhcnRSYW5nZU1heCA9PT0gdW5kZWZpbmVkID8gc3RhY2tNYXggOiBNYXRoLm1heChzdGFja01heCwgY2hhcnRSYW5nZU1heCk7CgkJCX0KCiAgICAgICAgICAgIG51bVZhbHVlcyA9IFtdOwogICAgICAgICAgICBzdGFja1JhbmdlcyA9IHN0YWNrZWQgPyBbXSA6IG51bVZhbHVlczsKICAgICAgICAgICAgc3RhY2tUb3RhbHMgPSBbXTsKICAgICAgICAgICAgc3RhY2tSYW5nZXNOZWcgPSBbXTsKICAgICAgICAgICAgZm9yIChpID0gMCwgdmxlbiA9IHZhbHVlcy5sZW5ndGg7IGkgPCB2bGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChzdGFja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgdmxpc3QgPSB2YWx1ZXNbaV07CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2ldID0gc3ZhbHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBzdGFja1RvdGFsc1tpXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgc3RhY2tSYW5nZXNbaV0gPSBzdGFja1Jhbmdlc05lZ1tpXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMCwgc2xlbiA9IHZsaXN0Lmxlbmd0aDsgaiA8IHNsZW47IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBzdmFsc1tqXSA9IGNoYXJ0UmFuZ2VDbGlwID8gY2xpcHZhbCh2bGlzdFtqXSwgY2xpcE1pbiwgY2xpcE1heCkgOiB2bGlzdFtqXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja1RvdGFsc1tpXSArPSB2YWw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2tNaW4gPCAwICYmIHN0YWNrTWF4ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrUmFuZ2VzTmVnW2ldICs9IE1hdGguYWJzKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tSYW5nZXNbaV0gKz0gdmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tSYW5nZXNbaV0gKz0gTWF0aC5hYnModmFsIC0gKHZhbCA8IDAgPyBhY3R1YWxNYXggOiBhY3R1YWxNaW4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVZhbHVlcy5wdXNoKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhbCA9IGNoYXJ0UmFuZ2VDbGlwID8gY2xpcHZhbCh2YWx1ZXNbaV0sIGNsaXBNaW4sIGNsaXBNYXgpIDogdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbHVlc1tpXSA9IG5vcm1hbGl6ZVZhbHVlKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBudW1WYWx1ZXMucHVzaCh2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1heCA9IG1heCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIG51bVZhbHVlcyk7CiAgICAgICAgICAgIHRoaXMubWluID0gbWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgbnVtVmFsdWVzKTsKICAgICAgICAgICAgdGhpcy5zdGFja01heCA9IHN0YWNrTWF4ID0gc3RhY2tlZCA/IE1hdGgubWF4LmFwcGx5KE1hdGgsIHN0YWNrVG90YWxzKSA6IG1heDsKICAgICAgICAgICAgdGhpcy5zdGFja01pbiA9IHN0YWNrTWluID0gc3RhY2tlZCA/IE1hdGgubWluLmFwcGx5KE1hdGgsIG51bVZhbHVlcykgOiBtaW47CgogICAgICAgICAgICBpZiAoY2hhcnRSYW5nZU1pbiAhPT0gdW5kZWZpbmVkICYmIChjaGFydFJhbmdlQ2xpcCB8fCBjaGFydFJhbmdlTWluIDwgbWluKSkgewogICAgICAgICAgICAgICAgbWluID0gY2hhcnRSYW5nZU1pbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2hhcnRSYW5nZU1heCAhPT0gdW5kZWZpbmVkICYmIChjaGFydFJhbmdlQ2xpcCB8fCBjaGFydFJhbmdlTWF4ID4gbWF4KSkgewogICAgICAgICAgICAgICAgbWF4ID0gY2hhcnRSYW5nZU1heDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy56ZXJvQXhpcyA9IHplcm9BeGlzID0gb3B0aW9ucy5nZXQoJ3plcm9BeGlzJywgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChtaW4gPD0gMCAmJiBtYXggPj0gMCAmJiB6ZXJvQXhpcykgewogICAgICAgICAgICAgICAgeGF4aXNPZmZzZXQgPSAwOwogICAgICAgICAgICB9IGVsc2UgaWYgKHplcm9BeGlzID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgeGF4aXNPZmZzZXQgPSBtaW47CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWluID4gMCkgewogICAgICAgICAgICAgICAgeGF4aXNPZmZzZXQgPSBtaW47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB4YXhpc09mZnNldCA9IG1heDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnhheGlzT2Zmc2V0ID0geGF4aXNPZmZzZXQ7CgogICAgICAgICAgICByYW5nZSA9IHN0YWNrZWQgPyAoTWF0aC5tYXguYXBwbHkoTWF0aCwgc3RhY2tSYW5nZXMpICsgTWF0aC5tYXguYXBwbHkoTWF0aCwgc3RhY2tSYW5nZXNOZWcpKSA6IG1heCAtIG1pbjsKCiAgICAgICAgICAgIC8vIGFzIHdlIHBsb3QgemVyby9taW4gdmFsdWVzIGEgc2luZ2xlIHBpeGVsIGxpbmUsIHdlIGFkZCBhIHBpeGVsIHRvIGFsbCBvdGhlcgogICAgICAgICAgICAvLyB2YWx1ZXMgLSBSZWR1Y2UgdGhlIGVmZmVjdGl2ZSBjYW52YXMgc2l6ZSB0byBzdWl0CiAgICAgICAgICAgIHRoaXMuY2FudmFzSGVpZ2h0RWYgPSAoemVyb0F4aXMgJiYgbWluIDwgMCkgPyB0aGlzLmNhbnZhc0hlaWdodCAtIDIgOiB0aGlzLmNhbnZhc0hlaWdodCAtIDE7CgogICAgICAgICAgICBpZiAobWluIDwgeGF4aXNPZmZzZXQpIHsKICAgICAgICAgICAgICAgIHlNYXhDYWxjID0gKHN0YWNrZWQgJiYgbWF4ID49IDApID8gc3RhY2tNYXggOiBtYXg7CiAgICAgICAgICAgICAgICB5b2Zmc2V0ID0gKHlNYXhDYWxjIC0geGF4aXNPZmZzZXQpIC8gcmFuZ2UgKiB0aGlzLmNhbnZhc0hlaWdodDsKICAgICAgICAgICAgICAgIGlmICh5b2Zmc2V0ICE9PSBNYXRoLmNlaWwoeW9mZnNldCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc0hlaWdodEVmIC09IDI7CiAgICAgICAgICAgICAgICAgICAgeW9mZnNldCA9IE1hdGguY2VpbCh5b2Zmc2V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHlvZmZzZXQgPSB0aGlzLmNhbnZhc0hlaWdodDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnlvZmZzZXQgPSB5b2Zmc2V0OwoKICAgICAgICAgICAgdGhpcy5pbml0Q29sb3JNYXAoKTsKICAgICAgICAgICAgdGhpcy5yYW5nZSA9IHJhbmdlOwogICAgICAgIH0sCgogICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIHggLz0gdGhpcy54U2NhbGU7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBNYXRoLmZsb29yKHggKiB0aGlzLnRhcmdldC5yYXRpbyAvIHRoaXMudG90YWxCYXJXaWR0aCk7CiAgICAgICAgICAgIHJldHVybiAocmVzdWx0IDwgMCB8fCByZXN1bHQgPj0gdGhpcy52YWx1ZXMubGVuZ3RoKSA/IHVuZGVmaW5lZCA6IHJlc3VsdDsKICAgICAgICB9LAoKICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLAogICAgICAgICAgICAgICAgdmFsdWVzID0gZW5zdXJlQXJyYXkodGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0pLAogICAgICAgICAgICAgICAgcmVzdWx0ID0gW10sCiAgICAgICAgICAgICAgICB2YWx1ZSwgaTsKICAgICAgICAgICAgZm9yIChpID0gdmFsdWVzLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZXNbaV07CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgaXNOdWxsOiB2YWx1ZSA9PT0gbnVsbCwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoaXMuY2FsY0NvbG9yKGksIHZhbHVlLCBjdXJyZW50UmVnaW9uKSwKICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IGN1cnJlbnRSZWdpb24KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKCiAgICAgICAgY2FsY0NvbG9yOiBmdW5jdGlvbiAoc3RhY2tudW0sIHZhbHVlLCB2YWx1ZW51bSkgewogICAgICAgICAgICB2YXIgY29sb3JNYXBGdW5jdGlvbiA9IHRoaXMuY29sb3JNYXBGdW5jdGlvbiwKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICBjb2xvciwgbmV3Q29sb3I7CgogICAgICAgICAgICBpZiAoY29sb3JNYXBGdW5jdGlvbiAmJiAobmV3Q29sb3IgPSBjb2xvck1hcEZ1bmN0aW9uKHRoaXMsIG9wdGlvbnMsIHZhbHVlbnVtLCB2YWx1ZSkpKSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IG5ld0NvbG9yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2tlZCkgewogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3N0YWNrZWRCYXJDb2xvcicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICh2YWx1ZSA8IDApID8gb3B0aW9ucy5nZXQoJ25lZ0JhckNvbG9yJykgOiBvcHRpb25zLmdldCgnYmFyQ29sb3InKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gMCAmJiBvcHRpb25zLmdldCgnemVyb0NvbG9yJykgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3plcm9Db2xvcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkLmlzQXJyYXkoY29sb3IpID8gY29sb3Jbc3RhY2tudW0gJSBjb2xvci5sZW5ndGhdIDogY29sb3I7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmVuZGVyIGJhcihzKSBmb3IgYSByZWdpb24KICAgICAgICAgKi8KICAgICAgICByZW5kZXJSZWdpb246IGZ1bmN0aW9uICh2YWx1ZW51bSwgaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciB2YWxzID0gdGhpcy52YWx1ZXNbdmFsdWVudW1dLAogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIHhheGlzT2Zmc2V0ID0gdGhpcy54YXhpc09mZnNldCwKICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtdLAogICAgICAgICAgICAgICAgcmFuZ2UgPSB0aGlzLnJhbmdlLAogICAgICAgICAgICAgICAgc3RhY2tlZCA9IHRoaXMuc3RhY2tlZCwKICAgICAgICAgICAgICAgIHRhcmdldCA9IHRoaXMudGFyZ2V0LAogICAgICAgICAgICAgICAgeCA9IHZhbHVlbnVtICogdGhpcy50b3RhbEJhcldpZHRoLAogICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0RWYgPSB0aGlzLmNhbnZhc0hlaWdodEVmLAogICAgICAgICAgICAgICAgeW9mZnNldCA9IHRoaXMueW9mZnNldCwKICAgICAgICAgICAgICAgIHksIGhlaWdodCwgY29sb3IsIGlzTnVsbCwgeW9mZnNldE5lZywgaSwgdmFsY291bnQsIHZhbCwgbWluUGxvdHRlZCwgYWxsTWluOwoKICAgICAgICAgICAgdmFscyA9ICQuaXNBcnJheSh2YWxzKSA/IHZhbHMgOiBbdmFsc107CiAgICAgICAgICAgIHZhbGNvdW50ID0gdmFscy5sZW5ndGg7CiAgICAgICAgICAgIHZhbCA9IHZhbHNbMF07CiAgICAgICAgICAgIGlzTnVsbCA9IGFsbChudWxsLCB2YWxzKTsKICAgICAgICAgICAgYWxsTWluID0gYWxsKHhheGlzT2Zmc2V0LCB2YWxzLCB0cnVlKTsKCiAgICAgICAgICAgIGlmIChpc051bGwpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnbnVsbENvbG9yJykpIHsKICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGhpZ2hsaWdodCA/IG9wdGlvbnMuZ2V0KCdudWxsQ29sb3InKSA6IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKG9wdGlvbnMuZ2V0KCdudWxsQ29sb3InKSwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgeSA9ICh5b2Zmc2V0ID4gMCkgPyB5b2Zmc2V0IC0gMSA6IHlvZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5kcmF3UmVjdCh4LCB5LCB0aGlzLmJhcldpZHRoIC0gMSwgMCwgY29sb3IsIGNvbG9yKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB5b2Zmc2V0TmVnID0geW9mZnNldDsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHZhbGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHZhbCA9IHZhbHNbaV07CgogICAgICAgICAgICAgICAgaWYgKHN0YWNrZWQgJiYgdmFsID09PSB4YXhpc09mZnNldCkgewogICAgICAgICAgICAgICAgICAgIGlmICghYWxsTWluIHx8IG1pblBsb3R0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1pblBsb3R0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyYW5nZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLmZsb29yKGNhbnZhc0hlaWdodEVmICogKChNYXRoLmFicyh2YWwgLSB4YXhpc09mZnNldCkgLyByYW5nZSkpKSArIDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsIDwgeGF4aXNPZmZzZXQgfHwgKHZhbCA9PT0geGF4aXNPZmZzZXQgJiYgeW9mZnNldCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgICAgICB5ID0geW9mZnNldE5lZzsKICAgICAgICAgICAgICAgICAgICB5b2Zmc2V0TmVnICs9IGhlaWdodDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IHlvZmZzZXQgLSBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgeW9mZnNldCAtPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0NvbG9yKGksIHZhbCwgdmFsdWVudW0pOwogICAgICAgICAgICAgICAgaWYgKGhpZ2hsaWdodCkgewogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5jYWxjSGlnaGxpZ2h0Q29sb3IoY29sb3IsIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGFyZ2V0LmRyYXdSZWN0KHggKiB0aGlzLnhTY2FsZSwgeSwgKHRoaXMuYmFyV2lkdGggLSAxKSAqIHRoaXMueFNjYWxlLCBoZWlnaHQgLSAxLCBjb2xvciwgY29sb3IpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFswXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0pOwoKCiAgICAvKioKICAgICAqIFN0YWNrIGNoYXJ0cwogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS5zdGFjayA9IHN0YWNrID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIHsKICAgICAgICB0eXBlOiAnc3RhY2snLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICB2YXIgdG90YWwgPSAwLCBpOwoKICAgICAgICAgICAgc3RhY2suX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgICAgIHRoaXMuc2hhcGVzID0ge307IC8vIG1hcCBzaGFwZSBpZHMgdG8gdmFsdWUgb2Zmc2V0cwogICAgICAgICAgICB0aGlzLnZhbHVlU2hhcGVzID0ge307IC8vIG1hcHMgdmFsdWUgb2Zmc2V0cyB0byBzaGFwZSBpZHMKICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMgPSAkLm1hcCh2YWx1ZXMsIE51bWJlcik7CgogICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTsKCiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnd2lkdGgnKSA9PT0gJ2F1dG8nKSB7CiAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5oZWlnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZm9yIChpID0gdmFsdWVzLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IHZhbHVlc1tpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnRvdGFsID0gdG90YWw7CgogICAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0ICogdGhpcy50YXJnZXQuZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuY2FudmFzV2lkdGggKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgIH0sCgogICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIHZhciBzaGFwZWlkID0gdGhpcy50YXJnZXQuZ2V0U2hhcGVBdChlbCwgeCAqIHRoaXMudGFyZ2V0LnJhdGlvLCB5ICogdGhpcy50YXJnZXQucmF0aW8pOwogICAgICAgICAgICByZXR1cm4gKHNoYXBlaWQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnNoYXBlc1tzaGFwZWlkXSAhPT0gdW5kZWZpbmVkKSA/IHRoaXMuc2hhcGVzW3NoYXBlaWRdIDogdW5kZWZpbmVkOwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb247CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpc051bGw6IHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dID09PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0sCiAgICAgICAgICAgICAgICBwZXJjZW50OiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSAvIHRoaXMudG90YWwgKiAxMDAsCiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5vcHRpb25zLmdldCgnc2xpY2VDb2xvcnMnKVtjdXJyZW50UmVnaW9uICUgdGhpcy5vcHRpb25zLmdldCgnc2xpY2VDb2xvcnMnKS5sZW5ndGhdLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBjdXJyZW50UmVnaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgY2hhbmdlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLAogICAgICAgICAgICAgICAgIG5ld3NsaWNlID0gdGhpcy5yZW5kZXJTbGljZShjdXJyZW50UmVnaW9uLCBoaWdobGlnaHQpLAogICAgICAgICAgICAgICAgIHNoYXBlaWQgPSB0aGlzLnZhbHVlU2hhcGVzW2N1cnJlbnRSZWdpb25dOwogICAgICAgICAgICBkZWxldGUgdGhpcy5zaGFwZXNbc2hhcGVpZF07CiAgICAgICAgICAgIHRoaXMudGFyZ2V0LnJlcGxhY2VXaXRoU2hhcGUoc2hhcGVpZCwgbmV3c2xpY2UpOwogICAgICAgICAgICB0aGlzLnZhbHVlU2hhcGVzW2N1cnJlbnRSZWdpb25dID0gbmV3c2xpY2UuaWQ7CiAgICAgICAgICAgIHRoaXMuc2hhcGVzW25ld3NsaWNlLmlkXSA9IGN1cnJlbnRSZWdpb247CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyU2xpY2U6IGZ1bmN0aW9uICh2YWx1ZW51bSwgaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodCwKICAgICAgICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aCwKICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMudmFsdWVzLAogICAgICAgICAgICAgICAgdG90YWwgPSB0aGlzLnRvdGFsLAogICAgICAgICAgICAgICAgc3RhcnQgPSAwLAogICAgICAgICAgICAgICAgZW5kID0gMCwKICAgICAgICAgICAgICAgIGksIHZsZW4sIGNvbG9yOwoKICAgICAgICAgICAgdmxlbiA9IHZhbHVlcy5sZW5ndGg7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2bGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHN0YXJ0ID0gZW5kOwogICAgICAgICAgICAgICAgdmFyIHNsaWNlV2lkdGggPSBNYXRoLnJvdW5kKHZhbHVlc1tpXSAqIHdpZHRoIC8gdG90YWwpOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlbnVtID09PSBpKSB7CiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBvcHRpb25zLmdldCgnc2xpY2VDb2xvcnMnKVtpICUgb3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJykubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5jYWxjSGlnaGxpZ2h0Q29sb3IoY29sb3IsIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmRyYXdSZWN0KHN0YXJ0LCAwLCBzbGljZVdpZHRoLCBoZWlnaHQsIHVuZGVmaW5lZCwgY29sb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZW5kICs9IHNsaWNlV2lkdGg7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMudGFyZ2V0LAogICAgICAgICAgICAgICAgdmFsdWVzID0gdGhpcy52YWx1ZXMsCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgYm9yZGVyV2lkdGggPSBvcHRpb25zLmdldCgnYm9yZGVyV2lkdGgnKSwKICAgICAgICAgICAgICAgIHNoYXBlLCBpOwoKICAgICAgICAgICAgaWYgKCFzdGFjay5fc3VwZXIucmVuZGVyLmNhbGwodGhpcykpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2ldKSB7IC8vIGRvbid0IHJlbmRlciB6ZXJvIHZhbHVlcwogICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJTbGljZShpKS5hcHBlbmQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlU2hhcGVzW2ldID0gc2hhcGUuaWQ7IC8vIHN0b3JlIGp1c3QgdGhlIHNoYXBlaWQKICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRhcmdldC5yZW5kZXIoKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvKioKICAgICAqIFRyaXN0YXRlIGNoYXJ0cwogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS50cmlzdGF0ZSA9IHRyaXN0YXRlID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIGJhckhpZ2hsaWdodE1peGluLCB7CiAgICAgICAgdHlwZTogJ3RyaXN0YXRlJywKCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgdmFyIGJhcldpZHRoID0gcGFyc2VJbnQob3B0aW9ucy5nZXQoJ2JhcldpZHRoJyksIDEwKSwKICAgICAgICAgICAgICAgIGJhclNwYWNpbmcgPSBwYXJzZUludChvcHRpb25zLmdldCgnYmFyU3BhY2luZycpLCAxMCk7CiAgICAgICAgICAgIHRyaXN0YXRlLl9zdXBlci5pbml0LmNhbGwodGhpcywgZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTsKCiAgICAgICAgICAgIHRoaXMucmVnaW9uU2hhcGVzID0ge307CiAgICAgICAgICAgIHRoaXMuYmFyV2lkdGggPSBiYXJXaWR0aCAqIHRoaXMudGFyZ2V0LmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgICAgIHRoaXMuYmFyU3BhY2luZyA9IGJhclNwYWNpbmcgKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICB0aGlzLnRvdGFsQmFyV2lkdGggPSAoYmFyV2lkdGggKyBiYXJTcGFjaW5nKSAqIHRoaXMudGFyZ2V0LmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gJC5tYXAodmFsdWVzLCBOdW1iZXIpOwogICAgICAgICAgICB2YXIgcmF3V2lkdGggPSAodmFsdWVzLmxlbmd0aCAqIGJhcldpZHRoICogdGhpcy50YXJnZXQuZGV2aWNlUGl4ZWxSYXRpbykgKyAoKHZhbHVlcy5sZW5ndGggLSAxKSAqIGJhclNwYWNpbmcgKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvKTsKICAgICAgICAgICAgdGhpcy54U2NhbGUgPSBNYXRoLm1pbigxLCByYXdXaWR0aCA/IHdpZHRoICogdGhpcy50YXJnZXQuZGV2aWNlUGl4ZWxSYXRpbyAvIHJhd1dpZHRoIDogMSk7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSByYXdXaWR0aCAqIHRoaXMueFNjYWxlOyAKCiAgICAgICAgICAgIHRoaXMuaW5pdENvbG9yTWFwKCk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgeCAvPSB0aGlzLnhTY2FsZTsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IE1hdGguZmxvb3IoeCAqIHRoaXMudGFyZ2V0LnJhdGlvIC8gdGhpcy50b3RhbEJhcldpZHRoKTsKICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgPCAwIHx8IHJlc3VsdCA+PSB0aGlzLnZhbHVlcy5sZW5ndGgpID8gdW5kZWZpbmVkIDogcmVzdWx0OwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb247CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpc051bGw6IHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dID09PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0sCiAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5jYWxjQ29sb3IodGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0sIGN1cnJlbnRSZWdpb24pLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBjdXJyZW50UmVnaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgY2FsY0NvbG9yOiBmdW5jdGlvbiAodmFsdWUsIHZhbHVlbnVtKSB7CiAgICAgICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgY29sb3JNYXBGdW5jdGlvbiA9IHRoaXMuY29sb3JNYXBGdW5jdGlvbiwKICAgICAgICAgICAgICAgIGNvbG9yLCBuZXdDb2xvcjsKCiAgICAgICAgICAgIGlmIChjb2xvck1hcEZ1bmN0aW9uICYmIChuZXdDb2xvciA9IGNvbG9yTWFwRnVuY3Rpb24odGhpcywgb3B0aW9ucywgdmFsdWVudW0sIHZhbHVlKSkpIHsKICAgICAgICAgICAgICAgIGNvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPCAwKSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IG9wdGlvbnMuZ2V0KCduZWdCYXJDb2xvcicpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID4gMCkgewogICAgICAgICAgICAgICAgY29sb3IgPSBvcHRpb25zLmdldCgncG9zQmFyQ29sb3InKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3plcm9CYXJDb2xvcicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb2xvcjsKICAgICAgICB9LAoKICAgICAgICByZW5kZXJSZWdpb246IGZ1bmN0aW9uICh2YWx1ZW51bSwgaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcywKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCwgaGVpZ2h0LCBoYWxmSGVpZ2h0LAogICAgICAgICAgICAgICAgeCwgeSwgY29sb3I7CgogICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0YXJnZXQucGl4ZWxIZWlnaHQ7CiAgICAgICAgICAgIGhhbGZIZWlnaHQgPSBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDIpOwoKICAgICAgICAgICAgeCA9IHZhbHVlbnVtICogdGhpcy50b3RhbEJhcldpZHRoOwogICAgICAgICAgICBpZiAodmFsdWVzW3ZhbHVlbnVtXSA8IDApIHsKICAgICAgICAgICAgICAgIHkgPSBoYWxmSGVpZ2h0OwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGFsZkhlaWdodCAtIDE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWVzW3ZhbHVlbnVtXSA+IDApIHsKICAgICAgICAgICAgICAgIHkgPSAwOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGFsZkhlaWdodCAtIDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB5ID0gaGFsZkhlaWdodCAtIDE7CiAgICAgICAgICAgICAgICBoZWlnaHQgPSAyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbG9yID0gdGhpcy5jYWxjQ29sb3IodmFsdWVzW3ZhbHVlbnVtXSwgdmFsdWVudW0pOwogICAgICAgICAgICBpZiAoY29sb3IgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmRyYXdSZWN0KHggKiB0aGlzLnhTY2FsZSwgeSwgKHRoaXMuYmFyV2lkdGggLSAxKSAqIHRoaXMueFNjYWxlLCBoZWlnaHQgLSAxLCBjb2xvciwgY29sb3IpOwogICAgICAgIH0KICAgIH0pOwoKCiAgICAvKioKICAgICAqIERpc2NyZXRlIGNoYXJ0cwogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS5kaXNjcmV0ZSA9IGRpc2NyZXRlID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIGJhckhpZ2hsaWdodE1peGluLCB7CiAgICAgICAgdHlwZTogJ2Rpc2NyZXRlJywKCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgZGlzY3JldGUuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpOwoKICAgICAgICAgICAgdGhpcy5yZWdpb25TaGFwZXMgPSB7fTsKICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMgPSAkLm1hcCh2YWx1ZXMsIE51bWJlcik7CiAgICAgICAgICAgIHRoaXMubWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgdmFsdWVzKTsKICAgICAgICAgICAgdGhpcy5tYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCB2YWx1ZXMpOwogICAgICAgICAgICB0aGlzLnJhbmdlID0gdGhpcy5tYXggLSB0aGlzLm1pbjsKICAgICAgICAgICAgd2lkdGggPSBvcHRpb25zLmdldCgnd2lkdGgnKSA9PT0gJ2F1dG8nID8gdmFsdWVzLmxlbmd0aCAqIDIgKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvIDogdGhpcy53aWR0aDsKICAgICAgICAgICAgLy9hZGp1c3Qgd2lkdGggZm9yIHBpeGVsIHJhdGlvCiAgICAgICAgICAgIHdpZHRoID0gd2lkdGggKiB0aGlzLnRhcmdldC5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHdpZHRoIC8gdmFsdWVzLmxlbmd0aCk7CiAgICAgICAgICAgIHRoaXMuaXRlbVdpZHRoID0gd2lkdGggLyB2YWx1ZXMubGVuZ3RoOwogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXAnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpIDwgdGhpcy5taW4pKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1pbiA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4JykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSA+IHRoaXMubWF4KSkgewogICAgICAgICAgICAgICAgdGhpcy5tYXggPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy50YXJnZXQpIHsKICAgICAgICAgICAgICAgIHRoaXMubGluZUhlaWdodCA9IG9wdGlvbnMuZ2V0KCdsaW5lSGVpZ2h0JykgPT09ICdhdXRvJyA/IE1hdGgucm91bmQodGhpcy5jYW52YXNIZWlnaHQgKiAwLjMpIDogb3B0aW9ucy5nZXQoJ2xpbmVIZWlnaHQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHggKiB0aGlzLnRhcmdldC5yYXRpbyAvIHRoaXMuaXRlbVdpZHRoKTsKICAgICAgICB9LAoKICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaXNOdWxsOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBjdXJyZW50UmVnaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyUmVnaW9uOiBmdW5jdGlvbiAodmFsdWVudW0sIGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgbWluID0gdGhpcy5taW4sCiAgICAgICAgICAgICAgICBtYXggPSB0aGlzLm1heCwKICAgICAgICAgICAgICAgIHJhbmdlID0gdGhpcy5yYW5nZSwKICAgICAgICAgICAgICAgIGludGVydmFsID0gdGhpcy5pbnRlcnZhbCwKICAgICAgICAgICAgICAgIHRhcmdldCA9IHRoaXMudGFyZ2V0LAogICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0ID0gdGhpcy5jYW52YXNIZWlnaHQsCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gdGhpcy5saW5lSGVpZ2h0LAogICAgICAgICAgICAgICAgcGhlaWdodCA9IGNhbnZhc0hlaWdodCAtIGxpbmVIZWlnaHQsCiAgICAgICAgICAgICAgICB5dG9wLCB2YWwsIGNvbG9yLCB4OwoKICAgICAgICAgICAgdmFsID0gY2xpcHZhbCh2YWx1ZXNbdmFsdWVudW1dLCBtaW4sIG1heCk7CiAgICAgICAgICAgIHggPSB2YWx1ZW51bSAqIGludGVydmFsOwogICAgICAgICAgICB5dG9wID0gTWF0aC5yb3VuZChwaGVpZ2h0IC0gcGhlaWdodCAqICgodmFsIC0gbWluKSAvIHJhbmdlKSk7CiAgICAgICAgICAgIGNvbG9yID0gKG9wdGlvbnMuZ2V0KCd0aHJlc2hvbGRDb2xvcicpICYmIHZhbCA8IG9wdGlvbnMuZ2V0KCd0aHJlc2hvbGRWYWx1ZScpKSA/IG9wdGlvbnMuZ2V0KCd0aHJlc2hvbGRDb2xvcicpIDogb3B0aW9ucy5nZXQoJ2xpbmVDb2xvcicpOwogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmRyYXdMaW5lKHgsIHl0b3AsIHgsIHl0b3AgKyBsaW5lSGVpZ2h0LCBjb2xvcik7CiAgICAgICAgfQogICAgfSk7CgoKICAgIC8qKgogICAgICogQnVsbGV0IGNoYXJ0cwogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS5idWxsZXQgPSBidWxsZXQgPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgewogICAgICAgIHR5cGU6ICdidWxsZXQnLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICB2YXIgbWluLCBtYXgsIHZhbHM7CiAgICAgICAgICAgIGJ1bGxldC5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAgICAgLy8gdmFsdWVzOiB0YXJnZXQsIHBlcmZvcm1hbmNlLCByYW5nZTEsIHJhbmdlMiwgcmFuZ2UzCiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gdmFsdWVzID0gbm9ybWFsaXplVmFsdWVzKHZhbHVlcyk7CiAgICAgICAgICAgIC8vIHRhcmdldCBvciBwZXJmb3JtYW5jZSBjb3VsZCBiZSBudWxsCiAgICAgICAgICAgIHZhbHMgPSB2YWx1ZXMuc2xpY2UoKTsKICAgICAgICAgICAgdmFsc1swXSA9IHZhbHNbMF0gPT09IG51bGwgPyB2YWxzWzJdIDogdmFsc1swXTsKICAgICAgICAgICAgdmFsc1sxXSA9IHZhbHVlc1sxXSA9PT0gbnVsbCA/IHZhbHNbMl0gOiB2YWxzWzFdOwogICAgICAgICAgICBtaW4gPSBNYXRoLm1pbi5hcHBseShNYXRoLCB2YWx1ZXMpOwogICAgICAgICAgICBtYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCB2YWx1ZXMpOwogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2Jhc2UnKSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaW4gPCAwID8gbWluIDogMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1pbiA9IG9wdGlvbnMuZ2V0KCdiYXNlJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5taW4gPSBtaW47CiAgICAgICAgICAgIHRoaXMubWF4ID0gbWF4OwogICAgICAgICAgICB0aGlzLnJhbmdlID0gbWF4IC0gbWluOwoJCQkKCQkJLy8gR1JBRElFTlQKCQkJdmFyIGNvbG9ycyA9IG9wdGlvbnMuZ2V0KCdyYW5nZUNvbG9ycycpOwoJCQlpZiAob3B0aW9ucy5nZXQoJ2dyYWRpZW50JykgJiYgY29sb3JzLmxlbmd0aCA+IDEpIHsKCQkJCXZhciByYWluYm93ID0gbmV3IFJhaW5ib3coKTsKCQkJCXJhaW5ib3cuc2V0U3BlY3RydW1CeUFycmF5KGNvbG9ycyk7CgkJCQlyYWluYm93LnNldE51bWJlclJhbmdlKDAsIHRoaXMudmFsdWVzLmxlbmd0aCk7CgkJCQkKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQljb2xvcnNbaV0gPSByYWluYm93LmNvbG9yQXQoaSk7CgkJCQl9CgkJCX0KCQkJCgkJCXRoaXMucmFuZ2VDb2xvcnMgPSBjb2xvcnM7CiAgICAgICAgICAgIHRoaXMuc2hhcGVzID0ge307CiAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXMgPSB7fTsKICAgICAgICAgICAgdGhpcy5yZWdpb25kYXRhID0ge307CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aCA9IG9wdGlvbnMuZ2V0KCd3aWR0aCcpID09PSAnYXV0bycgPyAnNC4wZW0nIDogd2lkdGg7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy4kZWwuc2ltcGxlZHJhdyh3aWR0aCwgaGVpZ2h0LCBvcHRpb25zLmdldCgnY29tcG9zaXRlJykpOwogICAgICAgICAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpOwogICAgICAgIH0sCgogICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIHZhciBzaGFwZWlkID0gdGhpcy50YXJnZXQuZ2V0U2hhcGVBdChlbCwgeCAqIHRoaXMudGFyZ2V0LnJhdGlvLCB5ICogdGhpcy50YXJnZXQucmF0aW8pOwogICAgICAgICAgICByZXR1cm4gKHNoYXBlaWQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnNoYXBlc1tzaGFwZWlkXSAhPT0gdW5kZWZpbmVkKSA/IHRoaXMuc2hhcGVzW3NoYXBlaWRdIDogdW5kZWZpbmVkOwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb247CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBmaWVsZGtleTogY3VycmVudFJlZ2lvbi5zdWJzdHIoMCwgMSksCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbi5zdWJzdHIoMSldLAogICAgICAgICAgICAgICAgcmVnaW9uOiBjdXJyZW50UmVnaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgY2hhbmdlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLAogICAgICAgICAgICAgICAgc2hhcGVpZCA9IHRoaXMudmFsdWVTaGFwZXNbY3VycmVudFJlZ2lvbl0sCiAgICAgICAgICAgICAgICBzaGFwZTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2hhcGVzW3NoYXBlaWRdOwogICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRSZWdpb24uc3Vic3RyKDAsIDEpKSB7CiAgICAgICAgICAgICAgICBjYXNlICdyJzoKICAgICAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMucmVuZGVyUmFuZ2UoY3VycmVudFJlZ2lvbi5zdWJzdHIoMSksIGhpZ2hsaWdodCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdwJzoKICAgICAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMucmVuZGVyUGVyZm9ybWFuY2UoaGlnaGxpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3QnOgogICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJUYXJnZXQoaGlnaGxpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnZhbHVlU2hhcGVzW2N1cnJlbnRSZWdpb25dID0gc2hhcGUuaWQ7CiAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9IGN1cnJlbnRSZWdpb247CiAgICAgICAgICAgIHRoaXMudGFyZ2V0LnJlcGxhY2VXaXRoU2hhcGUoc2hhcGVpZCwgc2hhcGUpOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlclJhbmdlOiBmdW5jdGlvbiAocm4sIGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgcmFuZ2V2YWwgPSB0aGlzLnZhbHVlc1tybl0sCiAgICAgICAgICAgICAgICByYW5nZXdpZHRoID0gTWF0aC5yb3VuZCh0aGlzLmNhbnZhc1dpZHRoICogKChyYW5nZXZhbCAtIHRoaXMubWluKSAvIHRoaXMucmFuZ2UpKSwKICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5yYW5nZUNvbG9yc1tybiAtIDJdOwogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhcmdldC5kcmF3UmVjdCgwLCAwLCByYW5nZXdpZHRoIC0gMSwgdGhpcy5jYW52YXNIZWlnaHQgLSAxLCBjb2xvciwgY29sb3IpOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlclBlcmZvcm1hbmNlOiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciBwZXJmdmFsID0gdGhpcy52YWx1ZXNbMV0sCiAgICAgICAgICAgICAgICBwZXJmd2lkdGggPSBNYXRoLnJvdW5kKHRoaXMuY2FudmFzV2lkdGggKiAoKHBlcmZ2YWwgLSB0aGlzLm1pbikgLyB0aGlzLnJhbmdlKSksCiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMub3B0aW9ucy5nZXQoJ3BlcmZvcm1hbmNlQ29sb3InKTsKICAgICAgICAgICAgaWYgKGhpZ2hsaWdodCkgewogICAgICAgICAgICAgICAgY29sb3IgPSB0aGlzLmNhbGNIaWdobGlnaHRDb2xvcihjb2xvciwgdGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy50YXJnZXQuZHJhd1JlY3QoMCwgTWF0aC5yb3VuZCh0aGlzLmNhbnZhc0hlaWdodCAqIDAuMyksIHBlcmZ3aWR0aCAtIDEsCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKHRoaXMuY2FudmFzSGVpZ2h0ICogMC40KSAtIDEsIGNvbG9yLCBjb2xvcik7CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyVGFyZ2V0OiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXR2YWwgPSB0aGlzLnZhbHVlc1swXSwKICAgICAgICAgICAgICAgIHggPSBNYXRoLnJvdW5kKHRoaXMuY2FudmFzV2lkdGggKiAoKHRhcmdldHZhbCAtIHRoaXMubWluKSAvIHRoaXMucmFuZ2UpIC0gKHRoaXMub3B0aW9ucy5nZXQoJ3RhcmdldFdpZHRoJykgLyAyKSksCiAgICAgICAgICAgICAgICB0YXJnZXR0b3AgPSBNYXRoLnJvdW5kKHRoaXMuY2FudmFzSGVpZ2h0ICogMC4xMCksCiAgICAgICAgICAgICAgICB0YXJnZXRoZWlnaHQgPSB0aGlzLmNhbnZhc0hlaWdodCAtICh0YXJnZXR0b3AgKiAyKSwKICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5vcHRpb25zLmdldCgndGFyZ2V0Q29sb3InKTsKICAgICAgICAgICAgaWYgKGhpZ2hsaWdodCkgewogICAgICAgICAgICAgICAgY29sb3IgPSB0aGlzLmNhbGNIaWdobGlnaHRDb2xvcihjb2xvciwgdGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy50YXJnZXQuZHJhd1JlY3QoeCwgdGFyZ2V0dG9wLCB0aGlzLm9wdGlvbnMuZ2V0KCd0YXJnZXRXaWR0aCcpIC0gMSwgdGFyZ2V0aGVpZ2h0IC0gMSwgY29sb3IsIGNvbG9yKTsKICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHZsZW4gPSB0aGlzLnZhbHVlcy5sZW5ndGgsCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIGksIHNoYXBlOwogICAgICAgICAgICBpZiAoIWJ1bGxldC5fc3VwZXIucmVuZGVyLmNhbGwodGhpcykpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgdmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMucmVuZGVyUmFuZ2UoaSkuYXBwZW5kKCk7CiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSAncicgKyBpOwogICAgICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlc1sncicgKyBpXSA9IHNoYXBlLmlkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlc1sxXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2hhcGUgPSB0aGlzLnJlbmRlclBlcmZvcm1hbmNlKCkuYXBwZW5kKCk7CiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSAncDEnOwogICAgICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlcy5wMSA9IHNoYXBlLmlkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlc1swXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2hhcGUgPSB0aGlzLnJlbmRlclRhcmdldCgpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgdGhpcy5zaGFwZXNbc2hhcGUuaWRdID0gJ3QwJzsKICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXMudDAgPSBzaGFwZS5pZDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YXJnZXQucmVuZGVyKCk7CiAgICAgICAgfQogICAgfSk7CgoKICAgIC8qKgogICAgICogUGllIGNoYXJ0cwogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS5waWUgPSBwaWUgPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgewogICAgICAgIHR5cGU6ICdwaWUnLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICB2YXIgdG90YWwgPSAwLCBpOwoKICAgICAgICAgICAgcGllLl9zdXBlci5pbml0LmNhbGwodGhpcywgZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICB0aGlzLnNoYXBlcyA9IHt9OyAvLyBtYXAgc2hhcGUgaWRzIHRvIHZhbHVlIG9mZnNldHMKICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlcyA9IHt9OyAvLyBtYXBzIHZhbHVlIG9mZnNldHMgdG8gc2hhcGUgaWRzCiAgICAgICAgICAgIHRoaXMudmFsdWVzID0gdmFsdWVzID0gJC5tYXAodmFsdWVzLCBOdW1iZXIpOwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCd3aWR0aCcpID09PSAnYXV0bycpIHsKICAgICAgICAgICAgICAgIHRoaXMud2lkdGggPSB0aGlzLmhlaWdodDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHZhbHVlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSB2YWx1ZXMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudG90YWwgPSB0b3RhbDsKICAgICAgICAgICAgdGhpcy5pbml0VGFyZ2V0KCk7CiAgICAgICAgICAgIHRoaXMucmFkaXVzID0gTWF0aC5mbG9vcihNYXRoLm1pbih0aGlzLmNhbnZhc1dpZHRoLCB0aGlzLmNhbnZhc0hlaWdodCkgLyAyKTsKICAgICAgICB9LAoKICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uIChlbCwgeCwgeSkgewogICAgICAgICAgICB2YXIgc2hhcGVpZCA9IHRoaXMudGFyZ2V0LmdldFNoYXBlQXQoZWwsIHggKiB0aGlzLnRhcmdldC5yYXRpbywgeSAqIHRoaXMudGFyZ2V0LnJhdGlvKTsKICAgICAgICAgICAgcmV0dXJuIChzaGFwZWlkICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zaGFwZXNbc2hhcGVpZF0gIT09IHVuZGVmaW5lZCkgPyB0aGlzLnNoYXBlc1tzaGFwZWlkXSA6IHVuZGVmaW5lZDsKICAgICAgICB9LAoKICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaXNOdWxsOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgcGVyY2VudDogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0gLyB0aGlzLnRvdGFsICogMTAwLAogICAgICAgICAgICAgICAgY29sb3I6IHRoaXMub3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJylbY3VycmVudFJlZ2lvbiAlIHRoaXMub3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJykubGVuZ3RoXSwKICAgICAgICAgICAgICAgIG9mZnNldDogY3VycmVudFJlZ2lvbgogICAgICAgICAgICB9OwogICAgICAgIH0sCgogICAgICAgIGNoYW5nZUhpZ2hsaWdodDogZnVuY3Rpb24gKGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgY3VycmVudFJlZ2lvbiA9IHRoaXMuY3VycmVudFJlZ2lvbiwKICAgICAgICAgICAgICAgICBuZXdzbGljZSA9IHRoaXMucmVuZGVyU2xpY2UoY3VycmVudFJlZ2lvbiwgaGlnaGxpZ2h0KSwKICAgICAgICAgICAgICAgICBzaGFwZWlkID0gdGhpcy52YWx1ZVNoYXBlc1tjdXJyZW50UmVnaW9uXTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2hhcGVzW3NoYXBlaWRdOwogICAgICAgICAgICB0aGlzLnRhcmdldC5yZXBsYWNlV2l0aFNoYXBlKHNoYXBlaWQsIG5ld3NsaWNlKTsKICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlc1tjdXJyZW50UmVnaW9uXSA9IG5ld3NsaWNlLmlkOwogICAgICAgICAgICB0aGlzLnNoYXBlc1tuZXdzbGljZS5pZF0gPSBjdXJyZW50UmVnaW9uOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlclNsaWNlOiBmdW5jdGlvbiAodmFsdWVudW0sIGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy50YXJnZXQsCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgcmFkaXVzID0gdGhpcy5yYWRpdXMsCiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aCA9IG9wdGlvbnMuZ2V0KCdib3JkZXJXaWR0aCcpLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gb3B0aW9ucy5nZXQoJ29mZnNldCcpLAogICAgICAgICAgICAgICAgY2lyY2xlID0gMiAqIE1hdGguUEksCiAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLnZhbHVlcywKICAgICAgICAgICAgICAgIHRvdGFsID0gdGhpcy50b3RhbCwKICAgICAgICAgICAgICAgIG5leHQgPSBvZmZzZXQgPyAoMipNYXRoLlBJKSoob2Zmc2V0LzM2MCkgOiAwLAogICAgICAgICAgICAgICAgc3RhcnQsIGVuZCwgaSwgdmxlbiwgY29sb3I7CgogICAgICAgICAgICB2bGVuID0gdmFsdWVzLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHZsZW47IGkrKykgewogICAgICAgICAgICAgICAgc3RhcnQgPSBuZXh0OwogICAgICAgICAgICAgICAgZW5kID0gbmV4dDsKICAgICAgICAgICAgICAgIGlmICh0b3RhbCA+IDApIHsgIC8vIGF2b2lkIGRpdmlkZSBieSB6ZXJvCiAgICAgICAgICAgICAgICAgICAgZW5kID0gbmV4dCArIChjaXJjbGUgKiAodmFsdWVzW2ldIC8gdG90YWwpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZW51bSA9PT0gaSkgewogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJylbaSAlIG9wdGlvbnMuZ2V0KCdzbGljZUNvbG9ycycpLmxlbmd0aF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGhpZ2hsaWdodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuZHJhd1BpZVNsaWNlKHJhZGl1cywgcmFkaXVzLCByYWRpdXMgLSBib3JkZXJXaWR0aCwgc3RhcnQsIGVuZCwgdW5kZWZpbmVkLCBjb2xvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBuZXh0ID0gZW5kOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMudmFsdWVzLAogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIHJhZGl1cyA9IHRoaXMucmFkaXVzLAogICAgICAgICAgICAgICAgYm9yZGVyV2lkdGggPSBvcHRpb25zLmdldCgnYm9yZGVyV2lkdGgnKSwKICAgICAgICAgICAgICAgIHNoYXBlLCBpOwoKICAgICAgICAgICAgaWYgKCFwaWUuX3N1cGVyLnJlbmRlci5jYWxsKHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJvcmRlcldpZHRoKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShyYWRpdXMsIHJhZGl1cywgTWF0aC5mbG9vcihyYWRpdXMgLSAoYm9yZGVyV2lkdGggLyAyKSksCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2JvcmRlckNvbG9yJyksIHVuZGVmaW5lZCwgYm9yZGVyV2lkdGgpLmFwcGVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IHZhbHVlcy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0pIHsgLy8gZG9uJ3QgcmVuZGVyIHplcm8gdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgc2hhcGUgPSB0aGlzLnJlbmRlclNsaWNlKGkpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXNbaV0gPSBzaGFwZS5pZDsgLy8gc3RvcmUganVzdCB0aGUgc2hhcGVpZAogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFyZ2V0LnJlbmRlcigpOwogICAgICAgIH0KICAgIH0pOwoKCiAgICAvKioKICAgICAqIEJveCBwbG90cwogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS5ib3ggPSBib3ggPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgewogICAgICAgIHR5cGU6ICdib3gnLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICBib3guX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSAkLm1hcCh2YWx1ZXMsIE51bWJlcik7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLmdldCgnd2lkdGgnKSA9PT0gJ2F1dG8nID8gJzQuMGVtJyA6IHdpZHRoOwogICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLnZhbHVlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogU2ltdWxhdGUgYSBzaW5nbGUgcmVnaW9uCiAgICAgICAgICovCiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFsKICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdscScsIHZhbHVlOiB0aGlzLnF1YXJ0aWxlc1swXSB9LAogICAgICAgICAgICAgICAgeyBmaWVsZDogJ21lZCcsIHZhbHVlOiB0aGlzLnF1YXJ0aWxlc1sxXSB9LAogICAgICAgICAgICAgICAgeyBmaWVsZDogJ3VxJywgdmFsdWU6IHRoaXMucXVhcnRpbGVzWzJdIH0KICAgICAgICAgICAgXTsKICAgICAgICAgICAgaWYgKHRoaXMubG91dGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goeyBmaWVsZDogJ2xvJywgdmFsdWU6IHRoaXMubG91dGxpZXJ9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5yb3V0bGllciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7IGZpZWxkOiAncm8nLCB2YWx1ZTogdGhpcy5yb3V0bGllcn0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmx3aGlza2VyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsgZmllbGQ6ICdsdycsIHZhbHVlOiB0aGlzLmx3aGlza2VyfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMucndoaXNrZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goeyBmaWVsZDogJ3J3JywgdmFsdWU6IHRoaXMucndoaXNrZXJ9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0sCgogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy50YXJnZXQsCiAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLnZhbHVlcywKICAgICAgICAgICAgICAgIHZsZW4gPSB2YWx1ZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoID0gdGhpcy5jYW52YXNXaWR0aCwKICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0LAogICAgICAgICAgICAgICAgbWluVmFsdWUgPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpID09PSB1bmRlZmluZWQgPyBNYXRoLm1pbi5hcHBseShNYXRoLCB2YWx1ZXMpIDogb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSwKICAgICAgICAgICAgICAgIG1heFZhbHVlID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSA9PT0gdW5kZWZpbmVkID8gTWF0aC5tYXguYXBwbHkoTWF0aCwgdmFsdWVzKSA6IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4JyksCiAgICAgICAgICAgICAgICBjYW52YXNMZWZ0ID0gMCwKICAgICAgICAgICAgICAgIGx3aGlza2VyLCBsb3V0bGllciwgaXFyLCBxMSwgcTIsIHEzLCByd2hpc2tlciwgcm91dGxpZXIsIGksCiAgICAgICAgICAgICAgICBzaXplLCB1bml0U2l6ZSwgdW5pdE9mZnNldDsKCiAgICAgICAgICAgIGlmICghYm94Ll9zdXBlci5yZW5kZXIuY2FsbCh0aGlzKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ3JhdycpKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ3Nob3dPdXRsaWVycycpICYmIHZhbHVlcy5sZW5ndGggPiA1KSB7CiAgICAgICAgICAgICAgICAgICAgbG91dGxpZXIgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgICAgICAgbHdoaXNrZXIgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgICAgICAgcTEgPSB2YWx1ZXNbMl07CiAgICAgICAgICAgICAgICAgICAgcTIgPSB2YWx1ZXNbM107CiAgICAgICAgICAgICAgICAgICAgcTMgPSB2YWx1ZXNbNF07CiAgICAgICAgICAgICAgICAgICAgcndoaXNrZXIgPSB2YWx1ZXNbNV07CiAgICAgICAgICAgICAgICAgICAgcm91dGxpZXIgPSB2YWx1ZXNbNl07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGx3aGlza2VyID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgICAgICAgIHExID0gdmFsdWVzWzFdOwogICAgICAgICAgICAgICAgICAgIHEyID0gdmFsdWVzWzJdOwogICAgICAgICAgICAgICAgICAgIHEzID0gdmFsdWVzWzNdOwogICAgICAgICAgICAgICAgICAgIHJ3aGlza2VyID0gdmFsdWVzWzRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFsdWVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEgLSBiOyB9KTsKICAgICAgICAgICAgICAgIHExID0gcXVhcnRpbGUodmFsdWVzLCAxKTsKICAgICAgICAgICAgICAgIHEyID0gcXVhcnRpbGUodmFsdWVzLCAyKTsKICAgICAgICAgICAgICAgIHEzID0gcXVhcnRpbGUodmFsdWVzLCAzKTsKICAgICAgICAgICAgICAgIGlxciA9IHEzIC0gcTE7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ3Nob3dPdXRsaWVycycpKSB7CiAgICAgICAgICAgICAgICAgICAgbHdoaXNrZXIgPSByd2hpc2tlciA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsd2hpc2tlciA9PT0gdW5kZWZpbmVkICYmIHZhbHVlc1tpXSA+IHExIC0gKGlxciAqIG9wdGlvbnMuZ2V0KCdvdXRsaWVySVFSJykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsd2hpc2tlciA9IHZhbHVlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2ldIDwgcTMgKyAoaXFyICogb3B0aW9ucy5nZXQoJ291dGxpZXJJUVInKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ3aGlza2VyID0gdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxvdXRsaWVyID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgICAgICAgIHJvdXRsaWVyID0gdmFsdWVzW3ZsZW4gLSAxXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbHdoaXNrZXIgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgICAgICAgcndoaXNrZXIgPSB2YWx1ZXNbdmxlbiAtIDFdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucXVhcnRpbGVzID0gW3ExLCBxMiwgcTNdOwogICAgICAgICAgICB0aGlzLmx3aGlza2VyID0gbHdoaXNrZXI7CiAgICAgICAgICAgIHRoaXMucndoaXNrZXIgPSByd2hpc2tlcjsKICAgICAgICAgICAgdGhpcy5sb3V0bGllciA9IGxvdXRsaWVyOwogICAgICAgICAgICB0aGlzLnJvdXRsaWVyID0gcm91dGxpZXI7CgogICAgICAgICAgICAvLyBOb24temVybyB1bml0IG9mZnNldCBjYW4gdGhyb3cgb2ZmIHRoZSBwbG90dGluZyBpZiBpdCBpcyBub3QKICAgICAgICAgICAgLy8gcmVxdWlyZWQgdG8gYXZvaWQgYSBkaXZpc2lvbiBieSB6ZXJvLgogICAgICAgICAgICB1bml0T2Zmc2V0ID0gMC4wOwogICAgICAgICAgICBpZiAoICggbWF4VmFsdWUgLSBtaW5WYWx1ZSApID09IDAuMCApIHsgdW5pdE9mZnNldCA9IDEuMDsgfQoKICAgICAgICAgICAgdW5pdFNpemUgPSBjYW52YXNXaWR0aCAvIChtYXhWYWx1ZSAtIG1pblZhbHVlICsgdW5pdE9mZnNldCApOwogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ3Nob3dPdXRsaWVycycpKSB7CiAgICAgICAgICAgICAgICBjYW52YXNMZWZ0ID0gTWF0aC5jZWlsKG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJykpOwogICAgICAgICAgICAgICAgY2FudmFzV2lkdGggLT0gMiAqIE1hdGguY2VpbChvcHRpb25zLmdldCgnc3BvdFJhZGl1cycpKTsKICAgICAgICAgICAgICAgIHVuaXRTaXplID0gY2FudmFzV2lkdGggLyAobWF4VmFsdWUgLSBtaW5WYWx1ZSArIHVuaXRPZmZzZXQpOwogICAgICAgICAgICAgICAgaWYgKGxvdXRsaWVyIDwgbHdoaXNrZXIpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZSgobG91dGxpZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCAvIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyTGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyRmlsbENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHJvdXRsaWVyID4gcndoaXNrZXIpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZSgocm91dGxpZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCAvIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyTGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyRmlsbENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBib3gKICAgICAgICAgICAgdGFyZ2V0LmRyYXdSZWN0KAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocTEgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgKiAwLjEpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocTMgLSBxMSkgKiB1bml0U2l6ZSksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuOCksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnYm94TGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnYm94RmlsbENvbG9yJyksCiAgICAgICAgICAgICAgICAvLyBDVVNUT00gTU9EOiBsaW5lIHdpZHRoICYgY29ybmVyIHJhZGl1cwogICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2xpbmVXaWR0aCcpLAogICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2Nvcm5lclJhZGl1cycpKS5hcHBlbmQoKTsKICAgICAgICAgICAgLy8gbGVmdCB3aGlza2VyCiAgICAgICAgICAgIC8vIENVU1RPTSBNT0Q6IHN0cmlrZXRocm91Z2ggb3B0aW9uCiAgICAgICAgICAgIHZhciByaWdodEVuZCA9IHExIC0gbWluVmFsdWU7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnc3RyaWtlVGhyb3VnaCcpKQogICAgICAgICAgICAgIHJpZ2h0RW5kID0gcndoaXNrZXIgLSBtaW5WYWx1ZTsKCiAgICAgICAgICAgIHRhcmdldC5kcmF3TGluZSgKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKGx3aGlza2VyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC8gMiksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKHJpZ2h0RW5kICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC8gMiksCiAgICAgICAgICAgICAgICAvLyBDVVNUT00gTU9EOiBsaW5lIHdpZHRoIGFkZGVkCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbGluZVdpZHRoJykpLmFwcGVuZCgpOwogICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChsd2hpc2tlciAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgobHdoaXNrZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSBjYW52YXNIZWlnaHQgLyA0KSwKICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCd3aGlza2VyQ29sb3InKSwKICAgICAgICAgICAgICAgIC8vIENVU1RPTSBNT0Q6IGxpbmUgd2lkdGggYWRkZWQKICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdsaW5lV2lkdGgnKSkuYXBwZW5kKCk7CiAgICAgICAgICAgIC8vIHJpZ2h0IHdoaXNrZXIKICAgICAgICAgICAgLy8gQ1VTVE9NIE1PRDogc3RyaWtldGhyb3VnaCBvcHRpb24KICAgICAgICAgICAgaWYgKCFvcHRpb25zLmdldCgnc3RyaWtlVGhyb3VnaCcpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGFyZ2V0LmRyYXdMaW5lKE1hdGgucm91bmQoKHJ3aGlza2VyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSwKICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKSwKICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocTMgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDIpLAogICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICAgIC8vIENVU1RPTSBNT0Q6IGxpbmUgd2lkdGggYWRkZWQKICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2xpbmVXaWR0aCcpKS5hcHBlbmQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChyd2hpc2tlciAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocndoaXNrZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSBjYW52YXNIZWlnaHQgLyA0KSwKICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCd3aGlza2VyQ29sb3InKSwKICAgICAgICAgICAgICAgIC8vIENVU1RPTSBNT0Q6IGxpbmUgd2lkdGggYWRkZWQKICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdsaW5lV2lkdGgnKSkuYXBwZW5kKCk7CgogICAgICAgICAgICAvLyBtZWRpYW4gbGluZQogICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMiAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuMSksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMiAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuOSksCiAgICAgICAgICAgICAgICAvLyBDVVNUT00gTU9EOiBtZWRpYW53aWR0aCBvcHRpb24KICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdtZWRpYW5Db2xvcicpLAogICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ21lZGlhbldpZHRoJykpLmFwcGVuZCgpOwogICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZ2V0KCd0YXJnZXQnKSA9PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgc2l6ZSA9IE1hdGguY2VpbChvcHRpb25zLmdldCgnc3BvdFJhZGl1cycpKTsKICAgICAgICAgICAgICAgIC8vIENVU1RPTSBNT0Q6IGNpcmNsZSByZXByZXNlbnRhdGlvbiBvZiBtZWRpYW4KICAgICAgICAgICAgICAgIHZhciB0YXJnZXRWYWwgPSBvcHRpb25zLmdldCgndGFyZ2V0Jyk7CiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0T2JqID0gb3B0aW9ucy5nZXQoJ3RhcmdldE9iaicpCiAgICAgICAgICAgICAgICBpZiAoIXRhcmdldE9iaiB8fCB0YXJnZXRPYmogPT0gJ2Nyb3NzaGFpcicpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKHRhcmdldFZhbCAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKGNhbnZhc0hlaWdodCAvIDIpIC0gc2l6ZSksCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKHRhcmdldFZhbCAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKGNhbnZhc0hlaWdodCAvIDIpICsgc2l6ZSksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCd0YXJnZXRDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKHRhcmdldFZhbCAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCAtIHNpemUpLAogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDIpLAogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKCh0YXJnZXRWYWwgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQgKyBzaXplKSwKICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ3RhcmdldENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAodGFyZ2V0T2JqID09ICdjaXJjbGUnKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3Q2lyY2xlKAogICAgICAgICAgICAgICAgICAgICAgICAodGFyZ2V0VmFsIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0LAogICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNIZWlnaHQgLyAyLAogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnc3BvdFJhZGl1cycpLAogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgndGFyZ2V0Q29sb3InKSwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ3RhcmdldENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRhcmdldC5yZW5kZXIoKTsKICAgICAgICB9CiAgICB9KTsKCgogIC8qanNsaW50IG5vbWVuOiB0cnVlLCBwbHVzcGx1czogdHJ1ZSwgdG9kbzogdHJ1ZSwgd2hpdGU6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8vKioKICAgICAqIFRpbWVsaW5lIHNwYXJrbGluZSBjaGFydAogICAgICogR2l2ZW4gYSBsaXN0IG9mIGV2ZW50cyB3aXRoIGJlZ2luL2ZpbmlzaCB0aW1lcywgZ3JhcGggdGhlbSB2ZXJ0aWNhbGx5IG9yIGhvcml6b250YWxseSBieSBldmVudCB0eXBlLgogICAgICogbGV0IGV2ZW50cyA9IFsKICAgICAqICB7YmVnaW46ZGF0ZSgxMWEpLCBmaW5pc2g6ZGF0ZSgxMmEpLCBjb2xvcjoncmVkJ30sCiAgICAgKiAge2JlZ2luOmRhdGUoMTJhKSwgZmluaXNoOmRhdGUoMXApLCBjb2xvcjonZ3JlZW4nfSwKICAgICAqICB7YmVnaW46ZGF0ZSgxcCksIGZpbmlzaDpkYXRlKDZwKSwgY29sb3I6J2JsdWUnfQogICAgICogXQogICAgICogbGV0IDEgcGl4ZWwgPSAxIG1pbnV0ZQogICAgICogbGV0IDggYW0gYmUgdGhlIHNwYXJrbGluZSBiZWdpbgogICAgICogbGV0IDggcG0gYmUgdGhlIHNwYXJrbGluZSBmaW5pc2ggCiAgICAgKiBsZXQgNzIwIHBpeGVscyBiZSB0aGUgdG90YWwgdmlzaWJsZSBkdXJhdGlvbgogICAgICogdGhlbiBncmFwaCAKICAgICAqICB8d2hpdGUgZm9yIDMwMCBwaXhlbHN8fHJlZCBmb3IgNjAgcGl4ZWxzfHxncmVlbiBmb3IgNjAgcGl4ZWxzfHxibHVlIGZvciAzMDAgcGl4ZWxzfHx3aGl0ZSBmb3IgMTIwIHBpeGVsc3wKICAgICAqLwo7KGZ1bmN0aW9uICgkKSB7CgogICAgInVzZSBzdHJpY3QiOwoKICAgICQuZm4uc3BhcmtsaW5lLnRpbWVsaW5lID0gdGltZWxpbmUgPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgYmFySGlnaGxpZ2h0TWl4aW4sIHsKCiAgICAgICAgdHlwZTogJ3RpbWVsaW5lJywKCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgLy8gZXhwZWN0IGEgRGF0ZSBvciB0aGUgTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSB0aGUgZXBvYwogICAgICAgICAgICBmdW5jdGlvbiBtaW51dGVzKGRhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRlIC8gKDYwICogMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZm9yY2UgcG9zaXRpdmUgbnVtYmVyIG90aGVyd2lzZSAwCiAgICAgICAgICAgIGZ1bmN0aW9uIGZvcmNlUG9zaXRpdmVOdW1iZXIodmFsKSB7CiAgICAgICAgICAgICAgICB2YWwgPSBNYXRoLmFicyh2YWwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGlzTmFOKHZhbCkgPyAwIDogdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpLCBkYXRhLCBzZWdtZW50LCBiZWdpbk1pbnV0ZXMsIGZpbmlzaE1pbnV0ZXMsIGR1cmF0aW9uTWludXRlcywgCiAgICAgICAgICAgICAgICBwaXhlbHNQZXJNaW51dGUsIHVzZXJJbml0SGFuZGxlciwgdGltZU1hcmtQaXhlbHMsIGlzVmVydGljYWxPcmllbnRhdGlvbiwgCiAgICAgICAgICAgICAgICB0aW1lTWFya0ludGVydmFsLCB0aW1lTWFya09mZnNldCwgdGltZU1hcmssIHRpY2ssIHRpY2tTaXplOwogICAgICAgICAgICB0aW1lbGluZS5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAvLyByZXF1aXJlZCBieSBiYXJIaWdobGlnaHRNaXhpbgogICAgICAgICAgICB0aGlzLnJlZ2lvblNoYXBlcyA9IHt9OwogICAgICAgICAgICAvLyBzZXRzIGNhbnZhcyBoZWlnaHQvd2lkdGgKICAgICAgICAgICAgdGhpcy5pbml0VGFyZ2V0KCk7CiAgICAgICAgICAgIC8vIGhvbGRzIGVhY2ggdGltZWxpbmUgZW50cnkgd2l0aCB4LHksdyxoLGxjLGZjLHJkIHZhbHVlcwogICAgICAgICAgICB0aGlzLnNlZ21lbnRzID0gW107CiAgICAgICAgICAgIC8vIGhvbGRzIHRpbWUgbWFya2VycyBlbnRyeSB3aXRoIHgxLHkxLHgyLHkyLGxjLHcgdmFsdWVzCiAgICAgICAgICAgIHRoaXMudGltZW1hcmtzID0gW107CiAgICAgICAgICAgIC8vIHBhaW50cyBhIDFweCBsaW5lIHNob3dpbmcgZnVsbCBsZW5ndGggb2YgdGltZWxpbmUKICAgICAgICAgICAgdGltZU1hcmtJbnRlcnZhbCA9IGZvcmNlUG9zaXRpdmVOdW1iZXIob3B0aW9ucy5tZXJnZWRPcHRpb25zLnRpbWVNYXJrSW50ZXJ2YWwpOwogICAgICAgICAgICAvLyBvcmllbnQgdGhlIHNwYXJrbGluZSBkaXJlY3Rpb24sIHRoZSBkZWZhdWx0IGlzIGhvcml6b250YWwKICAgICAgICAgICAgaXNWZXJ0aWNhbE9yaWVudGF0aW9uID0gJ3ZlcnRpY2FsJyA9PT0gb3B0aW9ucy5tZXJnZWRPcHRpb25zLm9yaWVudGF0aW9uOwogICAgICAgICAgICAvLyBhbGxvdyB1c2VyIHRvIG1hbmlwdWxhdGUgdGhlIGRhdGEgYmVmb3JlIHNlZ21lbnQgaXMgYnVpbHQKICAgICAgICAgICAgdXNlckluaXRIYW5kbGVyID0gJC5pc0Z1bmN0aW9uKG9wdGlvbnMubWVyZ2VkT3B0aW9ucy5pbml0KSA/IG9wdGlvbnMubWVyZ2VkT3B0aW9ucy5pbml0IDogZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQ7IH07CiAgICAgICAgICAgIGZ1bmN0aW9uIG9mZnNldChkYXRlLCBiYXNlbGluZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbChwaXhlbHNQZXJNaW51dGUgKiAobWludXRlcyhkYXRlKSAtIGJhc2VsaW5lKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gc2VnbWVudHMgdGhhdCBmYWxsIG91dHNpZGUgb2YgYmVnaW4vZmluaXNoIHdpbGwgYmUgY2xpcHBlZAogICAgICAgICAgICBiZWdpbk1pbnV0ZXMgPSBtaW51dGVzKG9wdGlvbnMubWVyZ2VkT3B0aW9ucy5iZWdpbik7CiAgICAgICAgICAgIGZpbmlzaE1pbnV0ZXMgPSBtaW51dGVzKG9wdGlvbnMubWVyZ2VkT3B0aW9ucy5maW5pc2gpOwogICAgICAgICAgICBkdXJhdGlvbk1pbnV0ZXMgPSAoZmluaXNoTWludXRlcyAtIGJlZ2luTWludXRlcyk7CiAgICAgICAgICAgIGlmIChpc1ZlcnRpY2FsT3JpZW50YXRpb24pIHsKICAgICAgICAgICAgICAgIHBpeGVsc1Blck1pbnV0ZSA9ICh0aGlzLmNhbnZhc0hlaWdodCAtIDEpIC8gZHVyYXRpb25NaW51dGVzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGl4ZWxzUGVyTWludXRlID0gKHRoaXMuY2FudmFzV2lkdGggLSAxKSAvIGR1cmF0aW9uTWludXRlczsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGltZU1hcmtJbnRlcnZhbCA+IDApIHsKICAgICAgICAgICAgICAgIHRpbWVNYXJrUGl4ZWxzID0gdGltZU1hcmtJbnRlcnZhbCAqIHBpeGVsc1Blck1pbnV0ZTsKICAgICAgICAgICAgICAgIC8vIGFkZCB0aWNrIG1hcmtzIGJhc2VkIG9uIHRpbWVNYXJrSW50ZXJ2YWwKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAoKGR1cmF0aW9uTWludXRlcyAqIHBpeGVsc1Blck1pbnV0ZSkgLyB0aW1lTWFya1BpeGVscykgKyAxOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0aWNrID0ge3gxOiAwLCB5MTogMCwgeDI6IDAsIHkyOiAwLCBsYzonI2ZmMDAxMScsIHc6IDF9OwogICAgICAgICAgICAgICAgICAgIHRpbWVNYXJrID0gTWF0aC5yb3VuZChpICogdGltZU1hcmtQaXhlbHMpOwogICAgICAgICAgICAgICAgICAgIHRpY2tTaXplID0gTWF0aC5jZWlsKHRpbWVNYXJrIC8gcGl4ZWxzUGVyTWludXRlKSAlIDYwID09PSAwID8gMyA6IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzVmVydGljYWxPcmllbnRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICB0aWNrLngyID0gdGlja1NpemU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpY2sueTEgPSB0aWNrLnkyID0gdGltZU1hcms7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGljay55MiA9IHRpY2tTaXplOwogICAgICAgICAgICAgICAgICAgICAgICB0aWNrLngxID0gdGljay54MiA9IHRpbWVNYXJrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbWVtYXJrcy5wdXNoKHRpY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gYWRkIGxhc3QgdGljayBtYXJrIGFuZCB0aW1lbGluZQogICAgICAgICAgICAgICAgaWYgKGlzVmVydGljYWxPcmllbnRhdGlvbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMudGltZW1hcmtzLnB1c2goe3gxOjAsIHkxOjAsIHgyOjAsIHkyOnRoaXMuY2FudmFzSGVpZ2h0LCBsYzonI2VlZScsIHc6MX0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbWVtYXJrcy5wdXNoKHt4MTowLCB5MTowLCB4Mjp0aGlzLmNhbnZhc1dpZHRoLCB5MjowLCBsYzonI2VlZScsIHc6MX0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGJ1aWxkIGVhY2ggc2VnbWVudCBmb3IgcmVuZGVyaW5nCiAgICAgICAgICAgIHRpbWVNYXJrT2Zmc2V0ID0gKHRpbWVNYXJrSW50ZXJ2YWwgPiAwKSA/IDEgOiAwOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBkZXRlcm1pbmUgd2h5IHZhbHVlcyBoYXMgYm9ndXMgbGVuZ3RoIHZhbHVlIGluIElFOAogICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpXSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEgPSB1c2VySW5pdEhhbmRsZXIodmFsdWVzW2ldLCBpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbWludXMgMiBpcyB0byBwcmV2ZW50IGNsaXBwaW5nIHRoZSBzZWdtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB0aW1lTWFya09mZnNldCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiB0aW1lTWFya09mZnNldCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3OiB3aWR0aCAtICh0aW1lTWFya09mZnNldCArIDEpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGhlaWdodCAtICh0aW1lTWFya09mZnNldCArIDEpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogYWRqdXN0IHNoYXBlIHNpemUgZm9yIG92ZXJsYXBwaW5nIHJlZ2lvbnMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVmVydGljYWxPcmllbnRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudC55ID0gb2Zmc2V0KGRhdGEuYmVnaW4sIGJlZ2luTWludXRlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50LmggPSBvZmZzZXQoZGF0YS5maW5pc2gsIG1pbnV0ZXMoZGF0YS5iZWdpbikpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudC54ID0gb2Zmc2V0KGRhdGEuYmVnaW4sIGJlZ2luTWludXRlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50LncgPSBvZmZzZXQoZGF0YS5maW5pc2gsIG1pbnV0ZXMoZGF0YS5iZWdpbikpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQuZmMgPSBkYXRhLmNvbG9yIHx8IG9wdGlvbnMubWVyZ2VkT3B0aW9ucy5maWxsQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnQubGMgPSBkYXRhLmxpbmVDb2xvciB8fCBvcHRpb25zLm1lcmdlZE9wdGlvbnMubGluZUNvbG9yOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzLnB1c2goc2VnbWVudCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzb3J0IHRoZSBzZWdtZW50cyBzbyBhbGwgc2VnbWVudHMgYXJlIHZpc2libGUgaW4gdGltZWxpbmUKICAgICAgICAgICAgdGhpcy5zZWdtZW50cyA9IHRoaXMuc2VnbWVudHMuc29ydChmdW5jdGlvbiBjb21wYXJlKGEsYikgewogICAgICAgICAgICAgICAgdmFyIGFiLCBhZiwgYmIsIGJmOwogICAgICAgICAgICAgICAgYWIgPSBOdW1iZXIoYS5kYXRhLmJlZ2luKTsKICAgICAgICAgICAgICAgIGJiID0gTnVtYmVyKGIuZGF0YS5iZWdpbik7CiAgICAgICAgICAgICAgICBhZiA9IE51bWJlcihhLmRhdGEuZmluaXNoKTsKICAgICAgICAgICAgICAgIGJmID0gTnVtYmVyKGIuZGF0YS5maW5pc2gpOwogICAgICAgICAgICAgICAgLy8gcmV2ZXJzZSBvcmRlciBzb3J0CiAgICAgICAgICAgICAgICByZXR1cm4gKGJiLWFiKSArIChiZi1hZik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIC8qKiByZXR1cm4gbW91c2UgY29vcmRpbmF0ZXMgb24gdGltZWxpbmUgKi8KICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uIChlbCwgeCwgeSkgewogICAgICAgICAgICByZXR1cm4ge2VsOiBlbCwgeDogeCwgeTogeX07CiAgICAgICAgfSwKCiAgICAgICAgLyoqIHJldHVybiBkYXRhIHVzZWQgdG8gZGlzcGxheSB0b29sdGlwIGZvciB0aGUgY3VycmVudCByZWdpb24ocykgKi8KICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpLCBlbCwgeCwgeSwgc2VnbWVudCwgcmVnaW9ucyA9IFtdLCBsZWZ0LCByaWdodCwgdG9wLCBib3R0b207CiAgICAgICAgICAgIGVsID0gdGhpcy5jdXJyZW50UmVnaW9uLmVsOwogICAgICAgICAgICB4ID0gdGhpcy5jdXJyZW50UmVnaW9uLng7CiAgICAgICAgICAgIHkgPSB0aGlzLmN1cnJlbnRSZWdpb24ueTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuc2VnbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHNlZ21lbnQgPSB0aGlzLnNlZ21lbnRzW2ldOwogICAgICAgICAgICAgICAgaWYgKHNlZ21lbnQpIHsKICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gc2VnbWVudC54OwogICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0gbGVmdCArIHNlZ21lbnQudzsKICAgICAgICAgICAgICAgICAgICB0b3AgPSBzZWdtZW50Lnk7CiAgICAgICAgICAgICAgICAgICAgYm90dG9tID0gdG9wICsgc2VnbWVudC5oOwogICAgICAgICAgICAgICAgICAgIGlmICh4ID4gbGVmdCAmJiB4IDwgcmlnaHQgJiYgeSA+IHRvcCAmJiB5IDwgYm90dG9tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbnMucHVzaChzZWdtZW50LmRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVnaW9uczsKICAgICAgICB9LAoKICAgICAgICAvKiogcmVuZGVyIHRpbWVsaW5lIHNlZ21lbnQgYW5kIHRpY2ttYXJrcyAqLwogICAgICAgIHJlbmRlclJlZ2lvbjogZnVuY3Rpb24gKHZhbHVlbnVtLCBoaWdobGlnaHQpIHsKICAgICAgICAgICAgdmFyIGksIHRpY2ssIHNlZ21lbnQsIHJlc3VsdCA9IFtdLCB0YXJnZXQgPSB0aGlzLnRhcmdldDsKICAgICAgICAgICAgaWYgKHZhbHVlbnVtID09PSAwKSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy50aW1lbWFya3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0aWNrID0gdGhpcy50aW1lbWFya3NbaV07CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGFyZ2V0LmRyYXdMaW5lKHRpY2sueDEsIHRpY2sueTEsIHRpY2sueDIsIHRpY2sueTIsIHRpY2subGMsIHRpY2sudykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlZ21lbnQgPSB0aGlzLnNlZ21lbnRzW3ZhbHVlbnVtXTsKICAgICAgICAgICAgaWYgKHNlZ21lbnQpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRhcmdldC5kcmF3UmVjdChzZWdtZW50LngsIHNlZ21lbnQueSwgc2VnbWVudC53LCBzZWdtZW50LmgsIHNlZ21lbnQubGMsIHNlZ21lbnQuZmMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0pOwp9KGpRdWVyeSkpOwoKCiAgICAvLyBTZXR1cCBhIHZlcnkgc2ltcGxlICJ2aXJ0dWFsIGNhbnZhcyIgdG8gbWFrZSBkcmF3aW5nIHRoZSBmZXcgc2hhcGVzIHdlIG5lZWQgZWFzaWVyCiAgICAvLyBUaGlzIGlzIGFjY2Vzc2libGUgYXMgJChmb28pLnNpbXBsZWRyYXcoKQoKICAgIFZTaGFwZSA9IGNyZWF0ZUNsYXNzKHsKICAgICAgICBpbml0OiBmdW5jdGlvbiAodGFyZ2V0LCBpZCwgdHlwZSwgYXJncykgewogICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDsKICAgICAgICAgICAgdGhpcy5pZCA9IGlkOwogICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICAgICAgICB0aGlzLmFyZ3MgPSBhcmdzOwogICAgICAgIH0sCiAgICAgICAgYXBwZW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0LmFwcGVuZFNoYXBlKHRoaXMpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICB9KTsKCiAgICBWQ2FudmFzX2Jhc2UgPSBjcmVhdGVDbGFzcyh7CiAgICAgICAgX3B4cmVnZXg6IC8oXGQrKShweCk/XHMqJC9pLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgdGFyZ2V0KSB7CiAgICAgICAgICAgIGlmICghd2lkdGgpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDsKICAgICAgICAgICAgdGhpcy5sYXN0U2hhcGVJZCA9IG51bGw7CiAgICAgICAgICAgIGlmICh0YXJnZXRbMF0pIHsKICAgICAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldFswXTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkLmRhdGEodGFyZ2V0LCAnX2pxc192Y2FudmFzJywgdGhpcyk7CiAgICAgICAgfSwKCiAgICAgICAgZHJhd0xpbmU6IGZ1bmN0aW9uICh4MSwgeTEsIHgyLCB5MiwgbGluZUNvbG9yLCBsaW5lV2lkdGgpIHsKICAgICAgICAgICAgLy8gQ1VTVE9NIE1PRDogbGluZSB3aWR0aCBhZGRlZAogICAgICAgICAgICByZXR1cm4gdGhpcy5kcmF3U2hhcGUoW1t4MSwgeTFdLCBbeDIsIHkyXV0sIGxpbmVDb2xvciwgbnVsbCwgbGluZVdpZHRoKTsKICAgICAgICB9LAoKICAgICAgICBkcmF3U2hhcGU6IGZ1bmN0aW9uIChwYXRoLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZW5TaGFwZSgnU2hhcGUnLCBbcGF0aCwgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aF0pOwogICAgICAgIH0sCgogICAgICAgIGRyYXdDaXJjbGU6IGZ1bmN0aW9uICh4LCB5LCByYWRpdXMsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dlblNoYXBlKCdDaXJjbGUnLCBbeCwgeSwgcmFkaXVzLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoXSk7CiAgICAgICAgfSwKCiAgICAgICAgZHJhd1BpZVNsaWNlOiBmdW5jdGlvbiAoeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgbGluZUNvbG9yLCBmaWxsQ29sb3IpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dlblNoYXBlKCdQaWVTbGljZScsIFt4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBsaW5lQ29sb3IsIGZpbGxDb2xvcl0pOwogICAgICAgIH0sCgogICAgICAgIC8vIENVU1RPTSBNT0Q6IGxpbmUgd2lkdGggLyByYWRpdXMgYWRkZWQKICAgICAgICBkcmF3UmVjdDogZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgsIHJhZGl1cykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2VuU2hhcGUoJ1JlY3QnLCBbeCwgeSwgd2lkdGgsIGhlaWdodCwgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCwgcmFkaXVzXSk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0RWxlbWVudDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYW52YXM7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBtb3N0IHJlY2VudGx5IGluc2VydGVkIHNoYXBlIGlkCiAgICAgICAgICovCiAgICAgICAgZ2V0TGFzdFNoYXBlSWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdFNoYXBlSWQ7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXIgYW5kIHJlc2V0IHRoZSBjYW52YXMKICAgICAgICAgKi8KICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBhbGVydCgncmVzZXQgbm90IGltcGxlbWVudGVkJyk7CiAgICAgICAgfSwKCiAgICAgICAgX2luc2VydDogZnVuY3Rpb24gKGVsLCB0YXJnZXQpIHsKICAgICAgICAgICAgJCh0YXJnZXQpLmh0bWwoZWwpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIENhbGN1bGF0ZSB0aGUgcGl4ZWwgZGltZW5zaW9ucyBvZiB0aGUgY2FudmFzCiAgICAgICAgICovCiAgICAgICAgX2NhbGN1bGF0ZVBpeGVsRGltczogZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIGNhbnZhcykgewogICAgICAgICAgICAvLyBYWFggVGhpcyBzaG91bGQgcHJvYmFibHkgYmUgYSBjb25maWd1cmFibGUgb3B0aW9uCiAgICAgICAgICAgIHZhciBtYXRjaDsKICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLl9weHJlZ2V4LmV4ZWMoaGVpZ2h0KTsKICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBpeGVsSGVpZ2h0ID0gbWF0Y2hbMV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnBpeGVsSGVpZ2h0ID0gJChjYW52YXMpLmhlaWdodCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hdGNoID0gdGhpcy5fcHhyZWdleC5leGVjKHdpZHRoKTsKICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBpeGVsV2lkdGggPSBtYXRjaFsxXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMucGl4ZWxXaWR0aCA9ICQoY2FudmFzKS53aWR0aCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByYXRpbyA9IHdpbmRvdy5oYXNPd25Qcm9wZXJ0eSgnZGV2aWNlUGl4ZWxSYXRpbycpID8gd2luZG93LmRldmljZVBpeGVsUmF0aW8gOiAxOwogICAgICAgICAgICB0aGlzLnBpeGVsV2lkdGggKj0gcmF0aW87CiAgICAgICAgICAgIHRoaXMucGl4ZWxIZWlnaHQgKj0gcmF0aW87CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogR2VuZXJhdGUgYSBzaGFwZSBvYmplY3QgYW5kIGlkIGZvciBsYXRlciByZW5kZXJpbmcKICAgICAgICAgKi8KICAgICAgICBfZ2VuU2hhcGU6IGZ1bmN0aW9uIChzaGFwZXR5cGUsIHNoYXBlYXJncykgewogICAgICAgICAgICB2YXIgaWQgPSBzaGFwZUNvdW50Kys7CiAgICAgICAgICAgIHNoYXBlYXJncy51bnNoaWZ0KGlkKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWU2hhcGUodGhpcywgaWQsIHNoYXBldHlwZSwgc2hhcGVhcmdzKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBBZGQgYSBzaGFwZSB0byB0aGUgZW5kIG9mIHRoZSByZW5kZXIgcXVldWUKICAgICAgICAgKi8KICAgICAgICBhcHBlbmRTaGFwZTogZnVuY3Rpb24gKHNoYXBlKSB7CiAgICAgICAgICAgIGFsZXJ0KCdhcHBlbmRTaGFwZSBub3QgaW1wbGVtZW50ZWQnKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBSZXBsYWNlIG9uZSBzaGFwZSB3aXRoIGFub3RoZXIKICAgICAgICAgKi8KICAgICAgICByZXBsYWNlV2l0aFNoYXBlOiBmdW5jdGlvbiAoc2hhcGVpZCwgc2hhcGUpIHsKICAgICAgICAgICAgYWxlcnQoJ3JlcGxhY2VXaXRoU2hhcGUgbm90IGltcGxlbWVudGVkJyk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogSW5zZXJ0IG9uZSBzaGFwZSBhZnRlciBhbm90aGVyIGluIHRoZSByZW5kZXIgcXVldWUKICAgICAgICAgKi8KICAgICAgICBpbnNlcnRBZnRlclNoYXBlOiBmdW5jdGlvbiAoc2hhcGVpZCwgc2hhcGUpIHsKICAgICAgICAgICAgYWxlcnQoJ2luc2VydEFmdGVyU2hhcGUgbm90IGltcGxlbWVudGVkJyk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmVtb3ZlIGEgc2hhcGUgZnJvbSB0aGUgcXVldWUKICAgICAgICAgKi8KICAgICAgICByZW1vdmVTaGFwZUlkOiBmdW5jdGlvbiAoc2hhcGVpZCkgewogICAgICAgICAgICBhbGVydCgncmVtb3ZlU2hhcGVJZCBub3QgaW1wbGVtZW50ZWQnKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBGaW5kIGEgc2hhcGUgYXQgdGhlIHNwZWNpZmllZCB4L3kgY28tb3JkaW5hdGVzCiAgICAgICAgICovCiAgICAgICAgZ2V0U2hhcGVBdDogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIGFsZXJ0KCdnZXRTaGFwZUF0IG5vdCBpbXBsZW1lbnRlZCcpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFJlbmRlciBhbGwgcXVldWVkIHNoYXBlcyBvbnRvIHRoZSBjYW52YXMKICAgICAgICAgKi8KICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgYWxlcnQoJ3JlbmRlciBub3QgaW1wbGVtZW50ZWQnKTsKICAgICAgICB9CiAgICB9KTsKCgogICAgVkNhbnZhc19jYW52YXMgPSBjcmVhdGVDbGFzcyhWQ2FudmFzX2Jhc2UsIHsKICAgICAgICBpbml0OiBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgdGFyZ2V0LCBpbnRlcmFjdCkgewogICAgICAgICAgICBWQ2FudmFzX2NhbnZhcy5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIHdpZHRoLCBoZWlnaHQsIHRhcmdldCk7CiAgICAgICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgIGlmICh0YXJnZXRbMF0pIHsKICAgICAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldFswXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwoKICAgICAgICAgICAgdmFyIGRldmljZVBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxLAogICAgICAgICAgICAgICAgYmFja2luZ1N0b3JlUmF0aW8gPSB0aGlzLmNvbnRleHQud2Via2l0QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCB0aGlzLmNvbnRleHQubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCB0aGlzLmNvbnRleHQubXNCYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IHRoaXMuY29udGV4dC5vQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCB0aGlzLmNvbnRleHQuYmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCAxLAogICAgICAgICAgICAgICAgcmF0aW8gPSBkZXZpY2VQaXhlbFJhdGlvIC8gYmFja2luZ1N0b3JlUmF0aW87CgogICAgICAgICAgICAkLmRhdGEodGFyZ2V0LCAnX2pxc192Y2FudmFzJywgdGhpcyk7CiAgICAgICAgICAgICQodGhpcy5jYW52YXMpLmNzcyh7IGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLCB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0LCB2ZXJ0aWNhbEFsaWduOiAndG9wJyB9KTsKICAgICAgICAgICAgdGhpcy5faW5zZXJ0KHRoaXMuY2FudmFzLCB0YXJnZXQpOwogICAgICAgICAgICB0aGlzLl9jYWxjdWxhdGVQaXhlbERpbXMod2lkdGgsIGhlaWdodCwgdGhpcy5jYW52YXMpOwogICAgICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMucGl4ZWxXaWR0aCAqIHJhdGlvOwogICAgICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLnBpeGVsSGVpZ2h0ICogcmF0aW87CiAgICAgICAgICAgIHRoaXMuY29udGV4dC5zY2FsZShyYXRpbywgcmF0aW8pOwogICAgICAgICAgICB0aGlzLmludGVyYWN0ID0gaW50ZXJhY3Q7CiAgICAgICAgICAgIHRoaXMuc2hhcGVzID0ge307CiAgICAgICAgICAgIHRoaXMuc2hhcGVzZXEgPSBbXTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50VGFyZ2V0U2hhcGVJZCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgLy8kKHRoaXMuY2FudmFzKS5jc3Moe3dpZHRoOiB0aGlzLnBpeGVsV2lkdGgsIGhlaWdodDogdGhpcy5waXhlbEhlaWdodH0pOwogICAgICAgICAgICAvL2lmIHRyYW5zZm9ybSBhcHBsaWVkIHRvIHBhcmVudCB0aGVuIG5lZWQgdG8gYWRqdXN0IGZvciB0aGF0CiAgICAgICAgICAgIHRoaXMuZGV2aWNlUGl4ZWxSYXRpbyA9IHJhdGlvOwogICAgICAgICAgICB0aGlzLnJhdGlvID0gdGhpcy5waXhlbFdpZHRoIC8gdGhpcy5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7CiAgICAgICAgfSwKCiAgICAgICAgX2dldENvbnRleHQ6IGZ1bmN0aW9uIChsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgaWYgKGxpbmVDb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gbGluZUNvbG9yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRleHQubGluZVdpZHRoID0gbGluZVdpZHRoID09PSB1bmRlZmluZWQgPyAxIDogbGluZVdpZHRoOwogICAgICAgICAgICBpZiAoZmlsbENvbG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gZmlsbENvbG9yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb250ZXh0OwogICAgICAgIH0sCgogICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5fZ2V0Q29udGV4dCgpOwogICAgICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLnBpeGVsV2lkdGgsIHRoaXMucGl4ZWxIZWlnaHQpOwogICAgICAgICAgICB0aGlzLnNoYXBlcyA9IHt9OwogICAgICAgICAgICB0aGlzLnNoYXBlc2VxID0gW107CiAgICAgICAgICAgIHRoaXMuY3VycmVudFRhcmdldFNoYXBlSWQgPSB1bmRlZmluZWQ7CiAgICAgICAgfSwKCiAgICAgICAgLy8gQ1VTVE9NIE1PRDogcmFkaXVzIGFkZGVkCiAgICAgICAgX2RyYXdTaGFwZTogZnVuY3Rpb24gKHNoYXBlaWQsIHBhdGgsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgsIHJhZGl1cykgewogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX2dldENvbnRleHQobGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCksCiAgICAgICAgICAgICAgICBpLCBwbGVuLCBkb25lID0gZmFsc2U7CiAgICAgICAgICAgIGlmICghcmFkaXVzKQogICAgICAgICAgICAgIHJhZGl1cyA9IDA7CiAgICAgICAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIC8vIENVU1RPTSBNT0Q6IGNvcm5lciByYWRpdXMgZHJhd2luZyBhZGRlZCBmb3IgcmVjdGFuZ2xlcwogICAgICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDUpIHsKICAgICAgICAgICAgICAgIGlmICgocGF0aFsxXVswXSAtIHBhdGhbMF1bMF0pIDwgcmFkaXVzKQogICAgICAgICAgICAgICAgICAgIHJhZGl1cyA9IDA7CiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGEgcmVjdGFuZ2xlCiAgICAgICAgICAgICAgICBpZiAocmFkaXVzID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubW92ZVRvKHBhdGhbMF1bMF0gKyByYWRpdXMgKyAwLjUsIHBhdGhbMF1bMV0gKyAwLjUpOwoKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxpbmVUbyhwYXRoWzFdWzBdIC0gcmFkaXVzICsgMC41LCBwYXRoWzFdWzFdICsgMC41KTsKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8ocGF0aFsxXVswXSAtIHJhZGl1cyArIDAuNSwgcGF0aFsxXVsxXSArIDAuNSwgcGF0aFsxXVswXSArIDAuNSwgcGF0aFsxXVsxXSArIHJhZGl1cyArIDAuNSk7CgogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubGluZVRvKHBhdGhbMl1bMF0gKyAwLjUsIHBhdGhbMl1bMV0gLSByYWRpdXMgKyAwLjUpOwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQucXVhZHJhdGljQ3VydmVUbyhwYXRoWzJdWzBdICsgMC41LCBwYXRoWzJdWzFdIC0gcmFkaXVzICsgMC41LCBwYXRoWzJdWzBdIC0gcmFkaXVzICsgMC41LCBwYXRoWzJdWzFdICsgMC41KTsKCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5saW5lVG8ocGF0aFszXVswXSArIHJhZGl1cyArIDAuNSwgcGF0aFszXVsxXSArIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5xdWFkcmF0aWNDdXJ2ZVRvKHBhdGhbM11bMF0gKyByYWRpdXMgKyAwLjUsIHBhdGhbM11bMV0gKyAwLjUsIHBhdGhbM11bMF0gKyAwLjUsIHBhdGhbM11bMV0gLSByYWRpdXMgKyAwLjUpOwoKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxpbmVUbyhwYXRoWzRdWzBdICsgMC41LCBwYXRoWzRdWzFdICsgcmFkaXVzICsgMC41KTsKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnF1YWRyYXRpY0N1cnZlVG8ocGF0aFs0XVswXSArIDAuNSwgcGF0aFs0XVsxXSArIHJhZGl1cyArIDAuNSwgcGF0aFs0XVswXSArIHJhZGl1cyArIDAuNSwgcGF0aFs0XVsxXSArIDAuNSk7CgogICAgICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IAogICAgICAgICAgICBpZiAoIWRvbmUpIHsKICAgICAgICAgICAgICBjb250ZXh0Lm1vdmVUbyhwYXRoWzBdWzBdICsgMC41LCBwYXRoWzBdWzFdICsgMC41KTsKICAgICAgICAgICAgICBmb3IgKGkgPSAxLCBwbGVuID0gcGF0aC5sZW5ndGg7IGkgPCBwbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgY29udGV4dC5saW5lVG8ocGF0aFtpXVswXSArIDAuNSwgcGF0aFtpXVsxXSArIDAuNSk7IC8vIHRoZSAwLjUgb2Zmc2V0IGdpdmVzIHVzIGNyaXNwIHBpeGVsLXdpZHRoIGxpbmVzCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobGluZUNvbG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpbGxDb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LmZpbGwoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRYICE9PSB1bmRlZmluZWQgJiYgdGhpcy50YXJnZXRZICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICAgIGNvbnRleHQuaXNQb2ludEluUGF0aCh0aGlzLnRhcmdldFgsIHRoaXMudGFyZ2V0WSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRhcmdldFNoYXBlSWQgPSBzaGFwZWlkOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgX2RyYXdDaXJjbGU6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCByYWRpdXMsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgpIHsKICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLl9nZXRDb250ZXh0KGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgpOwogICAgICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjb250ZXh0LmFyYyh4LCB5LCByYWRpdXMsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7CiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFggIT09IHVuZGVmaW5lZCAmJiB0aGlzLnRhcmdldFkgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgICAgY29udGV4dC5pc1BvaW50SW5QYXRoKHRoaXMudGFyZ2V0WCwgdGhpcy50YXJnZXRZKSkgewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VGFyZ2V0U2hhcGVJZCA9IHNoYXBlaWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpbmVDb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LnN0cm9rZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaWxsQ29sb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY29udGV4dC5maWxsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBfZHJhd1BpZVNsaWNlOiBmdW5jdGlvbiAoc2hhcGVpZCwgeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgbGluZUNvbG9yLCBmaWxsQ29sb3IpIHsKICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLl9nZXRDb250ZXh0KGxpbmVDb2xvciwgZmlsbENvbG9yKTsKICAgICAgICAgICAgY29udGV4dC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY29udGV4dC5tb3ZlVG8oeCwgeSk7CiAgICAgICAgICAgIGNvbnRleHQuYXJjKHgsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGZhbHNlKTsKICAgICAgICAgICAgY29udGV4dC5saW5lVG8oeCwgeSk7CiAgICAgICAgICAgIGNvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGlmIChsaW5lQ29sb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY29udGV4dC5zdHJva2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmlsbENvbG9yKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LmZpbGwoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRYICE9PSB1bmRlZmluZWQgJiYgdGhpcy50YXJnZXRZICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICAgIGNvbnRleHQuaXNQb2ludEluUGF0aCh0aGlzLnRhcmdldFgsIHRoaXMudGFyZ2V0WSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRhcmdldFNoYXBlSWQgPSBzaGFwZWlkOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLy8gQ1VTVE9NIE1PRDogcmFkaXVzIGFkZGVkCiAgICAgICAgX2RyYXdSZWN0OiBmdW5jdGlvbiAoc2hhcGVpZCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCwgcmFkaXVzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kcmF3U2hhcGUoc2hhcGVpZCwgW1t4LCB5XSwgW3ggKyB3aWR0aCwgeV0sIFt4ICsgd2lkdGgsIHkgKyBoZWlnaHRdLCBbeCwgeSArIGhlaWdodF0sIFt4LCB5XV0sIGxpbmVDb2xvciwgZmlsbENvbG9yLCBudWxsLCByYWRpdXMpOwogICAgICAgIH0sCgogICAgICAgIGFwcGVuZFNoYXBlOiBmdW5jdGlvbiAoc2hhcGUpIHsKICAgICAgICAgICAgdGhpcy5zaGFwZXNbc2hhcGUuaWRdID0gc2hhcGU7CiAgICAgICAgICAgIHRoaXMuc2hhcGVzZXEucHVzaChzaGFwZS5pZCk7CiAgICAgICAgICAgIHRoaXMubGFzdFNoYXBlSWQgPSBzaGFwZS5pZDsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlLmlkOwogICAgICAgIH0sCgogICAgICAgIHJlcGxhY2VXaXRoU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkgewogICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLAogICAgICAgICAgICAgICAgaTsKICAgICAgICAgICAgdGhpcy5zaGFwZXNbc2hhcGUuaWRdID0gc2hhcGU7CiAgICAgICAgICAgIGZvciAoaSA9IHNoYXBlc2VxLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgaWYgKHNoYXBlc2VxW2ldID09IHNoYXBlaWQpIHsKICAgICAgICAgICAgICAgICAgICBzaGFwZXNlcVtpXSA9IHNoYXBlLmlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNoYXBlc1tzaGFwZWlkXTsKICAgICAgICB9LAoKICAgICAgICByZXBsYWNlV2l0aFNoYXBlczogZnVuY3Rpb24gKHNoYXBlaWRzLCBzaGFwZXMpIHsKICAgICAgICAgICAgdmFyIHNoYXBlc2VxID0gdGhpcy5zaGFwZXNlcSwKICAgICAgICAgICAgICAgIHNoYXBlbWFwID0ge30sCiAgICAgICAgICAgICAgICBzaWQsIGksIGZpcnN0OwoKICAgICAgICAgICAgZm9yIChpID0gc2hhcGVpZHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBzaGFwZW1hcFtzaGFwZWlkc1tpXV0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IHNoYXBlc2VxLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgc2lkID0gc2hhcGVzZXFbaV07CiAgICAgICAgICAgICAgICBpZiAoc2hhcGVtYXBbc2lkXSkgewogICAgICAgICAgICAgICAgICAgIHNoYXBlc2VxLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5zaGFwZXNbc2lkXTsKICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gc2hhcGVzLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgc2hhcGVzZXEuc3BsaWNlKGZpcnN0LCAwLCBzaGFwZXNbaV0uaWQpOwogICAgICAgICAgICAgICAgdGhpcy5zaGFwZXNbc2hhcGVzW2ldLmlkXSA9IHNoYXBlc1tpXTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAoKICAgICAgICBpbnNlcnRBZnRlclNoYXBlOiBmdW5jdGlvbiAoc2hhcGVpZCwgc2hhcGUpIHsKICAgICAgICAgICAgdmFyIHNoYXBlc2VxID0gdGhpcy5zaGFwZXNlcSwKICAgICAgICAgICAgICAgIGk7CiAgICAgICAgICAgIGZvciAoaSA9IHNoYXBlc2VxLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgaWYgKHNoYXBlc2VxW2ldID09PSBzaGFwZWlkKSB7CiAgICAgICAgICAgICAgICAgICAgc2hhcGVzZXEuc3BsaWNlKGkgKyAxLCAwLCBzaGFwZS5pZCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGFwZXNbc2hhcGUuaWRdID0gc2hhcGU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgcmVtb3ZlU2hhcGVJZDogZnVuY3Rpb24gKHNoYXBlaWQpIHsKICAgICAgICAgICAgdmFyIHNoYXBlc2VxID0gdGhpcy5zaGFwZXNlcSwKICAgICAgICAgICAgICAgIGk7CiAgICAgICAgICAgIGZvciAoaSA9IHNoYXBlc2VxLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgaWYgKHNoYXBlc2VxW2ldID09PSBzaGFwZWlkKSB7CiAgICAgICAgICAgICAgICAgICAgc2hhcGVzZXEuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNoYXBlc1tzaGFwZWlkXTsKICAgICAgICB9LAoKICAgICAgICBnZXRTaGFwZUF0OiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgdGhpcy50YXJnZXRYID0geCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICB0aGlzLnRhcmdldFkgPSB5ICogd2luZG93LmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRUYXJnZXRTaGFwZUlkOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLAogICAgICAgICAgICAgICAgc2hhcGVzID0gdGhpcy5zaGFwZXMsCiAgICAgICAgICAgICAgICBzaGFwZUNvdW50ID0gc2hhcGVzZXEubGVuZ3RoLAogICAgICAgICAgICAgICAgY29udGV4dCA9IHRoaXMuX2dldENvbnRleHQoKSwKICAgICAgICAgICAgICAgIHNoYXBlaWQsIHNoYXBlLCBpOwogICAgICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLnBpeGVsV2lkdGgsIHRoaXMucGl4ZWxIZWlnaHQpOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2hhcGVDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzaGFwZWlkID0gc2hhcGVzZXFbaV07CiAgICAgICAgICAgICAgICBzaGFwZSA9IHNoYXBlc1tzaGFwZWlkXTsKICAgICAgICAgICAgICAgIHRoaXNbJ19kcmF3JyArIHNoYXBlLnR5cGVdLmFwcGx5KHRoaXMsIHNoYXBlLmFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5pbnRlcmFjdCkgewogICAgICAgICAgICAgICAgLy8gbm90IGludGVyYWN0aXZlIHNvIG5vIG5lZWQgdG8ga2VlcCB0aGUgc2hhcGVzIGFycmF5CiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlcyA9IHt9OwogICAgICAgICAgICAgICAgdGhpcy5zaGFwZXNlcSA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CgoKICAgIFZDYW52YXNfdm1sID0gY3JlYXRlQ2xhc3MoVkNhbnZhc19iYXNlLCB7CiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHRhcmdldCkgewogICAgICAgICAgICB2YXIgZ3JvdXBlbDsKICAgICAgICAgICAgVkNhbnZhc192bWwuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpOwogICAgICAgICAgICBpZiAodGFyZ2V0WzBdKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXRbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5kYXRhKHRhcmdldCwgJ19qcXNfdmNhbnZhcycsIHRoaXMpOwogICAgICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgJCh0aGlzLmNhbnZhcykuY3NzKHsgZGlzcGxheTogJ2lubGluZS1ibG9jaycsIHBvc2l0aW9uOiAncmVsYXRpdmUnLCBvdmVyZmxvdzogJ2hpZGRlbicsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIG1hcmdpbjogJzBweCcsIHBhZGRpbmc6ICcwcHgnLCB2ZXJ0aWNhbEFsaWduOiAndG9wJ30pOwogICAgICAgICAgICB0aGlzLl9pbnNlcnQodGhpcy5jYW52YXMsIHRhcmdldCk7CiAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZVBpeGVsRGltcyh3aWR0aCwgaGVpZ2h0LCB0aGlzLmNhbnZhcyk7CiAgICAgICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5waXhlbFdpZHRoOwogICAgICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLnBpeGVsSGVpZ2h0OwogICAgICAgICAgICBncm91cGVsID0gJzx2Omdyb3VwIGNvb3Jkb3JpZ2luPSIwIDAiIGNvb3Jkc2l6ZT0iJyArIHRoaXMucGl4ZWxXaWR0aCArICcgJyArIHRoaXMucGl4ZWxIZWlnaHQgKyAnIicgKwogICAgICAgICAgICAgICAgICAgICcgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDonICsgdGhpcy5waXhlbFdpZHRoICsgJ3B4O2hlaWdodD0nICsgdGhpcy5waXhlbEhlaWdodCArICdweDsiPjwvdjpncm91cD4nOwogICAgICAgICAgICB0aGlzLmNhbnZhcy5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZUVuZCcsIGdyb3VwZWwpOwogICAgICAgICAgICB0aGlzLmdyb3VwID0gJCh0aGlzLmNhbnZhcykuY2hpbGRyZW4oKVswXTsKICAgICAgICAgICAgdGhpcy5yZW5kZXJlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnByZXJlbmRlciA9ICcnOwogICAgICAgIH0sCgogICAgICAgIF9kcmF3U2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBwYXRoLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoLCByYWRpdXMpIHsKICAgICAgICAgICAgdmFyIHZwYXRoID0gW10sCiAgICAgICAgICAgICAgICBpbml0aWFsLCBzdHJva2UsIGZpbGwsIGNsb3NlZCwgdmVsLCBwbGVuLCBpOwogICAgICAgICAgICBmb3IgKGkgPSAwLCBwbGVuID0gcGF0aC5sZW5ndGg7IGkgPCBwbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHZwYXRoW2ldID0gJycgKyAocGF0aFtpXVswXSkgKyAnLCcgKyAocGF0aFtpXVsxXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5pdGlhbCA9IHZwYXRoLnNwbGljZSgwLCAxKTsKICAgICAgICAgICAgbGluZVdpZHRoID0gbGluZVdpZHRoID09PSB1bmRlZmluZWQgPyAxIDogbGluZVdpZHRoOwogICAgICAgICAgICBzdHJva2UgPSBsaW5lQ29sb3IgPT09IHVuZGVmaW5lZCA/ICcgc3Ryb2tlZD0iZmFsc2UiICcgOiAnIHN0cm9rZVdlaWdodD0iJyArIGxpbmVXaWR0aCArICdweCIgc3Ryb2tlQ29sb3I9IicgKyBsaW5lQ29sb3IgKyAnIiAnOwogICAgICAgICAgICBmaWxsID0gZmlsbENvbG9yID09PSB1bmRlZmluZWQgPyAnIGZpbGxlZD0iZmFsc2UiJyA6ICcgZmlsbENvbG9yPSInICsgZmlsbENvbG9yICsgJyIgZmlsbGVkPSJ0cnVlIiAnOwogICAgICAgICAgICBjbG9zZWQgPSB2cGF0aFswXSA9PT0gdnBhdGhbdnBhdGgubGVuZ3RoIC0gMV0gPyAneCAnIDogJyc7CiAgICAgICAgICAgIHZlbCA9ICc8djpzaGFwZSBjb29yZG9yaWdpbj0iMCAwIiBjb29yZHNpemU9IicgKyB0aGlzLnBpeGVsV2lkdGggKyAnICcgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJyIgJyArCiAgICAgICAgICAgICAgICAgJyBpZD0ianFzc2hhcGUnICsgc2hhcGVpZCArICciICcgKwogICAgICAgICAgICAgICAgIHN0cm9rZSArCiAgICAgICAgICAgICAgICAgZmlsbCArCiAgICAgICAgICAgICAgICAnIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjBweDt0b3A6MHB4O2hlaWdodDonICsgdGhpcy5waXhlbEhlaWdodCArICdweDt3aWR0aDonICsgdGhpcy5waXhlbFdpZHRoICsgJ3B4O3BhZGRpbmc6MHB4O21hcmdpbjowcHg7IiAnICsKICAgICAgICAgICAgICAgICcgcGF0aD0ibSAnICsgaW5pdGlhbCArICcgbCAnICsgdnBhdGguam9pbignLCAnKSArICcgJyArIGNsb3NlZCArICdlIj4nICsKICAgICAgICAgICAgICAgICcgPC92OnNoYXBlPic7CiAgICAgICAgICAgIHJldHVybiB2ZWw7CiAgICAgICAgfSwKCiAgICAgICAgX2RyYXdDaXJjbGU6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCByYWRpdXMsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgpIHsKICAgICAgICAgICAgdmFyIHN0cm9rZSwgZmlsbCwgdmVsOwogICAgICAgICAgICB4IC09IHJhZGl1czsKICAgICAgICAgICAgeSAtPSByYWRpdXM7CiAgICAgICAgICAgIHN0cm9rZSA9IGxpbmVDb2xvciA9PT0gdW5kZWZpbmVkID8gJyBzdHJva2VkPSJmYWxzZSIgJyA6ICcgc3Ryb2tlV2VpZ2h0PSInICsgbGluZVdpZHRoICsgJ3B4IiBzdHJva2VDb2xvcj0iJyArIGxpbmVDb2xvciArICciICc7CiAgICAgICAgICAgIGZpbGwgPSBmaWxsQ29sb3IgPT09IHVuZGVmaW5lZCA/ICcgZmlsbGVkPSJmYWxzZSInIDogJyBmaWxsQ29sb3I9IicgKyBmaWxsQ29sb3IgKyAnIiBmaWxsZWQ9InRydWUiICc7CiAgICAgICAgICAgIHZlbCA9ICc8djpvdmFsICcgKwogICAgICAgICAgICAgICAgICcgaWQ9Impxc3NoYXBlJyArIHNoYXBlaWQgKyAnIiAnICsKICAgICAgICAgICAgICAgIHN0cm9rZSArCiAgICAgICAgICAgICAgICBmaWxsICsKICAgICAgICAgICAgICAgICcgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO3RvcDonICsgeSArICdweDsgbGVmdDonICsgeCArICdweDsgd2lkdGg6JyArIChyYWRpdXMgKiAyKSArICdweDsgaGVpZ2h0OicgKyAocmFkaXVzICogMikgKyAncHgiPjwvdjpvdmFsPic7CiAgICAgICAgICAgIHJldHVybiB2ZWw7CgogICAgICAgIH0sCgogICAgICAgIF9kcmF3UGllU2xpY2U6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBsaW5lQ29sb3IsIGZpbGxDb2xvcikgewogICAgICAgICAgICB2YXIgdnBhdGgsIHN0YXJ0eCwgc3RhcnR5LCBlbmR4LCBlbmR5LCBzdHJva2UsIGZpbGwsIHZlbDsKICAgICAgICAgICAgaWYgKHN0YXJ0QW5nbGUgPT09IGVuZEFuZ2xlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJyc7ICAvLyBWTUwgc2VlbXMgdG8gaGF2ZSBwcm9ibGVtIHdoZW4gc3RhcnQgYW5nbGUgZXF1YWxzIGVuZCBhbmdsZS4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGVuZEFuZ2xlIC0gc3RhcnRBbmdsZSkgPT09ICgyICogTWF0aC5QSSkpIHsKICAgICAgICAgICAgICAgIHN0YXJ0QW5nbGUgPSAwLjA7ICAvLyBWTUwgc2VlbXMgdG8gaGF2ZSBhIHByb2JsZW0gd2hlbiBkcmF3aW5nIGEgZnVsbCBjaXJjbGUgdGhhdCBkb2Vzbid0IHN0YXJ0IDAKICAgICAgICAgICAgICAgIGVuZEFuZ2xlID0gKDIgKiBNYXRoLlBJKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3RhcnR4ID0geCArIE1hdGgucm91bmQoTWF0aC5jb3Moc3RhcnRBbmdsZSkgKiByYWRpdXMpOwogICAgICAgICAgICBzdGFydHkgPSB5ICsgTWF0aC5yb3VuZChNYXRoLnNpbihzdGFydEFuZ2xlKSAqIHJhZGl1cyk7CiAgICAgICAgICAgIGVuZHggPSB4ICsgTWF0aC5yb3VuZChNYXRoLmNvcyhlbmRBbmdsZSkgKiByYWRpdXMpOwogICAgICAgICAgICBlbmR5ID0geSArIE1hdGgucm91bmQoTWF0aC5zaW4oZW5kQW5nbGUpICogcmFkaXVzKTsKCiAgICAgICAgICAgIGlmIChzdGFydHggPT09IGVuZHggJiYgc3RhcnR5ID09PSBlbmR5KSB7CiAgICAgICAgICAgICAgICBpZiAoKGVuZEFuZ2xlIC0gc3RhcnRBbmdsZSkgPCBNYXRoLlBJKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUHJldmVudCB2ZXJ5IHNtYWxsIHNsaWNlcyBmcm9tIGJlaW5nIG1pc3Rha2VuIGFzIGEgd2hvbGUgcGllCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gZXNzZW50aWFsbHkgZ29pbmcgdG8gYmUgdGhlIGVudGlyZSBjaXJjbGUsIHNvIGlnbm9yZSBzdGFydEFuZ2xlCiAgICAgICAgICAgICAgICBzdGFydHggPSBlbmR4ID0geCArIHJhZGl1czsKICAgICAgICAgICAgICAgIHN0YXJ0eSA9IGVuZHkgPSB5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3RhcnR4ID09PSBlbmR4ICYmIHN0YXJ0eSA9PT0gZW5keSAmJiAoZW5kQW5nbGUgLSBzdGFydEFuZ2xlKSA8IE1hdGguUEkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdnBhdGggPSBbeCAtIHJhZGl1cywgeSAtIHJhZGl1cywgeCArIHJhZGl1cywgeSArIHJhZGl1cywgc3RhcnR4LCBzdGFydHksIGVuZHgsIGVuZHldOwogICAgICAgICAgICBzdHJva2UgPSBsaW5lQ29sb3IgPT09IHVuZGVmaW5lZCA/ICcgc3Ryb2tlZD0iZmFsc2UiICcgOiAnIHN0cm9rZVdlaWdodD0iMXB4IiBzdHJva2VDb2xvcj0iJyArIGxpbmVDb2xvciArICciICc7CiAgICAgICAgICAgIGZpbGwgPSBmaWxsQ29sb3IgPT09IHVuZGVmaW5lZCA/ICcgZmlsbGVkPSJmYWxzZSInIDogJyBmaWxsQ29sb3I9IicgKyBmaWxsQ29sb3IgKyAnIiBmaWxsZWQ9InRydWUiICc7CiAgICAgICAgICAgIHZlbCA9ICc8djpzaGFwZSBjb29yZG9yaWdpbj0iMCAwIiBjb29yZHNpemU9IicgKyB0aGlzLnBpeGVsV2lkdGggKyAnICcgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJyIgJyArCiAgICAgICAgICAgICAgICAgJyBpZD0ianFzc2hhcGUnICsgc2hhcGVpZCArICciICcgKwogICAgICAgICAgICAgICAgIHN0cm9rZSArCiAgICAgICAgICAgICAgICAgZmlsbCArCiAgICAgICAgICAgICAgICAnIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjBweDt0b3A6MHB4O2hlaWdodDonICsgdGhpcy5waXhlbEhlaWdodCArICdweDt3aWR0aDonICsgdGhpcy5waXhlbFdpZHRoICsgJ3B4O3BhZGRpbmc6MHB4O21hcmdpbjowcHg7IiAnICsKICAgICAgICAgICAgICAgICcgcGF0aD0ibSAnICsgeCArICcsJyArIHkgKyAnIHdhICcgKyB2cGF0aC5qb2luKCcsICcpICsgJyB4IGUiPicgKwogICAgICAgICAgICAgICAgJyA8L3Y6c2hhcGU+JzsKICAgICAgICAgICAgcmV0dXJuIHZlbDsKICAgICAgICB9LAoKICAgICAgICBfZHJhd1JlY3Q6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoLCByYWRpdXMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RyYXdTaGFwZShzaGFwZWlkLCBbW3gsIHldLCBbeCwgeSArIGhlaWdodF0sIFt4ICsgd2lkdGgsIHkgKyBoZWlnaHRdLCBbeCArIHdpZHRoLCB5XSwgW3gsIHldXSwgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCwgcmFkaXVzKTsKICAgICAgICB9LAoKICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmdyb3VwLmlubmVySFRNTCA9ICcnOwogICAgICAgIH0sCgogICAgICAgIGFwcGVuZFNoYXBlOiBmdW5jdGlvbiAoc2hhcGUpIHsKICAgICAgICAgICAgdmFyIHZlbCA9IHRoaXNbJ19kcmF3JyArIHNoYXBlLnR5cGVdLmFwcGx5KHRoaXMsIHNoYXBlLmFyZ3MpOwogICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJlZCkgewogICAgICAgICAgICAgICAgdGhpcy5ncm91cC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZUVuZCcsIHZlbCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnByZXJlbmRlciArPSB2ZWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5sYXN0U2hhcGVJZCA9IHNoYXBlLmlkOwogICAgICAgICAgICByZXR1cm4gc2hhcGUuaWQ7CiAgICAgICAgfSwKCiAgICAgICAgcmVwbGFjZVdpdGhTaGFwZTogZnVuY3Rpb24gKHNoYXBlaWQsIHNoYXBlKSB7CiAgICAgICAgICAgIHZhciBleGlzdGluZyA9ICQoJyNqcXNzaGFwZScgKyBzaGFwZWlkKSwKICAgICAgICAgICAgICAgIHZlbCA9IHRoaXNbJ19kcmF3JyArIHNoYXBlLnR5cGVdLmFwcGx5KHRoaXMsIHNoYXBlLmFyZ3MpOwogICAgICAgICAgICBleGlzdGluZ1swXS5vdXRlckhUTUwgPSB2ZWw7CiAgICAgICAgfSwKCiAgICAgICAgcmVwbGFjZVdpdGhTaGFwZXM6IGZ1bmN0aW9uIChzaGFwZWlkcywgc2hhcGVzKSB7CiAgICAgICAgICAgIC8vIHJlcGxhY2UgdGhlIGZpcnN0IHNoYXBlaWQgd2l0aCBhbGwgdGhlIG5ldyBzaGFwZXMgdGhlbiB0b2FzdCB0aGUgcmVtYWluaW5nIG9sZCBzaGFwZXMKICAgICAgICAgICAgdmFyIGV4aXN0aW5nID0gJCgnI2pxc3NoYXBlJyArIHNoYXBlaWRzWzBdKSwKICAgICAgICAgICAgICAgIHJlcGxhY2UgPSAnJywKICAgICAgICAgICAgICAgIHNsZW4gPSBzaGFwZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgaTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVwbGFjZSArPSB0aGlzWydfZHJhdycgKyBzaGFwZXNbaV0udHlwZV0uYXBwbHkodGhpcywgc2hhcGVzW2ldLmFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4aXN0aW5nWzBdLm91dGVySFRNTCA9IHJlcGxhY2U7CiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBzaGFwZWlkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgJCgnI2pxc3NoYXBlJyArIHNoYXBlaWRzW2ldKS5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGluc2VydEFmdGVyU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkgewogICAgICAgICAgICB2YXIgZXhpc3RpbmcgPSAkKCcjanFzc2hhcGUnICsgc2hhcGVpZCksCiAgICAgICAgICAgICAgICAgdmVsID0gdGhpc1snX2RyYXcnICsgc2hhcGUudHlwZV0uYXBwbHkodGhpcywgc2hhcGUuYXJncyk7CiAgICAgICAgICAgIGV4aXN0aW5nWzBdLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJFbmQnLCB2ZWwpOwogICAgICAgIH0sCgogICAgICAgIHJlbW92ZVNoYXBlSWQ6IGZ1bmN0aW9uIChzaGFwZWlkKSB7CiAgICAgICAgICAgIHZhciBleGlzdGluZyA9ICQoJyNqcXNzaGFwZScgKyBzaGFwZWlkKTsKICAgICAgICAgICAgdGhpcy5ncm91cC5yZW1vdmVDaGlsZChleGlzdGluZ1swXSk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0U2hhcGVBdDogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIHZhciBzaGFwZWlkID0gZWwuaWQuc3Vic3RyKDgpOwogICAgICAgICAgICByZXR1cm4gc2hhcGVpZDsKICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLnJlbmRlcmVkKSB7CiAgICAgICAgICAgICAgICAvLyBiYXRjaCB0aGUgaW50aWFsIHJlbmRlciBpbnRvIGEgc2luZ2xlIHJlcGFpbnQKICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXAuaW5uZXJIVE1MID0gdGhpcy5wcmVyZW5kZXI7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwoKCn0pKTsKCn0oZG9jdW1lbnQsIE1hdGgpKTsK"></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKICBuYW1lOiAic3BhcmtsaW5lIiwKICB0eXBlOiAib3V0cHV0IiwKICBmYWN0b3J5OiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewogICAgCiAgICB2YXIgaW5zdGFuY2UgPSB7fTsKICAgIAogICAgcmV0dXJuIHsKCiAgICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgCiAgICAgICAgJChlbCkuZW1wdHkoKTsKCiAgICAgICAgLy8gaWYgcmVuZGVyVGFnIHByb3ZpZGVkIHRoZW4gd2Ugd2lsbCBkbyB0aHJlZSB0aGluZ3MKICAgICAgICAvLyAgIDEuICBzZXQgaGVpZ2h0IGFuZCB3aWR0aCB0byAwIGFuZCBkaXNwbGF5IG5vbmUKICAgICAgICAvLyAgIDIuICBzZXQgb3VyIGVsIHRvIHRoZSByZW5kZXIgdGFnIGlmIGF2YWlsYWJsZQogICAgICAgIC8vICAgMy4gIHNldCBoZWlnaHQgYW5kIHdpZHRoIG9wdGlvbnMgdG8gbnVsbAogICAgICAgIGlmKGRhdGEucmVuZGVyU2VsZWN0b3IgJiYgJChkYXRhLnJlbmRlclNlbGVjdG9yKS5sZW5ndGgpewogICAgICAgICAgJChlbCkuY3NzKHsKICAgICAgICAgICAgJ2hlaWdodCc6ICcwJywKICAgICAgICAgICAgJ3dpZHRoJzogJzAnLAogICAgICAgICAgICAnZGlzcGxheSc6ICdub25lJwogICAgICAgICAgfSk7CiAgICAgICAgICBlbCA9IGRhdGEucmVuZGVyU2VsZWN0b3I7CiAgICAgICAgICAvLyBzZXQgaGVpZ2h0IGFuZCB3aWR0aCB0byBudWxsCiAgICAgICAgICAvLyAgIHRoaXMgbWlnaHQgYmUgY29uZnVzaW5nIGFuZCBuZWVkIHRvIGJlIHJldmVydGVkCiAgICAgICAgICBkYXRhLm9wdGlvbnMuaGVpZ2h0ID0gbnVsbDsKICAgICAgICAgIGRhdGEub3B0aW9ucy53aWR0aCA9IG51bGw7CiAgICAgICAgfQogICAgICAgICQoZWwpLnNwYXJrbGluZShkYXRhLnZhbHVlcywgZGF0YS5vcHRpb25zKTsKICAgICAgICAKICAgICAgICAvLyBleHBlcmltZW50YWwgYWRkQ29tcG9zaXRlIGZ1bmN0aW9uIGluIFIKICAgICAgICAvLyAgIHdpbGwgYWRkIGNvbXBvc2l0ZXMgdG8gZGF0YS5jb21wb3NpdGVzCiAgICAgICAgaWYoZGF0YS5jb21wb3NpdGVzKSB7CiAgICAgICAgICBpZighQXJyYXkuaXNBcnJheShkYXRhLmNvbXBvc2l0ZXMpKSB7CiAgICAgICAgICAgIGRhdGEuY29tcG9zaXRlcyA9IFtkYXRhLmNvbXBvc2l0ZXNdOwogICAgICAgICAgfQogICAgICAgICAgZGF0YS5jb21wb3NpdGVzLm1hcCggZnVuY3Rpb24oc3BrKSB7CiAgICAgICAgICAgICQoZWwpLnNwYXJrbGluZShzcGsudmFsdWVzLHNway5vcHRpb25zKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpbnN0YW5jZS5kYXRhID0gZGF0YTsKICAgICAgfSwKCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewoKICAgICAgICAvLyBub3Qgc3VyZSB3aGF0IHRvIGRvIGluIHRoZSBldmVudCBvZiByZXNpemUKICAgICAgICAvLyAgSSB0aGluayBub3RoaW5nIGZvciBub3cKICAgICAgICAvLyAgYnV0IHdpbGwgbmVlZCB0byBnZXQgYSBmZWVsIGZvciB1c2UgY2FzZXMKICAgICAgICAvLyAgd2hlcmUgdGhpcyBpcyBpbXBvcnRhbnQgc3VjaCBhcyBzbGlkZXMsIGZsZXhkYXNoYm9hcmQsIHRhYnNldAogICAgICAgIHRoaXMucmVuZGVyVmFsdWUoaW5zdGFuY2UuZGF0YSk7CgogICAgICB9CgogICAgfTsKICB9ICAKfSk7Cg=="></script>

</head>
<body style="background-color:white;">
<div id="htmlwidget_container">
  <span id="htmlwidget-45ca7ad6c5474a437207" class="sparkline html-widget"></span>
</div>
<script type="application/json" data-for="htmlwidget-45ca7ad6c5474a437207">{"x":{"values":[1.15472856274725,0.87598546436608,1.65830295438383,-0.801995985902198,0.33944561938062,-0.55777193428085,-0.191864372350669,-2.65196325681416,1.76121282564176,-0.960747120643699,-1.49043817546289,0.814760311336672,0.326168512959672,1.13163507795944,1.24596005650766,-1.36761839632512,-0.0356022229988092,-0.643642520771034,-0.90523871097792,0.665297479003847],"options":{"height":20,"width":60},"width":60,"height":20},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-45ca7ad6c5474a437207">{"viewer":{"width":60,"height":20,"padding":15,"fill":false},"browser":{"width":60,"height":20,"padding":40,"fill":false}}</script>
</body>
</html>
